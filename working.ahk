#MaxMem 4095
#NoEnv
#SingleInstance Force
SetWorkingDir,%A_ScriptDir%
S_KeyDir= %A_ScriptDir%
Process, Exist,
CURPID= %ERRORLEVEL%	
SetWinDelay,2
CoordMode,Mouse 
;;;;;;;;;;;;;;;;;;             SKELETONKEY            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;   by romjacket 2018  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;    [VERSION]  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GLBTOP:
RELEASE= [VERSION]
VERSION= [CURV]
#Include src\tf.ahk
#Include src\lbex.ahk
#Include src\LVA.ahk
#Include src\gets.ahk
#Include src\sets.ahk
#Include src\HtmlDlg.ahk
#Include src\AHKsock.ahk
/*  ;;[DEBUGOV]
#Include src\LV_InCellEdit.ahk
*/  ;;[DEBUGOV]
DetectHiddenWindows, On
IniRead,iniversion,Settings.ini,GLOBAL,version
stringreplace,iniversion,iniversion,",,All
;"
if (iniversion <> VERSION)
	{
		#Include sets\ExeRec.set
		TrayTip,Skeletonkey,Initializing,,48
		ifexist,Settings.ini
			{
				iniwrite,"%version%",Settings.ini,GLOBAL,version
			}
	}
ARCORG= arcorg.ini
ifnotexist,%ARCORG%
	{
		fileCopy,sets\arcorg.set,arcorg.ini
	}
IniRead,BLDBOT,%ARCORG%,GLOBAL,BLDBOT
IniRead,HOSTINGURL,%ARCORG%,GLOBAL,HOSTINGURL
IniRead,DATHUB,%ARCORG%,GLOBAL,DATHUB
tmpcvpth:
SetWorkingDir %A_ScriptDir%
S_KeyDir= %A_ScriptDir%
Loop %0%
	{
		DDRUN= 1
		directrun= 1
		ShortPathName := %A_Index%
		Loop %ShortPathName%
			{
				LongName = %A_LoopFileLongPath%
			}
		if (!instr(LongName,":")&& !instr(LongName,"="))
			{
				DDRUN=
				directrun=
			}
	}
romf= %LongName%
getport= %1%
getpath= %2%
fief=
OVRLKUPNM= OBSERVED_VOID
ifinstring,getport,-run=
	{
		stringsplit,fief,getport,=
		OVRLKUPNM:= fief2
		romf= %getpath%
	}
ifinstring,getport,-initialize
	{
		ifinstring,getport,!q
			{
				goto, initall
			}
		msgbox,3,Confirm,You are about to initialize skeletonKey.`nAre you sure?
		ifmsgbox,Yes
			{
				goto, initall
			}
		goto, QUITOUT
	}
ifinstring,getport,-clear
	{
		stringsplit,getpartp,getport,!
		stringreplace,getporv,getport,-,,All
		if (getpartp1 <> getport)
			{
				stringreplace,getpartp1,getpartp1,-,,All
				getporv= %getpartp1%
			}
		stringtrimleft,getporq,getporv,6
		ifinstring,getport,!q
			{
				goto, %getporv%
			}
		msgbox,3,Confirm,You are about to initialize %getporq%.`nAre you sure?
		ifmsgbox,Yes
			{
				goto, %getporv%
			}
		goto, QUITOUT
	}
if (getport = "_DEV_")	
	{
		VERSION= [CURV]
	}
INITRESTART:
iniread,fiin,Assignments.ini,ASSIGNMENTS,%OVRLKUPNM%
if (fiin <> "ERROR")
	{
		RUNCOREOVERRIDE= %OVRLKUPNM%
	}
if (RUNCOREOVERRIDE <> "")
	{
		APLN= 1
		coreselv:= RUNCOREOVERRIDE
	}
if (getport = "portable")
	{
		if (getpath = "")
			{
				exitapp
			}
		SETPORTABLE= 1
		goto, makePortable
		exitapp
	}
DragonDrop:
if (romf <> "")
	{
		FileGetSize,romsz,%romf%,K
		IniRead,raexe,Apps.ini,EMULATORS,retroarch
		splitpath,raexe,,raexeloc
		IniRead,autoExec,Settings.ini,GLOBAL,auto_exec
		splitpath,raexeloc,RaExeFile,raexedir
		if (raexefile <> "")
			{
				curcfg= %raexedir%\retroarch.cfg
				libretroDirectory= %raexedir%\cores
				gameoverdcfg= 
				Loop, %libretroDirectory%\*_libretro.dll
						{
							corelist.= A_LoopFileName . "|"
						}
			}
		splitpath,romf,romtitle,rompth,inputext,romname,inputdrv
		if (RUNCOREOVERRIDE = "")
			{
				gosub, extensionlookup
			}
		if (CHOSEN = "")
			{
				guicontrol,,LCORE,%coreselv%|
				gosub,SUBLNCH
			}
		CHOSEN=
		return
	}
EnvGet, CHKPYTH,PATH
Envget,CURSRPTH,USERPROFILE
Envget,app_data,APPDATA
GenSetQ:
ifnotexist, Settings.ini
	{
		INITIAL:= 1
		SplashImage = site\key.png
		SplashImageGUI(SplashImage, "Center", 100, true)
	}
romf= %1%
;;;;;;;;;;;;;;;;;;;;;      GENERATE SETTINGS    ;;;;;;;;;;;;;;;;;;;;;;;;
for obj in ComObjGet("winmgmts:\\.\root\cimv2").ExecQuery("SELECT OSArchitecture FROM Win32_OperatingSystem")
artmp :=(obj.OSArchitecture)
stringsplit, arpt, artmp, -
ARCH= %arpt1%
if (ARCH <> 64)
	{
		if (A_Is64bitOS	= 0)
			{
				ARCH= 32
			}
			else {
				ARCH= 64
			}
		}
OSVRZ1=
OSVRZ2=
OSVRZ3=
stringsplit, OSVRZ, A_OSVersion,.,
OSVRZ:= "Win" . OSVRZ1 . "." . OSVRZ2 . "x" . ARCH
formattime, date, YYYY_MM_DD, yyyy-MM-dd
RAUPDT= UPDATE
ARCHR=
if (ARCH = 64)
	{
		ARCHR= _64
	}
if (OSVRZ1 >= 7)
	{
		vdskwin= Windows|
	}
SysGet, MonitorWorkArea, MonitorWorkArea, 1
WGET= %S_KeyDir%\bin\wget.exe
ARIA= %S_KeyDir%\bin\aria2c.exe
ifNotExist, Settings.ini
	{
		gosub, CreateConfig
	}
ifNotExist, Settings.ini
	{
		ExitApp
	}	
IfNotExist, Assignments.ini
	{
		FileCopy,sets\Assignments.set,Assignments.ini
	}
IfNotExist, AppParams.ini
	{
		FileCopy,sets\AppParams.set,AppParams.ini
	}
ifnotexist,lkup.ini
	{
		Filecopy,sets\LkUp.set,lkup.ini
	}	
IfNotExist, emuCfgPresets.ini
	{
		FileRead,emuCfgPresets,sets\emuCfgPresets.set
		stringreplace,emucfgpresets,emucfgpresets,[ARCH],%ARCH%,All
		stringreplace,emucfgpresets,emucfgpresets,[BUILDBOT],%BLDBOT%,All
		fileappend,%emucfgpresets%,EmuCfgPresets.ini
	}
IfNotExist, launchparams.ini
	{
		FileCopy,sets\launchparams.set,launchparams.ini
	}
IfNotExist,mediafe.ini
	{
		FileCopy,sets\mediafe.set,mediafe.ini
	}
ifnotexist,datlist.ini
	{
		gosub,getDATLIST
	}
	else {
		alldats= ALL TOSEC|ALL REDUMP|ALL NO-INTRO||ALL MAME|
		Fileread,datfile,datlist.ini
		Loop,parse,datfile,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				ebi2= 	
				stringsplit,ebi,A_LoopField,=,"
				;"
				if (ebi2 <> "")
					{
						alldats.= ebi2 . "|"
					}
			}
		stringreplace,alldats,alldats,dats\,,all	
	}	
fileread,oldlkup,sets\lkup.set	
RJQNUM:= 0
Loop, rj\*_q.tdb
	{
		RJQNUM+=1
		SplitPath,A_LoopFileName,,,,dbqv
		StringTrimRight,dbqueue,dbqv,2
		SYSTMQ.= dbqueue . "|"
	}
IniRead,RJSYSTEMS,Settings.ini,GLOBAL,systems_directory
if (RJSYSTEMS = "")
	{
		alii= 1
		gosub, SETJKD
	}
ifnotexist,SystemLocations.ini
	{
		filecopy,sets\SystemLocations.set,SystemLocations.ini,1
		JUNCTOPT= 2
		FileRead,SysLLst,lkup.ini
		gosub, SYSDETECT
	}
IniRead,RJEMUD,Settings.ini,GLOBAL,emulators_directory
if (RJEMUD = "")
	{
		gosub, SETEMUD
	}
Iniread,raexeloc,apps.ini,EMULATORS,retroarch
if ((raexeloc <> "ERROR")&&(raexeloc <> ""))
	{
		splitpath,raexeloc,RaExeFile,raexedir
		splitpath,raexeloc,RaExeFile,raexedir
		If (raexedir = "")
			{
			}
			else {
				gosub resetCORES
			}
	}
IniRead,playlistloctmp,Settings.ini,GLOBAL,playlist_location
If (playlistloctmp <> "ERROR")
	{
		playlistloc= %playlistloctmp%
		ifnotexist, %playlistloctmp%
			{
				playlistloctmp= ERROR
				ifexist,%raexedir%\playlists\
					{
						playlistloctmp= %raexedir%\playlists
						playlistloc= %playlistloctmp%
					}
			}
		gosub, resetPlaylists	
	}
If (playlistloctmp = "ERROR")
	{
		gosub, NOFNDPL
	}
IniRead,historyloctmp,Settings.ini,GLOBAL,history_location
If (historyloctmp <> "ERROR")
	{
		historyloc= %historyloctmp%
		ifnotexist, %historyloctmp%
			{
				;;FileAppend,{`n%pspce%"version": "1.0"`,`n%pspce%"items": [`n%pspxe%{`n%pspce%"path": ""`,`n%pspce%"label": ""`,`n%pspce%"core_path": ""`,`n%pspce%"core_name": ""`,`n%pspce%"crc32": ""`,`n%pspce%"db_name": ""`n%pspxe%}`n%A_Space%%A_Space%]`n}`n,*%historyloctmp%
			}
	}
If (historyloctmp = "ERROR")
	{
		gosub, NoHistoryFile
	}
IniRead,DYNTRANS,Settings.ini,GLOBAL,Dynamic_Transparency
DYNTRANSCHK=
if (DYNTRANS = 1)
	{
		DYNTRANSCHK= Checked
	}
IniRead,HISAPND,Settings.ini,GLOBAL,history_append
if (HISAPND = 1)
	{
		HISAPNDCHK= Checked
	}
IniRead,CMIRLOC,Settings.ini,GLOBAL,Mirror_Links
if ((CMIRLOC = "ERROR")or !fileexist(CMIRLOC))
	{
		CMIRLOC=  %S_KeyDir%\mirrors
		iniwrite,"%CMIRLOC%",Settings.ini,GLOBAL,Mirror_Links
	}
IniRead,CICOLOC,Settings.ini,GLOBAL,Mirror_Icons
if ((CICOLOC = "ERROR")or !fileexist(CICOLOC))
	{
		CICOLOC=  %S_KeyDir%\icons
		iniwrite,"%CICOLOC%",Settings.ini,GLOBAL,Mirror_Icons
	}
Random,portbg,20000,60000
portbe:= portbg+7
METRANGE= %portbg%-%portbe%
iniwrite,%METRANGE%,Settings.ini,GLOBAL,dht_listen_port
Random,tornbg,20000,60000
tornbe:= tornbg+7
TORRANGE= %tornbg%-%tornbe%
iniwrite,%TORRANGE%,Settings.ini,GLOBAL,tcp_listen_port
IniRead, lastcore, Settings.ini,GLOBAL,last_core
splitpath, lastcore, coreselv,,,
IniRead, romf, Settings.ini,GLOBAL,last_rom
IniRead,ARCSRC,Settings.ini,GLOBAL,RemoteRepository
INIREAD,cloudloc,%ARCORG%,GLOBAL,CLOUDLOC
iniread,FILT_UNSUP,Settings.ini,GLOBAL,global_filter
if (FILT_UNSUP = "ERROR")
	{
		FILT_UNSUP= 0
	}
filtmrk= checked
if (FILT_UNSUP = 0)
		{
			filtmrk=
		}		
if ((ARCSRC = "ERROR")or(ARCSRC = ""))
	{
		iniwrite, "", Settings.ini,GLOBAL,RemoteRepository
		ArcSiteN= ""
	}
IniRead,ArcPRep,%ARCORG%,REPOSITORIES,
Loop,Parse,ArcPRep,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,air,A_LoopField,=,"
		;"
		stringreplace,air2,air2,`%ARCHR`%,%ARCHR%,All
		%air1%= %air2%
	}
IniRead,ArcSRCv,%ARCORG%,SOURCES,
srcfnd=
Loop,Parse,ArcSRCv,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		srcfnd+=1	
		stringsplit,SRCx,A_LoopField,:=,"
		;"
		if (srcfnd = 1)
			{
				ARCSRCb= %SRCx1%
			}
		ifnotinstring,ARCSRCS,%SRCx1%
			{
				ARCSRCS.= SRCx1 . "|"
			}
	}
Loop,gam\*,2
	{
		ifinstring,ARCSRCS,%A_LoopFileName%
			{
				continue
			}
		if (A_Index = 1)
			{
				ARCSRCb= %A_LoopFileName%
			}
		ARCSRCS.= A_LoopFileName . "|"
	}
iniread,ARCSRCv,Settings.ini,GLOBAL,RemoteRepository	
if ((ARCSRCv = "") or (arcsrcv = "ERROR"))
	{
		ARCSRC= %ARCSRCb%
	}
	else {
		ARCSRC= %ARCSRCv%
	}
sort,ARCSRCS	
GAMSRCS= gam\%ARCSRC%
LNCHPRIO= Checked
IniRead, LNCHPT,Settings.ini,GLOBAL,Launcher_Priority
if (LNCHPT <> 1)
	{
		LNCHPRIO=
		LNCHPT= 0
	}
iniread,EULA,Settings.ini,Global,%arcSRC%_EULA
stringreplace,urlsv,arcSRC,',,All
stringreplace,urlsv,urlsv,.,,All
stringreplace,urlsv,urlsv,&,,All
stringreplace,urlsv,urlsv,`%,,All
stringreplace,urlsv,urlsv,-,,All
stringreplace,urlsv,urlsv,`,,,All
stringreplace,urlsv,urlsv,~,,All
stringreplace,urlsv,urlsv,%A_Space%,,All
%urlsv%_EULA= %EULA%
EULAOPT= disabled
if (EULA = 1)
	{
		EULAOPT= 
		AUTOBBUT= show
	}
AUTOPGSIO=
IniRead, AUTOPGS,Settings.ini,GLOBAL,AutoLoad_PerGameSettings
if (AUTOPGS <> 0)
	{
		AUTOPGSIO= Checked
		AUTOPGS= 1
	}
ifNotExist, sys.ini
	{
		gosub, resetSYS
	}
ifNotExist, msys.ini
	{
		gosub, resetSYS
	}
if (INITIAL = 1)
	{
		SplashTextOn, ,skeletonKey,Creating Configuration
	}
if (INITIAL = 1)
	{
		SplashTextOn, ,skeletonKey,Creating Configuration
	}
ARC_USER= Login Not Set
ARCURLCK= disabled
IniRead,ARC_USERt,Settings.ini,GLOBAL,archive_login
if ((ARC_USERt <> "ERROR")&&(ARC_USERt <> ""))
	{
		ARC_USER= %ARC_USERt%
		ARCURLE= checked
		ARCURLCK=
	}
ARC_PASS= *****
IniRead,ARC_PASSt,Settings.ini,GLOBAL,archive_password
if ((ARC_USERt <> "ERROR")&&(ARC_PASSt <> ""))
	{
		ARC_PASS= %ARC_PASSt%
		ARCPSVD= checked
	}
if (INITIAL = 1)
	{
		ARC_USER= Login Not Set
		ARC_PASS= *****
	}
if (INITIAL = 1)
	{
		SplashTextOn, ,skeletonKey,Creating Configuration
	}
iniread,origasi,sets\Assignments.set,ASSIGNMENTS,
iniread,origsys,sets\Assignments.set,OVERRIDES,
iniread,sysposb,sets\emucfgpresets.set,PLAYLISTS,sysposb
iniRead, UTLPartSet,sets\EmuParts.set,UTILITIES
stringreplace,UTLPartSet,UTLPartSet,[ARCH],%ARCH%,All
iniRead, KMPPartSet,sets\EmuParts.set,KEYMAPPERS
stringreplace,KMPPartSet,kmppartset,[ARCH],%ARCH%,All
iniRead, FEPartSet,sets\EmuParts.set,FRONTENDS
stringreplace,FEPartSet,FEPartSet,[ARCH],%ARCH%,All
iniread,PrgLst,sets\EmuCfgPresets.set,Programs
iniRead, EmuPartSet,sets\EmuParts.set,EMULATORS
stringreplace,EmuPartSet,EmuPartSet,[ARCH],%ARCH%,All
stringreplace,EmuPartSet,EmuPartSet,[BUILDBOT],%BLDBOT%,All
IniRead,repoloc,Settings.ini,GLOBAL,Emulator_Repository
iniread,RASTABLE,%ARCORG%,GLOBAL,RASTABLE
FileRead, RepoLst,RepoList.ini
stringreplace, RepoLst,RepoLst,`n,|,All
FileRead,ArcOrgSet,%ARCORG%
FileRead,syssize,sets\size.set
FileRead,corslk,sets\corelk.set
FileRead,BiosFSet,sets\Bios.set
FileRead,fuzsys,sets\fuzsyslk.set
FileRead,SysLLst,lkup.ini
AllPartSet:= KMPPARTSET . "`n" . UTLPARTSET . "`n" . FEPARTSET . "`n" . EMUPARTSET
gosub, RBLDRUNLST
if (repoloc = "ERROR")
	{
		IniRead,repoloc,%ARCORG%,GLOBAL,HOSTINGURL
	}

if (INITIAL = 1)
	{
		SplashTextOn, ,skeletonKey,Creating Configuration
	}
emuinstpop=
Loop, Parse, EmuPartSet,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		StringSplit,sysplix,A_LoopField,<,:
		emupos .= (A_Index == 1 ? "" : "|") . sysplix1
		stringsplit,kvar,A_LoopField,<
		emuinstpop.= kvar1 . "|"
	}
sort,emuinstpop,D|
Loop,parse,FEPartSet,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		StringSplit,feplix,A_LoopField,<,:
		fepos .= (A_Index == 1 ? "" : "|") . feplix1
		stringsplit,kvar,A_LoopField,<	
		frntdlst.= kvar1 . "|"	
	}
iniread,alra,Settings.ini,GLOBAL,%ARCSRCv%_EULA
if (alra = 1)
	{
		ifnotexist,sys.ini
			{
				gosub,resetSYS
			}
		Loop,Read,sys.ini
			{
				syslist.= (A_Index == 1 ? "" : "|") . A_LoopReadLine
			}
		Loop,Read,hacksyst.ini
			{
				hacksyst .= (A_Index == 1 ? "" : "|") . A_LoopReadLine
			}
		Loop,Read,msys.ini
			{
				msyslist.= (A_Index == 1 ? "" : "|") . A_LoopReadLine
			}
	}
appcfg= AppParams.ini
IfNotExist, AppParams.ini
	{
		appcfg= AppParams.set
	}
iniread,sysemucfg,%appCfg%,
preEmuCfg=
Loop,Parse,sysemucfg,|`n`r
{
	if (A_LoopField = "")
		{
			continue
		}
	preEmuCfg .= A_LoopField . "|"
}
IniRead,asig,Assignments.ini,ASSIGNMENTS,
Loop,Parse,asig,`n
	{
		StringSplit,rasig,A_LoopField,=
		if rasig1 is not digit
			{
				reasign .= rasig1 . "|"
			}
	}
MsysRst:
mame_sys=
fileread,emucfgpr,emuCfgPresets.ini
iniread,pnvf,emuCfgPresets.ini
systrt=
Loop,parse,pnvf,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = "END_EMU")
			{
				systrt= 1
			}
		if (systrt = "")
			{
				continue
			}
		nwsys= %A_LoopField%
		ecfsysn= %A_LoopField%
		iniread,bbvr,emuCfgPresets.ini,%nwsys%,RJMAMENM
		mamad= 
		sysfnd= 
		Loop, Parse, msyslist,|
			{
				einv= %A_LoopField%
				ifnotinstring,mame_sysk,%einv%|
					{
						mame_sysk.= einv . "|"
					}
				if (bbvr = einv)
					{
						MAME_%bbvr%= %einv%
						mame_syst.= ecfsysn . "|"
						rev_%bbvr%= %ecfsysn%
						mamesplit.= einv . "|" . ecfsysn . "`n"
						mamad= 1
						break
					}
			}
	}
afep= |
Loop, Parse, mamesplit,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,ji,A_LoopField,|
		afep.= ji2 . "|"
		Loop,parse,mame_sysk,|
			{
				if (A_LoopField = ji1)
					{
						mame_sys.= ji2 . "|"
						stringreplace,mame_sysk,mame_sysk,%ji1%|,,
						break
					}
			}
	}
mame_sys.= mame_sysk
sort,mame_sys, Alphabetically D|

if (INITIAL = 1)
	{
		gosub, DestroySplashGUI
	}
iniread,forecolor,Settings.ini,THEME,foreground
if ((forecolor = "")or(forecolor = "ERROR"))
	{
		forecolor= Default
		iniwrite,%A_Space%,Settings.ini,THEME,foreground
	}
iniread,bgcolor,Settings.ini,THEME,background
if ((bgcolor = "")or(bgcolor = "ERROR"))
	{
		bgcolor= Default
		iniwrite,%A_Space%,Settings.ini,THEME,background
	}
iniread,skthemen,Settings.ini,THEME,theme_name
if ((skthemen = "")or(skthemen = "ERROR"))
	{
		skthemen= Default
		iniwrite,%A_Space%,Settings.ini,THEME,theme_name
	}
iniread,fontColor,Settings.ini,THEME,font_color
if ((fontColor = "")or(fontColor = "ERROR"))
	{
		fontColor= Default
		iniwrite,%A_Space%,Settings.ini,THEME,font_color
	}
iniread,fontName,Settings.ini,THEME,font_name
if ((fontName = "")or(fontName = "ERROR"))
	{
		fontName=
		iniwrite,%A_Space%,Settings.ini,THEME,font_name
	}
iniread,fontXlg,Settings.ini,THEME,font_large
if ((fontXlg = "")or(fontXlg = "ERROR"))
	{
		fontXlg= s11
		iniwrite,%fontXlg%,Settings.ini,THEME,font_large
	}
iniread,fontXmed,Settings.ini,THEME,font_medium
iniread,fontXmed,Settings.ini,THEME,font_medium
if ((fontXmed = "")or(fontXmed = "ERROR"))
	{
		fontXmed= s9
		iniwrite,%fontXmed%,Settings.ini,THEME,font_medium
	}
iniread,fontXsm,Settings.ini,THEME,font_small
if ((fontXsm = "")or(fontXsm = "ERROR"))
	{
		fontXsm= s7
		iniwrite,%fontXsm%,Settings.ini,THEME,font_small
	}
if (INITIAL = "")
	{
		gosub, DestroySplashGUI
		SplashImage = img\splash.png
		SplashImageGUI(SplashImage, "Center", "Center", true)
		;;Progress, ZX0 ZY0 B w300 CB808080 CWFFFFFF CT808080  WS900 FS11,.Loading skeletonKey.,,skelprg,BebasNeue
		WinSet, TransColor, White,skelprg
		WinSet, AlwaysOnTop
		WinGetPos,,, Width, Height, skelprg
		WinMove, skelprg,, (A_ScreenWidth/2)-(Width/2), (A_ScreenHeight/2)-(Height/2)-70
	}	
;;;;;;;;;;;;;;;;;;;;    LOCATIONS    ;;;;;;;;;;;;;;;;;
ifNotExist, hashdb.ini
	{
		gosub, PlaylistInit
	}
iniread,LOGGING,Settings.ini,GLOBAL,Logging
logenable= checked
if ((LOGGING = "")or(LOGGING = "ERROR"))
	{
		logenable=
	}
iniread,cacheloc,Settings.ini,GLOBAL,temp_location
if (cacheloc = "ERROR")
		{
			iniread, cachedirectory,%curcfg%,OPTIONS,cache_directory
			cacheloc= %cachedirectory%
			iniWrite, "%cacheloc%",Settings.ini,GLOBAL,temp_location
		}
ifnotexist,%cacheloc%
	{
		cacheloc= %A_Temp%
		iniWrite, "%cacheloc%",Settings.ini,GLOBAL,temp_location
	}
IfExist,apps.ini
	{
		iniread,keympr,Settings.ini,GLOBAL,Keymapper
		if (keympr <> "ERROR")
			{
				if (keympr = "Antimicro")
					{
						IniRead,amicropth,apps.ini,KEYMAPPERS,%keympr%
						kmprxtn= .amgp
					}
				if (keympr = "Xpadder")
					{
						IniRead,xpaddrpth,apps.ini,KEYMAPPERS,%keympr%
						kmprxtn= .xpadderprofile
					}
				iniread,kmprloc,apps.ini,KEYMAPPERS,%keympr%
				if (kmprloc <> 0)
					{
						SplitPath,kmprloc,,kmprd
					}
			}
		Loop,parse,fesup,|
			{
				iniread,fealn,apps.ini,FRONTENDS,%A_LoopField%
				if ((fealn <> "")&&(fealn <> "ERROR"))
					{
						Menu, rjscopy, Add, Export to %A_LoopField%, Export_%A_LoopField%
						fSYSINSTLBX.= A_LoopField . "|"
					}
			}	
		DAMVAR=
		XPDK=
		AMCK=
		IniRead,DAMVAR,apps.ini,UTILITIES,Daemon_Tools
		if (DAMVAR = "ERROR")
			{
				DAMVAR=
			}
		IniRead,DCHANGER,apps.ini,UTILITIES,DisplayChanger
		if (DCHANGER = "ERROR")
			{
				DCHANGER=
			}
		IniRead,XPDK,apps.ini,KEYMAPPERS,Xpadder
		if (XPDK = "ERROR")
			{
				XPDK=
			}
		IniRead,AMCK,apps.ini,KEYMAPPERS,Antimicro
		if (AMCK = "ERROR")
			{
				AMCK=
			}
		if (keympr = "ERROR")
			{
				if (AMCK <> "")
					{
						keympr= Antimicro
					}
				if (keympr = "ERROR")
					{
						if (XPDK <> "")
							{
								keympr= Xpadder
							}
					}
				if (keympr = "ERROR")
					{
						keympr= Antimicro
					}
			}
		IniRead,emultl,apps.ini,EMULATORS
		emulist=
		emunumtot:= 0
		Loop, Parse, emultl,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				emunumtot+=1
				emulti1=
				emulti2=
				StringSplit,emulti,A_LoopField,=
				emulist.= emulti1 . "|"
			}
	}
IniRead,RJSYSTMP,Settings.ini,GLOBAL,systems_directory
if (RJSYSTMP = "ERROR")
	{
		RJSYSTMP=
	}
systmfldrs=
knownfldrs=
initfldrs=
if (RJSYSTMP <> "")
	{
		totsys=
		Loop, %RJSYSTMP%\*,2
			{
				allsys+=1
				sysnam= %A_LoopFileName%
				systmfldrs.= A_LoopFileName . "|"
				Loop, Parse, SyslLst,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						sdspl1=
						sdspl2=
						stringsplit,sdspl,A_LoopField,=,"
						;"
						if (sdspl1 = sysnam)
							{
								totsys+=1
								knownfldrs.= sysnam . "|"
								break
							}
					}
			}
		IniRead,suvai,SystemLocations.ini,LOCATIONS
		Loop,parse,suvai,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,aei,A_LoopField,=,""
				if (aei2 <> "")
					{
						ifnotinstring,knownfldrs,%aei1%|
							{
								totsys+= 1
								systmfldrs.= aei1 . "|"
								knownfldrs.= aei1 . "|"
							}
					}
			}
	}
if (FILT_UNSUP = 1)
	{
		initfldrs= %knownfldrs%
	}
	else {
		initfldrs= %systmfldrs%
	}
IniRead,RJEMUD,Settings.ini,GLOBAL,emulators_directory
if (RJEMUD = "ERROR")
	{
		RJEMUD= %S_KeyDir%\app
	}
if (RJEMUD = "")
	{
		RJEMUD= %S_KeyDir%\app
	}
iniread,bsltmp,apps.ini,EMULATORS,BSL
splitpath, bsltmp,,BSLPTH
if (BSLPTH = "ERROR")
	{
		BSLPTH= %RJEMUD%\BSL
	}
ifnotexist, %BSLPTH%\BSL.exe
	{
		bsltmp= %RJEMUD%\BSL\BSL.exe
		FileCreateDir,%RJEMUD%\BSL
		FileCopy,bin\BSL.exe,%RJEMUD%\BSL\BSL.exe,1
		iniwrite,"%bsltmp%",apps.ini,EMULATORS,BSL
		iniwrite,"%bsltmp%",Assignments.ini,ASSIGNMENTS,BSL
		splitpath, bsltmp,,BSLPTH
	}
FENN= 	
Loop, Parse, SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		FENN+=1	
		syscfgfld3= 
		stringsplit,syscfgfld,A_LoopField,=
		allsupsys.= syscfgfld1 . "`n"
		allsupport.= syscfgfld1 . "|"
		%syscfgfld2%= %syscfgfld1%
		re_sysn= %syscfgfld1%
		sn_sysn= %syscfgfld2%
		fe_sysn= %syscfgfld3%
		if (fe_sysn <> "")
			{
				stringreplace,fe_sysn,fe_sysn,-,_,All
				fe_%fe_sysn%= %re_sysn%
			}
		fesyslst.= fe_sysn . "|"
		syspardinj_%FENN%= %re_sysn%
	}
fe_= 	
if (INITIAL = 1)
	{
		Loop, Parse, allsupport,|
			{
				FileCreateDir, rj\sysCfgs\%syscfgfld1%
			}
		fileread,EmuPartSet,sets\EmuParts.set
		stringreplace,emupartset,emupartset,[ARCH],%ARCH%,All
		stringreplace,emupartset,emupartset,[BUILDBOT],%BLDBOT%,All
		iniRead, FEPartSet,sets\EmuParts.set,FRONTENDS
		stringreplace,FEPartSet,FEPartSet,[ARCH],%ARCH%,All
		gosub, EmuDetect
		gosub, INITIALASIGN
		ifnotexist, rj\sysCfgs
			{
				fileCreateDir, rj\sysCfgs
			}
	}
DCHINST=Not Found
if (DCHANGER <> "0")
	{
		DCHINST= Installed
	}
DAMINST=Not Found
if (DAMVAR <> "0")
	{
		DAMINST= Installed
	}
if (TGLPBL = 1)
	{
		;
	}
if (INITIAL = 1)
	{
		gosub, DestroySplashGUI
		SplashImage = img\splash.png
		SplashImageGUI(SplashImage, "Center", "Center", true)
	}
Gui +hWndhMainWnd
Gui,Color,%bgcolor%
Gui,Font,%fontColor% %fontXmed%,%fontName%
Menu,ContextMenu,Add
Menu,rjscopy, Add, Export to Jacket, Export_image
Loop,parse,fSYSINSTLBX,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		Menu,rjscopy, Add, Export to %A_LoopField%, Export_%A_LoopField%
	}
Menu,rjscopy, Add
Menu,rjscopy, Add, Save As..., Renamesave_image
Menu,rjscopy, Add
Menu,rjscopy, Add, Open Folder, Open_ScrpFld
Menu,rjscopy, Add`
Menu,rjscopy, Add, Delete, delete_image
Menu,rjscopy, Add
Menu,medcachedel, Add, Delete sselph-scraper cache, Media_Cache_delete
Menu,RunWithDD, Add, Run With >>, Emulator_Add
Menu,RunWithDD, Add, Download Assets >>, ARCGSNP
Menu,RunWithDD, Add, Add to Playlist +, Playlist_Add
Menu,RunWithDD, Add, Add to Executable +, Exe_Add
Menu,RunWithDD, Add, Delete Emulator Settings, DelCfg_Add
Menu,RunWithDD, Add, Open In Explorer !, Open_Add
Menu,EMURCLASGN,Add,Assign to Unassigned Systems,Emu_popasgn
Menu,EMURCLASGN,Add,Open Emulator Directory,Emu_Open
Menu,RCL_CSYS,Add,Open System Directory,INSys_Open
Menu,RSTAPAR, Add, Reset-Preset, ReSeTAPAR
Menu,ESRCLMenu,Add,Toggle Selection, TOGFESEL
Menu,ESRCLMenu,Add,Add Selection, ADDFESEL
Menu,ESRCLMenu,Add,Remove Selection, REMFESEL
Menu,ESRCLMenu,Add,Delete Scraped Artwork, FEDELSEL
Menu,EMURESETI, Add, Reset, EMURSTI
Menu,PLSTMenu,Add,Add Selection, ADDPLSLC
Menu,MINITOGGLE,Add,Mini-Mode ,MINIMODET
Menu,MINITOGGLE,Add,On-Top ,AWYONLTGL
Menu,UTRCLMenu,Add,Toggle Selection, UTLTOGFESEL
Menu,UTRCLMenu,Add,Add Selection, UTLADDFESEL
Menu,UTRCLMenu,Add,Remove Selection, UTLREMFESEL
Menu,BDRCLMenu,Add,Delete Bios Cache, BIOSREMFESEL
Menu,EMURCLMenu,Add,Clear Emulator, EMUREMFESEL
Menu,EMURCLMenu,Add,Delete Emulator, EMUDELFESEL
Menu,EMURCLMenu,Add,Update Emulator, EMUUPDTSEL
Menu,clRfltmenu,Add,Show Detected,CLRFLTRSUB
Menu,FERCLMenu,Add,Toggle Selection, TOGFESEL
Menu,FERCLMenu,Add,Add Selection, ADDFESEL
Menu,FERCLMenu,Add,Remove Selection, REMFESEL
Menu,FEDELMenu,Add,Toggle Selection, TOGFESEL
Menu,FEDELMenu,Add,Add Selection, ADDFESEL
Menu,FEDELMenu,Add,Remove Selection, REMFESEL
Menu,FEDELMenu,Add,Delete Scraped Artwork, FEDELSEL
Menu,CLRROMLST, Add, Clear Assignments, CLRSYSLOC
Menu,RMVSYSLST, Add, Remove Path, RMVFSYS
Menu,RMVSYSLST,Add,Open System Directory,Sys_Open
Menu,RNMSYSA, Add, Rename System, RenameSystem
Menu,RNMSYSA, Add, Restore System Name, RestoreSystemN
Menu,RJRCLMenu,Add,Toggle Selection, TOGRJSEL
Menu,RJRCLMenu,Add,Add Selection, ADDRJSEL
Menu,RJRCLMenu,Add,Remove Selection, REMRJSEL
Menu,REMDATSEL, Add, Remove Selection, REMDAT
Menu,REMDATSEL, Add, Clear All, REMADAT
Menu,REMHSHSEL, Add, Remove Selection, REMHSH
Menu,REMHSHSEL, Add, Clear All, REMAHSH
Menu,REMHSHSEL, Add, Move to >, MOVEHSH
Menu,MORROMDDLM, Add,Open Game Settings..., CfgBrowse
Menu,MORROMDDLM, Add, Open Game Directory, MORROMDDLMENU
Menu,RUNMenu,Add,Run Menu,RUNMENU
Menu,RUNMenu,Add
Gui,Font,Bold
Menu,PEGWIN, Add, Reset Config,PEGRSWIN
Menu,RERCLWIN, Add, Reset Config,RFERSWIN
Menu,REZWIN, Add,640 480, RESWARUN
Menu,REZWIN, Add,720 480, RESWBRUN
Menu,REZWIN, Add,1024 768, RESWCRUN
Menu,REZWIN, Add,1280 720, RESWDRUN
Menu,REZWIN, Add,1280 1024, RESWERUN
Menu,REZWIN, Add,1920 1080, RESWFRUN
Menu,REZRCLWIN, Add,Reset Config, RESRSRUN
Menu,SHORTRUN, Add,Run With:=->, SQRUN
Menu,SHORTRUN,Add,
Menu,SHORTRUN, Add, Run Emulator without a ROM >, ASLNEMU
Menu,ARCSHORT, Add,Run With:=->, AQRUN
Menu,ARCSHORT,Add,
Menu,ASOCRUN, Add,Assign to System, ASRUN
Menu,ASOCRUN, Add,Assign to Game+, ASEMUOVR
Menu,ASOCRUN, Add,Launch Paramaters [ ], ASEMUCFG
Menu,ASOCRUN, Add, 
Menu,ASOCRUN, Add,! Delete Game Settings, DelCfg_Add
Menu,ARCGPCFG, Add, Configure Selected Game, ARCPCFG
Menu,ARCSETB, Add, Reset-URL, ARCEDURL
Menu,ARCSETB, Add,
Menu,ARCSETB, Add, Reset-ALL Sources, ARCEDURA
Menu,ARSOCCFG, Add, Configure Association, ARSCFG
Menu,ARSOCCFG, Add,
Menu,ARSOCCFG, Add, Reset Download/Run Paramaters, ARSRST
Menu,ASOCCFG, Add, Configure Association, ASCFG
Menu,ASOCCFG, Add, Refresh Directory, ASRLD
Menu,ASOCCFG,Add,
Gui,Font,Normal
Menu,RUNMENU,Add,Open Folder..., SQOWTH
Menu,PLEDTMenu,Add,Swap:=->, PLEDITCORE
Menu,PLEDTMenu,Add,Download Assets >>, ARCGSNP
Menu,ARCART, Add, Download Assets >>, ARCGSNP
Menu,ARCART, Add, Open Download Folder, EXPLJK
Gui,Add,StatusBar, vSTATUS, Helpy Helperton
Gui,Font,Bold
Gui,Add,Tab2, x0 y0 w765 h535 vTABMENU Bottom, Settings||:=: MAIN :=:|Emu:=:Sys|Playlists|Frontends|DAT:=:Repo|Jackets|Util|Netplay|Cores
;;;;;;;;;;;;;;;;;;;;;;;;;;;; [SETTINGS TAB] ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Gui,Tab, 1
Gui Tab, Settings
Gui,Add,GroupBox, x566 y14 w195 h184 vSKSUMGB, Summary
Gui,Add,Link,x708 y428 w45 h18 vDONATELNK gDONATE, <a href="https://www.paypal.me/romjacket/8.88">Donate</a>
Gui,Add,Text,x579 y484, ver %VERSION%
Gui,Add,GroupBox, x4 y33 w560 h79 +0x400000
Gui,Add,GroupBox, x4 y107 w560 h102 +0x400000
Gui,Add,GroupBox, x4 y251 w560 h80 +0x400000
Gui,Add,GroupBox, x4 y326 w560 h87 +0x400000
Gui,Add,GroupBox, x4 y408 w560 h87 +0x400000
gui,font, s16 bold
Gui,Add,Link,x579 y415 w75 h24 vHelpLink gHelp, <a href="site\index.html">Help</a>
Gui,Font,Bold
Gui,Font, %fontXmed%
Gui,Add,Checkbox, x583 y176 vAUTOLNCH gAutoLaunch Checked, Auto-Launch
Gui ,Add,Picture, x707 y448 w44 h48 ,site\key.png
Gui,Add,Button, x18 y147 w43 h23 vSETEMUD gSETEMUD, SET
Gui,Add,Button, x18 y62 w43 h23 vSETJKD gSETJKD, SET
Gui,Add,Text, x18 y88 vSKSYSTXT, Systems Dir
Gui,Add,Text, x18 y173 vSKEMUDTXT, Emulators Dir
Gui,Font,Normal
Gui,Add,CheckBox, x150 y90 vFILT_UNSUP gFILT_UNSUP %filtmrk%, Filter Unsupported
Gui,Add,CheckBox, x399 y90 vRENONDET gRENONDET checked, Rename Detected
Gui,Add,Button, x579 y460 w55 h18 vUpdateSK gUpdateSK, UPDATE
Gui,Font, Bold
Gui,Add,Slider, x579 y323 vTRANSLID gTRANSLID Range10-255,255
Gui,Add,Checkbox, x579 y360 vDYNTRANS gDYNTRANS %DYNTRANSCHK%, Dynamic Transparency
Gui,Add,Text, x18 y311, Playlists Dir
Gui,Add,Button, x18 y286 w43 h23 vplaylset gplaylset,SET
Gui,Font, normal
Gui,Add,text, hwndEdtHndl1 x61 y288 w490 h20 vplaylisttxt ReadOnly, %playlistloc%
Gui,Font, Bold
Gui,Add,Text, x18 y390 w56 h13, HIstory File
Gui,Add,Button, x18 y364 w43 h23 vhistset ghistset,SET
Gui,Font, normal
Gui,Add,Checkbox, x399 y389 vHISAPND gHISAPND %HISAPNDCHK%, Append All
Gui,Add,text, hwndEdtHndl2 x61 y366 w490 h20 vhisttxt ReadOnly, %historyloc%
Gui,Add,Button, x100 y87 w45 h18 vSYSDETECT gSysDetect, Detect
Gui,Add,Button, x100 y171 w45 h18 vEMUDETECT gEmuDetect, Detect
Gui,Add,Text, x581 y60 vSKDSETXT, Detected Emulators: %emunumtot%
Gui,Add,Text, x581 y29 vSKDETSTXT, Detected Systems:`n    %totsys% supported and %allsys% total
Gui,Add,DropDownList, hwndDplHndl1 x23 y8 w163 vSKRESDDL gSKRESDDL, All||Session|Jacket-Presets|Retroarch|Associations|Core-Cfgs|Playlist-DB
Gui,Add,Button, x187 y8 w55 h20 vSKRESET gSKRESET, RESET
Gui,Add,text, hwndEdtHndl3 x63 y65 w490 h20 Multi ReadOnly vSKSYSDISP, %RJSYSTEMS%
Gui,Add,Checkbox, x573 y76 vALWOTP gALWOTP, Always On Top
Gui,Add,CheckBox, x573 y94 vLOGGING gLOGGING %logenable%, Logging
Gui,Add,CheckBox, x573 y141 vAUTOPGS gAUTOPGS %AUTOPGSIO%, Auto-Load Per-Game Settings
Gui,Add,text, hwndEdtHndl4 x63 y149 w490 h20 Multi ReadOnly vSKEMUDISP, %RJEMUD%
Gui,Add,text, hwndEdtHndl5 x61 y453 w490 h20 vtmpdispl Multi ReadOnly, %cacheloc%
Gui,Font, Bold
Gui,Add,Text, x18 y476 vTMPDIRTXT, Temp/Cache Dir
Gui,Add,Button, x18 y450 w43 h23 vSETTMPD gSETTMPD, SET
Gui,Font, normal
/*  ;;[DEBUGOV]
Gui,Add,Text, x449 y10 w112 h15 vthemntxt, Theme
Gui,Add,DropDownList, hwndDplHndl2 x344 y7 w102 vSKTHEMEN gSKTHEMEN,%skthemen%||Default|Gray|White|Blue|Black
*/  ;;[DEBUGOV]
if (INITIAL = 1)
	{
		WinSet, TransColor, White,skelprg
		WinSet, AlwaysOnTop
		WinGetPos,,, Width, Height, skelprg
		WinMove, skelprg,, (A_ScreenWidth/2)-(Width/2), (A_ScreenHeight/2)-(Height/2)-70
	}
;;;;;;;;;;;;;;;;;;;;;;;;;;;; [MAIN TAB] ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
Gui,Tab, 2
Gui Tab, :=: MAIN :=:
Gui,Font,Bold
Gui,Add,Text, cred x18 y4 w53 h15 vCFGSWITCH Center,
Gui,Font, Normal
Gui,Add,Radio, x10 y4 h16 vRUNPLRAD gRUNPLRAD, Playlist
Gui,Add,Radio, x72 y4 h16 vRUNFLRAD gRUNFLRAD Checked, Folder
Gui,Add,ComboBox, hwndCbxHndl1 x39 y24 w604 vRUNROMCBX gEDTFROM +0x2 +E0x5000 Right hidden,
Gui,Add,Button, x23 y25 w15 h17 vEDTROMBTN gEDTROMBTN,E
Gui,Add,DropDownList, hwndDplHndl163 x39 y24 w377 vMORROM gEDTROM +0x2 +E0x5000 Right,
gui,font,Bold
Gui,Add,Button, x720 y516 w42 h19 vFNDGUI gFndGui hidden,find
Gui,Font,Normal
Gui,Add,Button, x745 y30 w16 h16 vMINISWITCH gMINISWITCH,-
Gui,Add,CheckBox, x435 y4 w55 h15 vCustSwitchs gCustSwitchs hidden, switch
Gui,Add,ComboBox, hwndCbxHndl2 x459 y24 w100 vCUSTMOPTS gCustmOpts hidden, |%INJOPT%
Gui,Add,ComboBox, hwndCbxHndl3 x560 y24 w85 vCUSTMARGS gCustmArgs hidden, |%INJARG%
Gui,Add,Button, x418 y2 w15 h21 vGROM gGetROM,...
Gui,Add,Button, x493 y2 w15 h17 vESWPLCRE gESWPLCRE,E
Gui,Add,ComboBox, x510 y2 w155 hwndRUNCORECBX vLCORECBX gLCoreCBX hidden,
Gui,Add,DropDownList, x510 y2 w155 hwndRUNCORE vLCORE gLnchCore,
Gui,Font, Bold
Gui,Add,Button, x681 y2 w64 h29 vLNCHBUT gLNCH disabled,LAUNCH
Gui,Add,Button, x745 y2 w16 h29 vRCLLNCH gRCLLNCH,>
gui,font,normal
Gui,Add,Button, x744 y34 w15 h15 vRETAL gRETAL hidden,>
Gui,Add,DropDownList, hwndDplHndl4 x142 y2 w274 vRUNSYSDDL gRUNSYSDDL, :=:System List:=:||%initfldrs%
Gui,Add,Combobox, hwndCbxHndl109 x142 y2 w274 vRUNSYSCBX gRUNSYSCBX +0x2 +E0x5000 Right hidden,:=:System List:=:||%initfldrs%
Gui,Add,Button,x125 y4 w15 h17 vRUNSYSBTN gRUNSYSBTN,E	
Gui,Font,Bold
Gui,Add,GroupBox, x12 y50 w740 h452 Right vSRCHGRP, SEARCH
Gui,Font,Norm
Gui,Add,listbox, x13 y111 w715 h400 HWNDlocalromp +HScroll1500 Multi vSRCHROMLBX gSRCHROMLBX hidden,
Gui,Add,Radio, x125 y61 w53 h18 vSRCHFLRAD gSRCHFLRAD Checked, Folder
Gui,Add,Radio, x186 y61 w60 h18 vSRCHPLRAD gSRCHPLRAD, Playlist
Gui,Add,CheckBox, x23 y61 w65 h16 vSRCHRCRSCHK gSRCHRCRSCHK Checked, Recurse
Gui,Add,Edit, hwndEdtHndl16 x329 y80 w368 h21 vSRCHROMEDT gSRCHROMEDT,
Gui,Add,Button, x700 y79 w47 h23 vSRCHROMBUT gSRCHROMBUT,search
Gui,Add,DropDownList, hwndDplHndl23 x20 y81 w300 vSRCHLOCDDL gSRCHLOCDDL, :=:System List:=:||%systmfldrs%
emutog= Hide
tmpvis= Hidden
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; [INSTALL TAB] ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Gui,Tab, 3
Gui Tab, Emu:=:Sys
Gui,Font,Bold
Gui,Add,GroupBox, x2 y15 w276 h470 vCACGRP,
Gui,Font,Norm
Gui,Font,Bold
Gui,Add,GroupBox, x473 y25 w263 h94 Center +0x400000 vGRPDROPBIOS hidden, Drop BIOS here
Gui,Font,Norm
Gui,Add,Button, x480 y45 w240 h60 vAUTOBIOS gAUTOBIOS hidden, AUTO
Gui,Add,Edit, hwndEdtHndl26 x5 y2 w210 vINSFLTR gINSFLTR,
Gui,Add,Button, x217 y5 w15 h15 vCLRFLTR gCLRFLTR,X
Gui,Add,Text, x235 y5 h13 vINSFLTRX, Filter
Gui,Add,listbox,x5 y23 w271 h463 HWNDtrxvail vPRGINSTLBX gPRGINSTLBX hidden,
Gui,Add,listbox, Multi x5 y23 w271 h463 HWNDeavlbx vSYSINSTLBX gSYSINSTLBX, %allsupport%
Gui,Add,Progress, x746 y8 w9 h465 Vertical -Smooth vDWNPRGRS hidden, 0
Gui,Add,listbox, x282 y433 w175 h69 HWNDprisl vEMPRLST gEMPRLST hidden,
Gui,Add,Button, x422 y413 w16 h17 vEMPRBUTA gEMPRBUTA hidden, +
Gui,Add,DropDownList, hwndDplHndl34 x283 y411 w125 vEMPRDDL gEMPRDDL hidden, Emulators|%runlist%
Gui,Add,Button, x458 y433 w16 h17 vEMPRBUTU gEMPRBUTU hidden, P
Gui,Add,Button, x458 y459 w16 h17 vEMPRBUTX gEMPRBUTX hidden, X
Gui,Add,Button, x458 y481 w36 h17 vDELCFGPGC gDELCFGPGC hidden, Clean
Gui,Font,Bold
Gui,Add,GroupBox, x510 y409 w228 h97 vEMGRPF Right hidden, Pre Cmd/ Post Cmd
Gui,Add,GroupBox, x472 y362 w265 h43 vDSKMNTGRP hidden, Disc-Mounting
Gui,Font, Normal
Gui,Add,CheckBox, x474 y38880 vDSKMNTCHK gDSKMNTCHK  hidden,Enable
Gui,Add,DropDownList, hwndDplHndl35 x534 y378 w90 vDSKMNTDDL gDSKMNTDDL  hidden, DaemonTools||VirtualCloneDrive|WinCDEmu|%vdskwin%Other
Gui,Add,Button, x625 y378 w44 h19 vDSKSELBUT gDSKSELBUT  hidden, Disc...
Gui,Add,CheckBox, x671 y370 h16 vDSKMNTOVR gDSKMNTOVR  hidden, override
Gui,Add,CheckBox, x514 y431 w45 h18 vEMCHKW gEMCHKW +0x20  hidden, Wait
Gui,Add,DropDownList, hwndDplHndl36 x562 y430 w151 vEMDDLF gEMDDLF  hidden, Pre-Command||Post-Command
Gui,Add,Button, x715 y429 w21 h23 vEMBUTG gEMBUTG  hidden, +
Gui,Add,DropDownList, hwndDplHndl37 x570 y452 w143 vEMDDLP gEMDDLP +0x2 +E0x5000  hidden,
Gui,Add,Button, x715 y451 w21 h23 vEMBUTH gEMBUTH  hidden, X ;PrePostDelete
Gui,Add,ComboBox, hwndCbxHndl23 x280 y411 w156 vRepoSet gRepoSet hidden, %repoloc%||%repolst%
Gui,Add,Text, x280 y436 h15 vSITEDTXT hidden, Remote Repository
Gui,Add,Button, x440 y412 w23 h19 vAddRepo gAddRepo hidden, +
Gui,Font,Bold
Gui,Add,Button,x370 y445 w15 h15 vUPDBTC gCLRNETP Hidden Disabled,-
Gui,Font,Normal
Gui,Font,Bold
Gui,Add,GroupBox, x278 y5 w185 h366 Center vCCGRP hidden, Installer
Gui,Font,Norm
Gui,Font,Bold
Gui,Add,DropDownList, hwndDplHndl38 x65 y485 w110 vSaList gSaList,Systems||Emulators|Utilities|Frontends
Gui,Add,Text, x9 y490 h15, \\\\\\\\\\
Gui,Add,Text, x185 y490 h15, //////////
Gui,Add,GroupBox, x465 y6 w275 h358 vSKRAstch hidden, Skeletonkey-System-Associations
Gui,Font,Norm
Gui,Add,DropDownList, hwndDplHndl39 x588 y477 w97 vLNCHPRDDL gLNCHPRDDL hidden,retroarch|Emulators|%addemu%
Gui,Add,Button, x688 y477 w42 h22 vLNCHPT gLNCHPT hidden,Priority
Gui,Add,DropDownList, hwndDplHndl40 x470 y26 w251 vADDCORE gAddCore hidden, Select_A_System||%allsupport%
Gui,Add,Button, x723 y25 w12 vOPNSYS gOpnSyS hidden,+
Gui,Add,Button, x723 y25 w12 vCnclOsys gCnclOsys hidden,-
Gui,Add,ComboBox, hwndCbxHndl24 x471 y54 w264 vADDNSYS gAddNSys Hidden, %allsupport%
Gui,Add,Edit, hwndEdtHnd200 x471 y54 w264 vRenOSys gRenOSys Hidden, 
Gui,Add,Button, x694 y79 w42 h19 vSAVNSYS gSavNSys Hidden, save
Gui,Add,Button, x694 y79 w42 h19 vSAVOSYS gSavOSys Hidden, save
Gui,Add,Text, x577 y75 h23 vOVSETTXT hidden, Extension-Override
Gui,Add,Button, x575 y167 w58 h19 vSELAPP gSelApp hidden, BROWSE
Gui ,Add,Text, x643 y147 h17 vSYSIDENT hidden, System Identifier
Gui,Add,ComboBox, hwndCbxHndl25 x635 y166 w103 vSYSNICK gSysNick Limit32 Hidden,%preEmuCfg%
Gui,Add,Button, x680 y197 w42 h17 vSVNICK gSvNick hidden, save
Gui,Add,Button, x723 y146 w15 h15 vDELNICK gDelNick hidden,X
Gui,Add,Edit, hwndEdtHndl28 x503 y96 w120 h21 vEXTINP gExtInp Hidden,
Gui,Add,ComboBox, hwndCbxHndl26 x505 y192 w120 vAPPOPT gAppOpt Hidden,|[CUSTMOPT]|%INJOPT%
Gui,Add,ComboBox, hwndCbxHndl27 x505 y218 w120 vAPPARG gAppArg Hidden,|[CUSTMARG]|%INJARG%
Gui,Add,Text, x633 y191 h23 vOPTTXT hidden, options
Gui,Add,Text, x633 y215 h23 vARGTXT hidden, arguments
Gui,Add,Button,x501 y122 h20 w50 vGBLpgs gGBLpgs hidden,Global
Gui,Add,CheckBox, x588 y122 h17 vEMUPGC gEmuPGC Checked hidden, Per-Game Config Files
Gui,Add,Radio, x490 y241 h23 vERUN gERun Checked Hidden, RUN from emulator path
Gui,Add,Radio, x490 y260 h23 vLRUN gLRun Hidden, RUN from ROM path
Gui,Add,CheckBox, x490 y283 h17 vNoExtn gNoExtn Hidden, Omit extension at runtime
Gui,Add,CheckBox, x649 y283 h13 vEXTARUN gEXTARUN Hidden,Run-Extracted
Gui,Add,CheckBox, x649 y244 h13 vOMITQ gOmitQ hidden, Omit-Quotes
Gui,Add,CheckBox, x649 y261 h13 vOMITPTH gOmitPth Hidden, No-Path
Gui,Add,Edit, hwndEdtHndl29 x476 y305 +Wrap w256 h48 vEXDISPL disabled hidden,
Gui,Add,Radio, x290 y254 h13 vUNIQLNK gUniqLnk Checked hidden, System Configs
Gui,Add,DropDownList, hwndDplHndl43 x282 y27 w177 vINSTEMUDDL gInstEmuDDL hidden, %emuinstpop%
Gui,Add,Button, x286 y170 w75 h23 vLOCEMUIN gLocEmuIn hidden, SELECT
Gui,Add,Button, x382 y92 w75 h23 vMULTINST gMULTInst hidden, ASSIGN
Gui,Add,Button, x740 y3 w15 h15 vEMUINSC gCLRNETP hidden,-
Gui,Add,Button, x382 y92 w75 h23 vEMUINST gEmuInst hidden,Install
Gui,Add,CheckBox, x350 y75 w120 h16 +0x20 vEMUASIGN gEmuAsign hidden, Assign to System
Gui,Add,Button, x408 y55 w51 h18 vCHEMUINST gChEmuInst hidden, Browse
Gui,Add,Text, x298 y58 h13 Center vEINSTTXT hidden, Install Location
Gui,Add,Checkbox, x285 y75 h16 vEMUAUTOA gEMUAUTOA hidden, Append to all systems
Gui,Add,Edit, hwndEdtHndl30 x286 y118 w171 h51 +0x400000 +ReadOnly vEINSTLOC hidden,
Gui,Add,Button, x402 y207 w55 h23 vROMDLOC gRomDLoc hidden, ADD
Gui,Add,Button, x382 y207 w75 h23 vMROMDLOC gMRomDLoc hidden, MULTI-SET
Gui,Add,Text, x288 y212 h17 vROMDTXT hidden,=>ROM Dirs
Gui,Add,Listbox, hwndLbxHndl3 x285 y234 w171 h123 vROMDEDT Multi +HScroll hidden,
;;;;;;;;;;;;;;;;;;;  BSL ;;;;;;;;;;;;;;;;;;;;;;;;
Gui,Font,Bold
Gui,Add,GroupBox, x468 y50 w269 h140 Center vSKBSRLGRP hidden, BSL - (ROM-Jacket-Launcher)
Gui,Font,Normal
Gui,Add,CheckBox, x474 y124 w14 h18 vSKENBF gSKENBF disabled hidden
Gui,Add,Button, x491 y123 w44 h19 vSKBEFCMD gSKBEFCMD disabled hidden, SET
Gui,Add,Text, x540 y126 vSKRBFTXT disabled hidden, Run .cmd before
Gui,Add,CheckBox, x474 y144 w14 h18 vSKENAF gSKENAF disabled hidden
Gui,Add,Button, x491 y141 w44 h19 vSKAFTCMD gSKAFTCMD disabled hidden, SET
Gui,Add,Text, x540 y144 vSKRAFTXT disabled hidden, Run .cmd after
Gui,Add,CheckBox, x495 y168 h17 vDISCFG gDISCFG disabled hidden,Disable Jacket Configurations
Gui,Add,CheckBox, x495 y83 h16 vSKOVRJM gSKOVRJM disabled hidden, override
Gui,Add,Radio, x630 y83 h17 vSKXPADOV gSKXPADOV disabled hidden, Xpadder
Gui,Add,Radio, x560 y83 h17 vSKAMOV gSKAMOV disabled checked hidden, Antimicro
Gui,Add,Button, x696 y82 w38 h20 vSKPROFOV gSKPROFOV disabled hidden, profile
Gui,Add,Text, x586 y62 vSKPRFJTXT hidden, Overrides
Gui,Add,CheckBox, x495 y105 h16 vSKFROV gSKFROV disabled hidden, override
Gui,Add,DropDownList, hwndDplHndl44 x564 y103 w163 vSKFROVDD gSKFROVDD disabled hidden, FRONTENDS||
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; [PLAYLISTS TAB] ;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Gui,Tab, 4
Gui,Tab, Playlists
Gui,Add,DropDownList, hwndDplHndl167 x24 y22 w283 vDWNLPOS gPOPLDDL, :=:System List:=:||%systmfldrs%
Gui,Add,CheckBox, x325 y15 w15 h16 vRECURSE gRECURSE,
Gui,Add,Text, x310 y31 w41 h13 vRECURTX,Recurse
Gui,Add,Radio, x22 y46 vEXCLBOOL gEXCLBOOL hidden checked,exclude
Gui,Add,Radio, x93 y46 vINCLBOOL gINCLBool hidden,include
Gui,Add,CheckBox, x140 y46 h17 vPARSEALL gParseAll hidden, All
Gui,Add,ComboBox, hwndCbxHndl57 x177 y44 w152 vEXTPARSED gExtParsed hidden, %omitxtv%
Gui,Add,Button, x331 y45 w22 h21 vFLTXT gFltXt hidden,F
Gui,Add,listbox, x24 y66 w316 h420 hwndLFTLSTBX vROMPOP gDragROM Multi +HScroll, %RomPLst%
Gui,Add,GroupBox, x356 y140 w58 h91 vPLGBA
Gui,Add,GroupBox, x391 y295 w58 h126 vPLGBB
Gui,Add,listbox, x449 y100 w300 h394 HWNDinsel vCURPLST gCURPLST Multi +HScroll,
Gui,Add,GroupBox, x362 y0 w81 h74 vAPNDTYPGRP
Gui,Add,Radio, x365 y25 h13 vPLAPPND gPlaylistAppend, Append
Gui,Add,Radio, x365 y10 h13 vPLOVR gPlaylistAppend Checked, Overwrite
Gui,Add,CheckBox, x367 y43 h14 vZIPSEEK gZipSeek checked, Zip-Search
Gui,Add,CheckBox, x367 y58 h14 vCRCENBL gCRCEnbl checked, CRC-Index
Gui,Font,Bold
Gui,Add,GroupBox, x447 y0 w304 h500 Right vPLGBC, Frontend
Gui,Add,GroupBox, x11 y4 w346 h493 +0x400000 vPLGBD, Drag and Drop ROMs here
Gui,Font,Bold
Gui,Add,DropDownList, hwndDplHndl85 x557 y0 w130 vPLISTTYP gPLISTYP,skeletonKeY||EmulationStation|RetroFE  ;;to Add Pegasus
Gui,Font,Norm
Gui,Add,ComboBox, hwndCbxHndl58 x449 y31 w252 vPLNAMEDT gPlaylistEdit, %sysposb%
Gui,Add,ComboBox, hwndCbxHndl59 x449 y53 w166 vPLCORE gPopulateCore disabled,||%runlist%
Gui,Add,CheckBox, x621 y52 h23 vDETECTCORE gDetectCore Checked, Detect
Gui,Add,Button,x679 y77 w60 h21 vSVPLST gSaveToPl,Create
Gui,Add,Button, x701 y30 w36 h23 vOPNPLST gOpnPlst,Open
Gui,Add,CheckBox, x521 y81 h14 vPGCONFG gPLPerGameConfig, Per-Game-Configs
Gui,Add,Button, x703 y54 w35 h23 vSVASPLST gSaveToPl hidden, Save
Gui,Add,Button, x453 y78 w58 h19 vSVAPLST gAltTempl,Template
Gui,Add,Text, x361 y79 w35 h15 vPLSELTXT, Select
Gui,Add,Button, x361 y94 w35 h15 +0x100 vPLLISTALL gPLLISTALL, All
Gui,Add,Button, x361 y108 w35 h15 +0x100 vPLLISTN gPLLISTN, None
Gui,Add,Button, x416 y100 w32 h15 +0x200 vPLLISTSORT gPLLISTSORT, Sort
Gui,Add,Button, x358 y150 w50 h18 vCPYPL gCopyToPl, +------>
Gui,Add,Text, x360 y170 vPLADPTXT, Add
Gui,Add,Button, x358 y191 w40 h19 vCLRPP gClearROMPop, 0=-->x
Gui,Add,Text, x365 y211 vPLCLRPTXT, Clear
Gui,Add,Button,x428 y230 w17 h16 vMVPLOU gMVPLOU,^
Gui,Add,Button,x428 y250 w17 h16 vMVPLOD gMVPLOD,v
Gui,Add,Button,x392 y305 w55 h24 vBRADD gAddToPL, Open...>
Gui,Add,Text, x391 y334 w59 h2 0x10 vFENWTXT
Gui,Add,Button,x396 y339 w50 h18 vREMPL gRemFromPL, x---<---o
Gui,Add,Text, x401 y357 vPLRMVTXT, Remove
Gui,Add,Button, x403 y381 w40 h19 vCLRPL gClearCurList, x<--=0
Gui,Add,Text, x416 y401 vPLCLRTXT, Clear
Gui,Add,Button, x367 y457 w75 h23 vPLINIT gPlaylistInit, Rebuild DB
Gui,Add,Text, x364 y483 h15 vPLDBTXT, Playlist Database
Gui,Add,DropDownList, hwndDplHndl86 x451 y31 w90 vESPLCORE gESPOPCORE hidden,|Fuzzy-Match||Exact-Match|MAME-Match|
Gui,Add,CheckBox, x373 y52 h13 vESBACKUP gESBackupPl Checked hidden, Backup
Gui,Font,Bold
Gui,Add,Button,x678 y27 w60 h25 vESSVPL gESSavePl hidden, CREATE
Gui,Font,Normal
Gui,Add,ComboBox, hwndCbxHndl60 x450 y55 w252 vESPLXMP gEsPlaylistNames hidden, %systmfldrs%%escommon%
Gui,Add,Button, x703 y54 w36 h23 vESOPENPL gEsOpenPl hidden, Open
Gui,Add,DropDownList, hwndDplHndl168 x24 y22 w283 vESDWNLPOS gESPopDownloads,%systmfldrs%
Gui,Add,Radio, x22 y46 vESRPOPDL gESRPopJ hidden, Jackets
Gui,Add,Radio, x85 y46 vESRPOPPL gESRPopMir hidden, Mirrors
Gui,Add,Radio, x139 y46 vESRPOPROM gESRPopRom checked hidden, ROMs
Gui,Add,DropDownList, hwndDplHndl88 x195 y44 vESMIRSEL gESMIRSEL hidden,|%CMIR1%||%MIRDDLOC%
Gui,Add,Button, x197 y44 w25 h19 vESROMROOT gESROMROOT hidden, ...
Gui,Add,Text, x230 y46 w125 h13 vESRRTXT hidden, NOT SET
Gui,Add,CheckBox, x34 y320 w68 h23 vESKIDG gESKIDG hidden, Kid-Game
Gui,Add,CheckBox, x124 y320 w55 h23 vESHIDDEN gESHIDDEN hidden, Hidden
Gui,Add,CheckBox, x334 y225 w64 h20 vESFAV gESFAV hidden, Favorite
Gui,Add,Button, x662 y26 w75 h23 vESSAVEOPL gESSAVEOPL hidden, SAVE
Gui,Add,Text, x16 y27 w120 h13 vESNAMTXT hidden,Name
Gui,Add,Edit, hwndEdtHndl36 x28 y41 w410 h21 vESNAMEDT gESNAMEDT hidden,
Gui,Add,Text, x19 y64 w120 h13 vESPTHTXT hidden,Path
Gui,Add,Edit, hwndEdtHndl37 x30 y79 w370 h21 vESPTHEDT gESPTHEDT hidden,
Gui,Add,Button, x403 y79 w39 h20 vESROMPTHBUT gESROMPTHBUT hidden, . . .
Gui,Add,Button, x457 y42 w59 h20 vESROMADDBUT gESROMADDBUT hidden, Add ROM
Gui,Add,Button, x457 y65 w59 h20 vESFLDADDBUT gESFLDADDBUT hidden, Add PATH
Gui,Add,Text, x20 y103 w120 h13 vESDESCTXT hidden,Description
Gui,Add,Edit, hwndEdtHndl38 x18 y120 w421 h99 vESDESCEDT gESDESCEDT hidden,
Gui,Add,Text, x307 y376 w40 h13 vESIMGTXT hidden,Image
Gui,Add,Button, x348 y389 w39 h19 vESIMGBUT gESIMGBUT hidden, . . .
Gui,Add,Text, x16 y392 w332 h13 vESOPNIMGPTHTXT hidden, ImagePath
Gui,Add,Text, x295 y411 w53 h13 vESTHMBTXT hidden, Thumbnail
Gui,Add,Button, x348 y421 w39 h19 vESTHUMBBUT gESTHUMBBUT hidden, . . .
Gui,Add,Text, x16 y425 w332 h13 vESTHUMBP hidden, ThumbnailPath
Gui,Add,Text, x311 y470 w37 h13 vESVIDTXT hidden,Video
Gui,Add,Button, x348 y480 w39 h19 vESVIDBUT gESVIDBUT hidden, . . .
Gui,Add,Text, x16 y484 w332 h13 vESVIDPTHTXT hidden, VideoPath
Gui,Add,Text, x298 y442 w50 h13 vESMARQTXT hidden,Marquee
Gui,Add,Button, x348 y453 w39 h19 vESMARQBUT gESMARQBUT hidden, . . .
Gui,Add,Text, x16 y456 w332 h13 vESMARQPTHTXT hidden, MarqueePath
Gui,Add,Text, x16 y229 w120 h13 vESPUBTXT hidden,Publisher
Gui,Add,Edit, hwndEdtHndl39 x23 y245 w120 h21 vESPUBEDT gESPUBEDT hidden,
Gui,Add,Text, x152 y229 w120 h13 vESDEVTXT hidden,Developer
Gui,Add,Edit, hwndEdtHndl40 x158 y244 w120 h21 vESDEVEDT gESDEVEDT hidden,
Gui,Add,Text, x290 y228 w40 h13 vESRATTXT hidden, Rating
Gui,Add,Slider, x284 y248 w120 h32 Range1-10 vESRATSLD gESRATSLD hidden, 0.5
Gui,Add,Text, x17 y273 w120 h13 vESRLSDTXT hidden, ReleaseDate
Gui,Add,DateTime, x44 y289 w100 h24 vESRLSDG gESRLSDG  hidden,
Gui,Add,Text, x161 y270 w49 h13 vESGENTXT hidden,Genre
Gui,Add,Edit, hwndEdtHndl41 x161 y289 w120 h21 vESGENEDT gESGENEDT hidden,
Gui,Add,Text, x287 y291 w49 h13 vESPLNUMTXT hidden, Player#
Gui,Add,DropDownList, hwndDplHndl89 x342 y289 w35 vESDDPLNUM gESDDPLNUM hidden,1||2|3|4|5|6|7|8
Gui,Add,DropDownList, hwndDplHndl94 x451 y31 w90 vRFPLCORE gRFPOPCORE hidden,|Fuzzy-Match||Exact-Match|MAME-Match|
Gui,Add,CheckBox, x373 y52 h13 vRFBACKUP gRFBackupPl Checked hidden, Backup
Gui,Font,Bold
Gui,Add,Button,x685 y27 w60 h25 vRFSVPL gRFSavePl hidden, CREATE
Gui,Font,Normal
Gui,Add,ComboBox, hwndCbxHndl62 x450 y55 w252 vRFPLXMP gRFPlaylistNames hidden, %systmfldrs%%escommon%
Gui,Add,CheckBox, x546 y23 h13 vRFUSESCR gRFUSESCR hidden checked, Use Scraped Assets
Gui,Add,CheckBox, x572 y40 w97 h13 vRFCPYSCR gRFCPYSCR hidden checked, `& copy to home
Gui,Add,DropDownList, hwndDplHndl170 x24 y22 w283 vRFDWNLPOS gRFPopDownloads,%systmfldrs%
Gui,Add,Radio, x22 y46 vRFRPOPDL gRFRPopJ hidden, Jackets
Gui,Add,Radio, x85 y46 vRFRPOPPL gRFRPopMir hidden, Mirrors
Gui,Add,Radio, x139 y46 vRFRPOPROM gRFRPopRom checked hidden, ROMs
Gui,Add,DropDownList, hwndDplHndl96 x195 y44 vRFMIRSEL gRFMIRSEL hidden,|%CMIR1%||%MIRDDLOC%
Gui,Add,Button, x197 y44 w25 h19 vRFROMROOT gRFROMROOT hidden, .Dir.
Gui,Add,Text, x230 y46 w125 h19 vRFRRTXT hidden, NOT SET
Gui,Add,CheckBox, x34 y320 w68 h23 vRFKIDG gRFKIDG hidden, Kid-Game
Gui,Add,CheckBox, x124 y320 w55 h23 vRFHIDDEN gRFHIDDEN hidden, Hidden
Gui,Add,CheckBox, x334 y225 w64 h20 vRFFAV gRFFAV hidden, Favorite
Gui,Add,Button, x662 y26 w75 h23 vRFSAVEOPL gRFSAVEOPL hidden, SAVE
Gui,Add,Text, x16 y27 w120 h13 vRFNAMTXT hidden,Name
Gui,Add,Edit, hwndEdtHndl48 x28 y41 w410 h21 vRFNAMEDT gRFNAMEDT hidden,
Gui,Add,Text, x19 y64 w120 h13 vRFPTHTXT hidden,Path
Gui,Add,Edit, hwndEdtHndl49 x30 y79 w370 h21 vRFPTHEDT gRFPTHEDT hidden,
Gui,Add,Button, x403 y79 w39 h20 vRFROMPTHBUT gRFROMPTHBUT hidden, . . .
Gui,Add,Button, x457 y42 w59 h20 vRFROMADDBUT gRFROMADDBUT hidden, Add ROM
Gui,Add,Button, x457 y65 w59 h20 vRFFLDADDBUT gRFFLDADDBUT hidden, Add PATH
Gui,Add,Text, x20 y103 w120 h13 vRFDESCTXT hidden,Description
Gui,Add,Edit, hwndEdtHndl50 x18 y120 w421 h99 vRFDESCEDT gRFDESCEDT hidden,
Gui,Add,Text, x307 y376 w40 h13 vRFIMGTXT hidden,Image
Gui,Add,Button, x348 y389 w39 h19 vRFIMGBUT gRFIMGBUT hidden, . . .
Gui,Add,Text, x16 y392 w332 h13 vRFOPNIMGPTHTXT hidden, ImagePath
Gui,Add,Text, x295 y411 w53 h13 vRFTHMBTXT hidden, Thumbnail
Gui,Add,Button, x348 y421 w39 h19 vRFTHUMBBUT gRFTHUMBBUT hidden, . . .
Gui,Add,Text, x16 y425 w332 h13 vRFTHUMBP hidden, ThumbnailPath
Gui,Add,Text, x311 y470 w37 h13 vRFVIDTXT hidden,Video
Gui,Add,Button, x348 y480 w39 h19 vRFVIDBUT gRFVIDBUT hidden, . . .
Gui,Add,Text, x16 y484 w332 h13 vRFVIDPTHTXT hidden, VideoPath
Gui,Add,Text, x298 y442 w50 h13 vRFMARQTXT hidden,Marquee
Gui,Add,Button, x348 y453 w39 h19 vRFMARQBUT gRFMARQBUT hidden, . . .
Gui,Add,Text, x16 y456 w332 h13 vRFMARQPTHTXT hidden, MarqueePath
Gui,Add,Text, x16 y229 w120 h13 vRFPUBTXT hidden,Publisher
Gui,Add,Edit, hwndEdtHndl51 x23 y245 w120 h21 vRFPUBEDT gRFPUBEDT hidden,
Gui,Add,Text, x152 y229 w120 h13 vRFDEVTXT hidden,Developer
Gui,Add,Edit, hwndEdtHndl52 x158 y244 w120 h21 vRFDEVEDT gRFDEVEDT hidden,
Gui,Add,Text, x290 y228 w40 h13 vRFRATTXT hidden, Rating
Gui,Add,Slider, x284 y248 w120 h32 Range1-10 vRFRATSLD gRFRATSLD hidden, 0.5
Gui,Add,Text, x17 y273 w120 h13 vRFRLSDTXT hidden, ReleaseDate
Gui,Add,DateTime, x44 y289 w100 h24 vRFRLSDG gRFRLSDG  hidden,
Gui,Add,Text, x161 y270 w49 h13 vRFGENTXT hidden,Genre
Gui,Add,Edit, hwndEdtHndl53 x161 y289 w120 h21 vRFGENEDT gRFGENEDT hidden,
Gui,Add,Text, x287 y291 w49 h13 vRFPLNUMTXT hidden, Player#
Gui,Add,DropDownList, hwndDplHndl97 x342 y289 w35 vRFDDPLNUM gRFDDPLNUM hidden,1||2|3|4|5|6|7|8
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; [FRONTENDS TAB] ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Gui,Tab,5
Gui,Tab,Frontends
Gui,Font,Bold
JDLIN= Media||Mirrored_Links|EmulationStation|Pegasus|RetroFE	
fvnbh= Media||%FELIST%
if (raexist = 1)
	{
		JDLIN= |Media||Mirrored_Links|EmulationStation|Pegasus|RetroFE
		fvnbh= Media||%FELIST%
	}
Gui,Add,DropDownList, hwndDplHndl110 x265 y2 w150 vfeDDLJ gfeDDLJ, %JDLIN%
Gui,Font,Normal
fenam= Media
fetog= Hide
fevis= Hidden
Gui,Add,Button, x128 y216 w75 h23 vfeBUTA gfeBUTA %fevis%, feBUTA
Gui,Add,Button, x128 y240 w75 h23 vfeBUTB gfeBUTB %fevis%, feBUTB
Gui,Add,Button, x128 y264 w75 h23 vfeBUTC gfeBUTC %fevis%, feBUTC
Gui,Add,Button, x368 y120 w75 h23 vfeBUTG gfeBUTG %fevis%, feBUTG
Gui,Add,Button, x368 y48 w75 h23 vfeBUTD gfeBUTD %fevis%, feBUTD
Gui,Add,Button, x368 y72 w75 h23 vfeBUTE gfeBUTE %fevis%, feBUTE
Gui,Add,Button, x368 y96 w75 h23 vfeBUTF gfeBUTF %fevis%, feBUTF
Gui,Add,Button, x640 y120 w75 h23 vfeBUTH gfeBUTH %fevis%, feBUTH
Gui,Add,Button, x640 y144 w75 h23 vfeBUTI gfeBUTI %fevis%, feBUTI
Gui,Add,Button, x689 y480 w66 h23 vfeBUTJ gfeBUTJ %fevis%, feBUTJ
Gui,Add,Button, x689 y480 w66 h23 vfeBUTK gfeBUTK %fevis%, feBUTK
Gui,Add,Button, x689 y480 w66 h23 vfeBUTL gfeBUTL %fevis%, feBUTL
Gui,Add,Button, x689 y480 w66 h23 vfeBUTM gfeBUTM %fevis%, feBUTM
Gui,Add,Button, x689 y480 w66 h23 vfeBUTO gfeBUTO %fevis%, feBUTO
Gui,Add,Picture, x0 y0 w1 h1 vfePICA gfePICA %fevis%,
Gui,Add,Picture, x0 y0 w1 h1 vfePICB gfePICB %fevis%,
Gui,Add,Picture, x0 y0 w1 h1 vfePICC gfePICC %fevis%,
Gui,Add,Picture, x0 y0 w1 h1 vfePICD gfePICD %fevis%,
Gui,Add,Picture, x0 y0 w1 h1 vfePICE gfePICE %fevis%,
Gui,Add,Picture, x0 y0 w1 h1 vfePICF gfePICF %fevis%,
Gui,Add,Picture, x0 y0 w1 h1 vfePICG gfePICG %fevis%,
Gui,Add,Link, x0 y0 w1 h1 vfeLNKA gfeLNKA %fevis%,
Gui,Add,Link, x0 y0 w1 h1 vfeLNKB gfeLNKB %fevis%,
Gui,Add,CheckBox, x128 y120 vfeCHKD gfeCHKD %fevis%, feCHKD
Gui,Add,CheckBox, x128 y144 vfeCHKE gfeCHKE %fevis%, feCHKE
Gui,Add,CheckBox, x128 y168 vfeCHKF gfeCHKF %fevis%, feCHKF
Gui,Add,CheckBox, x128 y192 vfeCHKG gfeCHKG %fevis%, feCHKG
Gui,Add,CheckBox, x248 y72 vfeCHKH gfeCHKH %fevis%, feCHKH
Gui,Add,CheckBox, x256 y384 vfeCHKI gfeCHKI %fevis%, feCHKI
Gui,Add,CheckBox, x256 y408 vfeCHKJ gfeCHKJ %fevis%, feCHKJ
Gui,Add,CheckBox, x256 y432 vfeCHKK gfeCHKK %fevis%, feCHKK
Gui,Add,CheckBox, x256 y456 vfeCHKL gfeCHKL %fevis%, feCHKL
Gui,Add,CheckBox, x520 y400 vfeCHKM gfeCHKM %fevis%, feCHKM
Gui,Add,CheckBox, x376 y288 vfeCHKN gfeCHKN %fevis%, feCHKN
Gui,Add,CheckBox, x624 y440 vfeCHKO gfeCHKO %fevis%, feCHKO
Gui,Add,CheckBox, x624 y464 vfeCHKP gfeCHKP %fevis%, feCHKP
Gui,Add,CheckBox, x640 y216 vfeCHKQ gfeCHKQ %fevis%, feCHKQ
Gui,Add,CheckBox, x8 y440 vfeCHKA gfeCHKA %fevis%, feCHKA
Gui,Add,CheckBox, x8 y464 vfeCHKB gfeCHKB %fevis%, feCHKB
Gui,Add,CheckBox, x8 y490 vfeCHKC gfeCHKC %fevis%, feCHKC
Gui,Add,ComboBox, hwndCbxHndl67 x248 y312 w124 vfeCBXE gfeCBXE %fevis%, feCBXE||
Gui,Add,ComboBox, hwndCbxHndl68 x248 y336 w126 vfeCBXF gfeCBXF %fevis%, feCBXF||
Gui,Add,ComboBox, hwndCbxHndl69 x248 y360 w126 vfeCBXG gfeCBXG %fevis%, feCBXG||
Gui,Add,ComboBox, hwndCbxHndl70 x368 y144 w126 vfeCBXH gfeCBXH %fevis%, feCBXH||
Gui,Add,ComboBox, hwndCbxHndl71 x368 y168 w127 vfeCBXI gfeCBXI %fevis%, feCBXI||
Gui,Add,ComboBox, hwndCbxHndl72 x504 y272 w100 vfeCBXJ gfeCBXJ %fevis%, feCBXJ||
Gui,Add,ComboBox, hwndCbxHndl73 x8 y248 w120 vfeCBXA gfeCBXA %fevis%, feCBXA||
Gui,Add,ComboBox, hwndCbxHndl74 x8 y272 w120 vfeCBXB gfeCBXB %fevis%, feCBXB||
Gui,Add,ComboBox, hwndCbxHndl75 x8 y296 w120 vfeCBXC gfeCBXC %fevis%, feCBXC||
Gui,Add,ComboBox, hwndCbxHndl76 x8 y320 w120 vfeCBXD gfeCBXD %fevis%, feCBXD||
Gui,Add,DropDownList, hwndDplHndl112 x248 y168 w121 vfeDDLE gfeDDLE %fevis%, feDDLE||
Gui,Add,DropDownList, hwndDplHndl113 x248 y192 w121 vfeDDLF gfeDDLF %fevis%, feDDLF||
Gui,Add,DropDownList, hwndDplHndl114 x248 y216 w121 vfeDDLG gfeDDLG %fevis%, feDDLG||
Gui,Add,DropDownList, hwndDplHndl115 x504 y248 w100 vfeDDLH gfeDDLH %fevis%, feDDLH||
Gui,Add,DropDownList, hwndDplHndl116 x504 y344 w121 vfeDDLI gfeDDLI %fevis%, feDDLI||
Gui,Add,DropDownList, hwndDplHndl117 x8 y120 w121 vfeDDLC gfeDDLC %fevis%, feDDLC||
Gui,Add,DropDownList, hwndDplHndl118 x8 y144 w121 vfeDDLD gfeDDLD %fevis%, feDDLD||
Gui,Add,DropDownList, hwndDplHndl119 x8 y72 w121 vfeDDLA gfeDDLA %fevis%, feDDLA||
Gui,Add,DropDownList, hwndDplHndl120 x8 y96 w121 vfeDDLB gfeDDLB %fevis%, feDDLB||
Gui,Add,Edit, hwndEdtHndl63 x128 y24 w120 vfeEDTA gfeEDTA %fevis%, feEDTA
Gui,Add,Edit, hwndEdtHndl64 x128 y48 w120 vfeEDTB gfeEDTB %fevis%, feEDTB
Gui,Add,Edit, hwndEdtHndl65 x128 y72 w120 vfeEDTC gfeEDTC %fevis%, feEDTC
Gui,Add,Edit, hwndEdtHndl66 x128 y96 w88 vfeEDTD gfeEDTD %fevis%, feEDTD
Gui,Add,Edit, hwndEdtHndl67 x256 y480 w120 vfeEDTE gfeEDTE %fevis%, feEDTE
Gui,Add,Edit, hwndEdtHndl68 x368 y24 w88 vfeEDTF gfeEDTF %fevis%, feEDTF
Gui,Add,Edit, hwndEdtHndl69 x560 y56 w120 vfeEDTG gfeEDTG %fevis%, feEDTG
Gui,Add,UpDown, x454 y24 w17 h21 -16 %fevis% vfeUPDA gfeUPDA
Gui,Add,Edit, hwndEdtHndl70 x560 y80 w120 vfeEDTH gfeEDTH %fevis%, feEDTH
Gui,Add,UpDown, x726 y296 w17 h21 -16 %fevis% vfeUPDB gfeUPDB
Gui,Add,Edit, hwndEdtHndl71 x640 y296 w88 vfeEDTI gfeEDTI %fevis%, feEDTI
Gui,Add,UpDown, x214 y96 w17 h21 -16 %fevis% vfeUPDC gfeUPDC
Gui,Font,Bold
Gui,Add,GroupBox, x488 y24 w71 h29 vfeGRPA %fevis%, feGRPA
Gui,Add,GroupBox, x488 y56 w70 h29 vfeGRPB %fevis%, feGRPB
Gui,Add,GroupBox, x488 y88 w68 h29 vfeGRPC %fevis%, feGRPC
Gui,Add,GroupBox, x496 y176 w88 h19 vfeGRPD %fevis%, feGRPD
Gui,Add,GroupBox, x496 y200 w101 h19 vfeGRPE %fevis%, feGRPE
Gui,Add,GroupBox, x496 y224 w94 h19 vfeGRPF %fevis%, feGRPF
Gui,Add,GroupBox, x602 y392 w151 h45 vfeGRPG %fevis%, feGRPG
Gui,Font, normal
Gui,Add,Radio, x248 y96 vfeRad5A gfeRad5A %fevis%, feRad5A
Gui,Add,Radio, x248 y120 vfeRad5B gfeRad5B %fevis%, feRad5B
Gui,Add,Radio, x248 y144 vfeRad5C gfeRad5C %fevis%, feRad5C
Gui,Add,Slider, x128 y288 w120 h32 Range0-100 vfeSLDA gfeSLDA  %fevis%, 50
Gui,Add,Radio, x248 y24 vfeRad4A gfeRad4A %fevis%, feRad4A
Gui,Add,Radio, x248 y48 vfeRad4B gfeRad4B %fevis%, feRad4B
Gui,Add,Slider, x128 y320 w120 h32 Range0-100 vfeSLDB gfeSLDB %fevis%, 50
Gui,Add,Slider, x128 y352 w120 h32 Range0-100 vfeSLDD gfeSLDD %fevis%, 50
Gui,Add,Radio, x376 y192 vfeRad6A gfeRad6A %fevis%, feRad6A
Gui,Add,Radio, x376 y216 vfeRad6B gfeRad6B %fevis%, feRad6B
Gui,Add,Radio, x376 y240 vfeRad6C gfeRad6C %fevis%, feRad6C
Gui,Add,Radio, x376 y264 vfeRad6D gfeRad6D %fevis%, feRad6D
Gui,Add,Slider, x504 y368 w120 h24 Range0-100 vfeSLDE gfeSLDE %fevis%, 50
Gui,Add,Radio, x376 y320 vfeRad7A gfeRad7A %fevis%, feRad7A
Gui,Add,Radio, x376 y344 vfeRad7B gfeRad7B %fevis%, feRad7B
Gui,Add,Slider, x602 y408 w151 h25 Range0-100 vfeSLDC gfeSLDC %fevis%, 50
Gui,Add,Radio, x376 y464 vfeRad8A gfeRad8A %fevis%, feRad8A
Gui,Add,Radio, x376 y488 vfeRad8B gfeRad8B %fevis%, feRad8B
Gui,Add,Progress, x504 y296 w120 h20 -Smooth vfePRGB %fevis%, 0
Gui,Add,Radio, x504 y440 vfeRad9A gfeRad9A %fevis%, feRad9A
Gui,Add,Radio, x504 y464 vfeRad9B gfeRad9B %fevis%, feRad9B
Gui,Add,Radio, x504 y488 vfeRad9C gfeRad9C %fevis%, feRad9C
Gui,Add,Progress, x504 y320 w120 h20 -Smooth vfePRGA cBlue Range0-600 %fevis%, 0
Gui,Add,Radio, x640 y168 vfeRad10A gfeRad10A %fevis%, feRad10A
Gui,Add,Radio, x640 y192 vfeRad10B gfeRad10B %fevis%, feRad10B
Gui,Add,Listbox, hwndLbxHndl5 x128 y392 w120 h30 vfeLBXA gfeLBXA %fevis%, feLBXA||
Gui,Add,Radio, x640 y240 vfeRad11A gfeRad11A %fevis%, feRad11A
Gui,Add,Radio, x640 y264 vfeRad11B gfeRad11B %fevis%, feRad11B
Gui,Add,Listbox, hwndLbxHndl6 x128 y448 w120 h30 vfeLBXB gfeLBXB %fevis% +HScroll1500, feLBXB||
Gui,Add,Radio, x8 y24 vfeRad1A gfeRad1A %fevis%, feRad1A
Gui,Add,Radio, x8 y48 vfeRad1B gfeRad1B %fevis%, feRad1B
Gui,Add,ListView, x128 y424 w120 h19 -Hdr background%bgcolor% c%foreColor% hwndFELSTVA vfeLVA gfeLVA %fevis%, |
Gui,Add,Radio, x8 y168 vfeRad2A gfeRad2A %fevis%, feRad2A
Gui,Add,Radio, x8 y192 vfeRad2B gfeRad2B %fevis%, feRad2B
Gui,Add,Radio, x8 y216 vfeRad2C gfeRad2C %fevis%, feRad2C
Gui,Add,ListView, x128 y480 w121 h27 -Hdr background%bgcolor% c%foreColor% hwndFELSTVB vfeLVB gfeLVB %fevis%, |
Gui,Add,Radio, x8 y344 vfeRad3A gfeRad3A %fevis%, feRad3A
Gui,Add,Radio, x8 y368 vfeRad3B gfeRad3B %fevis%, feRad3B
Gui,Add,Radio, x8 y392 vfeRad3C gfeRad3C %fevis%, feRad3C
Gui,Add,Radio, x8 y416 vfeRad3D gfeRad3D %fevis%, feRad3D
Gui,Add,ListView, x496 y120 w141 h53 -Hdr background%bgcolor% c%foreColor% hwndFELSTVC vfeLVC gfeLVC %fevis%, |
Gui,Add,Text, x248 y240 vfeTXTA %fevis%, feTXTA
Gui,Add,Text, x248 y264 vfeTXTB %fevis%, feTXTB
Gui,Add,Text, x248 y288 vfeTXTC %fevis%, feTXTC
Gui,Add,Text, x376 y368 vfeTXTD %fevis%, feTXTD
Gui,Add,Text, x376 y392 vfeTXTE %fevis%, feTXTE
Gui,Add,Text, x376 y416 vfeTXTF %fevis%, feTXTF
Gui,Add,Text, x376 y440 vfeTXTG %fevis%, feTXTG
Gui,Add,Text, x640 y344 vfeTXTH %fevis%, feTXTH
Gui,Add,Text, x640 y368 vfeTXTI %fevis%, feTXTI
Gui,Add,Text, x696 y344 vfeTXTJ %fevis%, feTXTJ
Gui,Add,Text, x696 y368 vfeTXTK %fevis%, feTXTK
Gui,Add,Text, x624 y488 vfeTXTL %fevis%, feTXTL
Gui,Add,Text, x560 y24 vfeTXTM %fevis%, feTXTM
Gui,Add,Text, x688 y24 vfeTXTN %fevis%, feTXTN
Gui,Add,Text, x688 y48 vfeTXTO %fevis%, feTXTO
Gui,Add,Text, x688 y72 vfeTXTP %fevis%, feTXTP
Gui,Add,Text, x688 y96 vfeTXTQ %fevis%, feTXTQ
Gui,Add,Text, x504 y416 vfeTXTS %fevis%,
Gui,Add,Text, x504 y432 vfeTXTT %fevis%,
Gui,Add,Text, x505 y400 vfeTXTR %fevis%,
gosub, feDDLJ
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; [ARCHIVE TAB] ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
Gui,Tab, 6
Gui,Tab, DAT:=:Repo
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Gui,Add,Radio, x9 y14 vDETSORT gDETSORT hidden Checked, Detect
Gui,Add,Radio, x9 y28 vSELSORT gSELSORT hidden disabled, Select
Gui,Add,Checkbox, x105 y28 vDETECTXTN gDETECTXTN disabled hidden, Detect Ext
Gui,Add,Checkbox, x275 y28 vDETHSHSZ gDETHSHSZ hidden, Limit Size
Gui,Add,Checkbox, x205 y28 vKNOWNDRP gKNOWNDRP hidden Checked, Limit Ext
Gui,Add,DropDownList, hwndDplHndl172 x9 y46 w260 vDRPSEL gDRPSEL hidden disabled,Select a System||%allsupport%
Gui,Add,Checkbox, x9 y70 vMOVDRP gMOVDRP checked hidden, Move Dropped
Gui,Add,Checkbox, x114 y70 vRENMDRP gRENMDRP checked hidden, Rename ROM
Gui,Add,Checkbox, x215 y70 vOVRWDRP gOVRWDRP checked hidden, Overwrite
Gui,Add,Checkbox, x9 y84 vSRCHDRP gSRCHDRP checked hidden, Search Compressed
Gui,Add,Checkbox, x9 y98 vJAKDRP gJAKDRP hidden, Jacketize Dropped
Gui,Add,Radio, x136 y98 vJAKBF gJAKBF hidden Checked disabled, Individuate
Gui,Add,Radio, x224 y98 vJAKAFT gJAKAFT hidden disabled, Consolidate
Gui,Add,ListBox, x9 y120 w329 h200 hwndDATLBX multi vDATLBX gDATLBX hidden,|
Gui,Add,Edit, x370 y2 w260 vSRTFLT gSRTFLT hidden,
Gui,Add,Button,x350 y3 w15 h15 vSRTCLRFLT gSRTCLRFLT hidden,X
Gui,Add,ListView,x350 y24 w388 h470 hwndLvwHnd4 vDRPLV gDRPLV hidden,|
Gui,Add,DropDownList, x8 y324 w283 hwndDplHndl173 vDATDRPD gDATDRPD hidden,%alldats%
Gui,Add,Button, x92 y348 w51 h19 vBRWSDAT gBRWSDAT hidden, Browse
Gui,Add,Radio, x8 y352 vTOSECDATYP gTOSECDATYP checked hidden, TOSEC
Gui,Add,Radio, x8 y374 vMAMEDATYP gMAMEDATYP hidden, MAME
Gui,Add,Radio, x8 y396 vNOINTDATYP gNOINTDATYP hidden, NO-INTRO
Gui,Add,Radio, x8 y414 vRDUMPDATYP gRDUMPDATYP hidden, REDUMP
Gui,Add,Button, x295 y324 w43 h19 vADDATS gADDATS hidden, Add
Gui,Font, Bold
Gui,Add,Button,x290 y465 w53 h29 vHASHALLROMS gHASHALLROMS hidden, SORT
Gui,Font, Normal
Gui,Add,Button, x695 y3 w43 h19 vADDSRTFILE gADDSRTFILE hidden, File
Gui,Add,Button, x636 y3 w55 h19 vADDSRTDIR gADDSRTDIR hidden, Directory
Gui,Add,Button, x740 y3 w15 h15 vHLTDATP gHLTDATP hidden,-
Gui,Add,DropDownList, x6 y481 w120 hwndDplHndl174 vDATREPO gDATREPO hidden,TOSEC||NO-INTRO|REDUMP|MAME
Gui,Add,Button, x135 y483 w73 h17 vGETDATREP gGETDATREP hidden, Download
Gui,Add,Progress, x742 y20 w10 h465 Vertical -Smooth vARCDPRGRS, 0
if (VERSION <> "[CURV]")
	{
		Loop,parse,SORTROMTAB,|
			{
				guicontrol,show,%A_LoopField%
			}
		goto, GUIJAKLOC
	}
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Gui,Add,GroupBox, x3 y2 w344 h284 +0x400000 vARCGSYS Center,
Gui,Font,Bold
Gui,Add,Radio, x130 y4 vSortROMS gSortROMS,Sort
Gui,Add,Radio, x180 y4 vARCTAB gArcTab Checked,Repo
Gui,Font,Normal
Gui,Add,DropDownList, hwndDplHndl121 x24 y29 w260 vARCSYS gArchiveSystems, Select a System||%syslist%
Gui,Add,ComboBox, hwndCbxHndl121 x26 y29 w260 vARCCBX gArchiveCBX +0x2 +E0x5000 Right hidden, Select a System||%syslist%
Gui,Add,Edit, x370 y2 w260 vARCMFLT gARCMFLT,
Gui,Add,Button,x350 y3 w15 h15 vARCLRFLT gARCLRFLT,X
Gui,Add,Button,x9 y32 w15 h17 vfltrRpoBtn gfltrRpoBtn,E
Gui,Add,DropDownList, hwndDplHndl122 x24 y51 w138 vARCCORES gArcCores, Emu_Preset||%runlist%
Gui,Add,Checkbox, x169 y51 h10 vREDWN gReDownload, Redownload
Gui,Add,CheckBox, x178 y74 h13 vDOWNONLY gDownOnly, Download Only
Gui,Add,CheckBox, x189 y78 h13 vstrmvid gSTRMVID hidden, Stream
Gui,Add,Button,  x265 y50 w75 h23 vARCLNCH gArcLaunch disabled,PLAY ::>
Gui,Add,ComboBox, hwndCbxHndl77 x88 y78 w126 vCUSTMOPT gCustmOpt hidden,|%INJOPT%
Gui,Add,ComboBox, hwndCbxHndl78 x218 y78 w123 vCUSTMARG gCustmArg hidden,|
Gui,Add,CheckBox, x26 y75 w65 h17 vCUSTSWITCH gCustSwitch, switches
Gui,Add,Checkbox, x280 y14 w25 vENHAK gENHAK,+hacks
Gui,Add,Checkbox, x9 y14 w25 vMAMESWCHK gMAMESWCHK,MAME
Gui,Add,DropDownList, hwndDplHndl123 x28 y258 w225 vUrlTxt gREPOUrlEdt, %ArcSRC%||%ARCSRCS%Add Repository
Gui,Add,Button, x255 y259 h18 vALTURLGET gALTURLGET,Download
Gui,Add,Button, x320 y259 h18 vADDRPOL gADDRPOL,F
Gui,Add,Edit, hwndEdtHndl74 x28 y302 w310 h21 vSRCHEDT gSearchInp %EULAOPT%,
Gui,Font,Bold
Gui,Add,Button, x42 y323 w75 h23 vSearchArc gSearchArc, SEARCH
gui,Font,Normal
Gui,Add,Radio, x32 y287 h13 vAincTog gAincTog checked,Include
Gui,Add,Radio, x93 y287 h13 vAexcTog gAexcTog,exclude
Gui,Add,DropDownList, hwndDplHndl124 x124 y324 w199 vSRCHDDL gSRCHDDL, All||%syslist%
Gui,Add,Button, x329 y326 w15 h15 vExpndASrch gExpndASrch hidden,+
Gui,Add,listbox, x24 y346 w320 h147 +Multi +HScroll HWNDsrchpopu vSRCHRSLT gArcSrchRes hidden,
Gui,Add,listbox, x350 y24 w388 h464 +Multi +HScroll HWNDarcpopu vARCPOP gArcPopulateList,
Gui,Add,Button, x655 y3 w61 h15 vCLIPURL gClipURL, CLIP URL
Gui,Add,CheckBox, x26 y100 h15 vEXTRURL gExtractURL,Extract ROM
Gui,Add,CheckBox, x118 y100 h15 vEXTEXPLD gEXTEXPLD hidden, explode
Gui,Add,CheckBox, x185 y100 h15 vRUNXTRACT gRunXtract Checked Hidden, Run ROM
Gui,Add,Checkbox, x266 y100 h15 vArcMove gArcMove hidden,cleanup
Gui,Add,Checkbox, x222 y138 h16 vArcCull gArcCull checked hidden,[ ( Consolidate ) ]
Gui,Add,Checkbox, cred x242 y138 h15 vSortOverride gSortOverride +0x200 hidden, Global Override
Gui,Add,Button, x25 y157 w59 h17 vSETOVD gSetOvd disabled, BROWSE
Gui,Add,CheckBox, x26 y119 h15 vJACKETMODE gDWNINJACK,Jacketize
Gui,Add,Edit, hwndEdtHndl75 x96 y116 h21 w218 vRNMJACK gRNMJACK hidden
Gui,Add,CheckBox, x26 y138 h17 vOVDCHK gOvdChk, Override Save Directory
Gui,Add,DropDownList, hwndDplHndl125 x87 y155 w254 vOVDLDS gOvDlds disabled,|Matching||%systmfldrs%
Gui,Add,Edit, hwndEdtHndl76 x23 y177 +Wrap w318 h35 vOVDTXT Disabled,
Gui,Font,Bold
Gui,Add,Text, cred x93 y495 w531 h15 vARCDET Center,
Gui,Add,Button, x740 y3 w15 h15 vCLRNETP gCLRNETP,-
Gui,font,Normal
GUIJAKLOC:
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; [JACKETS TAB] ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Gui,Tab, 7
Gui,Tab, Jackets
Gui,Add,DropDownList, hwndDplHndl126 x14 y12 w245 vRJSYSDD gRJSYSDD disabled, Systems||%systmfldrs%
Gui,Add,DropDownList, hwndDplHndl127 x13 y36 w64 vRJINCEXCL gRJINCEXCL disabled, All||A-Z|#
Gui,Add,Button, x79 y35 w37 h23 vRJSETRANGE gRJSETRANGE hidden, Range
Gui,Add,Text, x83 y40 h23 vRJRNGTXT, Range
Gui,Add,DropDownList, hwndDplHndl128 x126 y36 w100 vRJLSTYP gRJLSTYP disabled, Jackets+ROMs||Jackets ONLY|ROMs ONLY|All files
Gui,Add,Button, x228 y35 w49 h23 vRJRFRSHLST gRJRFRSHLST disabled, Refresh
Gui,Add,Edit, hwndEdtHndl77 x13 y61 w30 h21 Number vRJEDTD gRJEDTD hidden, 0
Gui,Add,Edit, hwndEdtHndl78 x13 y61 w30 h21 Limit1 vRJEDTDN gRJEDTDN hidden, A
Gui,Add,Text, x47 y65 h13 vRJTXTH hidden, to
Gui,Add,Edit, hwndEdtHndl79 x58 y61 w30 h21 Number vRJEDTB gRJEDTB hidden, 1000
Gui,Add,Edit, hwndEdtHndl80 x58 y61 w30 h21 Limit1 vRJEDTBN gRJEDTBN hidden, Z
Gui,Add,Button, x91 y59 w31 h23 vRJFLTRLST gRJFLTRLST hidden, Filter
Gui,Add,Edit, hwndEdtHndl81 x122 y60 w118 h21 vRJEDTC gRJEDTC disabled,
Gui,Add,Button, x241 y59 w35 h23 vRJFNDINLST gRJFNDINLST disabled, Find
Gui,Add,ListView, x12 y86 w254 h414 -Hdr -ReadOnly altsubmit Multi background%bgcolor% c%foreColor% vRJLSTV gRJLSTV hwndRJLV checked,|
/*  ;;[DEBUGOV]
RJRN1 := New LV_InCellEdit(RJLV)
RJRN1.SetColumns(1)
*/  ;;[DEBUGOV]
Gui,Add,Button, x267 y119 w56 h24 vRJSALITMS gRJSALITMS disabled, ALL
Gui,Add,Text, x267 y143 h14 vRJTXTN,Selects All ROMs
Gui,Add,GroupBox, x266 y155 w100 h113 vRJGRPN
Gui,Add,CheckBox, x267 y165 h15 vRJCHKL gRJCHKL disabled, Launchers
Gui,Add,CheckBox, x267 y180 h15 vRJCHKM gRJCHKM disabled, Config Files
Gui,Add,CheckBox, x267 y195 h15 vRJCHKP gRJCHKP disabled, Joystick Profiles
Gui,Add,CheckBox, x267 y210 h15 vRJCHKH gRJCHKH disabled, Logs
Gui,Add,CheckBox, x271 y250 h15 vRJCHKI gRJCHKI disabled, Emulators
Gui,Add,Button, x284 y226 w55 h21 vRJDELCOMP gRJDELCOMP Disabled, Delete
Gui,Add,Text, x274 y270 h18 vRLSTOT,total item #
Gui,Font, Bold
Gui,Add,GroupBox, x278 y26 w107 h88 vRJGRPA, System Settings
Gui,Font, Normal
Gui,Add,CheckBox, x301 y12 h13 vRJCHKG gRJCHKG Checked disabled, Auto-Pop
Gui,Add,Radio,x296 y45 h13 vRJSYSRADA gRJSYSRAD checked disabled, Reset
Gui,Add,Radio, x296 y60 h13 vRJSYSRADB gRJSYSRAD disabled, Default ;Settings
Gui,Add,Radio, x296 y76 h13 vRJSYSRADC gRJSYSRAD disabled, Custom ;Settings
Gui,Add,Button, x281 y91 w42 h20 vRJSYSLOAD gRJSYSLOAD disabled, Load ;Settings
Gui,Add,Button, x326 y91 w42 h20 vRJSYSSAV gRJSYSSAV disabled, Save ;Settings
Gui,Add,Button, x368 y95 w12 h14 +0x800 vRJSYSSAVAS gRJSYSSAVAS disabled, v ;Settings
Gui,Font, Bold
Gui,Add,GroupBox, x388 y6 w371 h109 vRJGRPG, Keymapper
Gui,Font, Normal
Gui,Add,CheckBox, x398 y27 h13 vRJENMAP gRJENMAP disabled, Enable ;Mapper
Gui,Add,Checkbox, x679 y15 h13 vRJOVKM gRJOVKM Disabled, Overwrite
Gui,Add,Text, x513 y28 h13 vRJTXTC, JoyMapper
Gui,Add,Text, x601 y28 h13 vRJTXTF, Return Profile
Gui,Add,DropDownList, hwndDplHndl129 x398 y42 w167 vRJMAPDD gRJMAPDD Disabled, %keympr%||Antimicro|Xpadder|other
Gui,Add,ComboBox, hwndCbxHndl79 x568 y42 w161 vRJMAPRET gRJMAPRET Disabled, %kmprd%\Mediacenter%kmprxtn%||%kmprd%\nolayout1%kmprxtn%
Gui,Add,Button, x732 y41 w21 h23 vRJMAPRETOPN gRJMAPRETOPN Disabled, O ;bounceproflie
Gui,Add,Radio, x398 y64 h13 vRJMAP1ROFTYPA gRJMAP1ROFTYPA Disabled, Joy 1
Gui,Add,Radio, x398 y79 h13 vRJMAP1ROFTYPB gRJMAP1ROFTYPB Disabled Checked, Kb 1
Gui,Add,Radio, x398 y95 h13 vRJMAP1ROFTYPC gRJMAP1ROFTYPC Disabled, Blank 1
Gui,Add,Text, x504 y92 h13 vRJTXTD, Joy 1 Profile
Gui,Add,ComboBox, hwndCbxHndl80 x449 y70 w100 vRJMAP1PL gRJMAP1PL Disabled, Player1%kmprxtn%||%kmprd%\nolayout1%kmprxtn%
Gui,Add,Button, x550 y68 w21 h23 vRJMAP1PLOPN gRJMAP1PLOPN Disabled, O ;player1profile
Gui,Add,Radio, x579 y65 h13 vRJMAP2ROFTYPA gRJMAP2ROFTYPA Disabled, Joy 2
Gui,Add,Radio, x579 y80 h13 vRJMAP2ROFTYPB gRJMAP2ROFTYPB Disabled Checked, Kb 2
Gui,Add,Radio, x579 y96 h13 vRJMAP2ROFTYPC gRJMAP2ROFTYPC Disabled, Blank 2
Gui,Add,Text, x689 y94 h13 vRJTXTE, Joy 2 Profile
Gui,Add,ComboBox, hwndCbxHndl81 x631 y70 w100 vRJMAP2PL gRJMAP2PL Disabled, Player2%kmprxtn%||%kmprd%\nolayout2%kmprxtn%
Gui,Add,Button, x732 y69 w21 h23 vRJMAP2PLOPN gRJMAP2PLOPN Disabled, O ;player2profile
Gui,Font,Bold
Gui,Add,GroupBox, x371 y115 w191 h117 vRJGRPI, Launchers
Gui,Font,Normal
Gui,Add,CheckBox, x391 y132 h13 vRJENLNCHR gRJENLNCHR disabled, Create ;Launcher Creation
Gui,Add,CheckBox, x467 y122 w90 h20 +0x20 vRJLNCHOVR gRJLNCHOVR Disabled, Overwrite ;Launchers
Gui,Add,Radio, x487 y144 h13 vRJRad4B gRJRad4B Disabled, Global
Gui,Add,Radio, x487 y160 h13 vRJRad4A gRJRad4A checked  Disabled, Per-Game
Gui,Add,Checkbox, x379 y149 vRJEXEB gRJEXEB disabled, Per-EXE
Gui,Add,Text, x379 y163 vRJTXTBP, preset
Gui,Add,DropDownList, hwndDplHndl130 x379 y177 w156 vRJEMUPRECFG gRJEMUPRECFG Disabled, %emulist%
Gui,Add,CheckBox, x379 y199 h21 w60 vRJCHKQ gRJCHKQ Disabled, Other
Gui,Add,Button, x484 y199 w75 h23 vRJBUTM gRJBUTM Disabled, Browse
Gui,Add,CheckBox, x384 y218 h23 +0x20 vRJCHKK gRJCHKK Disabled, Write ROM-Name to Launcher
Gui,Font,Bold
Gui,Add,GroupBox, x567 y115 w192 h97 vRJGRPE, Jacketize
Gui,Font,Normal
Gui,Add,CheckBox, x572 y130 h13 vRJCHKA gRJCHKA disabled, Jacketize
Gui,Add,Button, x740 y152 w16 h16 vRJADDSUBD gRJADDSUBD disabled, +
Gui,Add,Button, x740 y167 w16 h16 vRJREMSUBD gRJREMSUBD disabled, X
Gui,Add,ComboBox, hwndCbxHndl82 x646 y156 w92 vRJSUBDCBX gRJSUBDCBX disabled, %SUBDLST%
Gui,Add,Text, x608 y155 w33 h18 vRJTXTA1 +0x200, sub-dir
Gui,Add,CheckBox, x684 y179 w58 h13 +0x20 vRJSUBDH gRJSUBDH checked disabled, Hidden
Gui,Add,DropDownList, hwndDplHndl131 x651 y125 w84 vRJCNSLDD gRJCNSLDD Disabled, ()[]||()|[]|Individuate
Gui,Add,CheckBox,x741 y126 h13 w16 vRJENCNSLD gRJENCNSLD Disabled,  ;Consolidate Individuate
Gui,Add,CheckBox, x569 y178 h13 vRJENXTRARC gRJENXTRARC Disabled, Extract Archives
Gui,Add,Radio, x572 y192 h13 vRJXTRARCA gRJXTRARCA Disabled, Before
Gui,Add,Radio, x572 y206 h13 vRJXTRARCB gRJXTRARCB checked  Disabled, After
Gui,Add,Text, x627 y204 h13 vRJTXTK, and
Gui,Add,DropDownList, hwndDplHndl132 x649 y197 w100 vRJXTRARCDD gRJXTRARCDD Disabled, Store||Delete|Keep
Gui,Font,Bold
Gui,Add,GroupBox, x565 y227 w194 h112 right vRJGRPF, Pre Cmd/ Post Cmd
Gui,Font,Normal
Gui,Add,Button, x568 y282 w21 h23 vRJBUTV gRJBUTV disabled, ~ ;Edit Command
Gui,Add,Radio, x642 y247 h13 vRJRad11A gRJRad11A disabled, Local
Gui,Add,Radio, x694 y247 h13 vRJRad11B gRJRad11B checked disabled, Absolute
Gui,Add,CheckBox, x571 y263 w43 h18 vRJCHKW gRJCHKW +0x20 disabled, Wait
Gui,Add,DropDownList, hwndDplHndl133 x615 y261 w118 vRJDDLF gRJDDLF disabled, Pre-Command||Post-Command
Gui,Add,Button, x735 y260 w16 h16 vRJBUTG gRJBUTG disabled, + ;PrePost Add
Gui,Add,ComboBox, hwndCbxHndl83 x590 y283 w143 vRJCBXH gRJCBXH +0x2 +E0x5000 Right hidden,
Gui,Add,DropDownList, hwndDplHndl134 x590 y283 w143 vRJDDLP gRJDDLP +0x2 +E0x5000 Right disabled,
Gui,Add,Button, x620 y308 w43 h23 vRJBUTO gRJBUTO hidden, Add
Gui,Add,Edit, hwndEdtHndl82 x590 y308 w163 vRJEDTO gRJEDTO disabled,
Gui,Add,Button, x735 y282 w16 h16 vRJBUTH gRJBUTH disabled, X ;PrePostDelete
Gui,Font,Bold
Gui,Add,GroupBox, x524 y340 w235 h86 vRJGRPD, Disk Mounting
Gui,Font,Normal
Gui,Add,CheckBox, x627 y349 h13 vRJENDMNT gRJENDMNT disabled, Enable ;Disc Mounting
Gui,Add,DropDownList, hwndDplHndl135 x530 y364 w132 vRJDMNTDD gRJDMNTDD Disabled, DaemonTools||VirtualCloneDrive|WinCDEmu|%vdskwin%Other
Gui,Add,Button, x706 y361 w47 h22 vRJDIMGET gRJDIMGET Disabled, Browse
Gui,Add,Radio, x530 y390 h13 vRJRad8A gRJRad8A Disabled checked, pre-Emulator Run
Gui,Add,Radio, x530 y406 h13 vRJRad8B gRJRad8B Disabled, post-Emulator Run
Gui,Add,Checkbox, x661 y386 h17 vRJENDMOV +0x20 gRJENDMOV Disabled, Disk Override
Gui,Font,Bold
Gui,Add,GroupBox, x503 y430 w256 h77 vRJGRPC, Emulator Config Files
Gui,Font,Normal
Gui,Add,Text, x510 y463 h18 vRJTXTL, Pre-Run
Gui,Add,CheckBox, x627 y443 h13 vRJCHKF gRJCHKF Disabled, Create ;CfgCrea	tion
Gui,Add,CheckBox, x687 y443 h13 vRJCHKO gRJCHKO Disabled, Overwrite
Gui,Add,ComboBox, hwndCbxHndl84 x557 y459 w158 vRJPRECFGCBX gRJPRECFGCBX disabled,
Gui,Add,Button, x715 y458 w16 h16 vRJADDPRECFG gRJADDPRECFG disabled, + ;Add Pre Cfg Cmd
Gui,Add,Button, x734 y458 w16 h16 vRJREMPRECFG gRJREMPRECFG disabled, - ;Remove Pre Cfg Cmd
Gui,Add,Text, x505 y486 h18 vRJTXTM, Post-Run
Gui,Add,ComboBox, hwndCbxHndl85 x557 y481 w158 vRJPOSTCFGCBX gRJPOSTCFGCBX disabled,
Gui,Add,Button, x715 y480 w16 h16 vRJADDPOSTCFG gRJADDPOSTCFG disabled, + ;Add Post Cfg Cmd
Gui,Add,Button, x734 y480 w16 h16 vRJREMPOSTCFG gRJREMPOSTCFG disabled, - ;Remove Pre Cfg Cmd
Gui,Add,CheckBox, x401 y269 h15 vRJCHKR gRJCHKR disabled, Multi-Disk
Gui,Add,ComboBox,x372 y247 w191 vRJCBXJ gRJCBXJ Disabled, (Disk 1 of||(Disk 1 of|(Disk A|Disk 1
Gui,Add,Text, x484 y270 vRJTXTJ, disk identifiers
Gui,Add,CheckBox, x270 y290 h17 w13 vRJLNCHTYP gRJLNCHTYP checked disabled,
Gui,Add,ComboBox, hwndCbxHndl87 x287 y289 w274 vRJEMUXTCBX gRJEMUXTCBX Disabled, .exe`,.cmd`,,bat||.bin`,.cue
Gui,Add,Text, x275 y314 h16 vRJTXTG, ROM extensions
Gui,Add,CheckBox, x374 y315 h17 vRJCHKU gRJCHKU checked Disabled, Quotes
Gui,Add,CheckBox, x429 y315 h17 vRJCHKT gRJCHKT checked Disabled, Path
Gui,Add,CheckBox, x487 y315 h17 vRJCHKS gRJCHKS checked Disabled, Extension
Gui,Add,ComboBox, hwndCbxHndl88 x284 y340 w158 vRJEOPTSCBX gRJEOPTSCBX Disabled, %rjemuopt%
Gui,Add,Text, x454 y344 h17 vRJTXTZ, options
Gui,Add,ComboBox, hwndCbxHndl89 x284 y364 w158 vRRJEARGSCBX gRRJEARGSCBX Disabled, %rjemuarg%
Gui,Add,Text, x456 y365 h17 vRJTXT1A, arguments
Gui,Add,CheckBox, x435 y388 h17 vRJZJP gRJZJP checked disabled, Zip-Peek
Gui,Add,Radio, x284 y415 h18 vRJRAD1A gRJRAD1A checked disabled, Run from Emulator Directory
Gui,Add,Radio, x284 y397 h18  vRJRAD1B gRJRAD1B disabled, Run from ROM Directory
gui,add,Button, x278 y494 h18 vRJCHKJ gRJCHKJ disabled, Preview Queue
Gui,Add,DropDownList, hwndDplHndl136 x273 y437 w199 vRJQLSTDD gRJQLSTDD Disabled, QUEUE||%SYSTMQ%
Gui,Add,Button, x276 y465 w60 h23 vRJADDQ gRJADDQ Disabled, ADD
Gui,Add,Button, x477 y438 w16 h16 vRJREMQSYS gRJREMQSYS Disabled, X
Gui,Add,Text, x340 y468 h15 v vRJTXTAB, %RJQNUM% Systems
CNFRMT= Disabled
if (RJQNUM > 0)
{
	CNFRMT=
}
Gui,Add,Button, x407 y460 w91 h40 vRJPROCQ gRJPROCQ %CNFRMT% Disabled, CONFIRM %RJQNUM%
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; [UTILITIES TAB] ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Gui,Tab, 8
Gui,Tab, Util
utltog= Hide
utlvis= Hidden
Gui,Add,Button, x128 y216 w75 h23 vutlBUTA gutlBUTA %utlvis%, utlBUTA
Gui,Add,Button, x128 y240 w75 h23 vutlBUTB gutlBUTB %utlvis%, utlBUTB
Gui,Add,Button, x128 y264 w75 h23 vutlBUTC gutlBUTC %utlvis%, utlBUTC
Gui,Add,Button, x368 y120 w75 h23 vutlBUTG gutlBUTG %utlvis%, utlBUTG
Gui,Add,Button, x368 y48 w75 h23 vutlBUTD gutlBUTD %utlvis%, utlBUTD
Gui,Add,Button, x368 y72 w75 h23 vutlBUTE gutlBUTE %utlvis%, utlBUTE
Gui,Add,Button, x368 y96 w75 h23 vutlBUTF gutlBUTF %utlvis%, utlBUTF
Gui,Add,Button, x640 y120 w75 h23 vutlBUTH gutlBUTH %utlvis%, utlBUTH
Gui,Add,Button, x640 y144 w75 h23 vutlBUTI gutlBUTI %utlvis%, utlBUTI
Gui,Add,Button, x689 y480 w66 h23 vutlBUTJ gutlBUTJ %utlvis%, utlBUTJ
Gui,Add,CheckBox, x128 y120 vutlCHKD gutlCHKD %utlvis%, utlCHKD
Gui,Add,CheckBox, x128 y144 vutlCHKE gutlCHKE %utlvis%, utlCHKE
Gui,Add,CheckBox, x128 y168 vutlCHKF gutlCHKF %utlvis%, utlCHKF
Gui,Add,CheckBox, x128 y192 vutlCHKG gutlCHKG %utlvis%, utlCHKG
Gui,Add,CheckBox, x248 y72 vutlCHKH gutlCHKH %utlvis%, utlCHKH
Gui,Add,CheckBox, x256 y384 vutlCHKI gutlCHKI %utlvis%, utlCHKI
Gui,Add,CheckBox, x256 y408 vutlCHKJ gutlCHKJ %utlvis%, utlCHKJ
Gui,Add,CheckBox, x256 y432 vutlCHKK gutlCHKK %utlvis%, utlCHKK
Gui,Add,CheckBox, x256 y456 vutlCHKL gutlCHKL %utlvis%, utlCHKL
Gui,Add,CheckBox, x520 y400 vutlCHKM gutlCHKM %utlvis%, utlCHKM
Gui,Add,CheckBox, x376 y288 vutlCHKN gutlCHKN %utlvis%, utlCHKN
Gui,Add,CheckBox, x624 y440 vutlCHKO gutlCHKO %utlvis%, utlCHKO
Gui,Add,CheckBox, x624 y464 vutlCHKP gutlCHKP %utlvis%, utlCHKP
Gui,Add,CheckBox, x640 y216 vutlCHKQ gutlCHKQ %utlvis%, utlCHKQ
Gui,Add,CheckBox, x8 y440 vutlCHKA gutlCHKA %utlvis%, utlCHKA
Gui,Add,CheckBox, x8 y464 vutlCHKB gutlCHKB %utlvis%, utlCHKB
Gui,Add,CheckBox, x8 y490 vutlCHKC gutlCHKC %utlvis%, utlCHKC
Gui,Add,ComboBox, hwndCbxHndl90 x248 y312 w124 vutlCBXE gutlCBXE %utlvis%, utlCBXE||
Gui,Add,ComboBox, hwndCbxHndl91 x248 y336 w126 vutlCBXF gutlCBXF %utlvis%, utlCBXF||
Gui,Add,ComboBox, hwndCbxHndl92 x248 y360 w126 vutlCBXG gutlCBXG %utlvis%, utlCBXG||
Gui,Add,ComboBox, hwndCbxHndl93 x368 y144 w126 vutlCBXH gutlCBXH %utlvis%, utlCBXH||
Gui,Add,ComboBox, hwndCbxHndl94 x368 y168 w127 vutlCBXI gutlCBXI %utlvis%, utlCBXI||
Gui,Add,ComboBox, hwndCbxHndl95 x504 y272 w100 vutlCBXJ gutlCBXJ %utlvis%, utlCBXJ||
Gui,Add,ComboBox, hwndCbxHndl96 x8 y248 w120 vutlCBXA gutlCBXA %utlvis%, utlCBXA||
Gui,Add,ComboBox, hwndCbxHndl97 x8 y272 w120 vutlCBXB gutlCBXB %utlvis%, utlCBXB||
Gui,Add,ComboBox, hwndCbxHndl98 x8 y296 w120 vutlCBXC gutlCBXC %utlvis%, utlCBXC||
Gui,Add,ComboBox, hwndCbxHndl99 x8 y320 w120 vutlCBXD gutlCBXD %utlvis%, utlCBXD||
Gui,Add,DropDownList, hwndDplHndl137 x248 y168 w121 vutlDDLE gutlDDLE %utlvis%, utlDDLE||
Gui,Add,DropDownList, hwndDplHndl138 x248 y192 w121 vutlDDLF gutlDDLF %utlvis%, utlDDLF||
Gui,Add,DropDownList, hwndDplHndl139 x248 y216 w121 vutlDDLG gutlDDLG %utlvis%, utlDDLG||
Gui,Add,DropDownList, hwndDplHndl140 x504 y248 w100 vutlDDLH gutlDDLH %utlvis%, utlDDLH||
Gui,Add,DropDownList, hwndDplHndl141 x504 y344 w121 vutlDDLI gutlDDLI %utlvis%, utlDDLI||
Gui,Add,DropDownList, hwndDplHndl142 x640 y320 w100 vutlDDLJ gutlDDLJ %utlvis%, utlDDLJ||
Gui,Add,DropDownList, hwndDplHndl143 x8 y120 w121 vutlDDLC gutlDDLC %utlvis%, utlDDLC||
Gui,Add,DropDownList, hwndDplHndl144 x8 y144 w121 vutlDDLD gutlDDLD %utlvis%, utlDDLD||
Gui,Add,DropDownList, hwndDplHndl145 x369 y17 w153 vutlDDLA gutlDDLA, Executable||Cloud|Migrate
Gui,Add,DropDownList, hwndDplHndl146 x8 y96 w121 vutlDDLB gutlDDLB %utlvis%, utlDDLB||
Gui,Add,Edit, hwndEdtHndl83 x128 y24 w120 vutlEDTA gutlEDTA %utlvis%, utlEDTA
Gui,Add,Edit, hwndEdtHndl84 x128 y48 w120 vutlEDTB gutlEDTB %utlvis%, utlEDTB
Gui,Add,Edit, hwndEdtHndl85 x128 y72 w120 vutlEDTC gutlEDTC %utlvis%, utlEDTC
Gui,Add,Edit, hwndEdtHndl86 x128 y96 w88 vutlEDTD gutlEDTD %utlvis%, utlEDTD
Gui,Add,Edit, hwndEdtHndl87 x256 y480 w120 vutlEDTE gutlEDTE %utlvis%, utlEDTE
Gui,Add,Edit, hwndEdtHndl88 x368 y24 w88 vutlEDTF gutlEDTF %utlvis%, utlEDTF
Gui,Add,Edit, hwndEdtHndl89 x560 y56 w120 vutlEDTG gutlEDTG %utlvis%, utlEDTG
Gui,Add,UpDown, x454 y24 w17 h21 -16 %utlvis% vutlUPDA gutlUPDA
Gui,Add,Edit, hwndEdtHndl90 x560 y80 w120 vutlEDTH gutlEDTH %utlvis%, utlEDTH
Gui,Add,UpDown, x726 y296 w17 h21 -16 %utlvis% vutlUPDB gutlUPDB
Gui,Add,Edit, hwndEdtHndl91 x640 y296 w88 vutlEDTI gutlEDTI %utlvis%, utlEDTI
Gui,Add,UpDown, x214 y96 w17 h21 -16 %utlvis% vutlUPDC gutlUPDC
Gui,Font,Bold
Gui,Add,GroupBox, x488 y24 w71 h29 vutlGRPA %utlvis%, utlGRPA
Gui,Add,GroupBox, x488 y56 w70 h29 vutlGRPB %utlvis%, utlGRPB
Gui,Add,GroupBox, x488 y88 w68 h29 vutlGRPC %utlvis%, utlGRPC
Gui,Add,GroupBox, x496 y176 w88 h19 vutlGRPD %utlvis%, utlGRPD
Gui,Add,GroupBox, x496 y200 w101 h19 vutlGRPE %utlvis%, utlGRPE
Gui,Add,GroupBox, x496 y224 w94 h19 vutlGRPF %utlvis%, utlGRPF
Gui,Add,GroupBox, x602 y392 w151 h45 vutlGRPG %utlvis%, utlGRPG
Gui,Font, normal
Gui,Add,listbox, x128 y392 w120 h30 hwndUTILBXA vutlLBXA gutlLBXA %utlvis%, utlLBXA||
Gui,Add,listbox, x128 y448 w120 h30 hwndUTILBXB vutlLBXB gutlLBXB %utlvis%, utlLBXB||
Gui,Add,ListView, x128 y424 w120 h19 -Hdr background%bgcolor% c%foreColor% hwndUTILVA vutlLVA gutlLVA %utlvis%, |
Gui,Add,ListView, x128 y480 w121 h27 -Hdr background%bgcolor% c%foreColor% hwndUTILVB vutlLVB gutlLVB %utlvis%, |
Gui,Add,ListView, x496 y120 w141 h53 -Hdr background%bgcolor% c%foreColor% hwndUTILVC vutlLVC gutlLVC %utlvis%, |
Gui,Add,Progress, x504 y296 w120 h20 -Smooth vutlPRGB %utlvis%, 0
Gui,Add,Progress, x504 y320 w120 h20 -Smooth vutlPRGA %utlvis%, 0
Gui,Add,Radio, x248 y120 vutlRad5B gutlRad5B %utlvis%, utlRad5B
Gui,Add,Radio, x248 y144 vutlRad5C gutlRad5C %utlvis%, utlRad5C
Gui,Add,Radio, x248 y24 vutlRad4A gutlRad4A %utlvis%, utlRad4A
Gui,Add,Radio, x248 y48 vutlRad4B gutlRad4B %utlvis%, utlRad4B
Gui,Add,Radio, x248 y96 vutlRad5A gutlRad5A %utlvis%, utlRad5A
Gui,Add,Radio, x376 y192 vutlRad6A gutlRad6A %utlvis%, utlRad6A
Gui,Add,Radio, x376 y216 vutlRad6B gutlRad6B %utlvis%, utlRad6B
Gui,Add,Radio, x376 y240 vutlRad6C gutlRad6C %utlvis%, utlRad6C
Gui,Add,Radio, x376 y264 vutlRad6D gutlRad6D %utlvis%, utlRad6D
Gui,Add,Radio, x376 y320 vutlRad7A gutlRad7A %utlvis%, utlRad7A
Gui,Add,Radio, x376 y344 vutlRad7B gutlRad7B %utlvis%, utlRad7B
Gui,Add,Radio, x376 y464 vutlRad8A gutlRad8A %utlvis%, utlRad8A
Gui,Add,Radio, x376 y488 vutlRad8B gutlRad8B %utlvis%, utlRad8B
Gui,Add,Radio, x504 y440 vutlRad9A gutlRad9A %utlvis%, utlRad9A
Gui,Add,Radio, x504 y464 vutlRad9B gutlRad9B %utlvis%, utlRad9B
Gui,Add,Radio, x504 y488 vutlRad9C gutlRad9C %utlvis%, utlRad9C
Gui,Add,Radio, x640 y168 vutlRad10A gutlRad10A %utlvis%, utlRad10A
Gui,Add,Radio, x640 y192 vutlRad10B gutlRad10B %utlvis%, utlRad10B
Gui,Add,Radio, x640 y240 vutlRad11A gutlRad11A %utlvis%, utlRad11A
Gui,Add,Radio, x640 y264 vutlRad11B gutlRad11B %utlvis%, utlRad11B
Gui,Add,Radio, x8 y168 vutlRad2A gutlRad2A %utlvis%, utlRad2A
Gui,Add,Radio, x8 y192 vutlRad2B gutlRad2B %utlvis%, utlRad2B
Gui,Add,Radio, x8 y216 vutlRad2C gutlRad2C %utlvis%, utlRad2C
Gui,Add,Radio, x8 y24 vutlRad1A gutlRad1A %utlvis%, utlRad1A
Gui,Add,Radio, x8 y344 vutlRad3A gutlRad3A %utlvis%, utlRad3A
Gui,Add,Radio, x8 y368 vutlRad3B gutlRad3B %utlvis%, utlRad3B
Gui,Add,Radio, x8 y392 vutlRad3C gutlRad3C %utlvis%, utlRad3C
Gui,Add,Radio, x8 y416 vutlRad3D gutlRad3D %utlvis%, utlRad3D
Gui,Add,Radio, x8 y48 vutlRad1B gutlRad1B %utlvis%, utlRad1B
Gui,Add,Slider, x128 y288 w120 h32 Range0-100 vutlSLDA gutlSLDA  %utlvis%, 50
Gui,Add,Slider, x128 y320 w120 h32 Range0-100 vutlSLDB gutlSLDB %utlvis%, 50
Gui,Add,Slider, x128 y352 w120 h32 Range0-100 vutlSLDD gutlSLDD %utlvis%, 50
Gui,Add,Slider, x504 y368 w120 h24 Range0-100 vutlSLDE gutlSLDE %utlvis%, 50
Gui,Add,Slider, x602 y408 w151 h25 Range0-100 vutlSLDC gutlSLDC %utlvis%, 50
Gui,Add,Text, x248 y240 vutlTXTA %utlvis%, utlTXTA
Gui,Add,Text, x248 y264 vutlTXTB %utlvis%, utlTXTB
Gui,Add,Text, x248 y288 vutlTXTC %utlvis%, utlTXTC
Gui,Add,Text, x376 y368 vutlTXTD %utlvis%, utlTXTD
Gui,Add,Text, x376 y392 vutlTXTE %utlvis%, utlTXTE
Gui,Add,Text, x376 y416 vutlTXTF %utlvis%, utlTXTF
Gui,Add,Text, x376 y440 vutlTXTG %utlvis%, utlTXTG
Gui,Add,Text, x504 y416 vutlTXTS %utlvis%,
Gui,Add,Text, x504 y432 vutlTXTT %utlvis%,
Gui,Add,Text, x505 y400 vutlTXTR %utlvis%,
Gui,Add,Text, x560 y24 vutlTXTM %utlvis%, utlTXTM
Gui,Add,Text, x640 y344 vutlTXTH %utlvis%, utlTXTH
Gui,Add,Text, x640 y368 vutlTXTI %utlvis%, utlTXTI
Gui,Add,Text, x688 y24 vutlTXTN %utlvis%, utlTXTN
Gui,Add,Text, x688 y48 vutlTXTO %utlvis%, utlTXTO
Gui,Add,Text, x688 y72 vutlTXTP %utlvis%, utlTXTP
Gui,Add,Text, x688 y96 vutlTXTQ %utlvis%, utlTXTQ
Gui,Add,Text, x696 y344 vutltTXTJ %utlvis%, utltTXTJ
Gui,Add,Text, x696 y368 vutlTXTK %utlvis%, utlTXTK
Gui,Add,Text, x624 y488 vutltTXTL %utlvis%, utltTXTL
Gui,Add,Picture, x0 y0 w66 h66 vutlPICA %utlvis%, 
;;;;;;;;;;;;;;;;;        ----    END MENU SYSTEM    ----        ;;;;;;;;;;;;;;;;;;;
Gui,Add,Listbox, hwndLbxHndl7 x488 y330 w50 h50 vDropHideLBX gGuiDropFiles Hidden, Drop ROM here
gosub, DestroySplashGUI
TrayTip
Menu,Tray,Add,Activate,AWYONTGL
Menu,Tray,Add,Mini-Mode,MINIMODET
Menu,Tray,Add,Exit,QUITOUT
Menu,Tray,Tip
Gui,+LastFound
GuiIDn:=WinExist()
GuiID:= WinExist("Ahk_PID " DllCall("GetCurrentProcessId"))
/*  ;;[DEBUGOV]
Menu, tray, NoStandard
Loop,108
	{
		CtlColors.Attach(EdtHndl%a_Index%, bgcolor, foreColor)
	}	
Loop,125
	{
		CtlColors.Attach(CbxHndl%a_Index%, bgcolor, foreColor)
	}	
Loop,172
	{
		CtlColors.Attach(DplHndl%a_Index%, bgcolor, foreColor)
	}	
CtlColors.Attach(RUNCORE, bgcolor, foreColor)
Loop,8
	{
		CtlColors.Attach(LbxHndl%A_index%, bgcolor, foreColor)
	}
lbxhwnds= localromp|trxvail|eavlbx|AVWIND|prisl|nocrsl|LFTLSTBX|insel|IMGWIND|srchpopu|arcpopu|UTILBXA|UTILBXB	
Loop,Parse,lbxhwnds,|
	{
		CtlColors.Attach(%A_LoopField%, bgcolor, foreColor)
	}
*/  ;;[DEBUGOV]
Gui, Show, Autosize,skeletonKey
SplashTextOff
Guicontrol,,TABMENU,|Settings|:=: MAIN :=:||Emu:=:Sys|Playlists|Frontends|DAT:=:Repo|Jackets|Util
/*  ;;[DEBUGOV]
ADDNSYS_TT :="Name of the new system`nRight-Click for more options"
ADJS_TT :="Automatically assigns joysticks."
ALTURL_TT :="Enables login-restricted titles"
ALSLV_TT :="Allows connections in slave mode.  Requires less processing power for client and host,`nbut suffers from network latency."
ANLDP_TT :="Uses the analog stick as the directional pad for systems without an analog stick"
APORTNUM_TT :="The open port to your hosting session"
APPARG_TT :="Arguments for the emulator.`nThese are specified after the $ROM`nenter ''[CUSTMARG]'' to allow custom argumnts at runtime"
APPOPT_TT :="Options for the emulator.`nThese are specified after the exe and before the $ROM`nenter ''[CUSTMOPT]'' to allow custom options at runtime"
ARCCORES_TT :="Select a core to use"
ARCHOST_TT :="Hosts the selected ROM."
ARCLOGIN_TT :="Repository Login/username/email"
ARCLNCH_TT :="Play the selected rom using current settings."
ARCNCT_TT := "Connect to the selected host with the selected repository ROM"
ARCPASS_TT :="Archive.org login password."
ARCPOP_TT :="POPULATED ROMS"
ARCMFLT_TT :="Filter for current list"
ARCLRFLT_TT :="clears the current filter"
ARCSYS_TT :="Select a System to populate ROMs"
GBLpgs_TT :="Enables per-game settings for all presets."
ARDCORE_TT :="Assigns an alternative retroArch core to the selected system."
ART_TT :="Rate-Control"
AUTSYS_TT :="Auto Selects a system based upon the selected host's core."
ASYNC_TT :="Syncs audio"
RUNSYBTN_TT :="search the systems"
AUM_TT :="Allows all users to controll the menu"
AUO_TT :="Auto-loads core and game overrides"
AUTOASPECT_TT :="if this is true and video_aspect_ratio is not set`nthen the aspect ratio is decided by libretro implementation`nIf this is false, 1:1 PAR will always be assumed if video_aspect_ratio is not set."
AUTOCORE_TT := "Automatically match the host's selected core`nUnchecking allows users to select a core from your libretro (cores) diretectory"
AUTOLNCH_TT :="Automatically runs the dropped ROM using the current system/core.`nuncheck to change settings for the dropped ROM before launching"
AUTSHD_TT :="Automatically does the thing"
RAINSTLBX_TT :="Latest cores and updates available on the libretro buildbot."
BBOT_TT :="Cores available on the Libtretro BuildBot"
BCKCORE_TT :="Creates a backup of your original and updated cores and retroarch.`n(renamed to retroarch.exe.orig or ''.bak'' / core_libretro.dll.orig or ''.bak'')"
BFI_TT :="for 120hz monitors.  Inserts a black frame to interpolate 60hz games)"
BOXCVR_TT :="Front of the box"
BRADD_TT := "Browse for ROMs to add to your current playlist."
CGSLCT_TT := "Should work with most display modes"
CGSHDVAR_TT :="CG Shader"
MINISWITCH_TT :="Hold Alt and Left-Mouse Button to drag mini-skeletonKey."
VRSTRABUT_TT :="   Global Retroarch Reset`n   right-click to undo reset."
CHKPORTS_TT :="Checks each host to determine if the hosting port can recieve a connection.`n-- Can slow down lobby population, but reduces trouble-shooting difficulties. --"
CHECKFRAMES_TT :="Increase this number the further away you are from your partner"
CHEMUINST_TT :="Select a destination directory for the selected emulator.`n The emulator will be installed into its own folder"
CINC_TT :="Currently Installed Cores"
CLIENTSWITCH_TT :="Connect to hosts."
RNMJACK_TT :="RE/Name of the Jacket`n**  if not empty, all selected files will be saved to this jacket name **`nThe File-Name will be used if this field is empty"
CLIPURL_TT :="Copies the currently selected ROM's URL to the clipboard"
CLRCUROM_TT := "Clear the currently selected ROM's settings and core."
CLRDDL_TT :="Define the color of menu and video display items."
CLRPL_TT :="Clears Playlist"
CLRPLYR_TT :="Clears the settings for all controls.`n''nul''"
CLRPP_TT :="Clears populated ROMs"
CLRTHM_TT :="Color theme"
DYNTRANS_TT :="Dynamically enables\disables and sets the transparency of skeletonKey to 20`% when launching emulators."
CMPAN_TT :="Shows a brief description of menu items in the XMB GUI"
CNCTBUT_TT :="Connects/Invades using selected settings."
COREOPTCPY_TT :="Copies current core-options at launch`n then copies back changes made in retroarch."
CPORTNUM_TT :="Port of the Host."
CPYPL_TT :="Add selected ROMs to your current playlist"
CRNTCORS_TT :="Currently installed cores"
CROP_TT :="Crops video to fit the selected aspect ratio"
CSTCMD_TT :="Enter any options you wish to use (disables currently selected ROM)"
CSTCRE_TT :="allows you to specify a libretro core in any location"
CSTRAARGF_TT :="enter the location of a core_libretro.dll"
CSTRAOPTF_TT :="any options can be typed in here"
CURPLST_TT :="ROMs here will be added to the playlist"
CUSTSWITCH_TT :="Enables custom options/arguments replacing`n ''[CUSTMOPT]'' and ''[CUSTMARG]'''`nspecified for applications in the core-associations section of the install tab."
CUSTSWITCHS_TT :="Enables custom options/arguments replacing`n ''[CUSTMOPT]'' and ''[CUSTMARG]'''`nspecified for applications in the core-associations section of the install tab."
D3DDRV_TT :="works with the RGUI menu only"
D3D11_TT :="DirectX 11"
D3D12_TT :="DirectX 12"
EMUAUTOA_TT :="Any currently detected systems supported will have this emulator appended"
MAMESWCHK_TT :="Loads MAME softlist ROMs"
CUSTMOPT_TT :="Custom options replacing ''[CUSTMOPT]'' specified for applications in the'`ncore-associations section of the install tab"
CUSTMOPTS_TT :="Custom options replacing ''[CUSTMOPT]'' specified for applications in the'`ncore-associations section of the install tab"
CUSTMARG_TT :="Custom arguments replacing ''[CUSTMARG]'' specified for applications in the'`ncore-associations section of the install tab"
CUSTMARGS_TT :="Custom arguments replacing ''[CUSTMARG]'' specified for applications in the'`ncore-associations section of the install tab"
DAPP_TT :="Assign an application to the selected system."
DATEMNU_TT :="Shows the time and date in the main menu"
DCORE_TT :="Resets the currently selected system to its associated retroArch core."
DELCORECFG_TT :="Deletes current core-configuration file"
DETECTCORE_TT := "Allows RetroArch to autodetect or allow uers to assign a core to ROMs upon launching from the playlist"
DISPLRATXT_TT :="The currently detected retroarch settings"
DISPLSKTXT_TT :="The currently detected skeletonkey settings"
RUNFLRAD_TT :="Downlods folder (core_assets_directory)"
DOWNONLY_TT :="Downloads the selected ROM only. "
EMPRDDL_TT :="Selects an emulator preset"
EMPRBUTA_TT :="Adds the selected preset to the current system's association-list"
EMPRLST_TT :="The associated emulator presets for the currently selected system.`nThe Priority is listed at the top of this list."
EMPRBUTU_TT :="Prioritises the selected preset in the list."
EMPRBUTX_TT :="Removes the selected preset from the list."
DELCFGPGC_TT :="Deletes all per-game skeletetonkey-configurations for the selected emulator."
DPIOVR_TT :="Override the dpi of the video font"
EMUGUIDDL_TT :="skeletonkey will automatically populate the main tab with the gui of this emulator when enabled."
TMPDISPL_TT :="The temp directory location"
SETTMPD_TT :="Set the location for temp files."
DBLESCP_TT :="Allows retroarch to be closed with a double escape-press`nas opposed to a single press"
DTCOMP_TT :="Toggles desktop compositing.`n Works in windows 7 and older only"
DUTYCYCLE_TT :="How long the period of a turbo-enabled button should be.`nNumbers are in frames"
DWNLPOS_TT := "Folders populating your core-assets directory (Downloads)"
DYNWALL_TT :="Selects wallpaper which matches the current playlist item."
DirBut_TT :="Select a location"
SYSINSTLBX_TT :="The system for which you'd like to install an emulator for."
EINSTLOC_TT :="The location of the emulator.`nYou can also drag and drop an executable file"
EMUASIGN_TT :="Sets the default override assignment to the currently selected emulator.`neg: ROM-Jacket's preferred keymapper"
ESDWNLPOS_TT :="The current system-list"
ESPLCORE_TT :="The Displayed Name for the ROM and the type of search for images."
ESBACKUP_TT :="Backup the current gamelist.xml"
ESSVPL_TT :="Creates the gamelist.xml"
RJLNCHTYP_TT :="Enables ROM as the argument."
ESPLXMP_TT :="The name of the system"
ESOPENPL_TT :="Open a gamelist.xml for editing."
ESCPYSCR_TT :="copies and renames scraped images to the ''downloaded_images'' folder`nin the home-folder of emulationStation."
ESUSESCR_TT :="Uses any scraped content unless otherwise specified."
ESBOXSRCHBUT_TT :="Overrides and sets the path to box-art images."
ESRPOPDL_TT :="Populates the ROM-List with Jackets."
ESRPOPPL_TT :="Populates the ROM-List with Mirrored-Links."
ESRPOPROM_TT :="Populates the ROM-List with All Files found in a directory."
ESMIRSEL_TT :="The Selected mirror from which to populate the ROM-List."
ESROMROOT_TT :="Selects a directory to populate the ROM-List."
INSTEMUDDL_TT :="Select an emulator for the selected system"
EMUINST_TT :="Downloads and installs the selected emulator"
EXCLBOOL_TT :="Excludes the ROM list using filtered extensions."
EXELIST_TT :="Install RetroArch executable and assets"
EXTINP_TT :="extensions to assign.`nseparate by a comma.`neg: bin,zip,rom"
EXTRURL_TT :="If the ROM is a compressed archive, it will be extracted"
EMUDETECT_TT :="Detects emulators`nThis may take a minute or two depending on the number of executables in your Emulators Directory"
EXTPARSED_TT :="Comma separated extensions to filter ROMs.`nDo not include spaces or periods"
FILESERV_TT :="Enables the file-server to allow clients to download your currently hosted ROM"
FILTEXT_TT :="Filter files being show in 'Load Content' by supported extensions"
FILTSEL_TT :="Browse for a filter"
FLICKF_TT :="try different values"
FLK_TT :="may help with flickering"
FLTXT_TT :="Filters the ROM list for given extensions."
FNDGUI_TT :="Expands or shrinks the search window"
FNTSZ_TT :="Sets the video-font display size"
FORCEAR_TT :="Forces rendering area to stay equal to content aspect ratio or as defined in video_aspect_ratio."
FORCEROM_TT := "Forces the connection using a selected ROM"
FRAMEDELAY_TT :="Increase this number the further away you are from your partner"
FRMDL_TT :="Sets how many milliseconds to delay after VSync before running the core.`n Can reduce latency at cost of higher risk of stuttering."
FSREZ_TT :="Monitor resolution"
GCUPDT_TT :="Checks for updates to all existing cores"
GDIDRV_TT :="older machines may need to use this mode`nworks with RGUI menu only"
GLBLAUDIO_TT :="toggles the audio output."
GLSLCT_TT := "Works with OpenGL"
GLSHDVAR_TT :="GL Shader"
GMENU_TT :="For phones and crap"
GPUSS_TT :="Snaps screenshots as they are displayed through your videocard (with shaders)"
GPUVREC_TT :="Records video as it's displayed through your videocard (with shaders)"
GPUV_TT :="Sets how many frames CPU can run ahead of GPU when using video_hard_sync."
GRAVER_TT :="Detect RetroArch version and build number"
QRSETUP_TT :="Quick-setup RetroArch with popular cores."
GROM_TT :="Browse for a ROM"
GTHMB_TT :="Browse for any jpg or png file to use as a thumbnail."
HKEYDD_TT :="hotkeys define emulator and retroArch abilities.`n''Input_enable_hotkey'' should be used to minimize conflicts"
RUNPLRAD_TT :="Playlists in your playlists directory"
HOSTCORES_TT := "Filter rooms using by core"
HOSTIP_TT :="Your current IP Address"
HOSTSWITCH_TT :="Host ROMS."
LNCHPRDDL_TT :="Sets detected system's emulator-priority"
LNCHPT_TT :="Assigns all supported systems for the selected emulator`n`n  Selecting *Emulators* will assign the default/preferred emulator `nto the system if available."
AUTOPGS_TT :="Loads settings saved for the ROM in supported emulators."
HOVPREV_TT :="Preview images by hovering over the button or dropdown menu."
HSYNC_TT :="Attempts to hard-synchronize CPU and GPU. Can reduce latency at cost of performance."
HostButton_TT :="Hosts the currently selected ROM"
IDDINP_TT :="direct input driver"
IDSDLINP_TT :="legacy driver"
IMGFLS_TT :="Thumnail image files"
INCLBOOL_TT :="Filter the list to include extensions."
INJPORTABLE_TT :="Saves and configures the current settings"
INTG_TT :="Only scales video in integer steps.`nhe base size depends on system-reported geometry and aspect ratio.`nIf video_force_aspect is not set, X/Y will be integer scaled independently."
INVADE_TT :="Enables the invade option allowing skeletonKey to auto-detect selected host strings."
INETHOST_TT :="Enables hosting through retroarch's relay-server if a direct connection can not be initialized or a port cannot be opened to the server."
IPORTNUM_TT :="Port for your retroArch Host to recieve clients on."
JCFGADD_TT :="Create a custom name for input-remapping configuration file."
JOYCORE_TT :="core to customize an input-remapping configuration."
JSDLDRV_TT :="legacy driver"
JXINDRV_TT :="xbox360/xbox one/ps3/ps4 and compatible joystick driver"
KARC_TT :="Keep archives after downloading and extracting`n***   It is reccommended to keep this off   ***`Turning this on will prompt to overwrite any existing core archives while updating."
KBGP_TT :="Enables using the keyboard as a gamepad"
LANIPRAD_TT :="Local network address"
LATENCY_TT :="Desired audio latency in milliseconds. Might not be honored if driver can't provide given latency."
LCORE_TT :="Select an emulator/core"
LNCHBUT_TT :="Launch the currently displayed ROM`nRight-Click for emulator-quick-select"
JACKETMODE_TT :="Downloads the ROM to a directory of its title"
LOCEMUIN_TT :="Selects an emulator executable and assigns it to the selected systems"
SRCHROMEDT_TT :="Search for a ROM`n do not include wildcards (*) or other special characters"
SRCHLOCDDL_TT :="Search within"
RUNSYSCBX_TT :="system filter"
LOADRACORE_TT :="Loads a core-options configuration."
MGPC_TT :="The joystick button combo to open the GUI menu."
MINLAT_TT :="The number of frames of input latency for netplay to use to hide network latency.`nReduces jitter and makes netplay less CPU-intensive at the expense of input lag."
MNUACT_TT :="Define the button which will be assigned to menu functions"
MNUFLT_TT :="Filters the menu display using a linear filter"
MNUJOY_TT :="The button number as it corresponds to default values in the joystick tab"
MNUPNT_TT :="Enable touch input inside the menu."
MNUSYS_TT :="Select System"
MONUM_TT :="0 automatically detects and uses the primary monitor"
MOUSEON_TT :="Allows you to use the mouse within the XMB GUI."
MSWCHI_TT :="Tells the video driver to use a specified buffering mode.`n3 is good for slower machines.  2 for stronger."
MULTILNK_TT :="Assigns a single system nickname-identfier for all selected systems.`nf"
MUTE_TT :="Mutes all audio"
ENHAK_TT :="Displays a list containing the currrent systems'`nhacks`naltenates`noverdumps and broken`nbetas`ntranslations`nunlicensed"
MXUSR_TT :="Maximum users displayed in the GUI"
NAVWRAP_TT :="Revolves the menu when reaching the end"
NETCONNECT_TT := "Connect to the selected host"
RELYSRV_TT := "Relay-Server location."
NETCORE_TT := "Assigns a core to the ROM to connect to the selected host"
NETCOREASSETS_TT :="Select a filter for skeletonKey to search within.`n -- Selecting ''All_Playlists'' -- will search through every playlist for a matching ROM. --"
NETDWNL_TT := "Select a subdirectory from your core-assets directory."
NETIPRAD_TT :="Internet ip address"
AUTOBIOS_TT :="Automatically downloads and installs BIOS files for supported emulators"
NETNAME_TT :="Your netplay user name"
NETPLIST_TT := "Select a playlist file to parse for the matching ROM"
ExpndASrch_TT :="Expands and contrats the search-list"
NETPW_TT :="Netplay Password"
NETROMLIST_TT := "The ROM which will be used to connect with the currenly selected host"
NETROM_TT := "Browse for a ROM file"
NETHROM_TT := "Browse for a ROM file to host"
NETCROM_TT := "Browse for a ROM file to connect with"
NETSPECPW_TT :="Netplay spectator password"
NOROT_TT :="Don't rotate the video"
NOSTATE_TT := "Extremely Low-Latency netwok play can try to sync using`na mode which does not use save states."
OEMUDEL_TT :="Deletes the Current emulator from the apps.ini list."
OEMUSV_TT :="Saves the Current emulator to your Emulators list using the nickname"
OEMUNICK_TT :="NickName of the custom emulator"
OGLDRV_TT :="OpenGL is the default and most compatible option"
EXTARUN_TT :="Extracts the rom from an archive (7z/zip/rar) to the temp directory before launching"
OMITPTH_TT :="Runs the ROM using only the file.`n--Useful for mame--"
OMITQ_TT :="Removes quqtes from the ROM`n--useful for mame--"
OPACDDL_TT :="Set the opacity of the selected item using the slider."
OPNCORE_TT :="Displays emulator and core-configuration options"
OPNPLST_TT :="Open a .lpl playlist file to edit.`n** You can not ADD items while editing an existing ''open'' playlists**"
OPNSYS_TT :="Add a customized system."
CnclOsys_TT :="Cancel creation/rename."
RUNSYSDDL_TT :="A playlist file or Downloads subdirectory containing ROMs."
OUTFS_TT :="Fills the entire screen with retroArch"
OUTFW_TT :="When in fullscreen mode, will use the current monitor resolution"
OUTW_TT :="Displays retroArch in a window"
OVDCHK_TT :="Overrides the default directory for downloaded archives."
OVLIST_TT :="Up to 4 sets of extensions can be reassigned to a core or emulator."
PARSEALL_TT :="Will not filter any ROMs."
HISAPND_TT :="Append All Launched ROMs to the history file."
PAUSEBG_TT :="Pauses retroarch when not the top window"
PAUSMNU_TT :="Pauses the currently active media while in the menu"
PGCONFG_TT :="Creates a config file for every ROM in the currently selected playlist assigned to a core/emulator`n ie:        ''DETECT'' cannot be specified`n"
PGM_TT :="Use game-specifc overrides"
PLAPPND_TT :="Appends ROMs in your currently selected playlist to a playlist with the same name."
PLCORE_TT := "Selects a core to assign to ROMs in the active playlist"
	PLINIT_TT :="Recreates the playlist datbase for netplay."
PLNAMEDT_TT :="Gloabally identified pre-existing names for playlists`n(You can also type your own names)"
PLOVR_TT :="Overwrites playlists and per-ROM config files with identical names."
POLLING_TT :="Influence how input polling is done inside retroArch.`nSetting to ''Early'' or ''Late'' can result in less latency`ndepending on  your configuration"
PRBFND_TT :="String to replace`nLeaving this blank will enable skeletonKey to search for the default assets_directory:`n''\retroarch\downloads''"
PRBREP_TT := "Should be your current portable download folder`n''retroarch's assets_directory''"
PplTxt_TT :="changes absolute paths to relative paths where possible in retroarch configurations"
PSTIP_TT :="Pastes the i.p address:portnumber"
PLLISTALL_TT :="selects all items"
PLLISTN_TT :="deselects all items"
PLLISTSORT_TT :="Alphabetically sorts the list by ROM Title."

PthBut_TT := "Select the file"
PRVTSV_TT :="Disables netplay visibility for public servers`n(Private hosting)"
RALIST_TT :="Install RetroArch game and emulator cores."
RATESLD_TT :="offset"
RECURSE_TT :="Searches subdirectories for files'"
REDWN_TT :="Re-download the ROM if it exists.`n(existing ROM will be renamed to .bak"
REFHOSTS_TT :="Refreshes the lobby with currently hosted ROMs."
REFRESH_TT :="refresh rate"
REMPB_TT :="Automatically loads joystick mappings"
REMPL_TT :="Removes selected ROMs from your current playlist"
RESETCOREOPT_TT := "Resets the currently selected core options to default settings"
RETROM_TT := "Enables retrieving the rom from the host's file-server"
REWEN_TT :="Enables rewinding.`nRewind may increase lag"
REWGRAN_TT :="lower values increase the amount of smoothness of rewind"
REZV_TT :="Video resolution"
RIBN_TT :="Background ribbon display"
RETALFE_TT :="Launches Retroarch using current settings."
SortOverride_TT :="Overrides each system's settings for download location/extraction"
RJSYSDD_TT :="System to Process"
RJButA_TT :="Create or copy  a system."
RJINCEXCL_TT :="ROM-List to display"
RJCHKG_TT :="Automatically populates the ROM-List with content`nUnchecking this will enable filtering before population."
RJRFRSHLST_TT :="Refreshes the ROM-List"
RJEDTD_TT :="ROM-Number to begin listing`neg:0 will list first rom"
RJEDTDN_TT :="Any ROMs/Jackets Beginning with and alphabetically after this letter are listed.`neg: Enter 0 to include all ''numbered'' ROMs/Jackets"
RJEDTB_TT :="ROM-Number to end listing`neg:0 will list LAST ROM"
RJEDTBN_TT :="Any ROMs/Jackets beginning with this letter will not be listed"
RJEDTO_TT :="Options to add to the current command"
RJLSTYP_TT :=" Content to list"
RJFLTRLST_TT :="Filters between two alphanumeric characters"
RJEDTC_TT :="Filters the ROM-List for all content containing the entered characters."
RJFNDINLST_TT :="Searches and displays content for the current system"
RJLSTV_TT :="ROM-List`nJackets have a '':'' prefix."
RJSALITMS_TT :="Selects ALL items in the ROM-List"
AltURLSet_TT :="Adds a Repository"
RJCHKL_TT :="Deletes Launchers for the selected items in the ROM-List"
RJCHKM_TT :="Deletes Config Files for the selected items in the ROM-List"
RJCHKP_TT :="Deletes Joystick Profiles for the selected items in the ROM-List"
RJDELCOMP_TT :="Deletes checked items for the selected items in the ROM-List"
RJSYSRADA_TT :="Loads the previous existing settings for the system"
RJSYSRADB_TT :="Loads the default settings for the system"
RJSYSRADC_TT :="Changing the default or previous settings will toggle this"
RJSYSSAV_TT :="Previous settings for the system are overwritten with current ones."
RJENMAP_TT :="Enables the keymapper"
RJOVKM_TT :="Will create new keymapper profiles`nand overwrite any existing ones"
RJMAPDD_TT :="Keymapper program"
RJMAPRET_TT :="Profile to load when the emulator exits."
RJMAPRETOPN_TT :="Select the Return-profile`n(this is usaually a profile which can control the frontend"
RJMAP1ROFTYPA_TT :="Assigns Joystick presets for player 1"
RJMAP1ROFTYPB_TT :="Assigns Keyboard presets for player 1"
RJMAP1ROFTYPC_TT :="Assigns a blank profile for player 1"
RJMAP1PL_TT :="Profile to load for Player 1"
RJMAP1PLOPN_TT :="Select the profile for player 1"
RJMAP2ROFTYPA_TT :="Assigns Joystick presets for player 2"
RJMAP2ROFTYPB_TT :="Assigns Keyboard presets for player 2"
RJMAP2ROFTYPC_TT :="Assigns a blank profile for player 2"
RJMAP2PL_TT :="Player 2 keymapper profile"
RJMAP2PLOPN_TT :="Select the profile for player 2"
RJSYSSAVAS_TT :="Save As"
RJSYSLOAD_TT :="Load a preset"
RJENLNCHR_TT :="Create launchers"
RJLNCHOVR_TT :="Overwrites existing launchers with current settings"
RJRad4B_TT :="Disables Per-Game configurations"
RJRad4A_TT :="Enables Per-Game configurations"
RJEXEB_TT :="Extracts the emulator to each ROM-Jacket`n(where supported)"
RJEMUPRECFG_TT :="Emulator Preset"
RJEMUPRM_TT :="Configure Emulator Preset"
RJCHKQ_TT :="Enables a user-defined alternative emulator to be selected"
RJBUTM_TT :="Select an emulator executable"
RJCHKK_TT :="Each launcher is injected with the unique ROM's name.`nif disabled, the ROM is ''found'' by the launcher.`nEnabling this option will dramatically increase launcher-creation time"
RJCHKW_TT :="Wait for command to exit"
RJCHKA_TT :="ROMs are moved into folders of their respective names"
RJENCNSLD_TT :="Will help wrangle multi-disk games, duplicates, clones and regional versions of ROMs.`n''()'' and ''[]'' notations are removed from ROM-Jacket names."
RJENXTRARC_TT :="Extracts .7z, .zip and .rar files"
RJXTRARCA_TT :="Archives are extracted before jackets are created."
RJXTRARCB_TT :="Archives are extracted after jackets are created."
RJXTRARCDD_TT :="Store will move archives to skeletonKey's temp directory`nDelete will delete the archive after extraction`nKeep will not delete or move the archive"
CLRFLTR_TT :="Resets the current filter`nright-click for filter-options"
INSFLTR_TT :="Filters the current list"
MVPLOU_TT :="Moves an item up in the playlist."
MVPLOD_TT :="Moves an item down in the playlist."
DONATELNK_TT :="You can donate to me and I will thank you personally."
RJRad11A_TT :="File is in the jacket`nLocal path: eg: run.cmd"
RJRad11B_TT :="File is anywhere`nAbsolute path: eg: C:\run.cmd"
RJDDLF_TT :="Pre-command is a file executed before the emulator launches`nPost-command is a file executed after the emulator launches"
RJBUTG_TT :="Adds a command"
RJBUTV_TT :="Edits selected command"
RJDDLP_TT :="Current absolute command"
RJCBXH_TT :="Current local command"
RJBUTH_TT :="Deletes the selected command"
EMRad11A_TT :="File is in the jacket`nLocal path: eg: run.cmd"
EMRad11B_TT :="File is anywhere`nAbsolute path: eg: C:\run.cmd"
EMDDLF_TT :="Pre-command is a file executed before the emulator launches`nPost-command is a file executed after the emulator launches"
EMBUTG_TT :="Adds a command"
EMBUTV_TT :="Edits selected command"
EMDDLP_TT :="Current absolute command"
EMCBXH_TT :="Current local command"
EMBUTH_TT :="Deletes the selected command"
RJENDMNT_TT :="Enables Disc-Mounting"
RJDMNTDD_TT :="Disc-Mounting program"
RJDIMGET_TT :="Overrides any disc found by skeletonKey"
RJRad8A_TT :="Mounts the disc before the emulator is run"
RJRad8B_TT :="Mounts the disc after the emulator is run"
RJENDMOV_TT :="Enables a disc to be selected and override any disc found in a jacket"
RJCHKF_TT :="Create emulator configuration files"
RJCHKO_TT :="Overwrites existing configuration files"
RJRad6A_TT :="Copies configuration files to the emulator directory"
RJRad6B_TT :="Moves configuration files to the emulator directory"
AincTog_TT :="Include earch terms"
AexcTog_TT :="Exclude earch terms"
RJADDPRECFG_TT :="Add Pre-Config files"
RJREMPRECFG_TT :=" Remove Pre-Config files"
RJCPYMVCFGA_TT :="Copies configuration files back to the jacket"
RJCPYMVCFGB_TT :="Moves configuration files back to the jacket"
RJPOSTCFGCBX_TT :="Pre and Post Configs"
RJADDPOSTCFG_TT :="Add Post-run Cfg "
RJREMPOSTCFG_TT :="Remove Post-run Cfg"
EMEDTO_TT :="options to pass for the current pre/post command."
RJEMUXTCBX_TT :="Extensions which will be identified and launched`n- seperate by comma. do not include periods."
RJRAD1A_TT :=" Runs the emulator from emulator's directory"
RJRAD1B_TT :=" Runs the emulator from ROM's directory"
RJCHKU_TT :="Quotes surround the ROM and ROM-Path`nthis should only be disabled for emulators which require an un-quoted ROM name`neg: MAME/Demul/FBA"
RJCHKT_TT :="Includes the path to the ROM as part of the run command.`nThis should only be disabled for emulators which run the game from a list or local to the ROM`n(eg"
RJCHKS_TT :="Includes the extension. `nThis should only be disabled for emulators which require an only the ROM name`neg: MAME/Demul/FBA"
RRJEARGSCBX_TT :="Arguments. `n   be sure to include a space before the argument.`neg: '' -argument''"
RJEOPTSCBX_TT :="Options.`n  the ''<'' character can be used as a space character and is usually used before and after the exeutable. command`neg: ''<-option<''"
RJCHKR_TT :="Enable Searching for multi-disk ROMs."
RJCBXJ_TT :="comma seperate strings to search for."
CLRNETP_TT :="Clear paramaters`nTEMPORARY"
RJEDTA_TT :="command line output"
ADDCORE_TT :="Selects the system to edit.`nRight-Click to rename/restore"
RJZJP_TT :="Searches inside the zipped ROM for supported extensions.`nNeeded for dynamic meidatype assignments"
RJQLSTDD_TT :="System queue"
RJADDQ_TT :="Adds the selected ROMs in the ''Include'' ROM-List to the system's queue"
RJREMQSYS_TT :="Remove system from queue"
RUN2ND_TT :="Enables a secondary run-ahead thread."
RUNAHEAD_TT :="Enables a run-ahead thread to minimize latency."
RUNAFRMS_TT :="Frames to prefetch."
RJCNSLDD_TT :="Consolidation Methods:`n ''() []'' removes any (region) and any [tags] the Title may have.`n''()''  removes the region`n''[]'' removes any tags"
RJPROCQ_TT :="Processes the system queue."
RJADDSUBD_TT :="Add the subdirectory to the jackets."
RJREMSUBD_TT :="Remove the subdirectory from the jackets.`n      **This will not remove the directory if it is already created.**"
RJSUBDH_TT :="sets the visibility of the currently selected sub-directory."
RJSUBDCBX__TT :="The subdirectory to be created."
RJPRECFGCBX_TT :="Batch-script command to perform prior to emulator launch.`neg: copy /y ''*.cfg'' ''`%EMUL`%''"
RJPOSTCFGCBX_TT :="Batch-script command to perform after emulator exit.`neg: copy /y ''`%EMUL`%\*.cfg'' ''`%GAMDIR`%''"
RMPLOAD_TT :="Automatically load the core-input-remap file"
MROMDLOC_TT :="Select the location where ROMs exist.`nA junction-link will be made to this directory for each selected`nsystem into your retroarch downloads directory"
ROMDLOC_TT :="Select the location where ROMs exist.`nA junction-link will be made into your retroarch downloads directory"
ROMDEDT_TT :="Location of the ROM directory`nYou can also Drag and drop a folder to assign"
ROMFLS_TT :="Playlist ROM files"
ALWOTP_TT :="Makes skeletonKey always sit on top of other windows."
TRANSLID_TT :="Adjusts the transparency of the skeletonKey program window."
RUNROMCBX_TT :="EDITABLE Field for a ROM which will be launched"
MORROM_TT :="ROM which will be launched"
ROMPOP_TT :="Select ROMs to add from here"
ROOMFILTER_TT :="Filter the Lobby using any search term"
RSTPLYR_TT :="Resets the currently selected player controls to default"
RUNXTRACT_TT :="skeletonkey will try to run the extracted ROM`nthe archive will be executed otherwise"
ARCMOVE_TT :="Will Move the archive to the temp directory after extraction"
EXTEXPLD_TT :="archive will be extracted (exploded) ignoring any subdirectories.`n`nThis should be used in conjunction when saving into a jacket."
SALIST_TT :="Install standalone emulators"
SAVECOREOPT_TT := "Saves core-options config file for skeletonkey."
SAVEXIT_TT :="Saves retroarch settings upon exit.  Turning this on will allow skeletonKey to reload new settings after retroArch shuts down."
SAVNSYS_TT :="Save the new system"
SAVSRT_TT :="Battery and memory saves are stored in your specified save-location."
SDL2DRV_TT :="older machines may need to use this mode`nworks with RGUI menu only"
SDL2_TT :="older machines may need to use this option"
SAVPASS_TT :="Saves your archive.org password in skeletonkey's Settings.ini`n--note--`nthis is stored in plaintext --"
SEEKREP_TT :="Select a file to search for a ''retroarch's assets_directory'' location"
SERVPORT_TT :="Port for the file-server/client"
SETPSK_TT :="Select and set the portable skeletonKey location"
SETPRA_TT :="Select and set the portable retroarch location"
SETSYSTMP_TT :="Assigns the cache_directory (file-extraction) to the system's temp directory`nThe portable drive will be used for all temp-files if this is not enabled."
SHADW_TT :="Text shadows"
SHAREDV_TT :="Use a shared context for HW rendered libretro cores.`nAvoids having to assume HW state changes inbetween frames."
SHDSEL_TT :="Browse for a shader"
SHWADV_TT :="Shows the advanced settings for all menu items"
SHWFPS_TT :="Display the current Frames-Per-Second"
SHWHID_TT :="Show hidden files"
SHWHIS_TT :="Shows the history menu item"
MENSHOWCFG_TT :="Shows configurations menu"
MENSHOWCUP_TT :="Shows core-updater menu"
MENSHOWHLP_TT :="shows help menu"
MENSHOWINFO_TT :="shows info menu"
MENSHOWLDCONT_TT :="shows load-content menu"
MENSHOWLDCR_TT :="shows load-core menu"
MENSHOWONLUP_TT :="shows online-updater menu"
MENSHOWQUIT_TT :="shows quit menu item"
MENSHOWREB_TT :="shows reboot-menu item"
RCLLNCH_TT :="Quick-Launch Presets"
RaSpdEdt_TT :="Speed multiplier of the emulation.`n   1.0 is normal`n     `0.0 is unlocked."
SETEMUD_TT :="Sets the emulators directory"
SETJKD_TT :="Sets the systems directory"
SKRAEXE_TT :="Sets the retroarch directory"
SKRESET_TT :="Resets the dropdown menu item"
SKPRFJTXT_TT :="The BSL is a Batch-script launcher typically used by frontends to launch ROM-Jackets."
SKRBLD_TT :="Combines all retroarch playlists into a single database allowing skeletonKey`nto quickly search ROMs in your playlist libraries."
SKCLRQ_TT :="Clears and resets the ROM-Jacket system queue."
SHWIMG_TT :="Shows the Image-Menu item for any images in the history"
SHWMSC_TT :="Shows the Music-Menu item for any music in the history"
SHWSET_TT :="Shows Settings"
SHWVID_TT :="Shows the Video-Menu item for any videos in the history"
SKRAIMP_TT :="Imports a retroarch configuration and populates the GUI with stored values."
SKSVAS_TT :="Saves the current retroarch configuration to a custom location."
SKSAVE_TT :="Saves the current retroarch configuration."
SLSHDVAR_TT :="Slang Shader"
SLSLCT_TT := "Works with Vulkan"
SLVONLY_TT :="Disallows connections not in slave mode.`nNOT reccommended except for very fast networks with weak machines."
SMTHV_TT :="Filters video output.  Turn this option off when enabling shaders."
SRCHARCORG_TT :="Automatically searches the currently loaded repository for matching ROM if a local copy is not found."
SRCHEDT_TT :="Search for a repository ROM`ndo NOT include wildcards (*) or other special characters."
SRCHROMEDT_TT :="Search for a ROM`ndo NOT include wildcards (*) or other special characters."
SRCHLOCDDL_TT :="Playlist or Directory to search."
SRCHROMLBX_TT :="Search results`nRight-Click on selections for options"
SRCHFLRAD_TT :="Serach within your ROM-Jacket system folders or your retroarch downloads folder."
SRCHPLRAD_TT :="Search within playlists."
SRCHRCRSCHK_TT :="Searches subdirectories"
SRCHRSLT_TT :="SEARCH_RESULTS"
SSHTCVR_TT :="Video-snapshots"
STAI_TT :="# When saving a savestate, save state index is automatically increased before`nit is saved.`nAlso, when loading content, the index will be set to the highest existing index.`nThere is no upper bound on the index."
STAL_TT :="automatically loads your save-state upon starting the ROM"
STAS_TT :="Automatically saves your state in incriments"
STORT_TT :="Save states are saved in the specified save-state location"
STRCH_TT :="Only scales video in integer steps.`nhe base size depends on system-reported geometry and aspect ratio.`nIf video_force_aspect is not set, X/Y will be integer scaled independently."
SVAPLST_TT :="Allows you to define a template for per-ROM config files generated.`nIf this is not defined prior to creation, the current skeletonKey settings are used."
SVNICK_TT :="Saves the current application settings with the nickname of the system identfier`nright-click to reset the nickname to the default options"
DELNICK_TT :="Deletes the curent nickname-identfier"
SVPLST_TT :="Saves the current playlist"
SVTHMB_TT :="Save the currently selected thumbnail."
SWPV_TT :="Sets the v-sync frame number to buffer"
SWPFRMTXT_TT :="changes the current items in the window to switch from excuded to included or included to excluded."
SWAPOKC_TT :="Swaps the ok and cancel menu buttons."
SWHOST_TT :="Hosts the ROM using settings defined in the ''Netplay'' tab."
SYSNICK_TT :="Unique System Identifer"
TGLREP_TT :="Enable string replacement"
THMBNEDT_TT :="This should match the name of the ROM in your playlist."
THRDV_TT :="Use threaded video driver.`nUsing this might improve performance at possible cost of latency and more video stuttering."
THRTL_TT :="Keeps the menu from going crazy"
THUMBON_TT :="Enables thumbnails for the XMB GUI"
TITLCVR_TT :="ROM titlle screen"
TRIPB_TT :="Decreases screen tearing."
TURBOP_TT :="Describes the period when turbo-enabled buttons are toggled`nNumbers are in frames"
UNIFMENU_TT :="Uses the same controls in the menu as with the current game. `nApplies to the keyboard"
UNIQLNK_TT :="Creates and assigns a unique system nickname identifier for each selected system.`nPer-system emulator configurations"
UPDBTN_TT :="Download selected components"
UPDCL_TT :="Refresh cores in your installation"
VFNTEN_TT :="Enables custom font display"
DETSORT_TT :="Automatically sorts ROMs with system-exclusive extensions."
KNOWNDRP_TT :="Limits the files checked by excluding many extensions."
DETHSHSZ_TT :="Limits the DATs parsed by size."
DETECTXTN_TT :="Detects the extension of the selected system."
DRPSEL_TT :=""
MOVDRP_TT :="Moves dropped files to the associated system folder.`nLeaving this unchecked will only copy the file"
RENDRP_TT :="Renames the ROM to that found in the dat file."
OVRWDRP_TT :="Overwrites any existing ROM with the same name"
SRCHDRP_TT :="Searches inside .rar/.7z/.zip files for ROMs."
EXTDRP_TT :="Extracts files found in compressed archives"
ARCSORT_TT :="Archives compressed files to skeletonkey's cache directory."
KEEPSORT_TT :="Keeps compresed archives alongside the extracted ROM"
JAKDRP_TT :="Copies or moves the ROM to a folder of its name."
JAKAFT_TT :="Jacketizes based on the base-name`nie: strips the region and other information in parenthesis and brackets."
JAKBF_TT :="Jacketizes based on the complete name"
VIDASPECT_TT :="Aspect Ratio Mode"
DATLBX_TT :="List of DAT files to check for known files"
SRTFLT_TT :="Search for files in the selected list"
SRTCLRFLT_TT :="clears the filtered list"
DRPLV_TT :="List of files to check for known ROMs."
DATDRPD_TT :="List of dats."
BRWSDAT_TT :="Dat file to append to your datlist."
TOSECDATYP_TT :="Copies the selected dat to your TOSEC dat folder."
NOINTRODATYP_TT :="Copies the selected dat to your No-intro dat folder."
RDUMPDATYP_TT :="Copies the selected dat to your MAME dat folder."
MAMEDATYP_TT :="Copies the selected dat to your MAME dat folder."
ADDATS_TT :="Add selected dat to the datlist."
HASHALLROMS_TT :="Begins the sorting."
ADDSRTDIR :="Adds a folder to search"
ADDSRTFILE :="Adds a file to search"
HLTDATP_TT :="Cancels the sorting process."
DATREPO_TT :="Dat repository to download."
GETDATREP_TT :="Downloads selected dat repository."
ADDSRTDIR :="Adds a folder to search"
VIDSCL_TT :="Multiplier for the window size"
AVIDSYNC_TT :="Adaptive Video V-Sync"
VIDSYNC_TT :="Video V-Sync"
VLKDRV_TT :="requires a newer videocard capable of opengl 4x"
VidXLoc_TT :="horizontal position (in pixels) of the video on your monitor (only available in custom mode)"
VidYLoc_TT :="vertical position (in pixels) of the video on your monitor (only available in custom mode)"
XAUD_TT :="Another sound driver"
XMBALF_TT :="Menu opacity"
XMBSCL_TT :="Scales the XMB display"
XMBTHM_TT :="Icon theme number"
UpdateSK_TT :="Checks for the latest version of skeletonkey and downloads it if needed."
HelpLink_TT :="Opens the skeletonKey html-help file in your default internet browser."
ZIPSEEK_TT :="Searches within archives (.zip/.7z) for files.`nturn this off for Arcade/MAME-Style ROMs and archives."
ZIPSEEK_TT :="Gets and writes the CRC Hash number of ROMs to the playlist.`nThis can be expensive for CD/DVD systems.`nturn this off for Arcade/MAME-Style ROMs and archives."
SHDEN_TT :="Toggles shader"
FILT_UNSUP_TT :="Any dropdown listing the contents of your ''systems'' directory`n will filter out any directories which have not been detected or assigned"
RENONDET_TT :="Any systems-folders will be renamed to the supported nomenclature."
*/  ;;[DEBUGOV]
setPortable:
if (SETPORTABLE = 1)
	{
			gui,submit,nohide
			return
	}
if (locfnd = 1)
	{
		if (MINIMODE = 1)
			{
				gosub, MINIMODEOFF
			}
		GuiControl, Choose, TABMENU, 3
	}
gosub, PopFolders
gosub, MUTEJACKOPT
guicontrol,,ARCSYS,|Select a System||%syslist%
guicontrol,,ARCPOP,|
gosub, RecentWrite
gosub, utlDDLA

gui, submit, nohide
if (INITIAL = 1)
	{
		iniWrite, "%VERSION%",Settings.ini,GLOBAL,version
		SplashTextOff
	}
iniread,mamexsts,Apps.ini,EMULATORS,MAME
if (mamexsts <> "ERROR")
	{
		ifnotexist,lm.ini
			{
				gosub, MAMETOG
				guicontrol,enable,RJSYSDD
				INITIAL=
				return
			}
	}
ifexist, lm.ini
	{
		fileread,mamelistedmedia,lm.ini
		gosub, MAMELMREAD
	}
INITIAL=
guicontrol,enable,RJSYSDD
/*  ;;[DEBUGOV]
Class CtlColors {
   Static Attached := {}
   Static HandledMessages := {Edit: 0, ListBox: 0, Static: 0}
   Static MessageHandler := "CtlColors_OnMessage"
   Static WM_CTLCOLOR := {Edit: 0x0133, ListBox: 0x134, Static: 0x0138}
   Static HTML := {AQUA: 0xFFFF00, BLACK: 0x000000, BLUE: 0xFF0000, FUCHSIA: 0xFF00FF, GRAY: 0x808080, GREEN: 0x008000
                 , LIME: 0x00FF00, MAROON: 0x000080, NAVY: 0x800000, OLIVE: 0x008080, PURPLE: 0x800080, RED: 0x0000FF
                 , SILVER: 0xC0C0C0, TEAL: 0x808000, WHITE: 0xFFFFFF, YELLOW: 0x00FFFF}
   Static NullBrush := DllCall("GetStockObject", "Int", 5, "UPtr")
   Static SYSCOLORS := {Edit: "", ListBox: "", Static: ""}
   Static ErrorMsg := ""
   Static InitClass := CtlColors.ClassInit()
   __New() { ; You must not instantiate this class!
      If (This.InitClass == "!DONE!") { ; external call after class initialization
         This["!Access_Denied!"] := True
         Return False
      }
   }
   __Delete() {
      If This["!Access_Denied!"]
         Return
      This.Free() ; free GDI resources
   }
   ClassInit() {
      CtlColors := New CtlColors
      Return "!DONE!"
   }
   CheckBkColor(ByRef BkColor, Class) {
      This.ErrorMsg := ""
      If (BkColor != "") && !This.HTML.HasKey(BkColor) && !RegExMatch(BkColor, "^[[:xdigit:]]{6}$") {
         This.ErrorMsg := "Invalid parameter BkColor: " . BkColor
         Return False
      }
      BkColor := BkColor = "" ? This.SYSCOLORS[Class]
              :  This.HTML.HasKey(BkColor) ? This.HTML[BkColor]
              :  "0x" . SubStr(BkColor, 5, 2) . SubStr(BkColor, 3, 2) . SubStr(BkColor, 1, 2)
      Return True
   }
   CheckTxColor(ByRef TxColor) {
      This.ErrorMsg := ""
      If (TxColor != "") && !This.HTML.HasKey(TxColor) && !RegExMatch(TxColor, "i)^[[:xdigit:]]{6}$") {
         This.ErrorMsg := "Invalid parameter TextColor: " . TxColor
         Return False
      }
      TxColor := TxColor = "" ? ""
              :  This.HTML.HasKey(TxColor) ? This.HTML[TxColor]
              :  "0x" . SubStr(TxColor, 5, 2) . SubStr(TxColor, 3, 2) . SubStr(TxColor, 1, 2)
      Return True
   }
   Attach(HWND, BkColor, TxColor := "") {
      Static ClassNames := {Button: "", ComboBox: "", Edit: "", ListBox: "", Static: ""}
      Static BS_CHECKBOX := 0x2, BS_RADIOBUTTON := 0x8
      Static ES_READONLY := 0x800
      Static COLOR_3DFACE := 15, COLOR_WINDOW := 5
      If (This.SYSCOLORS.Edit = "") {
         This.SYSCOLORS.Static := DllCall("User32.dll\GetSysColor", "Int", COLOR_3DFACE, "UInt")
         This.SYSCOLORS.Edit := DllCall("User32.dll\GetSysColor", "Int", COLOR_WINDOW, "UInt")
         This.SYSCOLORS.ListBox := This.SYSCOLORS.Edit
      }
      This.ErrorMsg := ""
      If (BkColor = "") && (TxColor = "") {
         This.ErrorMsg := "Both parameters BkColor and TxColor are empty!"
         Return False
      }
      If !(CtrlHwnd := HWND + 0) || !DllCall("User32.dll\IsWindow", "UPtr", HWND, "UInt") {
         This.ErrorMsg := "Invalid parameter HWND: " . HWND
         Return False
      }
      If This.Attached.HasKey(HWND) {
         This.ErrorMsg := "Control " . HWND . " is already registered!"
         Return False
      }
      Hwnds := [CtrlHwnd]
      Classes := ""
      WinGetClass, CtrlClass, ahk_id %CtrlHwnd%
      This.ErrorMsg := "Unsupported control class: " . CtrlClass
      If !ClassNames.HasKey(CtrlClass)
         Return False
      ControlGet, CtrlStyle, Style, , , ahk_id %CtrlHwnd%
      If (CtrlClass = "Edit")
         Classes := ["Edit", "Static"]
      Else If (CtrlClass = "Button") {
         IF (CtrlStyle & BS_RADIOBUTTON) || (CtrlStyle & BS_CHECKBOX)
            Classes := ["Static"]
         Else
            Return False
      }
      Else If (CtrlClass = "ComboBox") {
         VarSetCapacity(CBBI, 40 + (A_PtrSize * 3), 0)
         NumPut(40 + (A_PtrSize * 3), CBBI, 0, "UInt")
         DllCall("User32.dll\GetComboBoxInfo", "Ptr", CtrlHwnd, "Ptr", &CBBI)
         Hwnds.Insert(NumGet(CBBI, 40 + (A_PtrSize * 2, "UPtr")) + 0)
         Hwnds.Insert(Numget(CBBI, 40 + A_PtrSize, "UPtr") + 0)
         Classes := ["Edit", "Static", "ListBox"]
      }
      If !IsObject(Classes)
         Classes := [CtrlClass]
      If (BkColor <> "Trans")
         If !This.CheckBkColor(BkColor, Classes[1])
            Return False
      If !This.CheckTxColor(TxColor)
         Return False
      ; Activate message handling on the first call for a class --------------------------------------------------------
      For I, V In Classes {
         If (This.HandledMessages[V] = 0)
            OnMessage(This.WM_CTLCOLOR[V], This.MessageHandler)
         This.HandledMessages[V] += 1
      }
      If (BkColor = "Trans")
         Brush := This.NullBrush
      Else
         Brush := DllCall("Gdi32.dll\CreateSolidBrush", "UInt", BkColor, "UPtr")
      For I, V In Hwnds
         This.Attached[V] := {Brush: Brush, TxColor: TxColor, BkColor: BkColor, Classes: Classes, Hwnds: Hwnds}
      DllCall("User32.dll\InvalidateRect", "Ptr", HWND, "Ptr", 0, "Int", 1)
      This.ErrorMsg := ""
      Return True
   }
   Change(HWND, BkColor, TxColor := "") {
      This.ErrorMsg := ""
      HWND += 0
      If !This.Attached.HasKey(HWND)
         Return This.Attach(HWND, BkColor, TxColor)
      CTL := This.Attached[HWND]
      If (BkColor <> "Trans")
         If !This.CheckBkColor(BkColor, CTL.Classes[1])
            Return False
      If !This.CheckTxColor(TxColor)
         Return False
      If (BkColor <> CTL.BkColor) {
         If (CTL.Brush) {
            If (Ctl.Brush <> This.NullBrush)
               DllCall("Gdi32.dll\DeleteObject", "Prt", CTL.Brush)
            This.Attached[HWND].Brush := 0
         }
         If (BkColor = "Trans")
            Brush := This.NullBrush
         Else
            Brush := DllCall("Gdi32.dll\CreateSolidBrush", "UInt", BkColor, "UPtr")
         For I, V In CTL.Hwnds {
            This.Attached[V].Brush := Brush
            This.Attached[V].BkColor := BkColor
         }
      }
      For I, V In Ctl.Hwnds
         This.Attached[V].TxColor := TxColor
      This.ErrorMsg := ""
      DllCall("User32.dll\InvalidateRect", "Ptr", HWND, "Ptr", 0, "Int", 1)
      Return True
   }
   Detach(HWND) {
      This.ErrorMsg := ""
      HWND += 0
      If This.Attached.HasKey(HWND) {
         CTL := This.Attached[HWND].Clone()
         If (CTL.Brush) && (CTL.Brush <> This.NullBrush)
            DllCall("Gdi32.dll\DeleteObject", "Prt", CTL.Brush)
         For I, V In CTL.Classes {
            If This.HandledMessages[V] > 0 {
               This.HandledMessages[V] -= 1
               If This.HandledMessages[V] = 0
                  OnMessage(This.WM_CTLCOLOR[V], "")
         }  }
         For I, V In CTL.Hwnds
            This.Attached.Remove(V, "")
         DllCall("User32.dll\InvalidateRect", "Ptr", HWND, "Ptr", 0, "Int", 1)
         CTL := ""
         Return True
      }
      This.ErrorMsg := "Control " . HWND . " is not registered!"
      Return False
   }
   Free() {
      For K, V In This.Attached
         If (V.Brush) && (V.Brush <> This.NullBrush)
            DllCall("Gdi32.dll\DeleteObject", "Ptr", V.Brush)
      For K, V In This.HandledMessages
         If (V > 0) {
            OnMessage(This.WM_CTLCOLOR[K], "")
            This.HandledMessages[K] := 0
         }
      This.Attached := {}
      Return True
   }
   IsAttached(HWND) {
      Return This.Attached.HasKey(HWND)
   }
}
CtlColors_OnMessage(HDC, HWND) {
   Critical
   If CtlColors.IsAttached(HWND) {
      CTL := CtlColors.Attached[HWND]
      If (CTL.TxColor != "")
         DllCall("Gdi32.dll\SetTextColor", "Ptr", HDC, "UInt", CTL.TxColor)
      If (CTL.BkColor = "Trans")
         DllCall("Gdi32.dll\SetBkMode", "Ptr", HDC, "UInt", 1) ; TRANSPARENT = 1
      Else
         DllCall("Gdi32.dll\SetBkColor", "Ptr", HDC, "UInt", CTL.BkColor)
      Return CTL.Brush
   }
}
return
*/  ;;[DEBUGOV]
SplashImageGUI(Picture, X, Y, Transparent = false)
	{
		Gui, XPT99:Margin , 0, 0
		Gui, XPT99:Add, Picture,, %Picture%
		Gui, XPT99:Color, 00000
		Gui, XPT99:+LastFound -Caption +ToolWindow -Border
		If Transparent
			{
				Winset, TransColor, 00000
				Winset, AlwaysOnTop
			}
		Gui, XPT99:Show, x%X% y%Y% NoActivate
		return
	}  
DestroySplashGUI:
Gui, XPT99:Destroy
return
SetWinDelay,2
CoordMode,Mouse
return
LVGetCheckedItems(cN,wN) 
	{
		ControlGet, LVItems, List,, % cN, % wN
		Pos:=!Pos,Item:=Object()
		While Pos
			{
				Pos:=RegExMatch(LVItems,"`am)(^.*?$)",_,Pos+StrLen(_)),mCnt:=A_Index-1,Item[mCnt]:=_1
			}
		Loop % mCnt {
			SendMessage, 0x102c, A_Index-1, 0x2000, % cN, % wN
			ChkItems.=(ErrorLevel ? Item[A_Index-1] "`n" : "")
			}
				Return ChkItems
	}
return

zpcrcproc:
CRCZ=
CRCZI=
ZPSZ=
ZPSZI=
ROMZ=
partition=
if (StdOut <> "")
	{
		xtnv=
		dskinc=
		Loop, Parse, StdOut,`n`r
			{
				stvi1=
				stvi2=
				stringsplit,evrx,A_LoopField,=
				ifinstring,evrx1,----------
					{
						partition+=1
						continue
					}
				if (partition > 1)
					{
						ifinstring,evrx1,Path
							{
								dskinc+=1
								if (frz = 1)
									{
										splitpath,evrx2,evrfn,evrfd,xtnv
										ROMZI.= evrx2 . "|"
										if (xtnv = "")
											{
												continue
											}
									}
								ifnotinstring,ROMZ,%evrx2%|
									{
										ROMZ.= evrx2 . "|"
									}
							}
						ifinstring,evrx1,size
							{
								ZPSZ:= evrx2
								ZPSZI.= evrx2 . "|"
							}
						ifinstring,evrx1,CRC
							{
								if (evrx2 = 0)
									{
										continue
									}
								CRCZ:= evrx2
								CRCZI.= evrx2 . "|"
								break
							}
					}
			}
		if (xtnv = "")
			{
				xtnv= %fext%
			}
	}
return

zpkproc:
ZPSZ=
partition=
if (StdOut <> "")
	{
		xtnv=
		dskinc=
		rjgdsk=
		Loop, Parse, StdOut,`n`r
			{
				stvi1=
				stvi2=
				stringsplit,evrx,A_LoopField,=
				ifinstring,evrx1,----------
					{
						partition+=1
						continue
					}
				if (partition > 1)
					{
						ifinstring,evrx1,Path
							{
								dskinc+=1
								splitpath,evrx2,evrfn,evrfd,xtnv
								rjgdsk.= evrx2 . "|"
								gamDISK%dskinc%= %evrx2%
							}
						ifinstring,evrx1,size
							{
								ZPSZ:= evrx2
							}
						IF (ZPSZ = 0)
							{
								continue
							}
				if ((ZPSZ > 0)&&(RJMULTIDISC <> 1))
						{
							break
						}
					}
			}
		if (xtnv = "")
			{
				xtnv= %fext%
			}
	}
return

CancelDown:
Process, close, %inspid%
DWNCNCL= 1
gosub, InteruptDwn
gosub, cleanprgb
return

InteruptDwn:
msgbox, 8707,Cancel Download, Would you like to terminate downloads and close skeletonKey?
ifmsgbox, yes
gosub QUITOUT
ifmsgbox, no
{
	DWNCNCL=
	return
}
return
ifmsgbox,Cancel
{
	GuiControl, Enable, RAINSTLBX
	GuiControl, Enable, UPDBTN
	GuiControl, Enable, EXELIST
	GuiControl, Disable, CNCLBTN
	;DWNCNCL=
	return
}
return
StdoutToVar_CreateProcess(sCmd, bStream="", sDir="", sInput="")
   {
   bStream=   ; not implemented
   sDir=      ; not implemented
   sInput=    ; not implemented
   DllCall("CreatePipe","Ptr*",hStdInRd
                       ,"Ptr*",hStdInWr
                       ,"Uint",0
                       ,"Uint",0)
   DllCall("CreatePipe","Ptr*",hStdOutRd
                       ,"Ptr*",hStdOutWr
                       ,"Uint",0
                       ,"Uint",0)
   DllCall("SetHandleInformation","Ptr",hStdInRd
                                ,"Uint",1
                                ,"Uint",1)
   DllCall("SetHandleInformation","Ptr",hStdOutWr
                                ,"Uint",1
                                ,"Uint",1)
   if A_PtrSize=4
      {
      VarSetCapacity(pi, 16, 0)
      sisize:=VarSetCapacity(si,68,0)
      NumPut(sisize,    si,  0, "UInt")
      NumPut(0x100,     si, 44, "UInt")
      NumPut(hStdInRd , si, 56, "Ptr")
      NumPut(hStdOutWr, si, 60, "Ptr")
      NumPut(hStdOutWr, si, 64, "Ptr")
      }
   else if A_PtrSize=8
      {
      VarSetCapacity(pi, 24, 0)
      sisize:=VarSetCapacity(si,96,0)
      NumPut(sisize,    si,  0, "UInt")
      NumPut(0x100,     si, 60, "UInt")
      NumPut(hStdInRd , si, 80, "Ptr")
      NumPut(hStdOutWr, si, 88, "Ptr")
      NumPut(hStdOutWr, si, 96, "Ptr")
      }
   DllCall("CreateProcess", "Uint", 0
                           , "Ptr", &sCmd
                          , "Uint", 0
                          , "Uint", 0
                           , "Int", True
                          , "Uint", 0x08000000
                          , "Uint", 0
                          , "Uint", 0
                           , "Ptr", &si
                           , "Ptr", &pi)
   DllCall("CloseHandle","Ptr",NumGet(pi,0))
   DllCall("CloseHandle","Ptr",NumGet(pi,A_PtrSize))
   DllCall("CloseHandle","Ptr",hStdOutWr)
   DllCall("CloseHandle","Ptr",hStdInRd)
   DllCall("CloseHandle","Ptr",hStdInWr)
   VarSetCapacity(sTemp,4095)
   nSize:=0
   loop
      {
      result:=DllCall("Kernel32.dll\ReadFile", "Uint", hStdOutRd
                                             ,  "Ptr", &sTemp
                                             , "Uint", 4095
                                             ,"UintP", nSize
                                              ,"Uint", 0)
      if (result="0")
         break
      else
         sOutput:= sOutput . StrGet(&sTemp,nSize,"CP850")
      }
   DllCall("CloseHandle","Ptr",hStdOutRd)
   Return,sOutput
   }
return
#If (MouseIsOverTitlebar()or(MINIMODE = 1))

MENU_X:= A_GuiX*(A_ScreenDPI/96)
MENU_Y:= A_GuiY*(A_ScreenDPI/96)
RButton::Menu, MINITOGGLE, Show, %MENU_X% %MENU_Y%
return
MouseIsOverTitlebar() {
    static WM_NCHITTEST := 0x84, HTCAPTION := 2
    if WinActive("skeletonKey") 
		{
			CoordMode Mouse, Screen
			MouseGetPos x, y, w
			if WinExist("ahk_class Shell_TrayWnd ahk_id " w)  ; Exclude taskbar.
				return false
			SendMessage WM_NCHITTEST,, (x & 0xFFFF) | ((y & 0xFFFF) << 16),, ahk_id %w%
			WinExist("ahk_id " GuiID)  ; Set Last Found Window for convenience.
			return ErrorLevel = HTCAPTION
		}
}
return

GuiContextMenu:
gui,submit,nohide
If A_GuiControlEvent RightClick
	{	
	MENU_X:= A_GuiX*(A_ScreenDPI/96)
	MENU_Y:= A_GuiY*(A_ScreenDPI/96)
	GuiScrapeMenu:
	URLFILE=
	save=
	IMTG=
	gui,submit,nohide
	if A_GuiControl = ROMFLS
		{
			Menu, ScrapeMenu, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = SRCHROMLBX
			{
				guicontrolget,SRCHLOCDDL,,SRCHLOCDDL
				guicontrolget,bltoh,,SRCHROMLBX
				SYSLKUP= %SRCHLOCDDL%
				FEDDLA= %SRCHLOCDDL%
				if (SelectedRow <> 0)
					{
						Menu, RunWithDD, Show, %MENU_X% %MENU_Y%
						return
					}
			}
	if A_GuiControl = SYSINSTLBX
		{
			if (SALIST = "Systems")
				{
					;;ADD SYSTEM RIGHTCLICK
				}
		}
	if A_GuiControl = SYSINSTLBX
		{
			if (SALIST = "Emulators")
				{
					;;ADD EMULATORS RIGHTCLICK
				}
		}
	if A_GuiControl = ROMPOP
		{
			Menu, PLSTMENU, Show, %MENU_X% %MENU_Y%
		}
	if A_GuiControl = EMUINST
		{
			Menu, EMURESETI, Show, %MENU_X% %MENU_Y%
		}
	if A_GuiControl = FEDDLJ
		{
			if (FEDDLJ = "RetroFE")
				{
					Menu, RERCLWIN, Show, %MENU_X% %MENU_Y%
					return
				}
		}
	if A_GuiControl = FEDDLJ
		{
			if (FEDDLJ = "Pegasus")
				{
					Menu, PEGWIN, Show, %MENU_X% %MENU_Y%
					return
				}
		}
	if A_GuiControl = FEDDLJ
		{
			if (FEDDLJ = "EmulationStation")
				{
					Menu, REZRCLWIN, Show, %MENU_X% %MENU_Y%
					return
				}
		}
	if A_GuiControl = FEBUTK
		{
			if (FEDDLJ = "EmulationStation")
				{
					Menu, REZWIN, Show, %MENU_X% %MENU_Y%
					return
				}
		}
	if A_GuiControl = RJLSTV
		{
			if (SelectedRow <> 0)
				{
					Menu, RJRCLMENU, Show, %MENU_X% %MENU_Y%
					return
				}
		}
	if A_GuiControl = DATLBX
		{
			Menu,REMDATSEL,show,%MENU_X% %MENU_Y%
		}
	if A_GuiControl = DRPLV
		{
			Menu,REMHSHSEL,show,%MENU_X% %MENU_Y%
		}
	if A_GuiControl = FEBUTA
		{
			IF (FETYP = "Media")
				{
					if (FERAD2A <> 1)
						{
							Menu, medcachedel, Show, %MENU_X% %MENU_Y%
							return
						}
				}
		}
	if A_GuiControl = MORROM
		{
			Menu, MORROMDDLM, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = FELBXB
		{
			Menu, rjscopy, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = LNCHBUT
		{
			Menu, SHORTRUN, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_Guicontrol = SvNick
		{
			Menu, RSTAPAR, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_Guicontrol = ADDCORE
		{
			Menu, RNMSYSA, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = ARCLNCH
		{
			Menu, ARCSHORT, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = CURPLST
		{
			if (fenam = "retroFE")
				{
					guicontrolget,GFERYP,,RFRPOPROM
					guicontrolget,SYSLKUP,,RFDWNLPOS
					pldelim= :
				}
			if (fenam = "EmulationStation")
				{
					guicontrolget,GFERYP,,ESRPOPROM
					guicontrolget,SYSLKUP,,ESDWNLPOS
					pldelim= :
				}
			Menu, PLEDTMENU, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = LCORE
		{
			guicontrolget,RUNSYSDDL,,RUNSYSDDL
			if (RUNSYSDDL = "")
				{
					return
				}
			guicontrolget,LCORE,,LCORE
			if (LCORE = "")
				{
					return
				}
			Menu, ASOCRUN, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = RUNSYSDDL
		{
			guicontrolget,RUNSYSDDL,,RUNSYSDDL
			if (RUNSYSDDL = ":=:System List:=:")
				{
					return
				}
			Menu, ASOCCFG, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_Guicontrol = UrlTxt
		{
			guicontrolget,URLTXT,,URLTXT
			stringreplace,urlsv,urltxt,',,All
			stringreplace,urlsv,urlsv,.,,All
			stringreplace,urlsv,urlsv,&,,All
			stringreplace,urlsv,urlsv,`%,,All
			stringreplace,urlsv,urlsv,-,,All
			stringreplace,urlsv,urlsv,`,,,All
			stringreplace,urlsv,urlsv,~,,All
			stringreplace,urlsv,urlsv,%A_Space%,,All
			Menu, ARCSETB, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = ARCSYS
		{
			guicontrolget,ARCSYS,,ARCSYS
			if (ARCSYS = "Select a System")
				{
					return
				}
			keyin=%ARCSYS%
			gosub,TransformSys	
			Menu, ARSOCCFG, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = ARCCORES
		{
			MENU, ARCGPCFG, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = INSTEMUDDL
		{
			Menu, EMURCLMENU, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GUicontrol = CLRFLTR
		{
			if ((SALIST = "Systems")or(SALIST = "Emulators"))
				{
					Menu, clRfltmenu, Show, %MENU_X% %MENU_Y%
				}
			return
		}
	if A_GuiControl = AUTOBIOS
		{
			Menu, BDRCLMENU, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = RomDLoc
		{
			Menu, CLRROMLST, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = ROMDEDT
		{
			Menu, RMVSYSLST, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = UTLLVA
		{
			if (SelectedRow <> 0)
				{
					Menu, UTRCLMENU, Show, %MENU_X% %MENU_Y%
					return
				}
		}
	if A_GuiControl = SYSINSTLBX
		{
			if ((SALIST = "Systems")&&(MULTISYS <> 1))
				{
					Menu, RCL_CSYS,Show, %MENU_X% %MENU_Y%
					return
				}
		}
	if A_GuiControl = PRGINSTLBX
		{
			if (SALIST = "Emulators")
				{
					Menu, EMURCLASGN,Show, %MENU_X% %MENU_Y%
					return
				}
		}
	if A_GuiControl = FELVA
		{
			if ((FETYP = "EmulationStation") or (FETYP = "Pegasus") or (FETYP = "RetroFE"))
				{
					if (FERAD5C = 1)
						{
							return
						}
					if (SelectedRow <> 0)
						{
							Menu, ESRCLMENU, Show, %MENU_X% %MENU_Y%
							return
						}
				}
			if (SelectedRow <> 0)
				{
					if (FERAD2A <> 1)
						{
							Menu, FEDELMENU, Show, %MENU_X% %MENU_Y%
							return
						}
					Menu, FERCLMENU, Show, %MENU_X% %MENU_Y%
					return
				}
		}
	if A_GuiControl = RETAL
		{
			Menu, RUNMENU, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = ARCPOP
		{
			guicontrolget,ARCSYS,,ARCSYS
			guicontrolget,bltoh,,ARCPOP
			SYSLKUP= %ARCSYS%
			FEDDLA= %ARCSYS%
			pldelim= :
			Menu, ARCART, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GuiControl = SRCHRSLT
		{
			guicontrolget,SRCHDDL,,SRCHDDL
			if (SRCHDDL = "All")
				{
					return
				}
			SYSLKUP= %SRCGDDL%
			FEDDLA= %SRCGDDL%
			guicontrolget,bltox,,SRCHRSLT
			bltoh=
			Loop, Parse,bltox,|
				{
					stringsplit,ari,A_LoopField,=
					bltoh.= ari2 . "|"
				}
			Menu, ARCART, Show, %MENU_X% %MENU_Y%
			return
		}
	if A_GUICONTROL = MINISWITCH
		{
			if (TABMENU = ":=: MAIN :=:")
				{
					Menu, MINITOGGLE, Show, %MENU_X% %MENU_Y%
				}
		}
	Return
}
return

SQOWTH:
guicontrolget,romofw,,MORROM
romow=
splitpath,romofw,,romow
if (romow = "")
	{
		SB_SetText("...No Rom is selected...")
		return
	}
SB_SetText("...ROM location is opening...")
Run, explorer.exe %romrow%,%romrow%
SB_SetText("")
return

InvTransformSys:
keyout= 
Loop,parse,oldlkup,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,ebi,A_LoopField,=
		einxh= % ebi1
		if (einxh = keyin)
			{
				Arc_OS= %ebi2%
				break
			}
			keyout= %keyin%
			Arc_OS= %keyin%
	}
ARC_OL= 	
return

RevTransformSys:
keyout= 
Loop,parse,sysllst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,ebi,A_LoopField,=
		if (ebi1 = keyin)
			{
				Loop,parse,oldlkup,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,ebv,A_LoopField,=
						if (ebi2 = ebv2)
							{
								keyout= %ebv1%
								break
							}
					}
				break	
			}
			keyout= %keyin%
	}
return

TransformSys:
keyout=
Loop,parse,oldlkup,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,ebi,A_LoopField,=
		if (ebi1 = keyin)
			{
				Loop,parse,sysllst,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,ebv,A_LoopField,=
						if (ebi2 = ebv2)
							{
								keyout= %ebv1%
								break
							}
					}
				break	
			}
			keyout= %keyin%
	}
return

RBLDRUNLST:
addemu=
glbsysa=
glbsysn=
addemu=
runlist=
siv=
IniRead,emuj,Assignments.ini,ASSIGNMENTS
Loop,Parse,emuj,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		emup2=
		stringsplit,emup,A_LoopField,=,"
		;"
		ifinstring,SysLLst,%emup1%=
			{
				continue
			}
		ifnotinstring,addemu,%emup1%|
			{
				if (emup2 = "")
					{
						continue
					}
				addemu.= "|" . emup1
			}
	}
runlist:= corelist . "|" . addemu
IniRead,emuj,Assignments.ini,OVERRIDES
Loop,Parse,emuj,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		emup2=
		stringsplit,emup,A_LoopField,=,"
		;"
		if instr(SysLLst,emup1 "=") or instr(addemu,emup1 "|")
			{
				continue
			}
		ifnotinstring,addemu,%emup1%|
			{
				emutsta=
				IniRead,emutsta,Assignments.ini,ASSIGNMENTS,%emup1%
				if ((emutsta = "")or(emutsta = "ERROR"))
					{
						continue
					}
				addemu.= "|" . emup1
			}
	}
runlist:= corelist . "|" . addemu
stringreplace,runlist,runlist,||,|,All
stringreplace,runlist,runlist,||,|,All
stringleft,runltmp,runlist,1
if (runltmp = "|")
	{
		stringtrimleft,runlist,runlist,1
	}
guicontrol,,LCORE,|%runlist%
guicontrol,,ARCCORES,|%runlist%
return

SCBUILDEMULST:
Loop, Parse, SysLLst,`n`r
	{
		snklu1=
		snklu2=
		stringsplit,snklu,A_LoopField,=
		afi=
		;%snklu2%SCL=
		;%snklu2%CLO=
		;%snklu2%CLA=
		iniread,jei,Assignments.ini,ASSIGNMENTS,%snklu1%
		if (jei <> "ERROR")
			{
				if instr(jei,"_libretro.dll") && !fileexist(raexedir . "\" . "cores" . "\" jei)
					{
						continue
					}
				%snklu2%SCL.= jei . "|"
			}
		iniread,xvn,emuCfgPresets.ini,%snklu1%,RJEMUOPTS
		if (xvn <> "ERROR")
			{
				stringreplace,xvn,xvn,<,%A_Space%,All
				%snklu2%CLO.= xvn . "|"
			}
		iniread,xvn,emuCfgPresets.ini,%snklu1%,RJEMUARGS
		if (xvn <> "ERROR")
			{
				stringreplace,xvn,xvn,<,%A_Space%,All
				%snklu2%CLA.= xvn . "|"
			}
		iniread,aif,emuCfgPresets.ini,%snklu1%,SUPEMU
		Loop, parse, aif,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				iniread,kin,Assignments.ini,ASSIGNMENTS,%A_LoopField%
				if ((kin <> "ERROR")&&(kin <> ""))
					{
						sanx=  % %snklu2%SCL
						ifinstring,sanx,%A_LoopField%|
							{								
								continue
							}
						%snklu2%SCL.= A_LoopField . "|"
					}
				iniread,xvn,emuCfgPresets.ini,%A_LoopField%,RJEMUOPTS
				if (xvn <> "ERROR")
					{
						stringreplace,xvn,xvn,<,%A_Space%,All
						%snklu2%CLO.= xvn . "|"
					}
				iniread,xvn,emuCfgPresets.ini,%A_LoopField%,RJEMUARGS
				if (xvn <> "ERROR")
					{
						stringreplace,xvn,xvn,<,%A_Space%,All
						%snklu2%CLA.= xvn . "|"
					}
			}
		iniread,aig,emuCfgPresets.ini,%snklu1%,SUPCORE
		Loop, parse, aig,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				swisnk= % %snklu2%SCL
				ifnotexist,%raexedir%\cores\%A_LoopField%
					{
						continue
					}
				ifinstring,swisnk,%A_LoopField%|
					{
						continue
					}
				%snklu2%SCL.= A_LoopField . "|"
			}
	}
return

ASRLD:
guicontrolget,ikn,,ESWPLCRE
CURRENTSYSTEM= 
if (ikn = ">")
	{
		gosub, RUNSYSCBX
	}
else {
gosub, RUNSYSDDL
}
return

ASCFG:
gui,submit,nohide
guicontrolget,RCLSYSTEM,,RUNSYSDDL
ARCFGCONT:
iniread,isrs,Assignments.ini,OVERRIDES,%RCLSYSTEM%
if (isrs = "ERROR")
	{
		SB_SetText("This is not a recognized system.  Associate an emulator or core to initialize.")
		MsgBox,8196,Undetected,Would you like to detect and rename this system?
		ifmsgbox,yes
			{
				Loop, parse, fuzsys,`n`r
					{
						 if (A_LoopField = "")
							{
								continue
							}
						fuzn1=
						fuzn2=
						flsn=
						fsys=
						stringsplit,fuztst,A_LoopField,>
						flsn= %fuztst2%
						fsys= % %fuztst2%
						Loop, Parse, fuztst1,|
							{
								Loop, %RJSYSTEMS%\%A_LoopField%,2
									{
										splitpath,A_LoopFileFullPath,fsnma
										if (fsnma = RCLSYSTEM)
											{
												FileMoveDir,%A_LoopFileFullPath%,%RJSYSTEMS%\%fsys%,R
												if (ERRORLEVEL = 0)
													{
														SB_SetText(" " RCLSYSTEM " renamed to " fsys "")
														systmfldrs.= fsys . "|"
														knownfldrs.= fsys . "|"
														initfldrs.= fsys . "|"
														fsystw= 
														iniread,fsysl,SystemLocations.ini,LOCATIONS,%fsys%
														if (fsys1 = "")
															{
																iniwrite,"%RJSYSTEMS%\%fsys%|",SystemLocations.ini,LOCATIONS,%fsys%
																continue
															}
														ifinstring,fsysl,%RJSYSTEMS%\%fsys%|
															{
																continue
															}
														Loop,parse,fsys1,|
															{
																if (A_LoopField = "")
																	{
																		continue
																	}
																if (A_Index = 1)
																	{
																		fsystw= %RJSYSTEMS%\%fsys%|
																		continue
																	}
																fsystw.= A_LoopField . "|"
															}
														iniwrite,"%fsystw%",SystemLocations.ini,LOCATIONS,%fsys%
														gosub, resetCoreAssets
														return
													}
												SB_SetText("renamed failed")
												return
											}
										continue	
									}
							}
					}
			}
		return
	}
stringsplit,aij,isrs,|
isrs= %aij1%
semu= %aij1%
if (MINIMODE = 1)
	{
		gosub, MINIMODEOFF 
	}
guicontrol,choose,TABMENU,3
guicontrol,,SALIST,|Systems||Emulators|Utilities|Frontends
gosub, SALIST
guicontrol,,ADDCORE,|%RCLSYSTEM%||
knum=
Loop, Parse, allsupsys,`n`r
	{
		knum+=1
		if (A_LoopField = RCLSYSTEM)
			{
				guicontrol, choose, SYSINSTLBX,%knum%
				gosub, SYSINSTLBX
				break
			}
	}
gosub, ADDCORE
return

RestoreSystemN:
gui,submit,nohide
guicontrol,hide,RenOSys
guicontrol,hide,SavOSys
guicontrol,hide,CnclOSys
guicontrol,,OpnSys,+
guicontrolget,ADDCORE,,ADDCORE
Loop,parse,sysllst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,hiu,A_LoopField,=
		if (hiu1 = ADDCORE)
			{
				fnkdsh= %hiu2%
				Loop,parse,oldlkup,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,nnh,A_LoopField,=
						if (nnh2 = fnkdsh)
							{
								OldSysN= %nnh1%
								fileread,emcfgrpl,emucfgpresets.ini
								filedelete,emucfgpresets.ini
								stringreplace,emcfgrpl,emcfgrpl,[%ADDCORE%],[%OldSysN%],All
								fileappend,%emcfgrpl%,emuCfgPresets.ini
								iniread,tmpll,Assignments.ini,OVERRIDES,%ADDCORE%
								if (tmpll = "")
									{
										tmpll=""
									}
								iniwrite,%tmpll%,Assignments.ini,OVERRIDES,%OldSysN%
								iniread,tmpll,Assignments.ini,ASSIGNMENTS,%ADDCORE%
								if (tmpll = "")
									{
										tmpll=""
									}
								iniwrite,%tmpll%,Assignments.ini,ASSIGNMENTS,%OldSysN%
								iniread,tmpll,LaunchParams.ini,LAUNCHPARAMS,%ADDCORE%
								if (tmpll = "")
									{
										tmpll=""
									}
									iniwrite,%tmpll%,LaunchParams.ini,LAUNCHPARAMS,%OldSysN%
								iniread,tmpll,SystemLocations.ini,LOCATIONS,%ADDCORE%
								if (tmpll = "")
									{
										tmpll=""
									}
								iniwrite,%tmpll%,SystemLocations.ini,LOCATIONS,%OldSysN%
								inidelete,Assignments.ini,OVERRIDES,%ADDCORE%
								inidelete,Assignments.ini,ASSIGNMENTS,%ADDCORE%
								inidelete,LaunchParams.ini,LAUNCHPARAMS,%ADDCORE%
								inidelete,SystemLocations.ini,LOCATIONS,%ADDCORE%
								stringreplace,systmfldrs,systmfldrs,%ADDCORE%|,%OldSysN%|
								stringreplace,initfldrs,initfldrs,%ADDCORE%|,%OldSysN%|
								stringreplace,allsupport,allsupport,%ADDCORE%|,%OldSysN%|
								stringreplace,knownfldrs,knownfldrs,%ADDCORE%|,%OldSysN%|
								stringreplace,allsupsys,allsupsys,%ADDCORE%`n,%OldSysN%`n
								filedelete,lkup.ini
								stringreplace,sysllst,sysllst,%ADDCORE%=,%OldSysN%=
								fileappend,%sysllst%,lkup.ini
								ifexist,%RJSYSTEMS%\%ADDCORE%\
									{
										ifnotexist,%RJSYSTEMS%\%OldSysN%\
											{
												Msgbox,8196,RenameSystem,Rename the`n%ADDCORE%`ndirectory in your systems folder?
												ifmsgbox,yes
													{
														fileMoveDir,%RJSYSTEMS%\%ADDCORE%,%RJSYSTEMS%\%OldSysN%,R
														iniread,beb,SystemLocations.ini,LOCATIONS,%OldSysN%
														stringreplace,beb,beb,%RJSYSTEMS%\%ADDCORE%|,%RJSYSTEMS%\%OldSysN%|
														iniwrite,"%beb%",SystemLocations.ini,LOCATIONS,%OldSysN%
													}
											}
									}
								SB_SetText(" " OldSysN " restored")																
								gosub,resetCoreAssets	
								guicontrol,,SYSINSTLBX,|%allsupport%	
								guicontrol,,ADDCORE,|Select_A_System||	
								return
							}
					}
			}
	}
SB_SetText(" could not restore system name")
guicontrol,hide,RenOSys
guicontrol,hide,SavOSys
guicontrol,hide,CnclOSys
guicontrol,show,OpnSys
return

RenameSystem:
gui,submit,nohide
guicontrol,show,RenOSys
guicontrol,show,SavOSys
guicontrol,show,CnclOSys
guicontrol,hide,OpnSys
guicontrolget,ADDCORE,,ADDCORE
guicontrol,,RenOSys,%ADDCORE%
return

RenOsys:
gui,submit,nohide
guicontrolget,RenOsys,,RenOsys
if (RenOsys = Addcore)
	{
		guicontrol,,RenOSys,
		return
	}
ifinstring,RenOsys,`%
	{
		SB_SetText("`% character not permitted")
		guicontrol,,RenOsys,
		return
	}
ifinstring,RenOsys,*
	{
		SB_SetText("* character not permitted")
		guicontrol,,RenOsys,
		return
	}
ifinstring,RenOsys,`"
;"
	{
		SB_SetText("`'' character not permitted")
		guicontrol,,RenOsys,
		return
	}
ifinstring,RenOsys,`\
	{
		SB_SetText("`\ character not permitted")
		guicontrol,,RenOsys,
		return
	}
ifinstring,RenOsys,=
	{
		SB_SetText("= character not permitted")
		guicontrol,,RenOsys,
		return
	}
ifinstring,RenOsys,`/
	{
		SB_SetText("`/ character not permitted")
		guicontrol,,RenOsys,
		return
	}
ifinstring,RenOsys,|
	{
		SB_SetText("| character not permitted")
		guicontrol,,RenOsys,
		return
	}
ifinstring,RenOsys,:
	{
		SB_SetText(": character not permitted")
		guicontrol,,RenOsys,
		return
	}
ifinstring,RenOsys,>
	{
		SB_SetText("> character not permitted")
		guicontrol,,RenOsys,
		return
	}
ifinstring,RenOsys,?
	{
		SB_SetText("? character not permitted")
		guicontrol,,RenOsys,
		return
	}
ifinstring,RenOsys,<
	{
		SB_SetText("< character not permitted")
		guicontrol,,RenOsys,
		return
	}
return

SavOsys:
gui,submit,nohide
guicontrolget,RenOSys,,RenOSys
guicontrolget,ADDCORE,,ADDCORE
stringreplace,RenOSys,RenOSys,:,-,All
stringreplace,RenOSys,RenOSys,>,-,All
stringreplace,RenOSys,RenOSys,<,-,All
stringreplace,RenOSys,RenOSys,?,-,All
stringreplace,RenOSys,RenOSys,*,-,All
stringreplace,RenOSys,RenOSys,\,-,All
stringreplace,RenOSys,RenOSys,/,-,All
stringreplace,RenOSys,RenOSys,|,-,All
stringreplace,RenOSys,RenOSys,=,-,All
ldfsy= 
Loop,parse,SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,hiu,A_LoopField,=
		Loop,parse,oldlkup,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (hui1 = RenOSys)
					{
						ldfsy= 1
						break
					}
			}
		if (hiu1 = RenOsys)
			{
				SB_SetText(" " RenOsys " is an identified system ")
				iniread,pthnw,SystemLocations.ini,LOCATIONS,%ADDCORE%
				iniread,pthnx,SystemLocations.ini,LOCATIONS,%RENOSYS%
				if (pthnx <> "")
					{
						Loop,parse,pthnw,|
							{
								if ((A_LoopField = "")or(pthnw = "")or instr(pthnx,A_LoopField "|"))
									{
										continue
									}
								if (A_Index = 1)
									{
										jusn= 
										jusp= 
										trnm= 
										splitpath,A_LoopField,jusn,jusp
										if (jusn = ADDCORE)
											{
												Msgbox,8196,Set System,Rename`n%Addcore%`nto`n%RenOsys%?
												ifmsgbox,yes
													{
														FileMoveDir,%A_LoopField%,%JUSP%\%RENOSYS%,R
													}
											}
										ptwr.= pthnw . "|"
									}
								ptwr.= A_LoopField . "|"
							}
						ptwr= %pthnx%%ptwr%
						stringreplace,ptwr,ptwr,||,|,All
						iniwrite,"%ptwr%",SystemLocations.ini,Locations,%RENOSYS%
						iniwrite,"",SystemLocations.ini,Locations,%ADDCORE%
					}
				else {
					iniwrite,"%pthnw%",SystemLocations.ini,Locations,%RENOSYS%
				}
				iniread,tmpll,Assignments.ini,OVERRIDES,%ADDCORE%
				if (tmpll = "")
					{
						tmpll=""
					}
				iniwrite,%tmpll%,Assignments.ini,OVERRIDES,%RENOSYS%
				iniread,tmpll,Assignments.ini,ASSIGNMENTS,%ADDCORE%
				if (tmpll = "")
					{
						tmpll=""
					}
				iniwrite,%tmpll%,Assignments.ini,ASSIGNMENTS,%RENOSYS%
				iniread,tmpll,LaunchParams.ini,LAUNCHPARAMS,%ADDCORE%
				if (tmpll = "")
					{
						tmpll=""
					}
				iniwrite,%tmpll%,LaunchParams.ini,LAUNCHPARAMS,%RENOSYS%
				iniread,aeb,emuCfgPresets.ini,%ADDCORE%
				loop,parse,aeb,`n
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,ebo,A_LoopField,=
						iniwrite,%ebo2%,emuCfgPresets.ini,%RenOsys%,%ebo1%
					}
				if (ldfsy <> 1)
					{
						inidelete,Assignments.ini,OVERRIDES,%ADDCORE%
						inidelete,Assignments.ini,ASSIGNMENTS,%ADDCORE%
						inidelete,LaunchParams.ini,LAUNCHPARAMS,%ADDCORE%
						inidelete,SystemLocations.ini,LOCATIONS,%ADDCORE%
						fileread,emcfgrpl,emucfgpresets.ini
						filedelete,emucfgpresets.ini
						stringreplace,emcfgrpl,emcfgrpl,[%ADDCORE%],[%RenOSys%],All
						fileappend,%emcfgrpl%,emuCfgPresets.ini
					}
					else {
							iniread,aea,sets\emuCfgPresets.set,%ADDCORE%
							stringreplace,aea,aea,[ARCH],%ARCH%
							loop,parse,aea,`n
								{
									if (A_LoopField = "")
										{
											continue
										}
									stringsplit,ebo,A_LoopField,=
									iniwrite,%ebo2%,emuCfgPresets.ini,%ADDCORE%,%ebo1%
									if (ebo1 = "LNCHPRM")
										{
											iniwrite,"%ebo2%",LaunchParams.ini,LAUNCHPARAMS,%ADDCORE%
										}
								}
					}
				stringreplace,sysllst,sysllst,%ADDCORE%|,%RenOSys%|
				stringreplace,systmfldrs,systmfldrs,%ADDCORE%|,%RenOSys%|
				stringreplace,initfldrs,initfldrs,%ADDCORE%|,%RenOSys%|
				stringreplace,allsupport,allsupport,%ADDCORE%|,%RenOSys%|
				stringreplace,knownfldrs,knownfldrs,%ADDCORE%|,%RenOSys%|
				stringreplace,allsupsys,allsupsys,%ADDCORE%`n,%RenOSys%`n
				filedelete,lkup.ini
				stringreplace,sysllst,sysllst,%ADDCORE%=,%RENOSYS%=
				fileappend,%sysllst%,lkup.ini
				guicontrol,hide,CnclOsys
				guicontrol,hide,SavOsys
				guicontrol,hide,RenOsys
				return
			}
	}
guicontrol,hide,CnclOsys
guicontrol,hide,SavOsys
guicontrol,hide,RenOsys
fileread,emcfgrpl,emucfgpresets.ini
filedelete,emucfgpresets.ini
stringreplace,emcfgrpl,emcfgrpl,[%ADDCORE%],[%RenOSys%],All
fileappend,%emcfgrpl%,emuCfgPresets.ini
iniread,tmpll,Assignments.ini,OVERRIDES,%ADDCORE%
if (tmpll = "")
	{
		tmpll=""
	}
iniwrite,%tmpll%,Assignments.ini,OVERRIDES,%RENOSYS%
iniread,tmpll,Assignments.ini,ASSIGNMENTS,%ADDCORE%
if (tmpll = "")
	{
		tmpll=""
	}
iniwrite,%tmpll%,Assignments.ini,ASSIGNMENTS,%RENOSYS%
iniread,tmpll,LaunchParams.ini,LAUNCHPARAMS,%ADDCORE%
if (tmpll = "")
	{
		tmpll=""
	}
iniwrite,%tmpll%,LaunchParams.ini,LAUNCHPARAMS,%RENOSYS%
iniread,tmpll,SystemLocations.ini,LOCATIONS,%ADDCORE%
if (tmpll = "")
	{
		tmpll=""
	}
iniwrite,%tmpll%,SystemLocations.ini,LOCATIONS,%RENOSYS%
inidelete,Assignments.ini,OVERRIDES,%ADDCORE%
inidelete,Assignments.ini,ASSIGNMENTS,%ADDCORE%
inidelete,LaunchParams.ini,LAUNCHPARAMS,%ADDCORE%
stringreplace,sysllst,sysllst,%ADDCORE%|,%RenOSys%|
stringreplace,systmfldrs,systmfldrs,%ADDCORE%|,%RenOSys%|
stringreplace,initfldrs,initfldrs,%ADDCORE%|,%RenOSys%|
stringreplace,allsupport,allsupport,%ADDCORE%|,%RenOSys%|
stringreplace,knownfldrs,knownfldrs,%ADDCORE%|,%RenOSys%|
stringreplace,allsupsys,allsupsys,%ADDCORE%`n,%RenOSys%`n
filedelete,lkup.ini
stringreplace,sysllst,sysllst,%ADDCORE%=,%RENOSYS%=
fileappend,%sysllst%,lkup.ini
iniread,pthnx,SystemLocations.ini,LOCATIONS,%RENOSYS%
iniread,pthnw,SystemLocations.ini,LOCATIONS,%ADDCORE%
Loop,parse,pthnw,|
	{
		if ((A_LoopField = "")or(pthnw = "")or instr(pthnx,A_LoopField))
			{
				continue
			}
		if (A_Index = 1)
			{
				jusn= 
				trnm= 
				splitpath,A_LoopField,jusn
				if (jusn = ADDCORE)
					{
						Msgbox,8196,Set System,Rename`n%Addcore%`nto`n%RenOsys%?
						ifmsgbox,yes
							{
								FileMoveDir,%A_LoopField%,%RENOSYS%,R
							}
					}
				ptwr.= pthnw . "|"
			}
		ptwr.= A_LoopField . "|"
	}
	ptwr= %pthnx%%ptwr%
iniwrite,"%ptwr%",SystemLocations.ini,Locations,%RENOSYS%
inidelete,SystemLocations.ini,LOCATIONS,%ADDCORE%
//*
ifexist,%RJSYSTEMS%\%ADDCORE%\
	{
		ifnotexist,%RJSYSTEMS%\%RENOSYS%\
			{
				Msgbox,8196,RenameSystem,Rename the`n%ADDCORE%`ndirectory in your systems folder?
				ifmsgbox,yes
					{
						fileMoveDir,%RJSYSTEMS%\%ADDCORE%,%RJSYSTEMS%\%RENOSYS%,R
						iniread,beb,SystemLocations.ini,LOCATIONS,%RENOSYS%
						stringreplace,beb,beb,%RJSYSTEMS%\%ADDCORE%|,%RJSYSTEMS%\%RENOSYS%|
						iniwrite,"%beb%",SystemLocations.ini,LOCATIONS,%RENOSYS%
					}
			}
	}
*/
gosub,resetCoreAssets	
guicontrol,,SYSINSTLBX,|%allsupport%
guicontrol,,ADDCORE,|Select_A_System||
return

CnclOsys:
gui,submit,nohide
guicontrol,hide,CnclOsys
guicontrol,hide,SavOsys
guicontrol,hide,RenOsys
guicontrol,hide,OpnSys
return

ASLNEMU:
guicontrolget,runalone,,LCORE
iniread,runalx,Assignments.ini,ASSIGNMENTS,%runalone%
if ((runalx <> "ERROR")&&(runalx <> ""))
	{
		runfrm= 
		runald= 
		iniread,runfrm,AppParams.ini,%runalone%,run_location
		if (runfrm = 0)
			{
				splitpath,runalx,,runald
			}
		SB_SetText(" " runalx " ")
		RunWait, "%runalx%",,%runald%
	}
else {
	SB_SetText(" Could not run " runalone " ")
	return
}	
return	

ASEMUCFG:
guicontrolget,SEMURUN,,LCORE
guicontrolget,SEMUSYS,,RUNSYSDDL
ifinstring,SEMURUN,_libretro.dll
	{
		SB_SetText("the current configuration options are displayed")
		return
	}
if (MINIMODE = 1)
	{
		gosub, MINIMODEOFF
	}	
guicontrol,choose,TABMENU,3
guicontrolget,SALIST,,SALIST
if (SALIST <> "Systems")
	{
		guicontrol,,SALIST,|Systems||Emulators|Utilities|Frontends
		gosub,SALIST
	}
guicontrol, Focus, SYSINSTLBX
febnbr= 
KRBP= 
if (semusys <> "")
	{
	Loop,500
		{
			KRBP+=1
			febav= % syspardinj_%KRBP%
			if (febav = SEMUSYS)
				{
					febnbr:= KRBP
					LBEX_SELECTSTRING(eavlbx,febnbr)
					LBEX_SetSel(eavlbx,febnbr)
					LBEX_SetFocus(eavlbx,febnbr)
					break
				}
		}
	}
gosub, SYSINSTLBX
guicontrol, Focus, EMPRLST
LBEX_SELECTSTRING(prisl,SEMURUN)
gosub, EMPRLST
/*
Loop,parse,PSETCFGITEMS,|
	{
		guicontrol,hide,%A_LoopField%
	}
guicontrol,show,EMUPGC
*/
return

ASRUN:
guicontrolget,CHKRUNS,,RUNSYSDDL
stringreplace,CHKRUNS,CHKRUNS,.lpl,,All
guicontrolget,CHKRUNE,,LCORE
iniread,CHRFFMP,Assignments.ini,OVERRIDES,%CHKRUNS%
if (CHRFFMP = "ERROR")
	{
		SB_SetText(" " CHKRUNS " is not a verified system")
		return
	}
CHKRMP=
ifinstring,CHRFFMP,%CHKRUNE%
	{
		ckins=
		Loop, Parse, CHRFFMP,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				ckins+=1
				if ((ckins = 1) && (A_LoopField <> CHKRUNE))
					{
						CHKRMP.= CHKRUNE . "|" . A_LoopField . "|"
						continue
					}
				if (A_LoopField <> CHKRUNE)
					{
						CHKRMP.= A_LoopField . "|"
					}
			}
		CHKRUNE= %CHKRMP%
		CHRFFMP=
	}
if (CHKRMP = "")
		{
			CHKRUNE.= "|" CHRFFMP
		}
iniread,tdsv,GameOverrides.ini,%RUNSYSDDL%
if (tdsv <> "ERROR")
	{
		Msgbox,8452,Overwrite All?,There are overrides for this system.`nClear Overrides for all titles in "%RUNSYSDDL%?"
		ifmsgbox,yes
			{
				inidelete,GameOverrides.ini,%RUNSYSDDL%
				SB_SetText("Overrides cleared for " CHKRUNS "")
			}
	}
iniwrite,"%CHKRUNE%",Assignments.ini,OVERRIDES,%CHKRUNS%
SB_SetText(" " CHKRUNE " assigned to " CHKRUNS "")
return

PLEDITCORE:
gui,submit,nohide
guicontrolget,PLISTTYP,,PLISTTYP
guicontrolget,CSPLITM,,CURPLST
if (CSPLITM = "")
	{
		SB_SetText("Playlist item must be selected")
		return
	}
ControlGet,curpllst, List,,,ahk_id %insel%
existlst=
sein=
Loop, Parse,curpllst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		sein+=1
		if (A_LoopField <> ",")
			{
				taih1=
				taih2=
				cvtdlst .= (sein == 1 ? "" : "|") . A_LoopField
			}
	}
plswap= %runlist%
pldelim= >
if (PLISTTYP = "RetroFE")
	{
		plswap= %systmfldrs%
		pldelim= :
	}
if (PLISTTYP = "Pegasus")
	{
		plswap= %systmfldrs%
		pldelim= :
	}
if (PLISTTYP = "EmulationStation")
	{
		plswap= %ESPLPLST%
		pldelim= :
	}
Loop, Parse, runlist,|
	{
		Menu, PLEDTMENU, Add, %A_LoopField%, PLSWPMENU
	}
mousegetpos,Ngx,Ngy
MENU_X:= Ngx*(A_ScreenDPI/96)
MENU_Y:= Ngy*(A_ScreenDPI/96)
Menu,PLEDTMENU, Show, %MENU_X% %MENU_Y%
return

PLSWPMENU:
gui,submit,nohide
Menu, PLSWPMENU, Add
coreswap= %A_ThisMenuItem%
ControlGet,curpllst, List,,,ahk_id %insel%
CSPLITM=
guicontrolget,CSPLITM,,CURPLST
cvtdlst=
sein=
Loop, Parse,curpllst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		sein+=1
		if (A_LoopField <> ",")
			{
				taih1=
				taih2=
				cvtdlst .= (sein == 1 ? "" : "|") . A_LoopField
			}
	}
ControlGet,curpllst, List,,,ahk_id %insel%
existlst=
Loop, Parse, CSPLITM,|
	{
		stringsplit,splitcore,A_LoopField,%pldelim%
		stringreplace,cvtdlst,cvtdlst,%A_LoopField%,%splitcore1%%pldelim%%coreswap%,All
	}
guicontrol,,CURPLST,|%cvtdlst%
Menu,PLSWPMENU,DeleteAll
return

ArcRCL:
gui,submit,nohide
guicontrol,,ARCCORES,|%A_ThisMenuItem%||%runlist%
qmen= 1
if (FILT_UNSUP <> 1)
	{
		if (Ident_sys = "")
			{
				gosub,RecentRead
			}
	}
coreselv= %A_ThisMenuItem%
guicontrol,,ARCCORES,|%A_ThisMenuItem%||%runlist%
coremsvc=
CUSTMOPT=
CSTINJOPT=
ifinstring,coreselv,mame
	{
		ifinstring,coreselv,_libretro
			{
				goto, Arclaunch
			}
		coremsvc=
		iniread,RJMAMENM,emuCfgPresets.ini,%EXTRSYS%,RJMAMENM
		iniread,CUSTMOPT,AppParams.ini,%coreselv%,options
		stringreplace,CUSTMOPT,CUSTMOPT,",,All
		;"
		if (CUSTMOPT = "[CUSTMOPT]")
			{
				iniread,CUSTMOPTLST,emuCfgPresets.ini,%ARCSYS%,MAME?RJEMUOPTS
				if (CUSTMOPTLST <> "ERROR")
					{
						Loop,Parse,CUSTMOPTLST,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								coremsvc= 1
								stringreplace,CSTINJOPT,A_LoopField,<,%A_Space%,All
								stringreplace,CSTINJOPT,CSTINJOPT,[RJMAMESYS],%RJMAMENM%,All
								break
							}
					}
			}
	}
guicontrol,,RUNFLRAD,1
guicontrol,,RUNSYSDDL,|%EXTRSYS%||%INITFLDRS%
gosub, ArcLaunch
return

RunRCL:
gui,submit,nohide
guicontrol,,LCORE,|%A_ThisMenuItem%||
coreselv= %A_ThisMenuItem%
qmen= 1
if (FILT_UNSUP <> 1)
	{
		if (Ident_sys = "")
			{
				gosub,RecentRead
			}
	}
guicontrol,,LCORE,|%A_ThisMenuItem%||
gosub, LnchCore
coremsvc=
ifinstring,coreselv,_libretro
	{
		goto, SUBLNCH
	}
coremsvc=
RCLSUP:
iniread,RJMAMENM,emuCfgPresets.ini,%RUNSYSDDL%,RJMAMENM
iniread,CUSTMOPT,AppParams.ini,%coreselv%,options
stringreplace,CUSTMOPT,CUSTMOPT,",,All
;"
if (CUSTMOPT = "[CUSTMOPT]")
	{
		ifnotinstring,coreselv,mame
			{
				INIREAD,effh,Assignments.ini,ASSIGNMENTS,%coreselv%
				splitpath,effh,efxf,efxd,efxtn,efxn
				Loop, Parse, emupartset,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,finfa,A_LoopField,<
						if (efxf = finfa3)
							{
								coreselv= %finfa1%
							}
					}
				iniread,ALTOPTLST,emuCfgPresets.ini,%RUNSYSDDL%,%coreselv%?RJEMUOPTS
				if (ALTOPTLST <> "ERROR")
					{
						Loop,Parse,ALTOPTLST,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								coremsvc= 1
								stringreplace,CSTINJOPT,A_LoopField,<,%A_Space%,All
								Loop,Parse,CSTINJOPT,|
									{
										if (A_LoopField = "")
											{
												continue
											}
										CSTINJOPT= %A_LoopField%
										break
									}
								stringreplace,CSTINJOPT,CSTINJOPT,[RJMAMESYS],%RJMAMENM%,All
								break
							}
					}
			}
		ifinstring,coreselv,mame
			{
				iniread,CUSTMOPTLST,emuCfgPresets.ini,%RUNSYSDDL%,MAME?RJEMUOPTS
				if (CUSTMOPTLST <> "ERROR")
					{
						Loop,Parse,CUSTMOPTLST,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								coremsvc= 1
								stringreplace,CSTINJOPT,A_LoopField,<,%A_Space%,All
								stringreplace,CSTINJOPT,CSTINJOPT,[RJMAMESYS],%RJMAMENM%,All
								break
							}
					}
			}
		guicontrol,,CUSTMOPTS,|%CSTINJOPT%||%INJOPT%
	}
gosub, SUBLNCH
return

AQRUN:
guicontrolget,curiasn,,ARCCORES
guiControlGet,plenb,Enabled,ARCLNCH
if (plenb = 0)
	{
		return
	}
keyin= %ARCSYS%
gosub, RevTransformSys	
poprc= 
IniRead,poprc,Assignments.ini,OVERRIDES,%keyout%
if ((poprc <> "")&&(poprc <> "ERROR"))
	{
		poprc= |%poprc%|
	}
else
	{
		poprc=
	}
adfn=
Menu, AQRUN, Add
iniread,aimn,emuCfgPresets.ini,%keyout%,SUPEMU
Loop,parse,aim,|
	{
		iniread,poprac,Assignments.ini,ASSIGNMENTS,%A_LoopField%
		if (poprac <> "")
			{
				ifnotinstring,poprc,|%A_LoopField%|
				poprc.= A_LoopField . "|"
			}
	}
if (raexefile <> "")
	{
		iniread,aimc,emuCfgPresets.ini,%keyout%,SUPCORE
		Loop, Parse,aimc,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (FileExist(libretrodirectory . "\" . A_LoopField))
					{
						poprc.= A_LoopField . "|"
					}
			}
	}
Loop,Parse,poprc,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		Menu, AQRUN, Add, %A_LoopField%, ArcRCL
	}
mousegetpos,Ngx,Ngy
MENU_X:= Ngx*(A_ScreenDPI/96)
MENU_Y:= Ngy*(A_ScreenDPI/96)
Menu,AQRUN, Show, %MENU_X% %MENU_Y%
Menu,AQRUN,DeleteAll
return

CLREDT:
gui, submit, nohide
romf=
last_rom=
coreselv=
romqtmp=
guicontrolget,RUNSYSDDL,,RUNSYSDDL
ifinstring,RUNSYSDDL,.lpl
	{
		stringtrimright,RUNSYDDL,RUNSYSDDL,4
	}
guicontrolget,LCORE,,LCORE
guicontrolget,romqtmp,,MORROM
splitpath,romqtmp,romfxe,romfd,romdxtn,romfn,romGD
ifexist,cfg\%RUNSYSDDL%\%LCORE%\%romfn%\
	{
		FileDelete, cfg\%RUNSYSDDL%\%LCORE%\%romfn%\*
		SB_SetText("Cleared " RUNSYSDDL " \ " LCORE " \ " romfn " settings")
	}

guicontrol,,LCORE,|%runlist%
guicontrol,, MORROM, |%romf%||
iniwrite, "%coreselv%",Settings.ini,GLOBAL,last_core
iniwrite, "%romf%",Settings.ini,GLOBAL,last_rom
gui, submit, nohide
gosub, LNCHCHK
ifinstring,LCORE,_libretro
	{
		guicontrol,move,CLRCUROM,x720 y30
		guicontrol,show,RETAL
	}
guicontrol,,SRCHFLRAD,1
guicontrol,,SRCHLOCDDL,|:=:System List:=:||%systmfldrs%
return

RCLLNCH:
RCLLNCH= 1
SQRUN:
guicontrolget,curiasn,,LCORE
ControlGet,curpllst, List,,,ahk_id %insel%
guicontrolget,RUNSYSDDL,,RUNSYSDDL
if (RUNPLRAD = 1)
	{
		ifinstring,RUNSYSDDL,.lpl
			{
				stringreplace,RUNSYSDDX,RUNSYSDDL,.lpl,,All
				ifinstring,A_LoopField,%A_Space%-%A_Space%
					{
						Loop,parse,SysLLst,`n`r
							{
								if (A_LoopField = "")
									{
										continue
									}
								stringsplit,vir,A_LoopField,=
								if (vir1 = RUNSYSDDX)
									{
										RUNSYSDDL= %A_LoopField%
										break
									}
							}
					}
			}
		if (RUNSYSDDL = "History")
			{
				RUNSYSDDL=
				guicontrolget,rrn,,MORROM
				Loop,parse,rrn,\
					{
						rsts= %A_LoopField%
						ifinstring,rsts,%A_Space%-%A_Space%
							{
								Loop,parse,SysLLst,`n`r
									{
										if (A_LoopField = "")
											{
												continue
											}
										stringsplit,vir,A_LoopField,=
										if (vir1 = rsts)
											{
												RUNSYSDDL= %vir1%
												break
											}
									}
							}
						if (RUNSYSDDL <> "")
							{
								break
							}
					}
			}
	}
ifinstring,RUNSYSDDL,:=:
	{
		guicontrolget,romf,,MORROM
		Loop, Parse, SysLLst,`n`r
			{
				stringsplit,aie,A_LoopField,=,`n`r
				ifinstring,romf,\%aie1%\
					{
						RUNSYSDDL= %aie1%
						break
					}
			}
	}
if (RUNSYSDDL = "")
	{
		SB_SetText("no system detected")
		return
	}
poprc=
IniRead,poprc,Assignments.ini,OVERRIDES,%RUNSYSDDL%
if (poprc = "ERROR")
	{
		return
	}
if (poprc <> "")
	{
		poprc= |%poprc%|
	}
else
	{
		poprc=
	}
adfn=
Menu, SQRUN, Add
iniread,aimn,emuCfgPresets.ini,%RUNSYSDDL%,SUPEMU
Loop,parse,aim,|
	{
		iniread,poprac,Assignments.ini,ASSIGNMENTS,%A_LoopField%
		if (poprac <> "")
			{
				ifnotinstring,poprc,|%A_LoopField%|
				poprc.= A_LoopField . "|"
			}
	}
if (raexefile <> "")
	{
		iniread,aimc,emuCfgPresets.ini,%RUNSYSDDL%,SUPCORE
		Loop, Parse,aimc,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (FileExist(libretrodirectory . "\" . A_LoopField))
					{
						poprc.= A_LoopField . "|"
					}
			}
	}
Loop,Parse,poprc,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		Menu, SQRUN, Add, %A_LoopField%, RunRCL
	}
Menu,SQRUN, Show, %MENU_X% %MENU_Y%
Menu,SQRUN,DeleteAll
RCLCNCH=
return

CfgBrowse:
gui,submit,nohide
guicontrolget,systmp,,RUNSYSDDL
guicontrolget,gamtmp,,MORROM
guicontrolget,lcrtmp,,LCORE
if (gamtmp = "")
	{
		return
	}
splitpath,gamtmp,,,,gamtnm
ifexist,cfg\%systmp%\%lcrtmp%\%gamtnm%\
	{
		Run, Explorer "cfg\%systmp%\%lcrtmp%\%gamtnm%"
		return
	}
SB_SetText(" CONFIG not found ")
return

DelCfg_Add:
gui,submit,nohide
itmlst=
guicontrolget,SRCHLOCVI,,SRCHLOCDDL
guicontrolget,ccoreLBX,,LCORE
guicontrolget,SRCHROMLVI,,SRCHROMLBX
if (ClrCfgT = 1)
	{
		guicontrolget,SRCHLOCVI,,RUNSYSDDL
		guicontrolget,SRCHROMLVI,,MORROM
		ifnotexist,%SRCHROMLVI%
			{
				SB_SetText(" ROM not found ")
				return
			}
		ClrCfgT=
	}
splitpath,SRCHROMLVI,,,,romfnm
if (SRCHPLRAD = 1)
	{
		gamfnd=
		Loop, Parse, SRCHROMLVI,|
			{
				gamsplv= %RJSYSTEMS%\%SRCHLOCVI%\%A_LoopField%
				stringsplit,gamspli,gamsplv,>
				Loop, Read, %playlistLoc%\%SRCHLOCDDL%
					{
						readah= %A_Index%
						if (gamspli1 = A_LoopReadLine)
							{
								aef:= readah + 2
								FileReadLine,ccoreLBX,%playlistLoc%\%SRCHLOCDDL%,%aef%
								splitpath,ccoreLBX,givxe,givxd,givxtn,givxn
								if (givxe <> gamspli2)
									{
										continue
									}
								if (givxe <> "")
									{
										ccoreLBX= %givxe%
										gamfnd= 1
									}
							}
					}
			}
		if (gamfnd = 1)
			{
				goto, srchplinj
			}
	}
if (ccoreLBX = "")
	{
		ccoreLBX= DETECT
	}
srchplinj:
iniread,givn,Assignments.ini,ASSIGNMENTS,%ccoreLBX%
if (givn <> "ERROR")
	{
		givxe=
		givxn=
		splitpath,givn,givxe,givxd,givxtn,givxn
		splitpath,givxd,,,,givxdn
		if (ccorelbx = givxn)
			{
				SB_SetText(" " givxn " Preset found ")
			}
	}
cfgwstr=
ifnotinstring,emupartset,%givxe%<
	{
		iniread,givxn,Assignments.ini,ASSIGNMENTS,%SRCHLOCDDL%
		if (givxn <> "ERROR")
			{
				iniread,givxn,Assignments.ini,ASSIGNMENTS,%givxdn%
				if (givxn = "ERROR")
					{
						cfgwstr= 1
						stringsplit,efji,SRCHROMLBX,`n>
						ifnotexist,cfg\%SRCHLOCDDL%\%efji1%\%givxdn%\
							{
								SB_SetText("No emulator found")
								return
							}
						givxn= %givxdn%
					}
			}
		givxe=
		givxn=
		splitpath,givn,givxe,givxd,givxtn,givxn
		if (givn <> "ERROR")
				{
					if (ccorelbx = givxn)
						{
							SB_SetText(" Cannot find emulator presets ")
							return
						}
					SB_SetText(" using " givn " presets")
				}
	}
ifinstring,ccoreLBX,_libretro.dll
	{
		stringreplace,ccv,ccoreLBX,_libretro.dll,,All
		gosub, getCREN
		FileDelete,%raexedir%\config\%corcfgnam%\%romfnm%.cfg
		if (ERRORLEVEL > 0)
			{
				SB_SetText("could not delete " romfnm " retroArch config file")
				return
			}
		SB_SetText("" romfnm " retroArch config file deleted")
		return
	}
Loop, Parse, SRCHROMLVI,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,gamspli,A_LoopField,>
		gamnm= %gamspli1%
		splitpath,gamnm,gamfxe,gamfdir,gamfxt,gamcnam,
		Loop, Parse,emupartset,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				Loop, 7
					{
						fein%A_Index%=
					}
				ifnotinstring,A_LoopField,%givxe%<
					{
						continue
					}
				stringsplit,fein,A_LoopField,<
				if (cfgwstr = 1)
					{
						fein4= *.ini|*.cfg|*.xml|*.conf|*.config
						fein5= *.mem|*.sav|*.state
					}
				if (fein4 <> "")
					{
						Loop, parse, fein4,|
							{
								splitpath,A_LoopField,svin
								FileDelete,cfg\%SRCHLOCVI%\%givxn%\%gamcnam%\%svin%
							}
					}
				if (fein5 <> "")
					{
						Loop, parse, fein5,|
							{
								splitpath,A_LoopField,svin
								FileDelete,cfg\%SRCHLOCVI%\%givxn%\%gamcnam%\.sstates\%svin%
							}
					}
				if (fein6 <> "")
					{
						Loop, parse, fein6,|
							{
								splitpath,A_LoopField,svin
								FileDelete,cfg\%SRCHLOCVI%\%givxn%\%gamcnam%\.Mem\%svin%
							}
					}
				if (fein7 <> "")
					{
						Loop, parse, fein7,|
							{
								splitpath,A_LoopField,svin
								FileDelete,cfg\%SRCHLOCVI%\%givxn%\%gamcnam%\.Mem\%svin%
							}
					}
				SB_SetText("deleted " ccoreLBX " config files for " gamcnam " ")
			}
	}
return

Emulator_Add:
multisel=
guicontrolget,romf,,SRCHROMLBX
Loop, Parse, romf,`n|
	{
		multisel+=1
		if (multisel > 1)
			{
				break
			}
	}
sivi=
if (multisel = 2)
	{
		iniread,fei,emuCfgPresets.ini,%SRCHLOCDDL%,RJMULTIDISC
		if (fei <> "ERROR")
			{
				multisel= 1
				sivi= 1
			}
	}
Menu,Emulator_Add, Add
if (multisel <> 1)
	{
		SB_SetText("Select a single item only")
		return
	}
if (sivi = 1)
	{
		Loop, parse,romf,`n|
			{
				if (A_LoopField = "")
					{
						continue
					}
				incdisk+= 1
				if (incdisk = 1)
					{
						romA= %A_LoopField%
					}
				if (incdisk = 2)
					{
						romB= %A_LoopField%
					}
				if (incdisk = 3)
					{
						romC= %A_LoopField%
					}
				if (incdisk = 4)
					{
						romD= %A_LoopField%
					}
				if (incdisk = 5)
					{
						romE= %A_LoopField%
					}
				if (incdisk = 6)
					{
						romF= %A_LoopField%
					}
				if (incdisk = 7)
					{
						romG= %A_LoopField%
					}
				if (incdisk = 8)
					{
						romH= %A_LoopField%
					}
				if (incdisk = 9)
					{
						romI= %A_LoopField%
					}
				if (incdisk = 12)
					{
						romJ= %A_LoopField%
					}
				if (incdisk = 13)
					{
						romK= %A_LoopField%
					}
				if (incdisk = 14)
					{
						romL= %A_LoopField%
					}
				sromp= %A_LoopField%
				srpopt=
				ifinstring,coreselv,mame
					{
						iniread,srpopt,emuCfgPresets.ini,MAME?RJEMUOPTS
						if (srpopt <> "ERROR")
							{
								stringsplit,ars,srpopt,|
								stringreplace,srpopt,ars1,<,%A_Space%,All
								ifinstring,srpopt,1
									{
										if (incdisk > 1)
											{
												stringsplit,afvi,srpopt,%A_Space%
												afvir= %afvi2%
												stringreplace,afvi2,afvi2,1,%incdisk%,All
												stringreplace,stpopt,afvi2,afvir,%incdisk%,All
											}
									}
							}
					}
				romf.= srpopt . sromq . sromp . sromq . A_Space
			}
		multisel= 1
	}
if (multisel = 1)
	{
		Loop, Parse, runlist,|
			{
				emuta= %A_LoopField%
				gosub, AddEmuTOList
			}
		mousegetpos,Ngx,Ngy
		MENU_X:= Ngx*(A_ScreenDPI/96)
		MENU_Y:= Ngy*(A_ScreenDPI/96)
		Menu,Emulator_Add, Show, %MENU_X% %MENU_Y%
	}
Menu,Emulator_Add,DeleteAll
return

EXPLJK:
gui,submit,nohide
guicontrolget,fldtx,,RNMJACK
guicontrolget,systx,,ARCSYS
if (OVDCHK = 1)
	{
		guicontrolget,OVDTXT,,OVDTXT
		JEXPLD= %OVDTXT%\%fldtx%
	}
	else {
		JEXPLD= %RJSYSTEMS%\%systx%\%fldtx%
	}
ifnotexist, %JEXPLD%
	{
		filecreatedir,%JEXPLD%
	}
Run, explorer.exe %JEXPLD%,%JEXPLD%
return

Open_Add:
gui,submit,nohide
multisel=
Loop, Parse, romf,`n|
	{
		multisel+= 1
		if (multisel > 1)
			{
				break
			}
	}
if (multisel = 1)
	{
		guicontrolget,srchfsel,,SRCHROMLBX
		srchfsel= %RJSYSTEMS%\%SRCHLOCDDL%\%srchfsel%
		SplitPath, srchfsel,,popdir
		Run, Explorer "%popdir%"
		return
	}
SB_SetText("Select a single item only")
return

Exe_Add:
gui,submit,nohide
filecreatedir,%S_KeyDir%\executable\roms
IniRead,kiv,SystemLocations.ini,LOCATIONS,%SRCHLOCDDL%
sinnz=
itmlst=
guicontrolget,itmlst,,SRCHROMLBX
Gui,ListView,utlLVA
lvachk= +Check
Loop,parse,kiv,|
	{
		newn= %A_LoopField%\
		Loop, Parse, itmLst,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				ifnotinstring,A_LoopField,:
					{
						sinnz:= newn . A_LoopField
					}
					else {
						sinnz:= A_LoopField
					}
				splitpath,sinnz,sinnxe
				sinnta= executable\roms\%sinnxe%
				filecopy,%sinnz%,%S_KeyDir%\executable\roms\%sinnxe%,1
				LV_Add(lvachk,sinnta)
				stringreplace,itmlst,itmlst,%A_LoopField%,,All
			}
	}
LV_ModifyCol()	
Guicontrol,choose,TABMENU,9	
return	
Playlist_Add:
gui,submit,nohide
itmlst=
guicontrolget,ccoreLBX,,LCORE
if (ccoreLBX = "")
	{
		ccoreLBX= DETECT
		}
guicontrolget,itmlst,,SRCHROMLBX
if (noadpl = 1)
	{
		return
		SB_SetText("Cannot add items to playlist currently being edited")
	}
IniRead,kiv,SystemLocations.ini,LOCATIONS,%SRCHLOCDDL%
sinnz= 
Loop,parse,kiv,|
	{
		newn= %A_LoopField%
		insrtsys= %newn%\%SRCHLOCDDL%\
		Loop, Parse, itmLst,|
			{
				if (A_LoopField = "")
					{
						continue
					}				
				ifnotinstring,A_LoopField,:
					{
						rplf= %insrtsys%
						sinnz:= insrtsys . A_LoopField . ">" . ccoreLBX
					}
					else {
						rplf= 
						sinnz:=  A_LoopField . ">" . ccoreLBX
					}
				LBEX_Add(insel,sinnz)
				stringreplace,itmlst,itmlst,%A_LoopField%|,,All
			}
	}
IF (itmlst <> "")
		{
			GuiControl,Choose,TABMENU,4
			ifinstring,sysposb,|%EXTRSYS%|
				{
					guicontrol,,PLNAMEDT,|%EXTRSYS%|%sysposb%
				}
		}
return

AddEmuTOList:
Menu, Emulator_Add, Add, %emuta%, RunRCL
return

AssociateRCM:
gui,submit,nohide
return

Media_Cache_delete:
FileRemoveDir,%app_data%\sselph-scraper,1
if (ERRORLEVEL = 1)
	{
		SB_SetText("some files could nt be deleted")
		return
	}
SB_SetText("cache deleted")	
return

delete_image:
Filedelete,%ASSETS%\%FEDDLA%\%curtxt%\%FEDDLE%\%imgdat%
gosub, FEDDLE
return

Open_ScrpFld:
ifnotexist,%ASSETS%\%FEDDLA%\%curtxt%\%FEDDLE%
	{
		sb_settext("No Assets exist for this title")
		return
	}
Run, explorer "%ASSETS%\%FEDDLA%\%curtxt%\%FEDDLE%"
SB_SetText("Explorer is opening Assets" "\" FEDDLA "\" curtxt "\" FEDDLE "")
return

Renamesave_image:
sbrim= 1
gosub,reinvimg
return

Export_RETROARCH:
sbrim=
gosub,reinvimg
return

Export_Pegasus:
sbrim=
gosub,reinvimg
return

Export_EmulationStation:
sbrim=
gosub,reinvimg
return

Export_retroFE:
sbrim=
gosub,reinvimg
return

Export_image:
sbrim=
gosub,reinvimg
return

reinvimg:
jaksdname=
guicontrolget,FEDDLE,,FEDDLE
splitpath,curtxt,curimgnm,curimgfd,curimgxt
splitpath,imgdat,,,curimgxt
ifnotexist,%RJSYSTEMS%\%FEDDLA%\%curtxt%\.snaps\
	{
		filecreatedir,%RJSYSTEMS%\%FEDDLA%\%curtxt%\.snaps
	}
if (FEDDLE = "Video")
	{
		jaksdnmae= %jaksdname%
	}
if (FEDDLE = "3Mix")
	{
		jaksdname= 3Mix
	}
if (FEDDLE = "Cart")
	{
		jaksdname= Cart
	}
if (FEDDLE = "Label")
	{
		jaksdname= Label
	}
if (FEDDLE = "4Mix")
	{
		jaksdname= 4Mix
	}
if (FEDDLE = "3DBoxart")
	{
		jaksdname= 3D_Folder
	}
if (FEDDLE = "Marquee")
	{
		jaksdname= Logo
	}
if (FEDDLE = "Boxart")
	{
		jaksdname= Folder
	}
if (FEDDLE = "Backdrops")
	{
		jaksdname= Backdrop
	}
if (FEDDLE = "MetaData")
	{
		jaksdname= %jaksdname%
	}
if (FEDDLE = "Logos")
	{
		jaksdname= Logo
	}
if (FEDDLE = "Snapshots")
	{
		snapnum=
		Loop, %RJSYSTEMS%\%FEDDLA%\%curtxt%\.snaps\*
			{
				snapnum+=1
			}
		jaksdname= .snaps\snapshot%snapnum%
	}
coverwimg= %RJSYSTEMS%\%FEDDLA%\%curtxt%\%jaksdname%.%curimgxt%
if (sbrim = 1)
	{
		rjexpimg=
		FileSelectFIle,rjexpimg,18,%curimgnm%.%curimgxt%,Save image as...,
		if (rjexpimg = "")
			{
				SB_SetText("Cancelled")
				return
			}
		splitpath,rjexpimg,rjexpn,rjexpd,rjexpxt,rjexprn
		if (rjexpxt <> curimgxt)
			{
				rjexpn= %rjexprn%
				coverwimg= %rjexpd%\%rjexpn%.%curimgxt%
			}
	}
filecopy,%ASSETS%\%FEDDLA%\%curtxt%\%FEDDLE%\%imgdat%,%coverwimg%,1
SB_SetText(" ..\scrapeArt\ ..." "\" imgdat " to " coverwimg "")
sbrim= 0
return

cleanprgb:
guicontrol,,FEPRGA,0
guicontrol,,fePRGB,0
guicontrol,,pgrTransfer,0
guicontrol,,ARCDPRGRS,0
return

SHRTNMLkUp:
SHRTNM=
Loop, Parse, SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		avir1=
		avir2=
		StringSplit,avir,A_LoopField,=
		if (avir1 = RVLKUP)
			{
				SHRTNM= %avir2%
				break
			}
	}
if (SHRTNM = "")
	{
		avkv1=
		avkv2=
		avkv3=
		avkv4=
		avkv5=
		StringSplit,avkv,RVLKUP,%A_Space%_-
		StringLeft,shrtnc,avkv1,4
		shrtnd=
		shrtne=
		shrtnf=
		shrtng=
		if (avkv2 <> "")
			{
				StringLeft,shrtnd,avkv2,4
			}
		if (avkv3 <> "")
			{
				StringLeft,shrtne,avkv3,4
			}
		if (avkv4 <> "")
			{
				StringLeft,shrtnf,avkv4,4
			}
		if (avkv5 <> "")
			{
				StringLeft,shrtng,avkv5,4
			}
		SHRTNM= %shrtnc%%shrtnd%%shrtne%%shrtnf%%shrtng%
	}
return

RecentWrite:
ifnotexist,%historyLoc%
	{
		return
	}
rlin= 1
HISTORY=
curline= 1
Loop, Read, %historyLoc%
	{
		if (romf = "")
			{
				romf = %A_LoopReadLine%
				coreline := curline+2
				FileReadLine,popcore,%historyLoc%,%coreline%
				splitpath,popcore,coreselv
			}
		newvl=
		FilereadLine, newvl, %historyLoc%,%rlin%
		if (newvl = "")
			{
				break
			}
		HISTORY .= newvl . "|"
		rlin+=6
	}
return
IsFolder( path ) {
	return !!InStr( FileExist(path), "D")  ; double NOT returns 0/1
}
GuiDropFiles:
guicontrolget,TABMENU,,TABMENU
ROMDRP= 1
directrun=
guicontrol,,LCORE,|%runlist%
If ((A_GuiX >= RDXgrid) && (A_GuiX <= RDXgrid+RDWgrid) && (A_GuiY >= RDYgrid) && (A_GuiY <= RDYgrid+RDHgrid))
	{
		if (TABMENU = ":=: MAIN :=:")
			{
				romlst= %A_GuiEvent%
				acnvt=
				Loop, Parse,romLst,`n`r
					{	
						if ((A_LoopField = "")or(A_LoopField = A_Space)or(A_LoopField = A_Tab))
							{
								continue
							}
						acnvt+= 1	
						if (acnvt = 1)
							{
								romf= %A_LoopField%
							}	
					}
				iniwrite, "%romf%", Settings.ini,GLOBAL,last_rom
				SB_SetText(" Loading " romf " ")
				guicontrol,,RUNPLRAD,1
				guicontrol,,RUNSYSDDL,|History||%plistNamz%
				guicontrol,, MORROM, |%romf%||%HISTORY%
				guicontrolget,AUTOLNCH, ,AUTOLNCH
				if (AUTOLNCH = "0")
					{
						coreselv=
						CHOSEN= 1
						gosub, DragonDrop
						if (coreselv <> "")
							{
								guicontrol,,LCORE,%coreselv%|
								return
							}
						Control, ShowDropDown, , %LCORE%, skeletonKey
						ControlFocus, %LCORE%, skeletonKey
						return
					}
				if (AUTOLNCH = 1)
					{
						CHOSEN=
						coreselv=
						gui,submit,nohide
						gosub, DragonDrop
						if (CHOSEN = 1)
							{
								Control, ShowDropDown, , ,ahk_id %RUNCORE%
								ControlFocus, ,ahk_id %RUNCORE%
								return
							}
					}
			}
	}
if ( (A_GuiX >= 320) && (A_GuiX <= 800) && (A_GuiY >= 0) && (A_GuiY <= 700) )
	{
				if (TABMENU = "DAT:=:Repo")
					{
						if (SortROMS <> 1)
							{
								return
							}
						SB_SetText("Loading items to be checked against DATs")
						gui,ListView,DRPLV
						LVACHK= +Check
						Loop, Parse, A_GuiEvent,`n`r
							{
								if (A_LoopField = "")
									{
										continue
									}
								drp_in= %A_LoopField%	
								ifexist,%A_LoopField%\
									{
										Loop,files,%A_LoopField%\*.*,R
											{
												drp_in= %A_LoopFileFullPath%
												gosub, DRP_PARSE
											}		
										continue	
									}
								gosub, DRP_PARSE	
							}
						LV_ModifyCol()	
						return						
					}
	}
if ( (A_GuiX >= bRegionX) && (A_GuiX <= bRegionX+bRegionW) && (A_GuiY >= bRegionY) && (A_GuiY <= bRegionY+bRegionH) )
	{
				RPDND= 1
				SB_SetText("Loading items")
				RomPlst=
				controlget,exstrpl,List,,,ahk_id %LFTLSTBX%
				stringreplace,RomPLst,A_GuiEvent,`n,|,All
				if (TABMENU = "Util")
					{
						gui,ListView,UTLLVA
						LVACHK= +Check
						Loop, Parse, RomPLst, |
							{
								if (A_LoopField = "")
									{
										continue
									}
								LV_Add(LVACHK,A_LoopField)
								UTL_TDB.= A_LoopField . "|"
							}
						LV_ModifyCol()
						return
					}
		if (TABMENU = "Playlists")
			{
				GuiControl,,ROMPOP,%exstrpl%%RomPLst%
			}
	}
if ( (A_GuiX >= cRegionX) && (A_GuiX <= cRegionX+cRegionW) && (A_GuiY >= cRegionY) && (A_GuiY <= cRegionY+cRegionH) )
	{
		if (TABMENU = "Emu:=:Sys")
			{
				guicontrolget,SALIST,,SALIST
				if (SALIST <> "Emulators")
					{
						return
					}
				SB_SetText("Sorting BIOS files")
				FileDelete, bios.ini
				FileAppend, %A_GuiEvent%, bios.ini
				arcdec=
				ifnotexist, %cacheloc%\bios
					{
						FileCreateDir, %cacheloc%\bios
						FileCreateDir, %cacheloc%\arc
					}
				Loop,Read,bios.ini
					{
						SB_SetText(" Categorizing BIOS files ")
						splitpath,A_LoopReadLine,biosfile,biospath,biosxt,biosn,biosdrv
						if ((biosxt = "zip") or (biosxt = "7z"))
							{
								arcdec= 1
								SB_SetText("extracting " A_LoopReadLine " ")
								Runwait, %comspec% cmd /c " "%S_KeyDir%\bin\7za.exe" e -y "%A_LoopReadLine%" -O"%cacheloc%\bios" ",,hide
							}
						if (biosxt = "rar")
							{
								arcdec= 1
								SB_SetText("extracting " A_LoopReadLine " ")
								Runwait, %comspec% cmd /c "bin\UnRAR.exe e -y "%A_LoopReadLine%" "*" +o "%cacheloc%\bios" ",,hide
							}
						FileCopy,%A_LoopReadLine%,%cacheloc%\bios\%biosfile%,1
					}
				gosub, BiosProc
			}
	}
if ( (A_GuiX >= dRegionX) && (A_GuiX <= dRegionX+dRegionW) && (A_GuiY >= dRegionY) && (A_GuiY <= dRegionY+dRegionH) )
	{
		if (TABMENU = "Emu:=:Sys")
			{
				if (SALIST <> "Systems")
					{
						return
					}
				if (semu = "")
					{
						SB_SetText(" Select a System First")
						return
					}
				stringreplace,semrn,semu,|,`n,All
				MsgBox,3,MultiLinkDrop,This will Link the following folders to:%semrn%`n"%A_GuiEvent%"`n
				ifMsgBox, No
					{
						SB_SetText(" Cancelled ")
						return
					}
				ifMsgBox, Cancel
					{
						SB_SetText(" Cancelled ")
						return
					}
				Loop,Parse,A_GuiEvent,`n
					{
						sysapn= %A_LoopField%
						if IsFolder(sysapn)
							{
								ROMDFLDR= %sysapn%
								gosub, MULTI_LINKLOOP
							}
					}
			}
	}
if ( (A_GuiX >= eRegionX) && (A_GuiX <= eRegionX+eRegionW) && (A_GuiY >= eRegionY) && (A_GuiY <= eRegionY+eRegionH) )
	{
		if (TABMENU = "Emu:=:Sys")
			{
				sggt= SYSTRP
				splitpath,A_GuiEvent,,,agext
				if (agext <> "exe")
					{
						SB_SetText(" This must be an executable ")
						return
					}
				guicontrolget,PRGINSTLBX,,PRGINSTLBX
				guicontrolget,systatus,,SALIST
				if (systatus = "Emulators")
					{
						sggt= EMUTRPDRP
					}
				EMUINSTLOCT= %A_GuiEvent%
				goto, %sggt%
			}
	}
ROMDRP=
return

SHA1GET:
ApndSHA= % FileSHA1( CrCFLN )
FileSHA1(sFile="", cSz=4) {
 cSz := (cSz<0||cSz>8) ? 2**22 : 2**(18+cSz), VarSetCapacity( Buffer,cSz,0 ) ; 09-Oct-2012
 hFil := DllCall( "CreateFile", Str,sFile,UInt,0x80000000, Int,3,Int,0,Int,3,Int,0,Int,0 )
 IfLess,hFil,1, Return,hFil
 hMod := DllCall( "LoadLibrary", Str,"advapi32.dll" )
 DllCall( "GetFileSizeEx", UInt,hFil, UInt,&Buffer ),    fSz := NumGet( Buffer,0,"Int64" )
 VarSetCapacity( SHA_CTX,136,0 ),  DllCall( "advapi32\A_SHAInit", UInt,&SHA_CTX )
 Loop % ( fSz//cSz + !!Mod( fSz,cSz ) )
   DllCall( "ReadFile", UInt,hFil, UInt,&Buffer, UInt,cSz, UIntP,bytesRead, UInt,0 )
 , DllCall( "advapi32\A_SHAUpdate", UInt,&SHA_CTX, UInt,&Buffer, UInt,bytesRead )
 DllCall( "advapi32\A_SHAFinal", UInt,&SHA_CTX, UInt,&SHA_CTX + 116 )
 DllCall( "CloseHandle", UInt,hFil )
 Loop % StrLen( Hex:="123456789ABCDEF0" ) + 4
  N := NumGet( SHA_CTX,115+A_Index,"Char"), SHA1 .= SubStr(Hex,N>>4,1) SubStr(Hex,N&15,1)
Return SHA1, DllCall( "FreeLibrary", UInt,hMod )
}
return

CRC32GET:
ApndCRC= % FileCRC32( CrCFLN )
FileCRC32(sFile="",cSz=4 ) {
 cSz := (cSz<0||cSz>8) ? 2**22 : 2**(18+cSz), VarSetCapacity( Buffer,cSz,0 )
 hFil := DllCall( "CreateFile", Str,sFile,UInt,0x80000000, Int,3,Int,0,Int,3,Int,0,Int,0 )
 IfLess,hFil,1, Return,hFil
 hMod := DllCall( "LoadLibrary", Str,"ntdll.dll" ), CRC32 := 0
 DllCall( "GetFileSizeEx", UInt,hFil, UInt,&Buffer ),    fSz := NumGet( Buffer,0,"Int64" )
 Loop % ( fSz//cSz + !!Mod( fSz,cSz ) )
   DllCall( "ReadFile", UInt,hFil, UInt,&Buffer, UInt,cSz, UIntP,Bytes, UInt,0 )
 , CRC32 := DllCall( "NTDLL\RtlComputeCrc32", UInt,CRC32, UInt,&Buffer, UInt,Bytes, UInt )
 DllCall( "CloseHandle", UInt,hFil )
 SetFormat, Integer, % SubStr( ( A_FI := A_FormatInteger ) "H", 0 )
 CRC32 := SubStr( CRC32 + 0x1000000000, -7 ), DllCall( "CharUpper", Str,CRC32 )
 SetFormat, Integer, %A_FI%
Return CRC32, DllCall( "FreeLibrary", UInt,hMod )
}
ApndADD= 0X%ApndCRC%
SetFormat, Integer, D
ApndINT:= ApndADD+0
return

SYSAZ:
gui,submit,nohide
AUTOFUZ= 0
if (SYSAZ = 1)
	{
		AUTOFUZ= 1
	}
return

SYSDETECT:
FuzzySystems:
nnewmsg=
syslkig=
toinsj=
toinsj.= "|"
Loop, Parse, SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,afe,A_LoopField,=
		%afe2%= %afe1%
		ifexist,%RJSYSTEMS%\%afe1%\
			{
				toinsj.= afe1 . "|"
				iniread,fik,SystemLocations.ini,LOCATIONS,%afe1%
				ifnotinstring,fik,%RJSYSTEMS%\%afe1%|
					{
						iniwrite,"%RJSYSTEMS%\%afe1%|%fik%",SystemLocations.ini,LOCATIONS,%afe1%
						SB_SetText("added " afe " ")
					}
			}
		pnsys.= afe1 . "|"
		arsys.= afe2 . "|"
	}
digfldrs=
nfiprm=
nfiprm.= "|" . pnsys
digfldrs.= "|" . knownfldrs
gui,submit,nohide
finvn= %totsys%
Loop, parse, fuzsys,`n`r
	{
		 if (A_LoopField = "")
			{
				continue
			}
		fuzn1=
		fuzn2=
		flsn=
		fsys=
		stringsplit,fuztst,A_LoopField,>
		flsn= %fuztst2%
		fsys= % %fuztst2%
		Loop, Parse, fuztst1,|
			{
				aeg=
				Loop,%RJSYSTEMS%\%A_LoopField%,2
					{
						aeg=
						ifinstring,digfldrs,|%A_LoopFileName%|
							{
								CONTINUE
							}
						ifnotinstring,nfiprm,|%A_LoopFileName%|
							{
								stringreplace,nfiprm,nfiprm,%fsys%|,,All
								splitpath,A_LoopFileFullPath,fdirnam,fdirpth
								if (JUNCTOPT = 2)
									{
										iniread,fik,SystemLocations.ini,LOCATIONS,%fsys%
										ifnotinstring,fik,%A_LoopFileFullPath%|
											{
												iniwrite,"%A_LoopFileFullPath%|%fik%",SystemLocations.ini,LOCATIONS,%fsys%
												SB_SetText("added " A_LoopFileFullPath " ")
											}
										ifnotinstring,knownfldrs,%fsys%
											{
												knownfldrs.= A_LoopFileName . "|"
											}
										aeg=1
										break
									}
							}
					}
			}
	}
SB_SetText("systems added")
if (aeg = 2)
	{
		gosub, resetCoreAssets
	}
if (nnewmsg = "")
	{
		return
	}
msgbox,1,ErrorReturn,%nnewmsg%
return

MINISWITCH:
MINIMODET:
gui,submit,nohide
if (MINIMODE <> 1)
	{
		Goto, MINIMODE
	}
MINIMODEOFF:
MINIMODE= 
WinSet, Region,,skeletonKey
WinSet, Style, +0x800000,skeletonKey
guicontrol,,MINISWITCH,-
return	
MINIMODE:
gui,submit,nohide
MINIMODE= 1
Guicontrol,Choose,TABMENU,2
guicontrol,,MINISWITCH,=
WinSet, Style, -0x800000, skeletonKey
mmwdth:= 750*(A_ScreenDPI/96)
mmwhght:= 45*(A_ScreenDPI/96)
WinSet, Region,18-4 W%mmwdth% H%mmwhght%,skeletonKey
return

AWYONLTGL:
gui,submit,nohide
if (ALWOTP = 1)
	{
		ALWOTP:= 0
		guicontrol,,ALWOTP,0
	}
else {
		ALWOTP:= 1
guicontrol,,ALWOTP,1
}
gosub, ALWOTP
return

AWYONTGL:
gui,submit,nohide
MINIMODE= 
ALWOTP:= 0
guicontrol,,ALWOTP,0
gosub, ALWOTP
TRANSLID:= 255
guicontrol,,TRANSLID,255
gosub TRANSLID
Winset,top,,skeletonKey
Winset,Enable,,skeletonKey
goto, MINIMODEOFF
return

DYNTRANS:
gui,submit,nohide
iniwrite,%DYNTRANS%,Settings.ini,GLOBAL,Dynamic_Transparency
if (DYNTRANS = 0)
	{
		guicontrol,,TRANSLID,255
		gosub, TRANSLID
	}
return

ALWOTP:
gui,submit,nohide
ALWOTPs= Off
if (ALWOTP = 1)
	{
		ALWOTPs= On
	}
Winset,alwaysOntop,%ALWOTPs%,skeletonKey
return

TRANSLID:
gui,submit,nohide
WinSet,Transparent,%TRANSLID%,skeletonKey
return

SKTHEMEN:
gui,submit,nohide
guicontrolget,skthemen,,SKTHEMEN
if (skthemen = "Default")
	{
		iniwrite,Default,Settings.ini,THEME,theme_name
		iniwrite,Default,Settings.ini,THEME,background
		iniwrite,Default,Settings.ini,THEME,foreground
		iniwrite,s11,Settings.ini,THEME,font_large
		iniwrite,s9,Settings.ini,THEME,font_medium
		iniwrite,s7,Settings.ini,THEME,font_small
		iniwrite,Default,Settings.ini,THEME,font_color
		iniwrite,%A_Space%,Settings.ini,THEME,font_name
		guicontrol,,themntxt,Theme (needs restart)
		return
	}
if (skthemen = "Gray")
	{
		iniwrite,Dark,Settings.ini,THEME,theme_name
		iniwrite,Gray,Settings.ini,THEME,background
		iniwrite,White,Settings.ini,THEME,foreground
		iniwrite,s11,Settings.ini,THEME,font_large
		iniwrite,s9,Settings.ini,THEME,font_medium
		iniwrite,s7,Settings.ini,THEME,font_small
		iniwrite,cWhite,Settings.ini,THEME,font_color
		;;iniwrite,Segoe UI,Settings.ini,THEME,font_name
		guicontrol,,themntxt,Theme (needs restart)
		return
	}
if (skthemen = "Black")
	{
		iniwrite,Dark,Settings.ini,THEME,theme_name
		iniwrite,Black,Settings.ini,THEME,background
		iniwrite,White,Settings.ini,THEME,foreground
		iniwrite,s11,Settings.ini,THEME,font_large
		iniwrite,s9,Settings.ini,THEME,font_medium
		iniwrite,s7,Settings.ini,THEME,font_small
		iniwrite,cWhite,Settings.ini,THEME,font_color
		;;iniwrite,Segoe UI,Settings.ini,THEME,font_name
		guicontrol,,themntxt,Theme (needs restart)
		return
	}
if (skthemen = "White")
	{
		iniwrite,White,Settings.ini,THEME,theme_name
		iniwrite,White,Settings.ini,THEME,background
		iniwrite,Black,Settings.ini,THEME,foreground
		iniwrite,s11,Settings.ini,THEME,font_large
		iniwrite,s9,Settings.ini,THEME,font_medium
		iniwrite,s7,Settings.ini,THEME,font_small
		iniwrite,cBlack,Settings.ini,THEME,font_color
		;;iniwrite,Palatino Linotype,Settings.ini,THEME,font_name
		guicontrol,,themntxt,Theme (needs restart)
		return
	}
if (skthemen = "Blue")
	{
		iniwrite,Blue,Settings.ini,THEME,theme_name
		iniwrite,0000FF,Settings.ini,THEME,background
		iniwrite,FFFFFF,Settings.ini,THEME,foreground
		iniwrite,s11,Settings.ini,THEME,font_large
		iniwrite,s9,Settings.ini,THEME,font_medium
		iniwrite,s7,Settings.ini,THEME,font_smallf
		iniwrite,cWhite,Settings.ini,THEME,font_color
		;;iniwrite,MS Serif,Settings.ini,THEME,font_name
		guicontrol,,themntxt,Theme (needs restart)
		return
	}
SETJKD:
RJSYSTSL=
EMUTSL=
if (INITIAL = 1)
	{
		splitpath,S_KeyDir,,,,,drvp
		RJSYSTSL= %drvp%\Console
		EMUTSL= %drvp%\Emulators
		ifexist, %S_KeyDir%\Console
			{
				RJSYSTSL= %S_KeyDir%\Console
			}
		ifexist, %S_KeyDir%\apps
			{
				EMUTSL= %S_KeyDir%\apps
			}
		ifexist, %drvp%\Console
			{
				RJSYSTSL= %drvp%\Console
			}
		ifexist, %drvp%\Emulators
			{
				EMUTSL= %drvp%\Emulators
			}
		Runwait, Init.exe %RJSYSTSL% %EMUTSL% %CURPID%
		iniread,RJSYSTEMS,Settings.ini,GLOBAL,systems_directory
		iniread,RJEMUD,Settings.ini,GLOBAL,emulators_directory
		if ((RJSYSTEMS = "") or (RJEMUD = "") or (RJSYSTEMS = "ERROR") or (RJEMUD = "ERROR"))
			{
				fileDelete,Settings.ini
				exitapp
			}
		gosub, CNFIR
		return
	}
SETJKR:
RJSYSTEMF=
FileSelectFolder, RJSYSTEMF,*%RJSYSTSL%,3,Select the Root folder for all systems
RJSYSTEMFX= %RJSYSTEMF%
if (RJSYSTEMF = "")
	{
		return
	}
stringright,efi,RJSYSTEMF,2
stringLeft,efix,RJSYSTEMF,2
ifnotexist,SystemLocations.ini
	{
		filecopy,sets\SystemLocations.set,SystemLocations.ini,1
	}
if (efi = ":\")
	{
		RJSYSDRV= %RJSYSTEMF%
		RJSYSTEMF= %efix%
		RJSYSTEMFX= %RJSYSDRV%Console
	}
splitpath,RJSYSTEMFX,pthnm
if (pthnm = A_Username)
	{
		Msgbox,3,User Directory Root?,Would you like to create a ''Console'' directory?`n     *reccommended*
		ifmsgbox,yes
			{
				RJSYSTEMF=%RJSYSTEMF%\Console
				ifnotexist, %RJSYSTEMF%\Console
					{
						FileCreateDir,%RJSYSTEMF%\Console
						if (ERRORLEVEL <> 0)
							{
								Msgbox,5,Directory Creation Failed,Directory %RJSYSTEMF% could not be created.
								ifmsgbox, Retry
									{
										RJSYSTSL=
										goto, SETJKR
									}
							}
					}
			}
		ifmsgbox,cancel
			{
				return
			}
	}
RESELSYSG:
nask=
Loop,Parse,SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,fei,A_LoopField,=
		ifexist,%RJSYSTEMF%\%fei1%
			{
				nask= 1
				break
			}
	}
if (nask = "")
	{
		if (efi = ":\")
			{
				SFEvb= Create a
				RJSYSTEMFR= %RJSYSTEMF%
				ifexist, %RJSYSTEMF%\Console
					{
						SFEvb= Use the
						RJSYSTEMFR= %RJSYSTEMF%\Console
					}
				Msgbox,8196,Confirm,%SFEvb% Console directory?
				ifmsgbox,cancel
					{
						RJSYSTSL=
						goto, SETJKR
					}
			}
		Msgbox,8196,Confirm,You have selected ''%RJSYSTEMF%''`nAre you sure you would like to use this directory?
		ifmsgbox,no
			{
				goto, SETJKD
			}
		ifmsgbox,cancel
			{
				goto, SETJKD
			}
		AUTOFUZ= 0
		JUNCTOPT= 2
		fileappend,k,%RJSYSTEMF%\sk
		if (ERRORLEVEL <> 0)
			{
				MsgBox,1,NoWrite,skeletonKey cannot write to ''%RJSYSTEMF%''`nAre you sure you want to use this directory?
				ifmsgbox,OK
					{
						goto,INRJSYSOK
					}
				goto, SETJKD
			}
		filedelete,%RJSYSTEMF%\sk
		INRJSYSOK:
		RJSYSTEMS= %RJSYSTEMF%
		nfemu= 1
		stringreplace,RJSYSTEMS,RJSYSTEMS,\\,\,All
		IniWrite, "%RJSYSTEMS%",Settings.ini,GLOBAL,systems_directory
	}
ifnotexist, %RJSYSTEMF%
	{
		filecreatedir,%RJSYSTEMF%
			if (ERRORLEVEL <> 0)
				{
					Msgbox,5,Directory Creation Failed,Directory %RJSYSTEMF% could not be created.
					ifmsgbox, Retry
						{
							RJSYSTSL=
							goto, SETJKR
						}
				}
	}
fileappend,k,%RJSYSTEMF%\sk
if (ERRORLEVEL <> 0)
	{
		MsgBox,1,NoWrite,skeletonKey cannot write to ''%RJSYSTEMF%''`nAre you sure you want to use this directory?
		ifmsgbox,OK
			{
				goto,SJMPOT
			}
		goto, SETJKR
	}
filedelete,%RJSYSTEMF%\sk
SJMPOT:
AUTOFUZ= 0
JUNCTOPT= 2
RJSYSTEMS= %RJSYSTEMF%
nfemu= 1
stringreplace,RJSYSTEMS,RJSYSTEMS,\\,\,All
guicontrol,,SKSYSDISP,%RJSYSTEMS%
IniWrite, "%RJSYSTEMS%",Settings.ini,GLOBAL,systems_directory
gosub, RJSYSRESET
if (FILT_UNSUP = 1)
	{
		systmfldrs= %knownfldrs%
		guicontrol,,RUNSYSDDL,|:=:System List:=:||%INITFLDRS%
		guicontrol,,RJSYSDD,|Systems||%systmfldrs%
		guicontrol,,SRCHLOCDDL,|:=:System List:=:||%INITFLDRS%
		guicontrol,,ESDWNLPOS,|%systmfldrs%
		return
	}
return

SETEMUD:
SETEMUR:
FileSelectFolder, RJEMUF,,3,Select the Root folder for all emulators
if (RJEMUF = "")
	{
		return
	}
stringright,efi,RJEMUF,2
stringLeft,efix,RJEMUF,2
if (efi = ":\")
	{
		SFEvb= Create an
		ifexist,%RJEMUF%\Emulators
			{
				SFEvb= Use the
			}
		RJSDRV= %RJEMUF%
		RJEMUF= %efix%
		RJEMUFX= %RJSDRV%Emulators
		Msgbox,8196,Confirm,Confirm %SFEvb% Emulator directory?
		ifmsgbox,yes
			{
				RJEMUF= %RJEMUFX%
			}
		ifmsgbox,cancel
			{
				EMUTSL=
				goto, SETEMUR
			}
	}
ifnotexist,%RJEMUF%
	{
		filecreatedir,%RJEMUF%
		if (ERRORLEVEL <> 0)
			{
				Msgbox,1,Directory Creation Failed, Directory %RJEMUF% could not be created.`nAre you sure you want to set this directory?
				ifmsgbox, OK
					{
						goto, EMUROK
					}
				return
			}
	}
splitpath,RJEMUF,RJHHS
splitpath,RJEMUF,usremum
if (usremum = A_Username)
	{
		Msgbox,8196,Confirm,Create an Emulators directory?
		ifmsgbox,Yes
			{
				RJEMUF= %RJEMUF%\Emulators
			}
		ifmsgbox,cancel
			{
				EMUTSL=
				goto, SETEMUR
			}
		Msgbox,3,User Directory Root?,Emulators Directory set to`n " %RJEMUF% "`n      Is this okay?
		ifmsgbox,yes
			{
				ifnotexist, %RJEMUF%
					{
						FileCreateDir,%RJEMUF%
						if (ERRORLEVEL <> 0)
							{
								Msgbox,1,Directory Creation Failed, Directory %RJEMUF% could not be created.`nAre you sure you want to set this directory?
								ifmsgbox, OK
									{
										goto, EMUROK
									}
								return
							}
					}
			}
		ifmsgbox,no
			{
				goto, SETEMUR
			}
		ifmsgbox,cancel
			{
				return
			}
	}
fileappend,k,%RJEMUF%\sk
if (ERRORLEVEL <> 0)
	{
		MsgBox,1,NoWrite,skeletonKey cannot write to ''%RJEMUF%''`nAre you sure you want to use this directory?
		ifmsgbox,OK
			{
				goto,EMUROK
			}
	}
filedelete,%RJEMUF%\sk
EMUROK:
CNFUR:
RJEMUD= %RJEMUF%
stringreplace,RJEMUD,RJEMUD,\\,\,All
CNFIR:
IfNotExist,%RJEMUD%\BSL\BSL.exe
	{
		FileCreateDir,%RJEMUD%\BSL
		FileCopy,bin\BSL.exe,%RJEMUD%\BSL\BSL.exe,1
		iniwrite,"%RJEMUD%\BSL\BSL.exe",apps.ini,EMULATORS,BSL
		iniwrite,"%RJEMUD%\BSL\BSL.exe",Assignments.ini,ASSIGNMENTS,BSL
	}
IniWrite, "%RJEMUD%",Settings.ini,GLOBAL,emulators_directory
SB_SetText("Use the ''Detect'' button to add emulators to the available index.")
if (INITIAL = 1)
	{
		fileread,EmuPartSet,sets\EmuParts.set
		stringreplace,emupartset,emupartset,[ARCH],%ARCH%,All
		stringreplace,emupartset,emupartset,[BUILDBOT],%BLDBOT%,All
		FileRead,FEPartSet,sets\Frontends.set
	}
gosub, emuDetect
gosub, resetEmuList
guicontrol,,SKDSETXT, Detected Supported Emulators: %emunumtot%
guicontrol,,SKEMUDISP,%RJEMUD%
return

UpdateSK:
FileDelete, site\version.txt
guicontrol,disable,UpdateSK
IniRead,sourceHost,%ARCORG%,GLOBAL,SOURCEHOST
IniRead,UPDATEFILE,%ARCORG%,GLOBAL,UPDATEFILE
splitpath,UPDATEFILE,UPDATEURLF,updateurlhost,updateurlx,updateurln
URLFILE= %sourceHost%
save= %S_KeyDir%\site\version.txt
splitpath,save,svaf,svap
exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
ifnotexist, site\version.txt
	{
		SB_SetText(" Update not found. ")
		guicontrol,enable,UpdateSK
		return
	}
FileReadLine,DATECHK,site\version.txt,1
stringsplit,VERCHKC,DATECHK,=
if ((VERCHKC3 <> RELEASE)or(DATECHK = "404: Not Found")or(DATECHK = "[CURV]"))
	{
		msgbox,8196,Update, Update available`n%VERCHKC1%`nWould you like to update skeletonKey?`n(program will close)
		IfMsgBox, yes
			{
				gosub, getupdate
				guicontrol,enable,UpdateSK
				ifnotexist,%cacheloc%\%UPDATEURLF%
					{
						return
					}
			}
		ifmsgbox, no
			{
				guicontrol,enable,UpdateSK
				return
			}
	}
guicontrol,enable,UpdateSK
return

getupdate:
upcnt=
filedelete,%cacheloc%\%UPDATEURLF%
save= %cacheloc%\%UPDATEURLF%%upcnt%.zip
splitpath,save,svaf,svap
exe_get(ARIA,UPDATEFILE,svap,svaf,CURPID,cacheloc)
ifexist,%save%
	{
		Process, close, Invader.exe
		Process, close, Skey-Deploy.exe
		Run, "Update.exe" "%save%"
		Process, close, skeletonKey.exe
		gosub, QUITOUT
		exitapp
	}
SB_SetText("Update file not found")
	return

Help:
MsgBox,4353,Help,%VERSION%`n%RELEASE%`nWould you like to open help documentation?
IfMsgBox,Yes
	{
		run, skeletonkey.html
	}
return

Donate:
run, http://romjacket.github.io/#DONATE
return

HISAPND:
gui,submit,nohide
iniwrite,"%HISAPND%",Settings.ini,GLOBAL,history_append
return

histset:
hstmp= %contentHistoryPath%
gui,submit,nohide
historytry=
historyloctmp=
histreset:
FileSelectFile,historyloctmp,3,%hstmp%,history Location,*.*
if (historyloctmp <> "")
	{
		historyloc= %historyloctmp%
		SB_SetText(" history location set to " historyloc " ")
		guicontrol,,histtxt,%historyloc%
		iniwrite, "%historyloc%",Settings.ini,GLOBAL,history_location
	}
historytry+=1
if ((historyloctmp = "") && (historytry < 1))
	{
		hstmp=
		goto, histreset
	}
if (historytry > 1)
	{
		return
	}
ifnotexist,%historyloctmp%
	{
		historyLoc= %S_KeyDir%\content_history.lpl
		ifnotexist,%historyloc%
			{
				SB_SetText("HISTORY NOT FOUND")
			}
	}
iniwrite, "%historyLoc%",Settings.ini,GLOBAL,history_location
guicontrol,,histtxt,%historyloc%
return

playlset:
pltmp= %playlistDirectory%
gui,submit,nohide
pltry=
playlistloctmp=
plreset:
pltry+=1
FileSelectFolder,playlistloctmp,*%pltmp%,3,Playlist Location
if (playlistloctmp <> "")
	{
		stringLeft,efix,playlistloctmp,2
		stringright,efi,playlistloctmp,2
		if (efi = ":\")
			{
				playlistloctmp= %efix%
			}
		playlistloc= %playlistloctmp%
		SB_SetText(" Playlist location set to " playlistloc " ")
		guicontrol,,playlisttxt,%playlistloc%
		iniwrite, "%playlistloc%",Settings.ini,GLOBAL,playlist_location
		return
		if (pltry > 1)
			{
				return
			}
		pltmp=
		goto, plreset
	}
guicontrol,,playlisttxt,%playlistloc%
return

SETTMPD:
cachetmp= %cacheDirectory%
gui,submit,nohide
cachetry=
cacheloctmp=
cachereset:
cachetry+=1
FileSelectFolder,cacheloctmp,*%pltmp%,3,Temp Location
if (cacheloctmp <> "")
	{
		stringright,efi,cacheloctmp,2
		stringLeft,efix,cacheloctmp,2
		if (efi = ":\")
			{
				cacheloctmp= %efix%
			}
		cacheloc= %cacheloctmp%
		SB_SetText(" Temp location set to " cacheloc " ")
		guicontrol,,tmpdispl,%cacheloc%
		iniwrite, "%cacheloc%",Settings.ini,GLOBAL,temp_location
		ifnotexist,%raexedir%\%raexefile%
			{
				if (raexedir <> "")
					{
						cacheDirectory= %cacheloc%
					}
			}
		ifnotexist,%cacheloc%
			{
				cacheloc= %A_WorkingDir%\tmp
				iniwrite, "%cacheloc%",Settings.ini,GLOBAL,temp_location
			}
		return
	}
cacheloc= %A_WorkingDir%\tmp
iniwrite, "%cacheloc%",Settings.ini,GLOBAL,temp_location
if (cachetry > 1)
	{
		return
	}
cachetmp=
goto, cachereset
return

LOGGING:
gui,submit,nohide
iniwrite,%LOGGING%,Settings.ini,GLOBAL,Logging
return

AUTOPGS:
gui,submit,nohide
if (AUTOPGS = 1)
	{
		iniwrite, 1,Settings.ini,GLOBAL,AutoLoad_PerGameSettings
		return
	}
iniwrite, 0,Settings.ini,GLOBAL,AutoLoad_PerGameSettings
return

SKBEFCMD:
gui, submit, nohide
return

SKAFTCMD:
gui, submit, nohide
return

SKENBF:
gui,submit,nohide
guicontrol,disable,SKAFTCMD
guicontrolget,SKENBF,,SKENBF
if (SKENBF =  1)
	{
		guicontrol,enable,SKBEFCMD
	}
return

DISCFG:
gui,submit,nohide
guicontrolget,DISCFG,,DISCFG
if (DISCFG = 1)
	{
		iniwrite,1,%BSLPTH%\BSL.ini,OPTIONS,configurations
		return
	}
iniwrite,"",%BSLPTH%\BSL.ini,OPTIONS,configurations
return

SKENAF:
guicontrol,disable,SKENAF
gui,submit,nohide
guicontrol,disable,SKAFTCMD
guicontrolget,SKENAF,,SKENAF
if (SKENAF =  1)
	{
		guicontrol,enable,SKAFTCMD
	}
return

SKOVRJM:
guicontrol,disable,SKPROFOV
guicontrol,disable,SKAMOV
guicontrol,disable,SKXPADOV
gui,submit,nohide
guicontrolget,SKOVRJM,,SKOVRJM
if (SKOVRJM = 1)
	{
		guicontrol,enable,SKPROFOV
		guicontrol,enable,SKAMOV
		guicontrol,enable,SKXPADOV
		iniwrite,1,%BSLPTH%\BSL.ini,OPTIONS,Joystick
		guicontrolget,bsljtt,,SKAMOV
		if (bsljtt = 1)
			{
				iniwrite,0,%BSLPTH%\BSL.ini,OPTIONS,Xpadder
				return
			}
		iniwrite,1,%BSLPTH%\BSL.ini,OPTIONS,Xpadder
	}
return

SKXPADOV:
gui,submit,nohide
iniwrite,1,%BSLPTH%\BSL.ini,OPTIONS,Xpadder
return

SKAMOV:
gui,submit,nohide
iniwrite,0,%BSLPTH%\BSL.ini,OPTIONS,Xpadder
return

SKPROFOV:
gui,submit,nohide
return

SKFROVDD:
gui,submit,nohide
return

SKFROV:
guicontrol,disable,SKFROVDD
gui,submit,nohide
guicontrolget,SKFROV,,SKFROV
if (SKFROV = 1)
	{
		guicontrol,enable,SKFROVDD
		guicontrolget,SKPROFOV,,SKPROFOV
		iniwrite,%SKPROFOV%,%BSLPTH%\BSL.ini,OPTIONS,Profile
	}
return

BiosProc:
FileDelete, crcs.ini
sysDir= %systemDirectory%
if (sysdir = "")
	{
		sysdir= %raexedir%\system
	}
ifnotexist, %sysdir%\
	{
		filecreatedir,%sysdir%
	}


IniRead,bsys,Apps.ini,EMULATORS
kbemu=
kbrmu=
Loop, Parse, bsys,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		efi1=
		efi2=
		stringsplit,efi,A_LoopField,=
		kbemu.= A_LoopField . "`n"
		kbrmu.= efi1 . "`n"
	}

BiosProcX:
biosnum:= 0
biosh:= 0
SB_SetText("searching " cacheloc "\" bios "")
Loop, Files, %cacheloc%\bios\*,
	{
		ApndCRC=
		CrCFLN= %A_LoopFileFullPath%
		InFileName= %A_LoopFileName%
		gosub, CRC32GET
		Loop,parse,kbemu,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,systj,A_LoopField,=,"
				;"
				ssu= %systj1%
				splitpath,systj2,,syym
				splitpath,systj2,,typth
				iniread,bpth,emucfgpresets.ini,%ssu%,BIOSPTH
				if ((bpth = "")or(bpth = "ERROR"))
					{
						bpth= %ssu%
					}
				stringreplace,typth,typth,%ssu%,%bpth%,All
				stringreplace,typth,typth,|,,All
				iniread,fmw,emucfgpresets.ini,%ssu%,FIRMWARE
				if ((fmw = "")or(fmw = "ERROR"))
					{
						continue
					}

				if !instr(fmw,ApndCRC)
					{
						continue
					}
				stringsplit,ggx,fmw,|
				loop,%ggx0%
					{
						bnx= % ggx%A_Index%
						ggh1= 
						ggh2= 
						stringsplit,ggh,bnx,:
						bnm= %ggh1%
						splitpath,bnm,fmwf	
						if ((ggh2 = "")or(ggh2 = "0000000"))
							{
								if (fmwf = InFileName)
									{
										biosnum+= 1
										ifinstring,bnm,\
											{
												splitpath,bnm,,bnmpth
												typth.= "\" . bnmpth
												bnm= %fmwf%
											}
										ifnotexist,%typth%\
											{
												filecreatedir,%typth%
											}
										filecopy,%A_LoopFileFullPath%,%typth%\%bnm%
										continue
									}
							}
						Loop,%ggh0%
							{
								fine= % ggh%A_index%
								if instr(fine,ApndCRC)
									{
										kbb= 
										ifinstring,bnm,\
											{
												splitpath,bnm,,bnmpth
												typth.= "\" . bnmpth
												bnm= %fmwf%
											}
										ifnotexist,%typth%\
											{
												filecreatedir,%typth%
											}
										stringright,nej,fine,1
										if (nej = ">")
											{
												biosnum+=1
												filecopy,%A_LoopFileFullPath%,%typth%\%bnm%,1
												SB_SetText("Found working bios for " ssu "")
												break
											}
										filecopy,%A_LoopFileFullPath%,%typth%\%bnm%											
										biosnum+=1
										break
									}
							}
							
					}
				
			}
		/*
		Loop, Parse,BiosFSet,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				CRCM1=
				CRCM2=
				CRCM3=
				CRCM4=
				CRCM5=
				CRCM6=
				stringsplit,CRCM,A_LoopField,:,>
				vpri2=
				stringsplit,vpri,CRCM2,?
				CRCMX= %vpri1%
				if (vpri2 <> "")
					{
						CRCMX= %vpri1%?%vpri2%
					}
				prib=
				stringright,prib,A_LoopField,1
				if (prib <> ">")
					{
						prib=
					}
				if (CRCM3 = ApndCRC)
					{
						biosnum++
						fileappend,%A_LoopFileFullPath%|%CRCM1%|%CRCMX%%prib%`n,crcs.ini
					}
			}
			
		*/	
	}


/*
ifnotexist,crcs.ini
	{
		msgbox, ,,BIOS NOT FOUND
		return
	}
	

Fileread,curbios,crcs.ini
Loop, Parse, curbios,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		biostring= %A_LoopField%
		juf1=
		juf2=
		juf3=
		stringsplit,juf,A_LoopField,|
		splitpath,juf1,actnam
		stringreplace,juf3,juf3,>,,All
		orign= %juf3%
		destnm= %juf3%
		ifinstring,juf3,?
			{
				destn1=
				destn2=
				stringsplit,destn,juf3,?
				orign= %destn1%
				destnm= %destn2%
			}
		Loop, Parse, kbemu,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,fia,A_LoopField,=,"
				;"
				SplitPath,fia2,,fiad
				sysex= %fia1%
				emif1=
				emif2=
				emif3=
				emif4=
				stringsplit,emif,juf2,=
				ifinstring,juf2,%sysex%
					{
						Loop, 6
							{
								fong1=
								fong2=
								fong3=
								fong4=
								fong5=
								stringsplit,fong,emif%A_Index%,\
								if (fong1 = sysex)
									{
										apndpth=
										stringreplace,apndpth,emif%A_Index%,%fia1%,,All
										ifinstring,juf2,.zip
											{
												splitpath,juf2,fnm
												destndz= %fiad%%apndpth%
												splitpath,destndz,,destnd
												ifnotexist,%destnd%\
													{
														fileCreateDir,%destnd%
													}
												stringreplace,newfd,juf1,%actnam%,%destnm%
												filemove,%juf1%,%newfd%,R
												RunWait, %comspec% /c " "%S_KeyDir%\bin\7za.exe" a -y "%fiad%%apndpth%" "%newfd%" ",,hide
												ifinstring,biostring,>
													{
														FileSetAttrib,+R,%fiad%%apndpth%\%juf3%
													}
												break
											}
										ifnotexist,%fiad%%apndpth%\
											{
												FilecreateDir,%fiad%%apndpth%
											}
										coolnm= %destn%
										FileCopy, %juf1%, %fiad%%apndpth%\%destnm%,1
										if (errorlevel = 1)
											{
												coolnm= %orign%
												FileCopy, %juf1%, %fiad%%apndpth%\%coolnm%,1
											}
										ifinstring,biostring,>
											{
												FileSetAttrib,+R,%fiad%%apndpth%\%coolnm%
											}
										break
									}
							}
					}
			}
	}
*/	
	
SB_SetText(" Found " biosnum " bios files")
return

AUTOBIOS:
guicontrol,disable,AUTOBIOS
filecreatedir,%cacheloc%\firmware
filecreatedir,%cacheloc%\bios
gui,submit,nohide
guicontrol,disable,SYSINSTLBX
guicontrol,disable,PRGINSTLBX
guicontrol,disable,RAINSTLBX
iniread,pcsx2_verx,Apps.ini,EMULATORS,PCSX2
if ((pcsx2_verx <> "ERROR")&&(pcsx2_verx <> ""))
	{
		splitpath,pcsx2_verx,,pcsx2_path
		filecreateDir,%pcsx2_verx%\bios
	}
iniread,mame_verx,Apps.ini,EMULATORS,MAME
if ((mame_verx <> "ERROR")&&(mame_verx <> ""))
	{
		splitpath,mame_verx,,mame_path
		filecreateDir,%mame_path%\roms
	}
iniread,retroarch_file,apps.ini,EMULATORS,retroarch
if ((retroarch_file <> "ERROR")&&(retroarch_file <> ""))
	{
		splitpath,retroarch_file,,retroarch_path
		filecreateDir,%retroarch_path%\system
	}
iniread,demul_file,apps.ini,EMULATORS,Demul
if ((demul_file <> "ERROR")&&(demul_file <> ""))
	{
		splitpath,demul_file,,demul_path
		filecreateDir,%demul_path%\roms
	}
if (EULAOPT = "disabled")
	{
		msgbox,8449,No Bios Index,The AutoBios was not found.
		goto,BDWNCPL
	}
ifexist,%GAMSRCS%\AutoBios.set
	{
		Loop, Read,%GAMSRCS%\AutoBios.set
			{
				if (A_LoopReadLine = "")
					{
						continue
					}
				stringsplit,aiv,A_LoopReadLine,|
				splitpath,aiv1,biosname
				save= %cacheloc%\bios\%biosname%
				biosout= %cacheloc%\bios
				if (aiv2 = "PS2")
					{
						if (pcsx2_verx = "ERROR")
							{
								continue
							}
						biosout= %pcsx2_path%\bios
						save= %cacheloc%\bios\%biosname%
					}
				if (aiv2 = "DEMUL")
					{
						if (demul_file = "ERROR")
							{
								continue
							}
						biosout= %demul_path%\roms
						save= %cacheloc%\firmware\%biosname%
					}
				if (aiv2 = "MESS")
					{
						if (mame_verx = "ERROR")
							{
								continue
							}
						biosout= %mame_path%\roms
						save= %cacheloc%\firmware\%biosname%
					}
				ifnotexist, %save%
					{
						SB_SetText("Downloading " biosname " ")
						;;DownloadFile(aiv1,save,True,True)								
						splitpath,save,svaf,svap
						exe_get(ARIA,aiv1,svap,svaf,CURPID,cacheloc)
					}
				ifnotexist, %save%
					{
						Msgbox,,Not Found,Could not download %biosname%,4
						continue
					}
				SB_SetText("extracting " biosname " ")
				if (aiv2 = "MAME")
					{
						filecopy,%save%,%mame_path%\roms
						continue
					}
				Runwait,"%S_KeyDir%\bin\7za.exe" e -y "%save%" -O"%biosout%",,hide
				if (ERRORLEVEL <> 0)
					{
						SB_SetText(" " save " could not be extracted")
					}
			}
	}
BDWNCPL:
gosub, BiosProc
guicontrol,enable,AUTOBIOS
guicontrol,enable,SYSINSTLBX
guicontrol,enable,PRGINSTLBX
guicontrol,enable,RAINSTLBX
return

RUNMENU:
return

MORROMDDLMENU:
gui,submit, nohide
guicontrolget,MORROMDIR,,MORROM
if (MORROMDIR = "")
	{
		return
	}
splitpath,MORROMDIR,,MORROMGD
Run, explorer.exe %MORROMGD%,%MORROMGD%
return

LNCHCHK:
lnchcc=
lnchrc=
nlnch=
guicontrol,hide,RETAL
guicontrol,move,CLRCUROM,x744 y34
guicontrolget,runcc,,RUNSYSDDL
guicontrolget,lnchcc,,LCORE
guicontrolget,lnchrc,,MORROM
if ((lnchrc = "")or(lnchcc = "")or(runcc = ":=:System List:=:"))
	{
		guicontrol,disable,LNCHBUT
		guicontrol,disable,RCLLNCH
		nlnch= 1
		return
	}
guicontrol,enable,LNCHBUT
guicontrol,enable,RCLLNCH
return

RUNPLRAD:
gui,submit,nohide
EXEMODE= 
guicontrol,,RUNSYSDDL,|History||%plistfiles%
gosub, RUNSYSDDL
return

RUNFLRAD:
EXEMODE= 
gui,submit,nohide
guicontrolget,lcrtst,,LCORE
guicontrolget,EDTROM,,MORROM
splitpath,EDTROM,edtrmf
Loop,Parse,RUNBOXGUIITEMS,|
	{
		guicontrol,disable,%A_LoopField%
	}
Loop,Parse,EDTROM,\
	{
		ifinstring,A_LoopField,%A_Space%-%A_Space%
			{
				kmat= %A_LoopField%
				Loop,Parse,systmfldrs,|
					{
						if (A_LoopField = kmat)
							{
								guicontrol,,RUNSYSDDL,|:=:System List:=:|%A_LoopField%||%INITFLDRS%
								gosub, RUNSYSDDL
								return
							}
					}
			}
	}
guicontrol,,RUNSYSDDL,|:=:System List:=:||%INITFLDRS%
gosub, RUNSYSDDL
return

FndGui:
gui,submit,nohide
return

ShowOnlyEmuGui:
return

NoHistoryFile:
historyLoctmp=
iniread,historyloctmp,config.cfg,OPTIONS,contentHistoryPath
if historyloctmp = "ERROR")
	{
		historyloc= %S_KeyDir%\content_history.lpl
		contenthistorypath= %historyloc%
		guicontrol,,histtxt,%S_KeyDir%\content_history.lpl
		return
	}
if (historyloctmp <> "")
	{
		historyloc= %historyloctmp%
		iniwrite, "%historyloc%",Settings.ini,GLOBAL,history_location
		guicontrol,,histtxt,%historyloc%
		contenthistorypath= %historyloc%
		ifexist,%historyLoc%
			{
				return
			}
	}
historyloc= %S_KeyDir%\content_history.lpl
ifnotexist, %historyloc%
	{
				SB_SetText("History file not found")
	}
guicontrol,,histtxt,%S_KeyDir%\content_history.lpl
iniwrite, "%S_KeyDir%\content_history.lpl",Settings.ini,GLOBAL,history_location
return

NoFNDPL:
playlistloctmp=
iniread,playlistloctmp,config.cfg,OPTIONS,playlist_directory
if playlistloctmp = "ERROR")
	{
		playlistloc= %S_KeyDir%\cfg
		guicontrol,,playlisttxt,%S_KeyDir%\cfg
		iniwrite, "%S_KeyDir%\cfg",Settings.ini,GLOBAL,playlist_location
		return
	}
if (playlistloctmp <> "")
	{
		playlistloc= %playlistloctmp%
		iniwrite, "%playlistloc%",Settings.ini,GLOBAL,playlist_location
		guicontrol,,playlisttxt,%playlistloc%
		ifexist,%PlaylistLoc%
			{
				return
			}
	}
playlistloc= %S_KeyDir%\cfg
guicontrol,,playlisttxt,%S_KeyDir%\cfg
iniwrite, "%S_KeyDir%\cfg",Settings.ini,GLOBAL,playlist_location
return

RENONDET:
gui,submit,nohide
return

FILT_UNSUP:
gui,submit,nohide
gosub, RJSYSRESET
INITFLDRS= %systmfldrs%
if (FILT_UNSUP = 1)
	{
		INITFLDRS= %knownfldrs%
		guicontrol,,RUNSYSDDL,|:=:System List:=:||%INITFLDRS%
		guicontrol,,RJSYSDD,|Systems||%systmfldrs%
		guicontrol,,SRCHLOCDDL,|:=:System List:=:||%systmfldrs%
		guicontrol,,ESDWNLPOS,|%systmfldrs%
		iniwrite, "%FILT_UNSUP%",Settings.ini,GLOBAL,global_filter
		return
	}
Loop,%RJSYSTEMS%	
iniwrite, "%FILT_UNSUP%",Settings.ini,GLOBAL,global_filter
return

RUNSYSBTN:
gui,submit,nohide
guicontrolget,RUNSYSBTN,,RUNSYSBTN
swpparv= %systmfldrs%
if (RUNPLRAD = 1)
	{
		swpparv= %plistfiles%
	}
if (RUNSYSBTN = "E")
	{
		guicontrol,,RUNSYSCBX,| ||%swpparv%
		guicontrol,hide,RUNSYSDDL
		guicontrol,show,RUNSYSCBX
		guicontrol,,RUNSYSBTN,>
		guicontrol,focus,RUNSYSCBX
		Controlfocus,ahk_id %CbxHndl109%
		return	
	}
guicontrol,show,RUNSYSDDL
guicontrol,hide,RUNSYSCBX
guicontrol,,RUNSYSBTN,E
return	
RUNSYSCBX:
guicontrolget,OPSYSX,,RUNSYSCBX
if (OPSYSX = CURRENTSYSTEM)
	{
		return
	}
CURRENTSYSTEM= %OPSYSX%	
if (OPTYP = "")
	{
		ROMSYS=  
	}
Sleep, 1100
gui,submit,nohide
guicontrolget,OPSYS,,RUNSYSCBX
if (OPSYS <> OPSYSX)
	{
		goto,RUNSYSCBX
	}
if (OPSYS = "")
	{
		ROMSYS=  
	}
if ((OPSYS = "")or(OPSYS = ":=:System List:=:"))
	{
		ROMSYS= :=:System List:=:
		if (RUNPLRAD = 1)
			{
				ROMSYS= History
				swpparv= %swpparv%
			}
		main_search= %ROMSYS%||%swpparv%
		guicontrol,,RUNSYSDDL,|%main_search%
		guicontrol,show,RUNSYSDDL	
		guicontrol,hide,RUNSYSCBX
		guicontrol,,RUNSYSBTN,E
		return
	}
OPTYP= 
main_search= 
Loop,parse,swpparv,|
	{
		if (A_LoopField = OPSYS)
			{
				OPTYP= %A_LoopField%
				EXTRSYS= %A_LoopField%
				main_search= %A_LoopField%||%swpparv%
				guicontrol,show,RUNSYSDDL
				guicontrol,hide,RUNSYSCBX
				guicontrol,,RUNSYSCBX,|%main_search%
				guicontrol,,RUNSYSDDL,|%main_search%
				guicontrol,,RUNSYSBTN,E
				goto, RUNSYSDDL
			}
	}
Loop,Parse,swpparv,|
	{
		if Instr(A_LoopField, OPSYS)
			{
				main_search.=  A_LoopField . "|"
			}
	}
if (main_search = "")
		{
			main_search= %swpparv%
		}
guicontrol,,RUNSYSCBX,|%OPSYS%||%main_search%
Control, ShowDropDown, , ,ahk_id %CbxHndl109%
return

RUNSYSDDL:
EXEMODE= 
guicontrol,,RUNSYSCBX,| |
gui,submit,nohide
guicontrolget,OPTYP,,RUNSYSDDL
if (OPTYP = CURRENTSYSTEM)
	{
		return
	}
CURRENTSYSTEM= %OPTYP%	
Sleep, 1000
RUNSYSCHNG= 1
ARCSYS=
RJMEDNM=
curmedINPT=
indvcp=
qmen=
coreselv=
librecore=
Ident_sys= 1
if (FILT_UNSUP <> 1)
	{
		Ident_sys=
	}
guicontrolget,coretmp,,LCORE
if (coretmp <> LCORE)
	{
		guicontrolget,eiei,,ESWPLCRE
		if (eiei = ">")
			{
				gosub, ESWPLCRE
			}
	}
guicontrol,,LCORE,|%runlist%
guicontrolget,RUNPLRAD,,RUNPLRAD
ROMSYS= %OPTYP%	
OPTYP= %OPTYP%
EXTRSYS= %OPTYP%
guicontrolget,SRCHTMP,,SRCHLOCDDL
guicontrolget,EDTROMBTN,,EDTROMBTN
if (EDTROMBTN = ">")
	{
		gosub, REHCBX
	}
guicontrol,,MORROM,|.........indexing............||
Loop,Parse,RUNBOXGUIITEMS,|
	{
		guicontrol,disable,%A_LoopField%
	}
Loop,Parse,GUISRCHITEMS,|
	{
		guicontrol,disable,%A_LoopField%
	}
poptadd=
romf=
if (RUNPLRAD = 1)
	{
		coreselv=
		selectedplaylist= %playlistLoc%\%OPTYP%
		guicontrol,,LCORE,|%runlist%
		if (OPTYP = "History")
			{
				selectedplaylist= %historyloc%
			}
		SB_SetText(" ... Indexing Playlist ...")
		PLineNum=
		PLineAdd=
		splitpath,OPTYP,,,,DDLUX
		finumb=
		finumj=
		newPlF=
		pplcr= 
		Loop, Read, %selectedplaylist%
			{
				if (A_LoopReadLine = "")
					{
						continue
					}
				PLineNum+=1
				PLineAdd+=1
				if (PLineAdd = 1)
					{
						romhn1=
						romhn2=
						stringreplace,fah,a_loopreadline,%A_Space%,,All
						stringreplace,fah,fah,%A_Tab%,,All
						if (fah = "{")
							{
								newPlF= 1
								continue
							}
						if (newPlF = 1)
							{
								continue
							}
						StringSplit,romhn,A_LoopReadLine,#
						if (romhn2 = "")
							{
								romhn2= %romhn1%
							}
						if (romf = "")
							{
								romf= %romhn1%
								finumb:= PlineNum + 2
							}
						poptadd.= romhn1 . "|"
					}
				if (newPlF = 1)
					{
						Stringreplace,romha,A_LoopReadLine,"path":%A_Space%,,UseErrorLevel
						if (ERRORLEVEL = 1)
							{
								finumb:= PLineNum+2
								finumj:= PLineNum+3
								stringtrimright,romha,romha,1
								stringreplace,romha,romha,\\,\,All
								stringreplace,romha,romha,",,All
								;"
								ifinstring,romha,.zip#
									{
										stringsplit,romhn,romha,#
										romf= %romhn1%
									}
									else {
											romf= %romha%
									}
								if (poptadd = "")
									{
										poptadd:= romf . "||"
									}	
								poptadd.= romf . "|"
								PLineAdd=
								continue	
							}
					}
				if (PLineAdd =  6)
					{
						PLineAdd=
					}
			}
		romfj1=
		romfj2=
		filereadline,tolcr,%selectedplaylist%,%finumb%
		filereadline,toljr,%selectedplaylist%,%finumj%
		if (newPlF = 1)
			{
				stringreplace,tolcr,tolcr,"core_path":%A_Space%,,UseErrorLevel
				stringtrimright,tolcr,tolcr,1
				stringreplace,tolcr,tolcr,\\,\,All
				stringreplace,tolcr,tolcr,",,All
				;"
				tolcr= %tolcr%
				stringreplace,toljr,toljr,"core_name":%A_Space%,,UseErrorLevel
				stringtrimright,toljr,toljr,1
				stringreplace,toljr,toljr,",,All
				;"
				toljr= %toljr%
			}
		splitpath,tolcr,coreselv,,corextnt,corejname
		if (pplcr = "")
			{
				pplcr= %coreselv%
			}
		if (corextnt = "exe")
			{
				pplcr= %corejname%
			}
		if (tolcr = "DETECT")
			{
				inpl= Assignments.ini
				rereadasini:
				iniread,fijj,%inpl%,OVERRIDES,%DDLUX%
				if (fijj = "ERROR")
					{
						if (inpl <> "sets\Assignments.set")
							{
								inpl= sets\Assignments.set
								goto, rereadasini
							}
						coreselv=
					}
				if (raexefile = "")
					{
						iniread,aixm,emuCfgPresets.ini,%DDLUX%,SUPEMU
						Loop,Parse,aixm,|
							{
								iniread,aib,Assignments.ini,ASSIGNMENTS,%A_LoopField%
								if (aib <> "")
									{
										coreselv= %aib%
										goto,splitromhash
									}
							}
					}
				Loop, Parse, fijj,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						coreselv= %A_LoopField%
						goto,splitromhash
					}
				splitpath,fijj,,,,coreselv
				ifinstring,fijj,_libretro.dll
					{
						coreselv= %fijj%
					}
			}
		splitromhash:
		stringsplit, romfj, romf,#
		stringmid,romhnck,romfj1,2,1
		if (romhnck <> ":")
			{
				ifexist, %raexedir%\%romfj1%
					{
						romf= %raexedir%\%romfj1%
						if (romfj2 <> "")
							{
								romf= %raexedir%\%romfj1%#%romfj2%
							}
					}
			}
		guicontrol,,LCORE,|%pplcr%||%runlist%
		guicontrol,,SRCHPLRAD,1
		guicontrol,,SRCHLOCDDL,|%OPTYP%||History|%plistfiles%
		guicontrol,,SRCHROMLBX,|
		guicontrol,,SRCHROMEDT,%romf%
		;;gosub, SRCHROMBUT
		guicontrol,,MORROM,|%romf%||%poptadd%
		;;gosub, EDTROM
		SB_SetText(" ... Index generated ...")		
		Loop,Parse,RUNBOXGUIITEMS,|
			{
				guicontrol,enable,%A_LoopField%
			}
		RUNSYSCHNG=
		GuiControl, MoveDraw, RUNSYSDDL
		return
	}
SB_SetText(" ... Indexing Directory ...")
guicontrolget,lcrtst,,LCORE
if (OPTYP = ":=:System List:=:")
	{
		guicontrol, ,MORROM
		guicontrol, ,LCORE
		coreselv=
		romf=
		RUNSYSCHNG=
		gosub, LNCHCHK
		SB_SetText("")
		GuiControl, MoveDraw, RUNSYSDDL
		return
	}
DDLUX= %OPTYP%
if (FILT_UNSUP <> 1)
	{
		ifinstring,SysLLst,%OPTYP%=
			{
				Ident_Sys= 1
			}
	}
REVSPL= 1
omitxtn=
omitxtz=
iniread,omitxtz,emuCfgPresets.ini,%OPTYP%,RJROMXT
if (omitxtz <> "ERROR")
	{
		stringreplace,omitxtz,omitxtz,.,,All
		stringreplace,omitxtz,omitxtz,`,,|,All
		stringsplit,omitxtn,omitxtz,= | ""
	}
if (omitxtn0 = "")
	{
		REVSPL=
		stringsplit,omitxtn,omitxt,= | ""
	}
ay := Object()
Loop, %omitxtn0%
	{
		new= % (omitxtn%a_index%)
		if (new <> "")
			{
				ay.insert(new)
			}
	}
SB_SetText("... Indexing Directory ...")
poptadd=
IniRead,kiv,SystemLocations.ini,LOCATIONS,%OPTYP%
Loop,Parse,kiv,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		Loop,Files,%A_LoopField%\*.*,R
			{
				ext= %A_LoopFileExt%
				noapl=
				for k, v in ay
					{
						extm:= v
						if (ext = extm)
							{
								noapl= 1
							}
					}
				if (noapl = REVSPL)
					{
						if (romf = "")
							{
								romf= %A_LoopFileLongPath%
							}
						krtn= %A_LoopFileLongPath%
						ifinstring,krtn,%RJSYSTEMS%\%OPTYP%\
							{
								stringreplace,krtn,A_LoopFileLongPath,%RJSYSTEMS%\%OPTYP%\,,All
							}
						poptadd .= krtn . "|"
					}
			}
}
SB_SetText("... Directory Indexed ...")
guicontrol,,MORROM,|%romf%||%poptadd%
guicontrol,,SRCHFLRAD,1
guicontrol,,SRCHLOCDDL,|%OPTYP%||%knownfldrs%
guicontrol,,SRCHROMLBX,|
gosub, SRCHROMBUT
if (Ident_sys = "")
	{
		goto, SkipCoreGet
	}
iniread,coreselz,Assignments.ini,OVERRIDES,%OPTYP%
if (raexefile = "")
	{
		goto, emucoredd
	}
emucoredd:
if (coreselz <> "ERROR")
	{
		coreselve=
		coreselvea= 
		Loop,20
			{
				coreselp%A_Index%=
			}
		ppl= 
		snx= 
		stringsplit,coreselp,coreselz,|
		Loop,%coreselp0%
			{
				snx= % coreselp%A_Index%
				if (snx = "")
					{
						continue
					}
				ppl+=1	
				if (ppl = 1)
					{
						guicontrol,,LCORE,|%snx%||
						coreselv= %snx%|
						continue
					}
				Loop,parse,emulist,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						if ((A_LoopField = snx)&& !instr(coreselva,A_LoopField . "|"))
							{
								coreselvea.= A_LoopField . "|"
							}
					}
			}
		coreselve= %coreselv%|%coreselvea%
	}
emucin:
if (coreselv = "")
	{
		kva=
		ifinstring,SysLLst,%OPTYP%=
		iniread,afkk,emuCfgPresets.ini,%OPTYP%,SUPEMU
		;;StringSplit,sysplit,afkk,|
		kr=
		ink=
		kva=
		coreselve= 
		coreselvea= 
		Loop, parse, afkk,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				kr= %A_LoopField%
				Loop, parse, emulist,|
					{
						kva=
						if (A_LoopField = "")
							{
								continue
							}
						kva+=1
						if (kva = 1)
							{
								guicontrol,,LCORE,|%A_LoopField%||
								coreselx= %A_LoopField%|
							}
						if (A_LoopField = kr)
							{
								coreselvea.= kr . "|"
								kva= 1
							}
					}
				coreselve:= coreselx . "|"	. coreselvea
				guicontrol,,LCORE,|%coreselve%|
				if (kva <> "")
					{
						break
					}
			}
		if (kva = "")
			{
				if (AUTOPGS = 1)
					{
						if (MINIMODE = 1)
							{
								gosub, MINIMODEOFF
							}
						guicontrol,,SALIST,|Emulators|Systems||Utilities|Frontends
						guicontrol,choose,TABMENU,3
						gosub, SaList
						knum=
						Loop, Parse, allsupport,|
							{
								knum+=1
								if (A_LoopField = OPTYP)
									{
										guicontrol, choose, SYSINSTLBX,%knum%
										guicontrol,,INSTEMUDDL,|%coreselx%|%emuinstpop%
										gosub, SYSINSTLBX
										SB_SetText(" " coreselx " emulator auto-suggested")
										break
									}
							}
					}
			}
	}
SkipCoreGet:
gosub, EDTROM
Loop,Parse,RUNBOXGUIITEMS,|
	{
		guicontrol,enable,%A_LoopField%
	}
Loop,Parse,GUISRCHITEMS,|
	{
		guicontrol,enable,%A_LoopField%
	}
RUNSYSCHNG=
rflr=
gosub, LNCHCHK
GuiControl, MoveDraw, RUNSYSDDL
return

CustmOpts:
gui, submit, nohide
BCSTO:= CUSTMOPT
CUSTMOPT=
if (CUSTSWITCHS = 1)
	{
		guicontrolget,CUSTMOPT,,CUSTMOPTS
		BCSTO:= CUSTMOPT
		guicontrol,,CUSTMOPT,|%CUSTMOPT%||%INJOPT%
		return
	}
return

CustmArgs:
gui, submit, nohide
BCSTA= %CUSTMARG%
CUSTMARG=
if (CUSTSWITCHS = 1)
	{
		guicontrolget,CUSTMARG,,CUSTMARGS
		BCSTA= %CUSTMARG%
		guicontrol,,CUSTMARG,|%CUSTMARG%||%INJOPT%
		return
	}
return

CustSwitchs:
gui,submit,nohide
iscor=
iscorext=
guicontrolget,iscor,,LCORE
splitpath,iscor,,,iscorext
if (iscorext = "dll")
	{
		guicontrol,,CUSTSWITCHS,0
	}
guicontrolget,CUSTSWITCHS,,CUSTSWITCHS
if (CUSTSWITCHS = 0)
	{
		guicontrol, hide, CUSTMOPT
		guicontrol, hide, CUSTMARG
		guicontrol, hide, CUSTMOPTS
		guicontrol, hide, CUSTMARGS
		guicontrol, move, RUNROMCBX, x39 y24 w604
		guicontrol, move, MORROM, x39 y24 w377
		guicontrol,,CUSTSWITCH,0
		CUSTMARG=
		CUSTMOPT=
		CUSTMARGS=
		CUSTMOPTS=
		guicontrol,,CUSTMOPTS,| ||%INJOPT%
		guicontrol,,CUSTMARGS,| ||%INJARG%
		guicontrol,,CUSTMOPT,| ||%INJOPT%
		guicontrol,,CUSTMARG,| ||%INJARG%
		return
	}
iniread,cstopon,AppParams.ini,%iscor%,options
iniread,custargon, AppParams.ini,%iscor%,arguments
if instr(cstopon,"[CUSTMOPT]") or Instr(custargon,"[CUSTMARG]")
	{
		guicontrol, show, CUSTMOPT
		guicontrol, show, CUSTMARG
		guicontrol, show, CUSTMARGS
		guicontrol, show, CUSTMOPTS
	}
if ((cstopon = "ERROR") or (cstopon = ""))
		{
			guicontrol, show, CUSTMopt
			guicontrol, show, CUSTMoptS
		}
if ((custargon = "ERROR") or (custargon = ""))
		{
			guicontrol, show, CUSTMARG
			guicontrol, show, CUSTMARGS
		}
guicontrol,,CUSTSWITCH,1
if ((CUSTMOPT = "") && (BCSTO <> ""))
	{
		guicontrol,,CUSTMOPT,|%BCSTO%||%INJOPT%
		guicontrol,,CUSTMOPTS,|%BCSTO%||%INJOPT%
	}
if ((CUSTMARG = "") && (BCSTA <> ""))
	{
		guicontrol,,CUSTMARG,|%BCSTA%||%INJARG%
		guicontrol,,CUSTMARGS,|%BCSTA%||%INJARG%
	}
guicontrol, move, RUNROMCBX, x39 y24 w377
guicontrol, move, MORROM, x39 y24 w377
return

SRCHLOCDDL:
gui,submit,nohide
guicontrolget,FNDGUI,,FNDGUI 	
guicontrolget,lcrtst,,LCORE
guicontrolget,SRCHLOCDDL,,SRCHLOCDDL
if (FNDGUI = "X")
	{
		guicontrol,,RUNSYSDDL,%SRCHLOCDDL%||
		gosub,RUNSYSDDL
	}
return

SRCHFLRAD:
gui,submit,nohide
guicontrol,show,SRCHRCRSCHK
guicontrolget,lcrtst,,LCORE
guicontrol,,SRCHLOCDDL,|:=:System List:=:||%systmfldrs%
return

SRCHRCRSCHK:
gui,submit,nohide
guicontrolget,SRCHRCRSCHK,,SRCHRCRSCHK
return

SRCHPLRAD:
gui,submit,nohide
guicontrol,hide,SRCHRCRSCHK
guicontrol,,SRCHLOCDDL,|All_Playlists||%plistfiles%
return

SRCHROMBUT:
gui,submit,nohide
guicontrolget,SRCHFLRAD
guicontrolget,SRCHPLRAD
guicontrolget,SRCHLOCDDL,,SRCHLOCDDL
guicontrolget, SRCHROMEDT,,SRCHROMEDT
guicontrol,show,SRCHROMLBX
guicontrol,,SRCHROMLBX,|..searching...
guicontrol,disable,SRCHROMBUT
sanm:= SRCHROMEDT
gosub,SanitizeN
SRCHROMEDT:= sanm
splitpath,SRCHLOCDDL,,,,SRCHLOCNM
if (SRCHPLRAD = 1)
	{
		if (SRCHLOCDDL = "All_Playlists")
			{
				lsrchpop=
				Fileread,hashdbini,hashdb.ini
				Loop, parse, hashdbini,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						hashsrch1=
						hashsrch2=
						hashsrch3=
						stringsplit,hashsrch,A_LoopField,|
						IfInString, hashsrch1, %SRCHROMEDT%
							{
									lsrchpop .= hashsrch2 . "=" . hashsrch1 . "|"
							}
					}
					guicontrol,,SRCHROMLBX, |%lsrchpop%
					guicontrol,enable,SRCHROMBUT
				return
			}
		lsrchpop=
		plnuminc=
		plpcr=
		primrha=
		Loop, Read, %playlistLoc%\%SRCHLOCDDL%
			{
				plnuminc+=1
				if (plnuminc = 1)
					{
						if (A_LoopReadLine = "{")
							{
								newPlF= 1
								continue
							}
						if (newPlF = 1)
							{
								continue
							}
						IfInString, A_LoopReadLine, %SRCHROMEDT%
							{
								plnumnam= %A_LoopReadLine%
							}
					}
				if (newPlF = 1)
					{
						IfInString,A_LoopReadLine,%SRCHROMEDT%
							{
								Stringreplace,romha,A_LoopReadLine,"path":%A_Space%,,UseErrorLevel
								if (ERRORLEVEL = 1)
									{
										finumb:= A_Index+2
										stringtrimright,romha,romha,1
										stringreplace,romha,romha,\\,\,All
										stringreplace,romha,romha,",,All
										;"
										filereadline,ecnmz,%playlistLoc%\%SRCHLOCDDL%,%finumb%
										stringreplace,ecnav,ecnmz,"core_path":%A_Space%,,All
										stringreplace,ecnav,ecnav,\\,\,All
										stringreplace,ecnav,ecnav,",,All
										;"
										stringtrimright,ecnav,ecnav,1
										splitpath,ecnav,ecnam,,,ecnay,ecnamg
										if (plpcr = "")
											{
												plpcr= %ecnay%
											}
										lsrchpop.= romha . ">" . ecnam . "|"
									}
								plnuminc=
							}
						continue
					}
				if (plnuminc = 3)
					{
						splitpath,A_LoopReadLine,ecnam,,,,ecnamg
						if (ecnam = "")
							{
								ecnam= %A_LoopReadLine%
							}
						lsrchpop .= plnumnam . ">" . ecnam . "|"
					}
			if (plnuminc = 6)
				{
					plnuminc=
				}
			}
		stringreplace,lsrchpop,lsrchpop,%RJSYSTEMS%\%SRCHLOCNM%\,,All
		guicontrol,,LCORE,|%plpcr%||
		guicontrol,,SRCHROMLBX, |%lsrchpop%
		guicontrol,enable,SRCHROMBUT
		return
	}
IniRead,kiv,SystemLocations.ini,LOCATIONS,%SRCHLOCDDL%
lsrchpok=
lsrchpop=
existingpop=
Loop,Parse,kiv,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		;;;LOCSRCHFLDR= %RJSYSTEMS%\%SRCHLOCDDL%
		LOCSRCHFLDR= %A_LoopField%
		guicontrolget,SRCHRCRSCHK,,SRCHRCRSCHK
		if (SRCHLOCDDL = ":=:System List:=:")
			{
				LOCSRCHFLDR= %RJSYSTEMS%
			}
		SB_SetText("...Searching...")
		Loop,%LOCSRCHFLDR%\*%SRCHROMEDT%*,,%SRCHRCRSCHK%
			{
				ext= %A_LoopFileExt%
				if (ext = "")
					{
						continue
					}
				noapl=
				for k, v in ar
					{
						extm:= v
						if (ext = extm)
							{
								noapl= 1
							}
					}
				if (noapl = "")
					{
						lsrchpop .= A_LoopFileFullPath . "|"
					}
			}
		if (A_index = 1)
			{
				lsrchpok= %lsrchpop%
				if instr(LOCSRCHFLDR,RJSYSTEMS)
					{
						stringreplace,lsrchpop,lsrchpop,%LOCSRCHFLDR%\,,All			
					}				
			}	
		guicontrolget, existingpop,,SRCHROMLBX
		guicontrol,,SRCHROMLBX,|%existingpop%|%lsrchpop%
		SB_SetText("Search Complete")
		guicontrol,enable,SRCHROMBUT
	}
return

SRCHROMEDT:
gui,submit,nohide
guicontrolget, SRCHROMEDT,,SRCHROMEDT
return

SRCHROMLBX:
gui,submit,nohide
guicontrolget, rmget,,EDTROM
splitpath,rmget,rmnm
guicontrolget,romOVf,,SRCHROMLBX
splitpath,romovf,rmnx
if (rmnx = romnm)
	{
		return
	}
Loop,Parse,GUISRCHITEMS,|
	{
		guicontrol,disable,%A_LoopField%
	}	
guicontrolget, SRCHLOCDDL,,SRCHLOCDDL
stringreplace,SRCHLOCDDLP,SRCHLOCDDL,.lpl,,All
guicontrolget, RUNSYSDDL,,RUNSYSDDL
guicontrolget, SRCHFLRAD,,SRCHFLRAD
guicontrolget, SRCHPLRAD,,SRCHPLRAD
guicontrol,,RUNPLRAD,%SRCHPLRAD%
guicontrol,,RUNFLRAD,%SRCHFLRAD%
MSRCHSEL=
Loop, Parse, romOVf,|
	{
		if (A_Index > 1)
			{
				MSRCHSEL= 1
				break
			}
	}
iniread,srchlocone,SystemLocations.ini,LOCATIONS,%SRCHLOCDDL%
Loop,parse,srchlocone,|
	{
		srchlocrpl= %A_LoopField%
		break
	}
ainc=
Loop, Parse, romOVf,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		ainc+=1
		romf= %A_LoopField%
		splitpath,romf,romfn,romfpth
		if !instr(romf,":")
			{
				romfx= %srchlocrpl%\%romf%
				if (SRCHLOCDDL = ":=:System List:=:")
					{
						romfx= %srchlocrpl%\%romf%
						stringsplit,SRCHLOCDDZ,romf,\
						SRCHLOCDDL= %SRCHLOCDDZ1%
						RUNSYSDDL= %SRCHLOCDDL%
						guicontrol,,RUNSYSDDL,|%SRCHLOCDDL%||%systmfldrs%
						guicontrol,,SRCHLOCDDL,|%SRCHLOCDDL%||%systmfldrs%
					}
				romf=%romfx%	
			}
		SRCHOVRD= 1
		if (SRCHFLRAD = 1)
			{
				stringreplace,nocad,romf,%srchlocrpl%\,,All
				if (ERRORLEVEL <> 0)
					{
						isofldr1=
						StringSplit,isofldr,nocad,\
						SRCHLOCDDL:= isofldr1
						coreslv=
						iniread, coreord,Assignments.ini,OVERRIDES,%isofldr2%
						if (coreord <> "ERROR")
							{
								stringsplit,aij,coreord,|
								coreord= %aij1%
								iniread,coreslv,Assignments.ini,ASSIGNMENTS,%coreord%
							}
						GRPOVRD= 1
					}
				if (lsrchpop <> "")
					{
						if (RUNSYSDDL <> SRCHLOCDDL)
							{
							}
						guicontrol,,MORROM,|%romf%||%lsrchpop%
					}
				if (lsrchpop = "")
					{
						if (ainc = 1)
							{
								gosub, RUNSYSDDL
							}
					}
				GRPOVRD=
			}
		SRCHOVRD=
		if (SRCHPLRAD = 1)
			{
				stringsplit,efjn,romf,>
				romf= %efj1%
				plselcore= %efjn2%
				stringsplit,efjn,A_LoopField,>
				romf= %efjn1%
				plselcore= %efjn2%
				if (plselcore = "DETECT")
					{
						plselcore= %coreselv%
					}
				if (SRCHLOCDDL = "All_Playlists")
					{
						LOCRSPL1=
						LOCRSPL2=
						stringsplit,LOCRSPL,SRCHROMLBX,=
						guicontrol,,RUNSYSDDL,|%LOCRSPL1%||History|%plistfiles%
						gosub, RUNSYSDDL
						romf:= LOCRSPL2
						romfj1=
						romfj2=
						stringsplit, romfj, romf,#
						stringmid,romhnck,romfj1,2,1
						if (romhnck <> ":")
							{
								ifexist, %raexedir%\%romfj1%
									{
										romf= %raexedir%\%romfj1%
										if (romfj2 <> "")
											{
												romf= %raexedir%\%romfj1%#%romfj2%
											}
									}
							}
						if (ainc = 1)
							{
								guicontrol,,MORROM,|%romf%||%poptadd%
								gosub, EDTROM
							}
						return
					}
				romfj1=
				romfj2=
				stringsplit, romfj, romf,#
				stringmid,romhnck,romfj1,2,1
				guicontrol,,RUNSYSDDL,|%SRCHLOCDDL%||History|%plistfiles%
				GRPOVRD= 1
				if (lsrchpop <> "")
					{
						if (RUNSYSDDL <> SRCHLOCDDL)
							{
								guicontrol,,RUNSYSDDL,|%SRCHLOCDDL%||History|%plistfiles%
							}
						guicontrol,,MORROM,|%romfj1%||%lsrchpop%
						if (MSRCHSEL <> 1)
							{
								guicontrol,,LCORE,|%plselcore%||
							}
					}
				if (lsrchpop = "")
					{
						gosub, RUNSYSDDL
					}
				GRPOVRD=
			}
		romfj1=
		romfj2=
		stringsplit, romfj, romf,#
		stringmid,romhnck,romfj1,2,1
		if (romhnck <> ":")
			{
				ifexist, %raexedir%\%romfj1%
					{
						romf= %raexedir%\%romfj1%
						if (romfj2 <> "")
							{
								romf= %raexedir%\%romfj1%#%romfj2%
							}
					}
			}
	}
if (poptadd = "")
	{
		poptadd= %lsrchpop%
	}
prexv=
ifnotinstring,romfj1,:\
	{
		prexv= %srchlocrpl%\
	}
if (ainc = 1)	
	{
		guicontrol,,MORROM,|%prexv%%romfj1%||%poptadd%
		gosub, EDTROM
	}
Loop,Parse,GUISRCHITEMS,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

CheckStatus:
if (INTERRUPTDWN = 1)
	{
		FileGetSize, FSize, %save%
		If (FSize >= Size)
			{
				Critical
				SetTimer, CheckStatus, off
				FileRead, FileData, %save%
				MsgBox,,Aborted,Download Aborted,5
				SetTimer, DownloadFileFunction_UpdateProgressBar, off
				filedelete,%save%
				SB_SetText("Download interrupted")
				INTERRUPTDWN=
			}
   }
return

RepoSet:
ONPLUSREM=
guicontrolget,REPOSET,,REPOSET
guicontrol,disable,ADDREPO
REPODEL= %REPOSET%
ifnotinstring,repolst,|%REPOSET%
	{
		guicontrol,enable,ADDREPO
		guicontrol,,ADDREPO, +
		IniWrite, "%reposet%",Settings.ini,GLOBAL,Emulator_Repository
	}
if (REPOSET = "")
	{
		ONPLUSREM= 1
		guicontrol,enable,ADDREPO
		guicontrol,,ADDREPO, -
	}
return

AddRepo:
guicontrolget,REPOSET,,REPOSET
guicontrol,disable,ADDREPO
if (REPOSET <> "")
	{
		repoLst.= REPOSET . "|"
		guicontrol,,REPOSET,|%REPOSET%||%repolst%
	}
if (REPOSET = "")
	{
		if (ONPLUSREM = 1)
			{
				stringreplace,repoLst,repoLst,|%REPODEL%,,All
				guicontrol,disable,ADDREPO
				Loop, read,repolist.ini
					{
						REPOSET= %A_LoopReadLine%
					}
				Guicontrol,,REPOSET,|%REPOSET%||%repolst%
			}
	}
stringreplace, repowrite,RepoLst,|,`n,All
FileDelete, RepoList.ini
fileappend, %repoWrite%,RepoList.ini
IniWrite, "%REPOSET%",Settings.ini,GLOBAL,Emulator_Repository
return

CLRFLTRSUB:
gui,submit,nohide
if (SALIST = "Systems")
	{
		guicontrol,,SYSINSTLBX,|%knownfldrs%
	}
if (SALIST = "Emulators")
	{
		guicontrol,,PRGINSTLBX,|%addemu%
	}
return

CLRFLTR:
gui,submit,nohide
guicontrol,,INSFLTR,
guicontrolget,INSFLTR,,INSFLTR
if (INSFLTR = "")
	{
		return
	}
INSFLTR:
gui,submit,nohide
guicontrolget,INSFLTR,,INSFLTR
SB_SetText("searching")
if (SALIST = "Emulators")
	{
		if (INSFLTR = "")
			{
				SB_SetText("")
				guicontrol,,PRGINSTLBX,|%emuinstpop%
				return
			}
		reapp= 	
		Loop,parse,emuinstpop,|
			{
				ifinstring,A_LoopField,%INSFLTR%
					{
						reapp.= A_LoopField . "|"
					}
			}
		SB_SetText("")
		GuiControl,,PRGINSTLBX,|%reapp%	
		if (INSFLTR = "INSTALLED")
			{
				goto, CLRFLTRSUB
			}
		return	
	}
if (SALIST = "Systems")
	{
		Loop,Parse,SYSINSTITEMS,|
			{
				guicontrol,hide,%A_LoopField%
			}
		guicontrol,show,SYSINSTLBX	
		if (INSFLTR = "")
			{
				SB_SetText("")
				guicontrol,,SYSINSTLBX,|%allsupport%
				return
			}
		reisys= 	
		Loop,parse,allsupport,|
			{
				ifinstring,A_LoopField,%INSFLTR%
					{
						reisys.= A_LoopField . "|"
					}
			}
		SB_SetText("")
		GuiControl,,SYSINSTLBX,|%reisys%	
		if (INSFLTR = "DETECTED")
			{
				goto, CLRFLTRSUB
			}
		return	
	}
return

SaList:
gui,submit,nohide
guicontrol,disable,salist
guicontrolget,SALIST,,SALIST
guicontrol,show,CLRFLTR
guicontrol,show,INSFLTRX
guicontrol,show,INSFLTR
guicontrol,hide,SAVOSYS
guicontrol,hide,RENOSYS
guicontrol,hide,CNCLOSYS
guicontrol,,INSFLTR,
guicontrol,move,EMUPGC,x595 y122
guicontrol,move,GBLPgs,x501 y122
Loop,Parse,EMUTABITEMS,|
	{
		guicontrol,hide,%A_LoopField%
	}
guicontrol,hide,GBLpgs
guicontrol,hide,AUTOBIOS
guicontrol,disable,EMUASIGN
guicontrol,disable,ROMDLOC
guicontrol,disable,LOCEMUIN
guicontrol,disable,EMUINST
guicontrol,disable,INSTEMUDDL
guicontrol,disable,CHEMUINST
guicontrol,,INSTEMUDDL,|%emuinstpop%
guicontrol,move,CACGRP, x2 y15 w276 h470
guicontrol,move,CCGRP,x278 y5 w185 h359
guicontrol,,CCGRP,Installer
guicontrol,,CACGRP,
guicontrol,,EINSTLOC,
guicontrol,,ROMDEDT,
guicontrol,,OVSETTXT,
if (SALIST = "Frontends")
	{
		Loop,Parse,FEINSTITEMS,|
			{
				guicontrol,show,%A_LoopField%
			}
		guicontrol,hide,INSFLTR
		guicontrol,hide,CLRFLTR
		guicontrol,hide,INSFLTRX
		guicontrol,,PRGINSTLBX,|%frntdlst%
		guicontrol,move,CACGRP, x2 y5 w276 h478
		guicontrol,move,CCGRP,x278 y5 w185 h366
		guicontrol,,CCGRP,Installer
		guicontrol,,CACGRP,Frontends
		guicontrol,enable,salist
		return
	}
if (SALIST = "Utilities")
	{
		Loop,Parse,UTLINSTITEMS,|
			{
				guicontrol,show,%A_LoopField%
			}
		guicontrol,hide,INSFLTR
		guicontrol,hide,CLRFLTR
		guicontrol,hide,INSFLTRX
		guicontrol,move,CACGRP,x2 y5 w276 h478
		guicontrol,move,CCGRP,x278 y5 w185 h366
		guicontrol,,PRGINSTLBX,|Antimicro|DS4Windows|Daemon_Tools|DirectX|Visual_C++_Runtimes|Xinput_Drivers|Xpadder|DisplayChanger|VirtualCloneDrive|WinCDEmu|360button|Joy2Key
		guicontrol,,CCGRP,Installer
		guicontrol,,CACGRP,Utilities
		guicontrol,enable,salist
		return
	}
multiemu=
if (SALIST = "Systems")
	{
		guicontrol,show,SYSINSTLBX
		guicontrol,,SKRAstch,Skeletonkey-System-Associations
	}
if (SALIST = "Emulators")
	{
		guicontrol,,PRGINSTLBX,|%emuinstpop%
		guicontrol,show,AUTOBIOS
		guicontrol,,SKRAstch,Skeletonkey-Emulator-Associations
		gosub, Dapp
		Loop,Parse,PSETCFGITEMS,|
			{
				guicontrol,hide,%A_LoopField%
			}
		Loop,Parse,EMUINSTITEMS,|
			{
				guicontrol,show,%A_LoopField%
			}
		guicontrol, hide,OVLIST
		;;guicontrol, hide,OVSETTXT
		guicontrol, hide,ROMDLOC
		guicontrol, hide,ROMDTXT
		guicontrol, hide,ROMDEDT
		guicontrol,hide,EMUASIGN
		guicontrol, hide,ROMDTXT
		guicontrol, hide,ROMDEDT
		guicontrol,hide,OPNSYS
		guicontrol,hide,ADDCORE
		guicontrol,hide,EXDISPL
		guicontrol,hide,EXTARUN
		guicontrol,hide,EXDISPL
		guicontrol,show,Gblpgs
		guicontrol,show,EMUPGC
		guicontrol,move,EMUPGC,x595 y436
		guicontrol,move,GBLPgs,x541 y436
	}
guicontrol, , SYSNICK,| ||%preEmuCfg%
Loop, Parse, EmuPartSet,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit, multabc, A_LoopField,<,:
		multiemu .= multabc1 . "|"
	}
guicontrol,enable,salist
return

EMURSTI:
gui,submit,nohide
guicontrolget,INSTEMUDDL,,INSTEMUDDL
guicontrolget,INSTEMUDET,,EINSTLOC
if (INSTEMUDDL = "")
	{
		return
	}
iniread,inststtl,Apps.ini,%SALIST%,%INSTEMUDDL%
if ((inststtl = "ERROR")or(inststtl = "")&&(INSTEMUDET = ""))
	{
		SB_SetText("" INSTEMUDDL " is not installed")	
	}
inidelete,Apps.ini,%SALIST%,%INSTEMUDDL%
iniwrite,"",Assignments.ini,Assignments,%INSTEMUDDL%
iniread,rsetz,EmuCfgPresets.ini,%INSTEMUDDL%,URLPTH
stringsplit,rsetzs,rsetz,/
Loop,%rsetzs0%
	{
		rsetztd= %A_LoopField%
	}
guicontrol,,EINSTLOC,	
Filedelete,%cacheDirectory%\%rsetztd%
if (ERRORLEVEL = 0)
	{
		SB_SetText("" rsetztd " was deleted and " INSTEMUDDL " was reset")
	}
ifexist,%RJEMUD%\%INSTEMU%\
	{
		Msgbox,8196,Delete Install,Delete the %RJEMUD%\%INSTEMUDDL% folder?
		IfMsgbox,Yes
			{
				if (!FileExist(RJEMUD . "\" . INSTEMUDDL . "\")or(INSTEMUDDL))
					{
						return
					}
				FileRemoveDir,%RJEMUD%\%INSTEMUDDL%,1
				if (ERRORLEVEL = 0)
					{
						SB_SetText(" Directory Deleted ")
					}
			}
	}
return

ChEmuInst:
xtractmu=
xtractmul=
FileSelectFolder,xtractmul,,3,Select Destination Directory for %selfnd%
if (xtractmul = "")
	{
		return
	}
	stringright,efi,xtractmul,2
	stringLeft,efix,xtractmul,2
	if (efi = ":\")
		{
			xtractmul= %efix%
		}
guicontrolget,selfnd,,INSTEMUDDL
xtractmu= %xtractmul%\%selfnd%
INSTLRS= Xinput_Drivers|DirectX|Daemon_Tools|Visual_C++_Runtimes|MediaBrowser|Kodi_XBMC
noselb=
Stringsplit,noselb,INSTLRS,|
aer := Object()
Loop, %noselb0%
	{
		new= % (noselb%a_index%)
		if (noselb%a_index% <> "")
			{
				aer.insert(new)
			}
	}
nigb:= semu
noini=
for k, v in aer
	{
		extm:= v
		if (nigb = extm)
			{
				goto, INST_%semu%
			}
	}
return

SanUrl:
stringreplace,sanfile,sanfile,`%26,&,All
stringreplace,sanfile,sanfile,`%2B,+,All
stringreplace,sanfile,sanfile,`%20,%A_Space%,All
stringreplace,sanfile,sanfile,`%23,#,All
stringreplace,sanfile,sanfile,`%24,$,All
stringreplace,sanfile,sanfile,`%21,!,All
stringreplace,sanfile,sanfile,`%28,(,All
stringreplace,sanfile,sanfile,`%29,),All
stringreplace,sanfile,sanfile,`%5B,[,All
stringreplace,sanfile,sanfile,`%5D,],All
stringreplace,sanfile,sanfile,`%3D,=,All
stringreplace,sanfile,sanfile,`%2C,`,,All
stringreplace,sanfile,sanfile,`%40,@,All
stringreplace,sanfile,sanfile,`%3B,`;,All
stringreplace,sanfile,sanfile,`%27,',All
stringreplace,sanfile,sanfile,`%7B,{,All
stringreplace,sanfile,sanfile,`%7D,},All
stringreplace,sanfile,sanfile,`%7E,~,All
stringreplace,sanfile,sanfile,`%25,`%,All
return

INST_Kodi_XBMC:
kodiinst=
Loop, apps\%semu%\*.exe
	{
		kodiinst:= A_LoopFileFullPath
	}
ifnotexist, %kodiinst%
	{
		return
	}
XBLOPT=
if (xtractmul = "")
	{
		XBLOPT= /S
		xtractmul= %S_KeyDir%\apps\Kodi
	}
Runwait,"%kodiinst%" %XBLOPT% /D=%xtractmul%,,,inspid
return

INST_MediaBrowser:
mbinst=
Loop, apps\%semu%\MediaBrowser*.msi
	{
		mbinst:= A_LoopFileFullPath
	}
ifnotexist, %mbinst%
	{
		return
	}
mbinstopt= /norestart
if (xtractmul = "")
	{
		mbinstopt= /qb /norestart /i
		xtractmul= %A_ProgramFiles%
	}
Runwait,msiexec %mbinstopt% "%mbinst%",,,inspid
return

INST_Xinput_Drivers:
xbdrvinst=
Loop, apps\%semu%\Xbox360_*eng.exe
	{
		xbdrvinst:= A_LoopFileFullPath
	}
ifnotexist, %xbdrvinst%
	{
		return
	}
Runwait,"%xbdrvinst%" /q:a,,,inspid
return

INST_Visual_C++_Runtimes:
vcdrvinst=
Loop, apps\%semu%\VBCRedist_AIO_x86_x64.exe
	{
		vcdrvinst:= A_LoopFileFullPath
	}
ifnotexist, %vcdrvinst%
	{
		return
	}
Runwait,"%vcdrvinst%" /ai /y,,,inspid
return

INST_DirectX:
dxdrvinst=
Loop, apps\%semu%\dxwebsetup.exe
	{
		dxdrvinst:= A_LoopFileFullPath
	}
ifnotexist, %dxdrvinst%
	{
		return
	}
Runwait,"%dxdrvinst%" /Q,,,inspid
return

INST_Daemon_Tools:
dtdrvinst=
if (xtractmfp = "")
	{
		xtractmfp= %cacheloc%\DTLite.exe
		dtdrvinst= %xtractmfp%
	}
ifnotexist, %dtdrvinst%
	{
		return
	}
if (xtractmul = "")
	{
		xtractmul= %RJEMUD%\Daemon Tools
	}
Runwait,"%dtdrvinst%" /S /nogadget /notoolbar /sptd /D="%xtractmul%",,,inspid
RegWrite, REG_SZ, HKEY_LOCAL_MACHINE\SOFTWARE\TestKey, MyValueName, Test Value
RegWrite, REG_DWORD, HKEY_CURRENT_USER\Software\Disc Soft\DAEMON Tools Pro\Config, Automount,0
RegWrite, REG_DWORD, HKEY_CURRENT_USER\Software\Disc Soft\DAEMON Tools Pro\Config /f /v Autostart,0
RegWrite, REG_DWORD, HKEY_CURRENT_USER\Software\Disc Soft\DAEMON Tools Pro\Config,CheckForUpdate,0
RegWrite, REG_DWORD, HKEY_CURRENT_USER\Software\Disc Soft\DAEMON Tools Pro\Config,SendStatistic,0
RegWrite, REG_DWORD, HKEY_CURRENT_USER\Software\Disc Soft\DAEMON Tools Pro\Config,UpdateCheckCounter,0
RegWrite, REG_DWORD, HKEY_CURRENT_USER\Software\Disc Soft\DAEMON Tools Pro\Config,UseTrayAgent,0
RegWrite, REG_DWORD, HKEY_CURRENT_USER\Software\Disc Soft\DAEMON Tools Pro\GuiNamespace,AskDeleteICItem,1
RegWrite, REG_DWORD, HKEY_CURRENT_USER\Software\Disc Soft\DAEMON Tools Pro\GuiNamespace,AskImageInUse,0
RegWrite, REG_DWORD, HKEY_CURRENT_USER\Software\Disc Soft\DAEMON Tools Pro\GuiNamespace,AskRemoveVD,0
RegWrite, REG_DWORD, HKEY_CURRENT_USER\Software\Disc Soft\DAEMON Tools Pro\Options,ManageIsImageInfoEnable,0
Daemon_Tools=%xtractmul%\DTLite.exe
return

PRGINSTLBX:
gui, submit, nohide
xtractmu=
MULTICHK=
MULTISYS=
guicontrol,,SYSNICK,| ||%preEmuCfg%
guicontrol,,APPOPT,| ||%INJOPT%
guicontrol,,APPARG,| ||%INJARG%
guicontrol,,EMUASIGN,Assign to System
guicontrol,,EMUASIGN,0
guicontrol,,EMUINST,Install
guicontrol,,EINSTLOC
guicontrolget,semu,,PRGINSTLBX
guicontrol,hide,OEMUDEL
guicontrol,hide,OEMUSV
guicontrol,hide,OEMUNICK
guicontrol,hide,OEMUTXT
guicontrol,hide,MULTLNK
guicontrol,hide,UNIQLNK
guicontrol,hide,MULTINST
guicontrol,hide,MROMDLOC
guicontrol,hide,EMUASIGN
guicontrol,hide,OEMUNICK
guicontrol,hide,OEMUDEL
guicontrol,hide,OEMUSV
guicontrol,hide,OEMUTXT
guicontrol,show,LOCEMUIN
guicontrol,show,EINSTTXT
guicontrol,show,ChEmuInst
guicontrol,show,EINSTLOC
guicontrol,enable,EMUASIGN
guicontrol,enable,ROMDLOC
guicontrol,enable,EmuPGC
guicontrol,enable,LOCEMUIN
guicontrol,enable,EMUINST
guicontrol,enable,INSTEMUDDL
guicontrol,enable,CHEMUINST
curtxt= 
LineNum=
Loop,Parse,PrgLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		LineNum+=1
		selfnd=
		stemu=
		stemu1=
		stemu2=
		stemu3=
		stemu4=
		stemu5=
		emuplst=
		stringsplit,stemu,A_LoopField,|
		emuplst= %stemu2%
		if (stemu1 = semu)
			{
				curtxt= %semu%
				selfnd= %stemu2%
				guicontrol,,INSTEMUDDL,|%stemu2%||%emuplst%|%emuinstpop%Other
				gosub, ChkMu
			}
			guicontrolget,selfnd,,INSTEMUDDL
			emuname= %semu%
	}
noselb=
Stringsplit,noselb,noBrws,|
if (SALIST = "Emulators")
	{	
		guicontrol,,EMUAUTOA,0
		guicontrol,,INSTEMUDDL,|%semu%||Other
		IniRead, ksvel,apps.ini,EMULATORS,%semu%
		if ((ksvel = "")or(ksvel = "ERROR"))
			{
				guicontrol,disable,EMUASIGN
				return
			}
		SYSINSTLBX= %semu%
		guicontrol,,EINSTLOC,%ksvel%
		guicontrolget,SYSPOPD,,PRGINSTLBX
		gosub, DApp
		guicontrol, hide,ROMDTXT
		guicontrol, hide,ROMDEDT
		Loop,parse,PSETCFGITEMS,|
			{
				guicontrol,hide,%A_LoopField%
			}
		guicontrol,show,EMUPGC
		return
	}
awr := Object()
Loop, %noselb0%
	{
		new= % (noselb%a_index%)
		if (noselb%a_index% <> "")
			{
				awr.insert(new)
			}
	}
nigb:= semu
noini=
for k, v in awr
	{
		extm:= v
		if (nigb = extm)
			{
				noini= 1
				guicontrol,hide,LOCEMUIN
				guicontrol,hide,OEMUDEL
				guicontrol,hide,OEMUSV
				guicontrol,hide,OEMUNICK
				guicontrol,hide,OEMUTXT
				guicontrol,hide,EINSTTXT
				guicontrol,hide,ChEmuInst
				guicontrol,hide,EINSTLOC
			}
	}
if (semu = "Xpadder")
	{
		guicontrol,enable,EMUASIGN
		IniRead, kmprt, Settings.ini,GLOBAL,Keymapper
		if (kmprt = "Xpadder")
			{
				guicontrol,,EMUASIGN,1
			}
		guicontrol,show,EMUASIGN
		guicontrol,,EMUASIGN,Default Keymapper
	}
if (semu = "Antimicro")
	{
		guicontrol,enable,EMUASIGN
		IniRead, kmprt, Settings.ini,GLOBAL,Keymapper
		if (kmprt = "Antimicro")
			{
				guicontrol,,EMUASIGN,1
			}
		guicontrol,show,EMUASIGN
		guicontrol,,EMUASIGN,Default Keymapper
	}
ifinstring,noinstallers,%PRGINSTLBX%
	{
		guicontrol,disable,CHEMUINST
		guicontrol,disable,EMUINST
		guicontrol,disable,INSTEMUDDL
	}
return

SYSINSTLBX:
gui, submit, nohide
xtractmu=
MULTICHK=
MULTISYS=
ENABLE_SYSINST=
sleep,240
guicontrolget,SYSGOT,,SYSINSTLBX
if (SYSGOT = prev_sys)
	{
		return
	}
guicontrol,,ADDCORE,|%SYSINSTLBX%||
guicontrol,,EMUASIGN,Assign to System
guicontrol,,EMUINST,Install
guicontrol,,EINSTLOC
guicontrol,,EMPRLST,|
guicontrol,,EMPRDDL,|Emulators|%runlist%
GuiControl,,EMUASIGN,1
Loop, Parse, SYSGOT,|
	{
		MULTICHK+=1
		if (MULTICHK = 2)
			{
				reasign= %multiemu%
				break
			}
	}
if (MULTICHK = 2)
	{
		MULTISYS= 1
		gosub, AppSetReset
		guicontrol,,ADDCORE,|MULTISYSTEM||
		gosub, DApp
		Loop,Parse,SYSINSTITEMS,|
			{
				guicontrol,show,%A_LoopField%
			}
		guicontrol,,ROMDEDT,
		return
	}
gosub, AppSetReset
IniRead,ksiv,Assignments.ini,OVERRIDES,%SYSGOT%
if (ksiv = "ERROR")
	{
		ksiv= 
	}
guicontrol,,EMPRLST,|%ksiv%
LineNum=
selfnd=
stemu=
stemu1=
stemu2=
stemu3=
stemu4=
stemu5=
emuplst=
iniread,asiu,emuCfgPresets.ini,%SYSGOT%,SUPEMU
Loop,parse,asiu,|
	{
		stemu%A_index%= %A_LoopField%
		emuplst.= A_LoopField . "|"
	}
selfnd= %stemu1%
guicontrol,,INSTEMUDDL,|%selfnd%||%emuplst%%emuinstpop%Other
iniread,kfr,SystemLocations.ini,LOCATIONS,%SYSGOT%
iniread,jkj,Apps.ini,EMULATORS,%selfnd%
if ((jkj <> "")&&(jkj <> "ERROR"))
	{
		guicontrol,,EINSTLOC,%jkj%
	}
if (kfr = "ERROR")
	{
		kfr= 
	}
guicontrol,,ROMDEDT,|%kfr%
if (salist = "Systems")
	{
		Loop,Parse,sysselitems,|
			{
				guicontrol,hide,%A_LoopField%
			}
		Loop,Parse,SYSINSTITEMS,|
			{
				guicontrol,show,%A_LoopField%
			}
	}
guicontrol,show,EMUINST
ENABLE_SYSINST.= "|EMBUTV|EMCHKW|EMDDLF|EMBUTG|EMDDLP|EMBUTH|DSKMNTCHK|ROMDLOC|INSTEMUDDL|ADDCORE|EMUASIGN|ROMDLOC|LOCEMUIN|EMUINST|INSTEMUDDL|CHEMUINST|EMPRLST|EMPRBUTA|EMPRDDL|EMPRBUTU|EMPRBUTX|DELCFGPGC"
loop,parse,enable_sysinst,|
	{
		GUICONTROL,enable,%A_loopField%
	}
prev_sys= %SYSGOT%
return

MultInst:
gui, submit, nohide
guicontrolget,selfnd,,INSTEMUDDL
guicontrolget,EINSTLOC,,EINSTLOC
guicontrolget,SYSGOTS,,SYSINSTLBX
if (EINSTLOC = "")
	{
		iniread,EINSTLOC,apps.ini,EMULATORS,%selfnd%
		guicontrol,,EINSTLOC,%EINSTLOC%
	}
guicontrolget,APPOPT,,APPOPT
guicontrolget,OVRKND,,SYSNICK
guicontrolget,APPARG,,APPARG
guicontrolget,EMUPGC,,EMUPGC
guicontrolget,LRUN,,LRUN
guicontrolget,NOEXTN,,NOEXTN
guicontrolget,OMITQ,,OMITQ
guicontrolget,EXTARUN,,EXTARUN
guicontrolget,OMITPTH,,OMITPTH
splitpath,EINSTLOC,EINSTFNM,EINSTDIR,EINSTX,EINSTNAM
if (EINSTX = "exe")
	{
		emuxe:= EINSTFNM
	}
guicontrol,,EINSTLOC,%EINSTDIR%\%emuxe%
GuiControl,,EMUASIGN,1
Loop, Parse, SYSGOTS,|
	{
		OVRKND=
		SYSGOT:= A_LoopField
		gosub, MultiAssign
		gosub, ResetEmuList
		gosub, SYSINSTLBX
	}
Loop,parse,EMUINSTITEMS,|
	{
		guicontrol,enable,%A_LoopField%
	}	
return

EmuInst:
gui,submit,nohide
Loop,parse,EMUINSTITEMS,|
	{
		guicontrol,disable,%A_LoopField%
	}
guicontrolget,INSTLTYP,,SaList
guicontrolget,selfnd,,INSTEMUDDL
guicontrolget,SYSINSTLBX,,SYSINSTLBX
guicontrolget,EINSTLOC,,EINSTLOC
guicontrolget,EmuAsign,,EmuAsign
if ((EINSTLOC <> "")&&(INSTLTYP = "Systems"))
	{
		goto, MultiSys
		sb_settext(" MultiSys ")
	}
urlprfx= %repoloc%
if (selfnd = "")
	{
		Loop,parse,EMUINSTITEMS,|
			{
				guicontrol,enable,%A_LoopField%
			}
		return
	}
Guicontrol, show, EMUINSC
EMURJINT:
emufzd= 
iniread,urlloc,EmuCfgPresets.ini,%selfnd%,URLPTH
stringsplit,urloc,urlloc,<
Loop,Parse,AllPartSet,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		urloc=
		urloc1=
		urloc2=
		cplstr= %A_LoopField%
		stringsplit,slfm,A_LoopField,<
		stringsplit,urloc,slfm2,/
		if (slfm1 = selfnd)
			{
				emufzd= 1
				URLFILE= %repoloc%/%urloc1%/%urloc2%
				ifinstring,repoloc,github
					{
						URLFILE= %repoloc%/%urloc1%/raw/master/%urloc2%
					}
				sb_settext(" " URLFILE " ")
				save=%cacheloc%\%urloc2%
				if (instr(slfm2,"http:")or instr(slfm2,"https:"))
					{
						URLFILE= %slfm2%
						Loop, %urloc0%
							{
								aef= % urloc%A_Index%
								URLFNM= %aef%
							}
						urloc2= %URLFNM%
						urloc1= %selfnd%
						save=%cacheloc%\%URLFNM%.7z
						sb_settext(" " URLFILE " save file is " save "")
					}
				if ((selfnd = "Daemon_Tools")or(selfnd = "XInput_Drivers")or(selfnd = "Visual_C++_Runtimes")or(selfnd = "DirectX"))
					{
						xtractmu= %cacheloc%
					}
				if (xtractmu = "")
					{
						xtractmu= %RJEMUD%\%selfnd%
					}
				splitpath,save,svaf,svap
				rtrcnt= 
				origurl= %URLFILE%
				EMUDOWNLOADING:
				exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
				if (rjintr = 1)
					{
						KARC= 1
						rjintr= 2
					}
				ifnotexist, %save%
					{
						rjintr= x
						msgbox,8452,, %urloc1%`n''%URLFILE%''`n was not downloaded`nretry?, 20
						ifmsgbox,yes
							{
								rtrcnt+= 1
								Loop,parse,ALTHOST,>
									{
										if (A_Index = rtrcnt)
											{
												stringreplace,URLFILE,origurl,repoloc,%A_LoopField%,All
												break
											}
										rtrcnt= 
										URLFILE= %origurl%	
									}
								goto,EMUDOWNLOADING
							}
						GuiControl, hide, EMUINSC
						guicontrol,,ADDCORE,|Select_A_System||
						break
					}
				if (rjintr = 2)
					{
						Loop,parse,EMUINSTITEMS,|
							{
								guicontrol,enable,%A_LoopField%
							}

						return
					}
				gosub, XTRACTEMU
				if (XTRACTFAIL = 1)
					{
						rjintr= x
						SB_SetText(" " urloc1 " could not be installed.")
						GuiControl, hide, EMUINSC
						Loop,parse,EMUINSTITEMS,|
							{
								guicontrol,enable,%A_LoopField%
							}
						return
					}
				if ((rjintr = 1) or (rjintr = "x"))
					{
						rjintr=
						GuiControl, hide, EMUINSC
						Loop,parse,EMUINSTITEMS,|
							{
								guicontrol,enable,%A_LoopField%
							}
						return
					}
				fSYSINSTLBX= 
					{
						emuxetmp1=
						emuxetmp2=
						emuxetmp3=
						emuxetmp4=
						emuxetmp5=
						emuxetmp6=
						StringSplit,emuxetmp,A_LoopField,<,:
						if (emuxetmp1 = slfm1)
							{
								xtractmfp= %xtractmu%\%emuxetmp3%
							}
					}
				guicontrol,,EINSTLOC,%xtractmfp%
				guicontrolget,INSTLTYP,,SaList
				if (INSTLTYP = "Frontends")
					{	
						if (instr(fesup,slmf1)&& !instr(fSYSINSTLBX,slmf1))
							{
								Menu, rjscopy, Add, Export to %slfm1%, Export_%slfm1%
								fSYSINSTLBX.= slfm1 . "|"
							}
						iniwrite, "%xtractmfp%",apps.ini,FRONTENDS,%slfm1%
					}
				if (INSTLTYP = "Utilities")
						{
						inisect= UTILITIES
						if (selfnd = "DirectX")
							{
								RunWait,%comspec% /c "%cacheloc%\DirectX\dxwebsetup.exe" /c:"DXwSetup.exe /windowsupdate" /q /r:n,%cacheloc%,hide
								xtractmfp= Installed
							}
						if (selfnd = "Visual_C++_Runtimes")
							{
								RunWait,%comspec% /c "%cacheloc%\allvcs\install.bat",%cacheloc%,hide
								xtractmfp= Installed										
							}
						if (selfnd = "Xinput_Drivers")
							{
								RunWait,%comspec% /c "%cacheloc%\Xinput_Drivers\XBox360_%ARCH%.exe" /q:a,%cacheloc%,hide
								xtractmfp= Installed
							}
						if (selfnd = "vigembus")
							{
								RunWait,%comspec% /c "%cacheloc%\vigembus\Xinput_Drivers.exe" /exenoui /qn,%cacheloc%,hide
								xtractmfp= Installed
							}
						if (selfnd = "Xpadder")
							{
								inisect= KEYMAPPERS
							}
						if (selfnd = "DisplayChanger")
							{
								DCHANGER= %xtractmfp%
							}
						if (selfnd = "Daemon_Tools")
							{
								DAMZIL= %xtractmfp%
								gosub, INST_Daemon_Tools
							}
						if (selfnd = "Antimicro")
							{
								inisect= KEYMAPPERS
							}
					iniwrite, "%xtractmfp%",apps.ini,%inisect%,%slfm1%
					}
				if (INSTLTYP = "Emulators")
					{
						inisect= EMULATORS
						iniwrite, "%xtractmfp%",apps.ini,%inisect%,%slfm1%
						iniwrite, "%xtractmfp%",Assignments.ini,ASSIGNMENTS,%slfm1%
						ifnotinstring,emulist,%slfm1%
							{
								emulist.= urloc1 . "|"
							}
						ifnotinstring,addemu,|%slfm1%
							{
								addemu.= "|" . urloc1
							}
						gosub, RBLDRUNLST	
						guicontrol,,EMPRDDL,|%runlist%
					}
				OVRKND=
				emuxe=
				emuprt1=
				emuprt2=
				emuprt3=
				emuprt4=
				iniread,emuxe,EmuCfgPresets.ini,%slfm1%,EXENAM
				Loop, Parse, EmuPartSet,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						StringSplit,emuprt,A_LoopField,<,:
						if (emuprt1 = slfm1)
							{
								emuxe= %emuprt3%
								OVRKND= %emuprt1%
								iniwrite, "%xtractmu%\%emuxe%",apps.ini,EMULATORS,%slfm1%
								ifnotinstring,preEmuCfg,%slfm1%
									{
										preEmuCfg.= slfm1 . "|"
									}
								guicontrol,,EMPRDDL,|%slfm1%||%runlist%
								gosub, EMPRBUTASPLIT
								iniwrite, "%xtractmu%\%emuxe%",Assignments.ini,ASSIGNMENTS,%OVRKND%
								break
							}
					}
				gosub, ResetRunList
				gosub, ResetEmuList
				guicontrol,,LCORE,|%runlist%
				guicontrol,,PLCORE,|%lastcore%||%runlist%
				reasign .= semu . "|"
				ADDCORE:= semu
				guicontrol,,ADDCORE,|%semu%||
				SB_SetText(" ")
				gosub, DApp
				Guicontrol, ,DWNPRGRS, 0
				guicontrol,,EMPRLST,|%EMPRLT%
				ifinstring,selfnd,MAME
					{
						ifnotinstring,addemu,mame_system
							{
								addemu.= "|" . "mame_arcade"
								iniwrite,"%xtractmfp%",Assignments.ini,ASSIGNMENTS,mame_arcade
							}
						ifnotinstring,addemu,mame_system
							{
								addemu.= "|" . "mame_system"
								iniwrite,"%xtractmfp%",Assignments.ini,ASSIGNMENTS,mame_system
							}
						splitpath,xtractmfp,,mamevpth
						filecreateDir,%mamevpth%\roms
						ifnotexist,lm.ini
							{
								gosub, MAMETOG
							}
					}
				break
			}
	}	
if (emufzd = "")
	{
		SB_SetText(" " selfnd " not found")
		Loop,parse,EMUINSTITEMS,|
			{
				guicontrol,enable,%A_LoopField%
			}
		return
	}
	else {
		SB_SetText(" " selfnd " installed")
	}
if ((INSTLTYP = "Emulators")&&(EMUAUTOA = 1))
	{
		stranb= %selfnd%
		gosub, EmuIterA
		SB_SetText("assigned " stranb "to supported systems detected")
	}
if (INSTLTYP = "Systems")
	{
		iniwrite, "%xtractmfp%",apps.ini,EMULATORS,%selfnd%
		iniwrite, "%xtractmfp%",Assignments.ini,ASSIGNMENTS,%selfnd%
		iniread,supemu,emuCfgPresets.ini,%SYSINSTLBX%,SUPEMU
		if (EmuAsign = 1)
			{
				if ((supemu = "")or(supemu = "ERROR"))
					{
						supemu= %selfnd%
					}
				fndsy= %selfnd%	
				noead= 
				rewr= 
				selxt=
				Loop,parse,supemu,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						if (A_LoopField = selfnd)
							{
								iniread,ceurmu,Assignments.ini,OVERRIDES,%SYSINSTLBX%
								if (ceurmu = "")
									{
										rewr= %selfnd%|
										iniwrite, "%rewr%",Assignments.ini,OVERRIDES,%SYSINSTLBX%
										break
									}
									else {
										Loop,parse,ceurmu,|
											{
												if (A_LoopField = "")
													{
														continue
													}
												if (selfnd = A_LoopField)
													{
														selxt= 1
														rewr.= A_LoopField . "|"
														continue
													}
												rewr.= A_LoopField . "|"
											}
									}
										if (selxt <> 1)
											{
												rewr:= selfnd . "|" . rewr
											}
										iniwrite, "%rewr%",Assignments.ini,OVERRIDES,%SYSINSTLBX%
							}
					}
			}
	}
ifinstring,selfnd,MAME
	{
		ifnotinstring,addemu,mame_system
			{
				addemu.= "|" . "mame_arcade"
				iniwrite,"%xtractmfp%",Assignments.ini,ASSIGNMENTS,mame_arcade
			}
		ifnotinstring,addemu,mame_system
			{
				addemu.= "|" . "mame_system"
				iniwrite,"%xtractmfp%",Assignments.ini,ASSIGNMENTS,mame_system
			}
		splitpath,xtractmfp,,mamevpth
		filecreateDir,%mamevpth%\roms
		ifnotexist,lm.ini
			{
				gosub, MAMETOG
			}
	}
ifinstring,selfnd,retroarch
	{
		raexeloc= %xtractmfp%
		splitpath,raexeloc,RaExeFile,raexedir
		gosub, resetCORES
	}
gosub, RBLDRUNLST
gosub, ResetEmuList
reasign .= semu . "|"
GuiControl,,ADDCORE,|Select_A_System||
Guicontrol, ,DWNPRGRS, 0
GuiControl, hide, EMUINSC
if (EMUASIGN = 1)
	{
		if (MULTISYS = 1)
			{
				goto, MultInst
			}
	}	
if (salist = "EMULATORS")
	{
		gosub, PRGINSTLBX	
	}
iniread,reqbios,EmuCfgPresets.ini,%selfnd%,BIOS
if (reqbios <> "")
	{
		SB_SetText("installing bios files")
		kbrmu= %selfnd%
		gosub,BiosProcx
	}
if (salist = "SYSTEMS")
	{
		prev_sys= 
		gosub, SYSINSTLBX	
	}
Loop,parse,EMUINSTITEMS,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

MultiSys:
EmuAsign:
gui, submit, nohide
guicontrolget,EMUASIGN,,EMUASIGN
guicontrolget,PRGINSTLBX,,PRGINSTLBX
EINSTLOC=
OVRKND=
guicontrolget, EINSTLOC,, EINSTLOC
if ((PRGINSTLBX = "Emulators")&& fileExist(ksvel))
	{
		guicontrol,,EMUINST,Assign
	}
if (PRGINSTLBX = "Antimicro")
{
		if (EMUASIGN = 1)
			{
				iniwrite, "Antimicro",Settings.ini,GLOBAL,Keymapper
			}
	}
if (PRGINSTLBX = "Xpadder")
	{
		if (EMUASIGN = 1)
			{
				iniwrite, "Xpadder",Settings.ini,GLOBAL,Keymapper
			}
	}
if (EINSTLOC <> "")
	{
		if (EMUASIGN = 1)
			{
			}
		splitpath,EINSTLOC,emutfpx,,,selfnd
		Loop, Parse,AllPartSet,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				emuprt1=
				emuprt2=
				emuprt3=
				emuprt4=
				StringSplit,emuprt,A_LoopField,<,:
				if (emuprt3 = emutfpx)
					{
						emuxe= %emuprt3%
						OVRKND= %emuprt1%
						break
					}
			}
	}
Loop,parse,EMUINSTITEMS,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

MultLnk:
gui,submit,nohide
return

UniqLnk:
gui,submit,nohide
gosub, AppParamPop
return

EMPREW:
return

EMPOSTW:
return

EMDDLF:
gui,submit,nohide
guicontrolget,EMDDLF,,EMDDLF
CMDRO= EMPREOPT
CMDRT= EMPRERUN
CMDRS= EMPREW
if (EMDDLF = "Post-Command")
	{
		CMDRO= EMPOSTOPT
		CMDRT= EMPOSTRUN
		CMDRS= EMPOSTW
	}
IniRead, ADDFN,AppParams.ini,%sysni%,%CMDRT%
guicontrol,,EMDDLP,|%ADDFN%
return

EMCHKW:
gui,submit,nohide
IniRead, EMSTV,AppParams.ini,%sysni%,%CMDRS%
guicontrolget,EMCHKW,,EMCHKW
guicontrolget,EMDDLP,,EMDDLP
nvar1=
nvar2=
stringsplit,nvar,EMDDLP,>
optn= %nvar2%
avar=
apndtyp=
Loop, Parse, EMSTV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		avar+=1
		if (avar = optn)
			{
				avar+=1
				apndtyp.= EMCHKW . "|"
				continue
			}
		apndtyp.= A_LoopField . "|"
	}
if (apndtyp = "")
	{
		apndtyp= %EMCHKW%
	}
IniWrite, %apndtyp%,AppParams.ini,%sysni%,%CMDRS%
EMSTV= %apndtyp%
return

EMBUTV:
gui,submit,nohide
guicontrolget,EMDDLP,,EMDDLP
if (EMDDLP = "")
	{
		SB_SetText("No command currently selected")
		return
	}
ADDTMP=
FileSelectFIle,ADDTMP,1,,Select An executable or script
if (ADDTMP = "")
	{
		return
	}
nvar1=
nvar2=
stringsplit,nvar,EMDDLP,>
stringreplace, ADDFN,ADDFN,%EMDDLP%,%ADDTMP%>%nvar2%,All
EMDDLP= %ADDTMP%>%nvar2%
guicontrol,,EMDDLP,|%EMDDLP%||%ADDFN%
return

EMBUTG:
gui,submit,nohide
ADDFT=
ADDAK=
prepnd=
FileSelectFile,ADDFT,1,,Select An executable or script
if (ADDFT = "")
	{
		return
	}
IniRead, EMOPV,AppParams.ini,%sysni%,%CMDRO%
IniRead, ADDFN,AppParams.ini,%sysni%,%CMDRT%
IniRead, EMSTV,AppParams.ini,%sysni%,%CMDRS%
guicontrolget,EMDDLP,,EMDDLP
nvar1=
nvar2=
stringsplit,nvar,EMDDLP,>
optn= %nvar2%
if (nvar2 = "")
	{
		optn=
		NEWFN=
		if (ADDFN <> "")
			{
				cnttot= 100
				cntdwn= 99
				curadd= 1
				Loop, 99
					{
						cnttot-=1
						cntdwn-=1
						stringreplace,ADDFN,ADDFN,>%cntdwn%,>%cnttot%,All
					}
				NEWFN.= ADDFT . ">" . "1" . "|" . ADDFN
				ADDAK= %NEWFN%
				prepnd= 1
			}
	}
if (prepnd = 1)
	{
		goto, emprepost
	}
adnm=
curadd=
Loop, Parse, ADDFN,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		nvar1=
		nvar2=
		stringsplit,nvar,A_LoopField,>
		adnm+=1
		if (adnm = optn)
			{
				curadd:= adnm+1
				ADDAK.= nvar1 . ">" . adnm . "|" . ADDFT . ">" . curadd . "|"
				adnm+=1
				continue
			}
		ADDAK.= nvar1 . ">" . adnm . "|"
	}
if (adnm = "")
	{
		IniWrite,%ADDFT%>1,AppParams.ini,%sysni%,%CMDRT%
		IniWrite,:,AppParams.ini,%sysni%,%CMDRO%
		IniWrite,%EMCHKW%,AppParams.ini,%sysni%,%CMDRS%
		guicontrol,,EMDDLP,|%ADDFT%>1|| |
		optn= 1
		return
	}
if (optn = "")
	{
		ADDAK= %ADDFT%>1
	}
emprepost:
guicontrol,,EMCHKW,0
Sort,ADDAK,N D>
guicontrol,,EMDDLP,|%ADDFT%>%curadd%||%ADDAK% |
IniWrite, %ADDAK%,AppParams.ini,%sysni%,%CMDRT%
opvn=
curovn=
EMEDTNX=
if (optn = "")
	{
		EMEDTNX.= ":" . "|" . EMOPV
	}
if (optn <> "")
	{
		Loop, Parse, EMOPV,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				opvn+=1
				if (opvn = optn)
					{
						opvn+=1
						curovn:= opvn
						EMEDTNX.= A_LoopField . "|" . ":" . "|"
						continue
					}
				EMEDTNX.= A_LoopField . "|"
			}
	}
EMOPV= %EMEDTNX%
IniWrite, %EMEDTNX%,AppParams.ini,%sysni%,%CMDRO%
EMSTX=
opvn=
if (optn = "")
	{
		EMSTX.= EMCHKW
	}
if (optn <> "")
	{
		Loop, Parse, EMSTV,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				opvn+=1
				if (opvn = optn)
					{
						opvn+=1
						EMSTX.= A_LoopField . "|" . "0" . "|"
						continue
					}
				EMSTX.= A_LoopField . "|"
			}
	}
IniWrite, %EMSTX%,AppParams.ini,%sysni%,%CMDRS%
return

EMDDLP:
gui,submit,nohide
IniRead,EMSTV,AppParams.ini,%sysni%,%CMDRS%
IniRead,EMOPV,AppParams.ini,%sysni%,%CMDRO%
guicontrolget,EMDDLP,,EMDDLP
ADDFT=
ADDAK=
optn=
optk=
nvar1=
nvar2=
stringsplit,nvar,EMDDLP,>
optn= %nvar2%
Loop, Parse, ADDFN,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		optk+=1
	}
optv=
Loop, Parse, EMSTV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		optv+=1
		if (optv = optn)
			{
				guicontrol,,EMCHKW,%A_LoopField%
				break
			}
	}
return

EMBUTH:
ADDFW=
ADDFK=
ADDFO=
prepnd=
guicontrolget,GETFRM,,EMDDLP
IniRead, EMOPV,AppParams.ini,%sysni%,%CMDRO%
IniRead, ADDFN,AppParams.ini,%sysni%,%CMDRT%
IniRead, EMSTV,AppParams.ini,%sysni%,%CMDRS%
if (GETFRM = "")
	{
		SB_SetText("No command selected")
		return
	}
nvar1=
nvar2=
stringsplit,nvar,GETFRM,>
optn= %nvar2%
if (nvar2 = "")
	{
		return
	}
newnm=
Loop, Parse, ADDFN,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		nvar1=
		nvar2=
		stringsplit,nvar,A_LoopField,>
		if (nvar2 = optn)
			{
				continue
			}
		newnm+=1
		ADDFK.= nvar1 . ">" . newnm . "|"
	}
newnm=
Loop, Parse, EMOPV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		newnm+=1
		if (newnm = optn)
			{
				continue
			}
		ADDFO.= A_LoopField . "|"
	}
newnm=
Loop, Parse, EMSTV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		newnm+=1
		if (newnm = optn)
			{
				continue
			}
		ADDFW.= A_LoopField . "|"
	}
ADDFN= %ADDFK%
EMOPV= %ADDFO%
EMSTV= %ADDFW%
guicontrol,,EMCHKW,0
guicontrol,,EMDDLP,|%ADDFN%| |
IniWrite, %ADDFK%,AppParams.ini,%sysni%,%CMDRT%
IniWrite, %ADDFO%,AppParams.ini,%sysni%,%CMDRO%
IniWrite, %ADDFW%,AppParams.ini,%sysni%,%CMDRS%
return

InstEmuDDL:
gui,submit,nohide
EINSTLOC=
guicontrol,,EINSTLOC,
guicontrol,show,EMUINST
guicontrol,show,CHEMUINST
guicontrol,show,EMUASIGN
guicontrol,show,LOCEMUIN
guicontrol, hide,OEMUDEL
guicontrol, hide,OEMUSV
guicontrol, hide,OEMUNICK
guicontrol, hide,OEMUTXT
guicontrolget,selfnd,,INSTEMUDDL
guicontrol, disable,OEMUDEL
guicontrol, disable,OEMUSV
guicontrol, disable,OEMUNICK
gosub, ChkMu
if (selfnd = "Other")
	{
		OEMUNICK=
		guicontrol,hide,EMUINST
		guicontrol,hide,CHEMUINST
		guicontrol,hide,EMUASIGN
		guicontrol,hide,MULTINST
		guicontrol, show,OEMUDEL
		guicontrol, show,OEMUSV
		guicontrol, show,OEMUNICK
		guicontrol, show,OEMUTXT
		exintmp=
		guicontrolget,exintmp,,EINSTLOC
		if (exintmp <> "")
			{
				guicontrol, enable,OEMUDEL
				guicontrol, enable,OEMUSV
				guicontrol, enable,OEMUNICK
			}
	}
return

EmuLkup:
emuxe= 
emumatch= 
Loop, Parse,AllPartSet,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			} 
		emupts1=
		emupts2=
		emupts3=
		emupts4=
		StringSplit,emupts,A_LoopField,<,:
		StringSplit,emupg,emupts2,/
		if (emupts1 = selfnd)
			{
				emupth= %emupg1%
				emuxe= %emupts3%
				emumatch= 1
				break
			}
	} 
return

ChkMu:
loop,parse,AllPartSet,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,aen,A_LoopField,</
		if (aen1 = selfnd)
			{
				pthloc= %aen2%
			}
		break
	}
ifexist, %RJEMUD%\%selfnd%\
	{
		gosub,EmuLkup
		SB_SetText(" " selfnd " is installed --- ")
		guicontrol,,EINSTLOC,%RJEMUD%\%selfnd%\%emuxe%
	}
ifexist,%selfnd%*.7z
	{
		guicontrol,,EMUINST,Initialize
	}
ASREP= Apps
if (SALIST = "Utilities")
	{
		ASREX= Utilities
		if (curtxt = "Xpadder")
			{
				ASREX= KEYMAPPERS
			}
		if (curtxt = "Antimicro")
			{
				ASREX= KEYMAPPERS
			}
	}
if (SALIST = "Frontends")
	{
		ASREX= FRONTENDS
	}
if (SALIST = "Emulators")
	{
		ASREX= Assignments
	}
iniread,avar,%ASREP%.ini,%ASREX%,
oemum=
if ((avar = "ERROR")or(avar = ""))
	{		
		iniread,nplcmx,sets\EmuParts.set,%ASREX%,%semu%
		if ((nplcmx <> "")&&(nplcmx <> "ERROR"))
			{
				stringsplit,fjei,nplcmx,<
				if (emumatch = 1)
					{
						ifexist,%RJEMUD%\%semu%\%fjei2%
							{
								sefnr= %RJEMUD%\%semu%\%fjei2%
								iniwrite,"%RJEMUD%\%semu%\%fjei2%",%ASREP%.ini,%ASREX%,%semu%
								SB_SetText(" " selfnd " is installed - ")
								guicontrol,,EINSTLOC,%RJEMUD%\%semu%\%fjei2%
							}
					}
			}
	}
Loop, Parse, avar,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		nplc1=
		nplc2=
		stringsplit,nplc,A_LoopField,=,"
		;"
		if (nplc2 = "")
			{
				continue
			}
		if (nplc1 = semu)
			{
				iniread,sefnr,%ASREP%.ini,%ASREX%,%semu%
				if ((sefnr = "ERROR")&&(nplc2 <> ""))
					{
						sefnr= %nplc2%
					}
				nple=
				npld=
				nplx=
				SplitPath,sefnr,nple,npld,nplx,npln
				if (nplx <> "dll")
					{
						Loop, Parse, AllPartSet,`n`r
							{
								if (A_LoopField = "")
									{
										continue
									}
								emuprt1=
								emuprt2=
								emuprt3=
								StringSplit,emuprt,A_LoopField,<
								splitpath,emuprt3,nexv
								if (nexv = nple)
									{
										if (aimt = sefnr)
											{
												SB_SetText(" " selfnd " is installed - ")
												guicontrol,,EINSTLOC,%npld%\%nple%
											}
										return
									}
							}
						guicontrol,hide,EMUINST
						guicontrol,hide,EMUASIGN
						guicontrol,hide,CHEMUINST
						guicontrol,hide,EINSTTXT
						iniread,aimt,Apps.ini,EMULATORS,%semu%
						SB_SetText(" " npln " is installed -- ")
						guicontrol,,EINSTLOC,%npld%\%nple%
						oemum:= nplc2
						guicontrol,,INSTEMUDDL,|Other||%emuinstpop%
						IniRead, xemt, apps.ini,EMULATORS
						guicontrol, show,OEMUDEL
						guicontrol, enable,OEMUDEL
						guicontrol, show,OEMUSV
						guicontrol, enable,OEMUSV	
						guicontrol, show,OEMUNICK
						guicontrol, enable,OEMUNICK
						guicontrol, show,OEMUTXT
					}
				Loop, Parse, xemt,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
					armm1=
						armm2=
						StringSplit,armm,A_LoopField,=,"
						;"
						if (armm2 = oemum)
							{
								guicontrol,,OEMUNICK,|%armm1%||%emulist%
							}
					}
			}
	}
return

EMPRDDL:
gui,submit,nohide
guicontrolget,EMPRDDL,,EMPRDDL
return

EmuItera:
SB_SetText("Assigning "  stranb " to supported systems")
Loop,parse,systmfldrs,|
	{
		iniread,supemu,emuCfgPresets.ini,%A_LoopField%,SUPEMU
		if ((supemu = "")or(supemu = "ERROR"))
			{
				continue
			}
		fndsy= %A_LoopField%	
		noead= 
		rewr= 
		Loop,parse,supemu,|
			{
				if (A_LoopField = selfnd)
					{
						if (A_LoopField = "")
							{
								continue
							}
						iniread,ceurmu,Assignments.ini,OVERRIDES,%fndsy%
						Loop,parse,ceurmu,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								if (A_LoopField = stranb)
									{
										noead= 1
									}
								rewr.= A_LoopField . "|"
							}
						if (noead = "")
							{
								rewr.= stranb . "|"
							}
						iniwrite, "%rewr%",Assignments.ini,OVERRIDES,%fndsy%
					}
			}
	}
return

EMPRLST:
gui,submit,nohide
guicontrolget,emprcur,,EMPRLST
ControlGet, ksiv, List, , , ahk_id %prisl%
stringreplace,ksiv,ksiv,`n|,All
stringleft,ksichk,ksiv,1
if (ksichk = "|")
	{
		stringtrimleft,ksiv,ksiv,1
	}
stringright,ksichk,ksiv,1
if (ksichk = "|")
	{
		stringtrimright,ksiv,ksiv,1
	}
if (emprcur = "")
	{
		return
	}
ifinstring,emprcur,_libretro.dll
	{
		emprcur=
		Loop,parse,systm_hide,|
			{
				guicontrol,hide,%A_LoopField%
			}
	}	
	else {		
		Loop,parse,systm_cfg,|
			{
				guicontrol,show,%A_loopField%
			}

	}
guicontrol,,SYSNICK,|%emprcur%||%preEmuCfg%
gosub, SYSNICK
return

EMPRBUTA:
gui,submit,nohide
guicontrolget,semu,,SYSINSTLBX
if (semu = "")
	{
		guicontrolget,semu,,ADDCORE
	}
EMPRBUTASPLIT:
guicontrolget,EMPRDDL,,EMPRDDL
iniread,ksiv,Assignments.ini,OVERRIDES,%semu%
if (ksiv = "ERROR")
	{
		ksiv= 
	}
stringleft,ksichk,ksiv,1
if (ksichk = "|")
	{
		stringtrimleft,ksiv,ksiv,1
	}
stringright,ksichk,ksiv,1
if (ksichk = "|")
	{
		stringtrimright,ksiv,ksiv,1
	}
jsiv= %ksiv%
if (EMPRDDL = "Emulators")
	{
		return
	}
if (semu = "")
	{
		return
	}
EMPRLT= %EMPRDDL%|
jsiv= 
Loop, parse, ksiv,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = EMPRDDL)
			{
				continue
			}
		jsiv.= A_LoopField . "|"
		ifnotinstring,EMPRLT,%A_LoopField%|
			{
				EMPRLT.= A_LoopField . "|"
			}
	}	
if (EMUASIGN = 1)
	{
		iniwrite,"%EMPRLT%",Assignments.ini,OVERRIDES,%semu%
		guicontrol,,EMPRLST,|%EMPRLT%
	}		
else {
		jsiv.= EMPRDDL . "|"
		EMPRLT= %jsiv%
		iniwrite,"%jsiv%",Assignments.ini,OVERRIDES,%semu%
		guicontrol,,EMPRLST,|%jsiv%
}	
iniread,trmb,AppParams.ini,%semu%
if ((trmb <> "ERROR")&&(trmp <> ""))
	{
		guicontrol,,SYSNICK,|%semu%||%runlist%
		gosub, sysnick
	}
else, {
		iniread,trmb,sets\AppParams.set,%semu%
			{
				if ((trmb <> "ERROR")&&(trmp <> ""))
					{
						guicontrol,,SYSNICK,|%semu%||%runlist%
						goto, sysnick
					}
			}
		iniwrite, " ",AppParams.ini,%semu%,options
		iniwrite, "",AppParams.ini,%semu%,arguments
		iniwrite, "0",AppParams.ini,%semu%,extension
		iniwrite, "0",AppParams.ini,%semu%,per_game_configurations
		iniwrite, "0",AppParams.ini,%semu%,no_quotes
		iniwrite, "0",AppParams.ini,%semu%,no_path
		iniwrite, "0",AppParams.ini,%semu%,run_location
		iniwrite, "",AppParams.ini,%semu%,EMPOSTOPT
		iniwrite, "",AppParams.ini,%semu%,EMPREOPT
		iniwrite, "",AppParams.ini,%semu%,EMPOSTRUN
		iniwrite, "",AppParams.ini,%semu%,EMPRERUN
		iniwrite, "",AppParams.ini,%semu%,EMPREW
		iniwrite, "",AppParams.ini,%semu%,EMPOSTW
		iniwrite, "0",AppParams.ini,%semu%,DSKMNTCHK
		iniwrite, "DaemonTools",AppParams.ini,%semu%,DSKMNTPRG
		iniwrite, "0",AppParams.ini,%semu%,DSKMNTOVR
		iniwrite, "0",AppParams.ini,%semu%,EXTARUN
}
return

EMPRBUTU:		
gui,submit,nohide
guicontrolget,emprcur,,EMPRLST
semu= %ADDCORE%
iniread,ksiv,Assignments.ini,OVERRIDES,%semu%
stringreplace,ksiv,ksiv,|||,|,All
stringreplace,ksiv,ksiv,||,|,All
if (ksiv = "ERROR")
	{
		ksiv= 
	}
stringleft,ksichk,ksiv,1
if (ksichk = "|")
	{
		stringtrimleft,ksiv,ksiv,1
	}
stringright,ksichk,ksiv,1
if (ksichk = "|")
	{
		stringtrimright,ksiv,ksiv,1
	}
if (emprcur = "")
	{
		return
	}
EMPRLT= %emprcur%|
Loop, parse, ksiv,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = emprcur)
			{
				continue
			}
		EMPRLT.= A_LoopField . "|"
	}
guicontrol,,EMPRLST,|%EMPRLT%
iniwrite,"%EMPRLT%",Assignments.ini,OVERRIDES,%semu%
iniwrite,"%emprcur%",Assignments.ini,ASSIGNMENTS,%semu%
return

DELCFGPGC:
gui,submit,nohide
guicontrolget,SYSINSTLBX,,SYSINSTLBX
if (SYSINSTLBX = "")
	{
		return
	}
Msgbox,3,Clean per-game configs,Would you like to delete all per-game configuration files for %SYSINSTLBX%?
ifmsgbox, Yes
	{
		SB_SetText("Deleting " SYSINSTLBX " per-game skeletonkey-configuration files")
		FileremoveDir,cfg\%SYSINSTLBX%,1
		FileCreateDir,cfg\%SYSINSTLBX%
		SB_SetText("")
	}
return

EMPRBUTD:
return

EMPRBUTX:
gui,submit,nohide
guicontrolget,emprcur,,EMPRLST
iniread,ksiv,Assignments.ini,OVERRIDES,%semu%
if (ksiv = "ERROR")
	{
		ksiv= 
	}
stringleft,ksichk,ksiv,1
if (ksichk = "|")
	{
		stringtrimleft,ksiv,ksiv,1
	}
stringright,ksichk,ksiv,1
if (ksichk = "|")
	{
		stringtrimright,ksiv,ksiv,1
	}
if (emprcur = "")
	{
		return
	}
EMPRLT=
newsemu=
Loop, parse, ksiv,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = emprcur)
			{
				continue
			}
		EMPRLT.= A_LoopField . "|"
	}
Loop, Parse, EMPRLT,|
	{
		if (A_Index = 1)
			{
				newsemu= %A_LoopField%
				break
			}
	}
guicontrol,,EMPRLST,|%EMPRLT%
if (newsemu = "")
	{
		EMPRLT= 0
	}
iniwrite,"%EMPRLT%",Assignments.ini,OVERRIDES,%semu%
iniwrite,"%newsemu%",Assignments.ini,ASSIGNMENTS,%semu%
guicontrol,,ADDNSYS,|
gosub,SvNick
guicontrol,,ADDNSYS,|%allsupport%
return

DSKMNTCHK:
gui,submit,nohide
guicontrolget,sysni,,SYSNICK
if (sysni = "")
	{
		guicontrol,,DSKMNTCHK,0
		return
	}
guicontrol,disable,DSKMNTDDL
guicontrol,disable,DSKSELBUT
guicontrol,disable,DSKMNTOVR
if (DSKMNTCHK = 1)
	{
		guicontrol,enable,DSKSELBUT
		guicontrol,enable,DSKMNTDDL
		guicontrol,enable,DSKMNTOVR
	}
iniwrite,"%DSKMNTCHK%",AppParams.ini,%sysni%,DSKMNTCHK
return

DSKMNTDDL:
gui,submit,nohide
guicontrolget,dskmntddl,,DSKMNTDDL
if (dskmntddl = "other")
	{
		dskmntprgtmp=
		FileSelectFIle,dskmntprgtmp,3,,Select a disk-mounting application
		if (dskmntprgtmp = "")
			{
				return
			}
		DSKMNTPRG= %dskmntprgtmp%
	}
iniwrite,"%DSKMNTPRG%",AppParams.ini,%sysni%,DSKMNTPRG
return

DSKSELBUT:
gui,submit,nohide
dskseltmp=
FileSelectFile,dskseltmp,3,,Select a Disk
if (dskseltmp = "")
	{
		guicontrol,,DSKMNTOVR,0
		guicontrol,disable,DSKSELBUT
		iniwrite,"0",AppParams.ini,%sysni%,DSKMNTOVR
		return
	}
DSKSELOVR= %dskseltmp%
iniwrite,"%DSKSELOVR%",AppParams.ini,%sysni%,DSKMNTOVR
return

DSKMNTOVR:
gui,submit,nohide
guicontrol,disable,DSKSELBUT
if (DSKMNTOVR = 1)
	{
		guicontrol,enable,DSKSELBUT
		goto, DSKSELBUT
	}
return

LocEmuIn:
gui,submit,nohide
guicontrolget,PRGINSTLBX,,PRGINSTLBX
guicontrolget,systatus,,SALIST
if (systatus = "Systems")
	{
		goto, SYSTRPV
	}
EMUTRP:
EMUINSTLOCT=
FileSelectFile, EMUINSTLOCT,3,,Select the executable,*.exe
if (EMUINSTLOCT= "")
	{
		return
	}
EMUTRPDRP:
Loop,parse,emu_lst,|
	{
		guicontrol,disable,%A_LoopField%
	}
guicontrolget,emtw,,InstEmuDDL
SplitPath,EMUINSTLOCT,emuxe,EINSTPTH,,emunm
guicontrol,,EINSTLOC,%EMUINSTLOCT%
splitpath,EINSTPTH,EINSTFNM,EINSTDIR,EINSTX,EINSTNAM
if (EINSTX = "exe")
	{
		EINSTPTH:= EINSTDIR
		emuxe:= EINSTFNM
	}
Loop, Parse, PRGINSTLBX,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (systatus = "Emulators")
			{
				iniwrite, "%EMUINSTLOCT%",apps.ini,EMULATORS,%semu%
				Loop, Parse, addemu,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						ahri=
						if (A_LoopField = semu)
							{
								ahri= 1
								break
							}
					}
				if (ahri = "")
					{
						ifnotinstring,addemu,|%semu%
							{
								addemu.= "|" . semu
							}
						runlist:= corelist . "|" . addemu
						guicontrol,,EMPRDDL,|%runlist%
						iniwrite, "%EMUINSTLOCT%",Assignments.ini,ASSIGNMENTS,%semu%
						if (EMUAUTOA = 1)
							{
								stranb= %semu%
								gosub, EmuItera
							}
					}
			}
		if (systatus = "Utilities")
			{
				if (semu = "Daemon_Tools")
					{
						DAMVAR= %EMUINSTLOCT%
					}
				if (semu = "Xpadder")
					{
						xpaddrpth= %EMUINSTLOCT%
						iniwrite, "%EMUINSTLOCT%",apps.ini,KEYMAPPERS,%semu%
						return
					}
				if (semu = "Antimicro")
					{
						amicropth= %EMUINSTLOCT%
						iniwrite, "%EMUINSTLOCT%",apps.ini,KEYMAPPERS,%semu%
						return
					}
				if (semu = "DisplayChanger")
					{
						DCHANGER= %EMUINSTLOCT%
					}
				iniwrite, "%EMUINSTLOCT%",apps.ini,UTILITIES,%semu%
			}
		if (systatus = "Frontends")
			{					
				if (instr(fesup,semu)&& !instr(fSYSINSTLBX,semu))
					{
						Menu, rjscopy, Add, Export to %semu%, Export_%semu%
						fSYSINSTLBX.= semu . "|"
					}
				iniwrite, "%EMUINSTLOCT%",apps.ini,FRONTENDS,%semu%
			}
	}
stringreplace,runlist,runlist,||,|,All
stringreplace,runlist,runlist,||,|,All
stringleft,runltmp,runlist,1
if (runltmp = "|")
	{
		stringtrimleft,runlist,runlist,1
	}
ifinstring,selfnd,MAME
	{
		ifnotinstring,addemu,mame_system
			{
				addemu.= "|" . "mame_arcade"
				iniwrite,"%EMUINSTLOCT%",Assignments.ini,ASSIGNMENTS,mame_arcade
			}
		ifnotinstring,addemu,mame_system
			{
				addemu.= "|" . "mame_system"
				iniwrite,"%EMUINSTLOCT%",Assignments.ini,ASSIGNMENTS,mame_system
			}
		splitpath,xtractmfp,,mamevpth
		filecreateDir,%mamevpth%\roms
		ifnotexist,lm.ini
			{
				gosub, MAMETOG
			}
	}
ifinstring,selfnd,retroarch
	{
		raexeloc= %EMUINSTLOCT%
		splitpath,raexeloc,RaExeFile,raexedir
		gosub, resetCORES
	}
gosub, RBLDRUNLST
Loop,parse,emu_lst,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

SYSTRPV:
EMUINSTLOCT=
FileSelectFile, EMUINSTLOCT,3,,Select an emulator executable,*.exe
if (EMUINSTLOCT= "")
	{
		return
	}
SYSTRP:
SplitPath,EMUINSTLOCT,emuxe,EINSTLOCP,,emunm
guicontrolget,SYSINSTLBX,,SYSINSTLBX
guicontrolget,OVRKND,,SYSNICK
guicontrolget,selfnd,,INSTEMUDDL
guicontrolget,APPOPT,,APPOPT
guicontrolget,APPARG,,APPARG
guicontrolget,EMUPGC,,EMUPGC
guicontrolget,LRUN,,LRUN
guicontrolget,NOEXTN,,NOEXTN
guicontrolget,OMITQ,,OMITQ
guicontrolget,EXTARUN,,EXTARUN
guicontrolget,OMITPTH,,OMITPTH
guicontrol,,EINSTLOC,%EMUINSTLOCT%
guicontrolget,EINSTLOC,,EINSTLOC
splitpath,EMUINSTLOCT,EINSTFNM,EINSTDIR,EINSTX,EINSTNAM
if (EINSTX = "exe")
	{
		EINSTLOCP:= EINSTDIR
		emuxe:= EINSTFNM
	}
Loop, Parse, SYSINSTLBX,|
	{
		OVRKND=
		semu:= A_LoopField
		gosub, MultiAssign
	}
oemunn=
splitpath,emuxe,,,,oemunn
gosub, AppParamPop
if (selfnd <> "Other")
	{
		gosub, SYSINSTLBX
	}
if (selfnd = "retroarch")
	{
		Guicontrol,,TABMENU,|Settings|:=: MAIN :=:||Emu:=:Sys|Playlists|Frontends|DAT:=:Repo|Jackets|Util
		raexist= 1
	}
return

MultiAssign:
Loop, Parse, SYSGOTS,|
	{
		MULTICHK+=1
		if (MULTICHK = 2)
			{
				break
			}
	}
Loop, Parse,SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		LKUP1=
		LKUP2=
		stringsplit,LKUP,A_LoopField,=,`n`r
		if (semu = LKUP1)
			{
				OVRKSC= %LKUP2%
				SHRTN= % %LKUP2%
				%LKUP2%= %LKUP1%
				break
			}
	}
if (OVRKND = "")
	{
		stringsplit,SHRTMP,LKUP1,A_Space,-
		StringRight,SHK,SHRTMP1,7
		OVRKND= %SHK%Z
	}
splitpath,EINSTLOC,EINSTFNM,EINSTDIR,EINSTX,EINSTNAM
if (EINSTX = "exe")
	{
		EINSTLOCP:= EINSTDIR
		emuxe:= EINSTFNM
	}
if (selfnd <> "Other")
	{
		iniwrite, "%EINSTLOC%",apps.ini,EMULATORS,%selfnd%
	}
if (selfnd = "Other")
	{
		selfnd= %OVRKND%
	}
iniread,ovrktm,Assignments.ini,OVERRIDES,%SYSGOTS%
if (ovrktm = "ERROR")
	{
		ovrktm= 
	}
EMPRLT= %selfnd%|
Loop, parse, ovrktm,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = selfnd)
			{
				continue
			}
		EMPRLT.= A_LoopField . "|"
	}
empr=
Loop, Parse, preEmuCfg,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = selfnd)
			{
				continue
			}
		empr.= A_LoopField . "|"
	}
iniwrite, "%EMPRLT%",Assignments.ini,OVERRIDES,%SYSGOT%
iniwrite, "%EINSTLOC%",Assignments.ini,ASSIGNMENTS,%selfnd%
iniwrite, "%APPOPT%",AppParams.ini,%selfnd%,options
if (APOPT = "")
	{
		iniwrite, " ",AppParams.ini,%selfnd%,options
	}
iniwrite, "%APPARG%",AppParams.ini,%selfnd%,arguments
iniwrite, "%NOEXTN%",AppParams.ini,%selfnd%,extension
iniwrite, "%EMUPGC%",AppParams.ini,%selfnd%,per_game_configurations
iniwrite, "%OMITQ%",AppParams.ini,%selfnd%,no_quotes
iniwrite, "%EXTARUN%",AppParams.ini,%selfnd%,EXTARUN
iniwrite, "%OMITPTH%",AppParams.ini,%selfnd%,no_path
iniwrite, "%LRUN%",AppParams.ini,%selfnd%,run_location
iniwrite, "%EMPOSTOPT%",AppParams.ini,%selfnd%,EMPOSTOPT
iniwrite, "%EMPREOPT%",AppParams.ini,%selfnd%,EMPREOPT
iniwrite, "%EMPOSTRUN%",AppParams.ini,%selfnd%,EMPOSTRUN
iniwrite, "%EMPRERUN%",AppParams.ini,%selfnd%,EMPRERUN
iniwrite, "%EMPOSTW%",AppParams.ini,%selfnd%,EMPOSTW
iniwrite, "%EMPREW%",AppParams.ini,%selfnd%,EMPREW
reasign .= SYSGOT . "|"
guicontrol,,EMPRLST,|%EMPRLT%
ifnotinstring,selfnd,_libretro.dll
	{
		guicontrol,,SYSNICK,|%selfnd%||%preEmucfg%
	}
return

MRomDLoc:
ROMDFLDR=
FileSelectFolder,ROMDFLDR,,3,Select a source directory for multiple systems
if (ROMDFLDR = "")
	{
		return
	}
stringright,efi,ROMDFLDR,2
stringLeft,efix,ROMDFLDR,2
if (efi = ":\")
	{
		ROMDFLDR= %efix%
	}	
MULTI_LINKLOOP:
guicontrolget,SYSINSTLBX,,SYSINSTLBX
Loop, Parse, SYSINSTLBX,|
	{
		semu:= A_LoopField
		gosub, RomDLocM
	}
return

RomDLoc:
ROMDFLDR=
FileSelectFolder,ROMDFLDR,,3,Locate the %semu% folder
if (ROMDFLDR = "")
	{
		SB_SetText("No folder selected")
		return
	}
stringright,efi,ROMDFLDR,2
stringLeft,efix,ROMDFLDR,2
if (efi = ":\")
	{
		ROMDFLDR= %efix%
	}	
RomDLocM:
IniRead,kiv,SystemLocations.ini,LOCATIONS,%semu%
ifinstring,kiv,%ROMDFLDR%|
	{
		SB_SetText("This location already exists in the " semu " list")
		return
	}
ifnotinstring,initfldrs,%semu%|
	{
		initfldrs.= semu . "|"
	}
guicontrol,,RUNSYSDDL,|%initfldrs%
iniWrite,"%ROMDFLDR%|%kiv%",SystemLocations.ini,LOCATIONS,%semu%
if (kiv = "ERROR")
	{
		kiv= 
	}
guicontrol,,ROMDEDT,|%ROMDFLDR%|%kiv%
gosub, resetCoreAssets
return

LnkGet:
JNKLNK=
junct=
junctv1=
junctv2=
FileDelete,dxt.ini
runwait, %comspec% cmd /c "for /f "tokens=2`,3 delims=<>" `%a in ('dir /a:d "%RJSYSTEMS%\%semu%?`"') do if "`%~a"=="JUNCTION" for /f "tokens=* delims= " `%n in ("`%~b") do echo."`%~n" >dxt.ini &&exit /b ",,hide
ifexist, dxt.ini
	{
		FileReadLine,dxtini,dxt.ini,1
		stringreplace,junct,dxtini,%semu%,,
		StringSplit,junctv,junct,[, ] `"
		;"
		guicontrol,,ROMDEDT,|%junctv2%
		JNKLNK= 1
	}
return

XTRACTEMU:
XTRACTFAIL=
SB_SetText(" " save " " "extracting")
runwait, %comspec% cmd /c  " "%S_KeyDir%\bin\7za.exe" x -y "%save%" -O"%xtractmu%" ", ,hide
SB_SetText(" " save " " "was extracted")
ifnotexist, %xtractmu%
		{
			SB_SetText(" " save " " "was NOT extracted")
			rjintr=
			XTRACTFAIL= 1
		}
if (KARC = 0)
	{
		filedelete, %save%
	}
return

LNCHPRDDL:
gui,submit,nohide
guicontrolget,LNCHPRDDL,,LNCHPRDDL
return

ReSeTAPAR:
gui,submit,nohide
guicontrolget,SYSNICK,,SYSNICK
iniread,sysnvp,sets\AppParams.set,%SYSNICK%
if (sysnvp = "ERROR")
	{
		SB_SetText("Preset not found")
		return
	}
Loop,parse,sysnvp,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,fei,A_LoopField,=
		iniwrite,%fei2%,AppParams.ini,%SYSNICK%,%fei1%
	}
IniRead,ovrob,sets\Assignments.set,OVERRIDES,%SYSNICK%
if ((ovrob <> "ERROR") and (ovrob <> ""))
	{
		iniwrite,%ovrob%,Assignments.ini,OVERRIDES,%SYSNICK%
	}
gosub, SysNick
return

Emu_Open:
gui,submit,nohide
guicontrolget,emupsgn,,PRGINSTLBX
iniread,aix,Apps.ini,EMULATORS,%emupsgn%
if (aix = "ERROR")
	{
		SB_SetText(" it appears " emupsgn " is not yet installed")
		return
	}
splitpath,aix,,emupsgd
RunWait, %comspec% /c explorer "%emupsgd%",,
return

Emu_popasgn:
gui,submit,nohide
guicontrolget,emupsgn,,PRGINSTLBX
bko=
iniread,aix,Assignments.ini,ASSIGNMENTS,%emupsgn%
if (aix = "")
	{
		bko= 1
		SB_SetText(" it appears " emupsgn " is not yet installed")
		return
	}
guicontrol,disable,LNCHPT
guicontrol,disable,SaList
guicontrol,disable,RAINSTLBX
guicontrol,disable,SYSINSTLBX
guicontrol,disable,PRGINSTLBX
Loop,parse,allsupport,|
	{
		psys= %A_LoopField%
		iniread,avd,emuCfgPresets.ini,%A_LoopField%,SUPEMU
		ifinstring,avd,%emupsgn%
			{
				iniread,aii,Assignments.ini,OVERRIDES,%psys%
				if (aii = "")
					{
						iniwrite,"%emupsgn%",Assignments.ini,OVERRIDES,%psys%
						SB_SetText("Assigned " emupsgn " to " psys " ")
					}
			}	
	}
guicontrol,enable,LNCHPT
guicontrol,enable,SaList
guicontrol,enable,RAINSTLBX
guicontrol,enable,SYSINSTLBX
guicontrol,enable,PRGINSTLBX
return

LNCHPT:
gui,submit,nohide
guicontrol,disable,LNCHPT
guicontrol,disable,SaList
guicontrol,disable,RAINSTLBX
guicontrol,disable,SYSINSTLBX
guicontrol,disable,PRGINSTLBX
guicontrolget,LNCHPRDDL,,LNCHPRDDL
guicontrolget,LNCHPT,,LNCHPT
iniread,smuemu,apps.ini,EMULATORS,
stringreplace,smuemu,smuemu,`n,|,All
stringreplace,smuemu,smuemu,=,|,All
stringreplace,smuemu,smuemu,",,All
;"
smuemu:= "|" . smuemu
SB_SetText(" Prioritizing " LNCHPRDDL " ")
INITIALASIGN:
if (LNCHPRDDL = "Emulators")
	{
		repw=
		Loop, Parse, origsys,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				fei1=
				fei2=
				stringsplit,fei,A_LoopField,=,"
				;"
				iniread,aik,Assignments.ini,OVERRIDES,%fei1%
				iniread,aij,emuCfgPresets.ini,%fei1%,SUPEMU
				iniread,aic,emuCfgPresets.ini,%fei1%,SUPCORE
				if (aij = "ERROR")
					{
						continue
					}
				inix=
				nwv=
				repx=
				repw=
				Loop,Parse,aij,|
					{
						nwv= %A_LoopField%
						iniread,emx,Apps.ini,EMULATORS,%A_LoopField%
						if (emx = "ERROR")
							{
								continue
							}
						if (inix = "")
							{
								inix= %A_LoopField%|
							}
						repw=
						Loop,Parse,aik,|
							{
								if (A_LoopField = nwv)
									{
										continue
									}
								repx.= A_LoopField . "|"
							}
					}
				repw.= inix . repx
				if (raexefile <> "")
					{
						Loop,Parse,aic,|
							{
								ifnotexist,%raexedir%\cores\%A_LoopField%
									{
										continue
									}
								jijv= %A_LoopField%
								Loop,parse,repw,|
									{
										if (A_LoopField = jijv)
											{
												continue
											}										
									}
							repw.= A_LoopField . "|"
							}
					}
				iniwrite,"%repw%",Assignments.ini,OVERRIDES,%fei1%
			}
		iniwrite, 1,Settings.ini,GLOBAL,Launcher_Priority
		goto, LNCHPTFIN
	}
if (LNCHPRDDL = "retroarch")
	{
		iniread,raexeloc,Apps.ini,EMULATORS,retroarch
		if (RaExeFile = "ERROR")
				{
					SB_SetText("Retroarch is not present")
					guicontrol,,SALIST,|Systems|Emulators||Utilities|Frontends
					gosub, SaList
					guicontrol,enable,LNCHPT
					guicontrol,enable,SaList
					guicontrol,enable,RAINSTLBX
					guicontrol,enable,SYSINSTLBX
					guicontrol,enable,PRGINSTLBX
					return
				}
		LNCHPT= 0
		repw=
		Loop, Parse, origsys,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				fei1=
				fei2=
				stringsplit,fei,A_LoopField,=,"
				;"
				iniread,aik,Assignments.ini,OVERRIDES,%fei1%
				iniread,aij,emuCfgPresets.ini,%fei1%,SUPEMU
				iniread,aic,emuCfgPresets.ini,%fei1%,SUPCORE
				if (aic = "ERROR")
					{
						continue
					}
				repw=
				repx=
				inix=
				Loop,Parse,aic,|
					{
						ifnotexist,%raexedir%\cores\%A_LoopField%
							{
								continue
							}
						if (inix = "")
							{
								inix= %A_LoopField%|
							}
						nwv= %A_LoopField%
						Loop,Parse,aik,|
							{
								if (A_LoopField = nwv)
									{
										continue
									}
								repx.= A_LoopField . "|"
							}
					}
				repw.= inix . repx
				Loop,Parse,aij,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						nwv= %A_LoopField%|
						iniread,emx,Apps.ini,EMULATORS,%A_LoopField%
						if (emx = "ERROR")
							{
								continue
							}
						Loop,Parse,aik,|
							{
								if (A_LoopField = nwv)
									{
										continue
									}
								Loop,parse,repw,|
									{
									if (A_LoopField = nwv)
										{
											continue
										}										
									}
								repw.= A_LoopField . "|"
							}
					}	
				stringreplace,repw,repw,||,|,All
				iniwrite,"%repw%",Assignments.ini,OVERRIDES,%fei1%
			}
		iniwrite, 1,Settings.ini,GLOBAL,Launcher_Priority
		goto,LNCHPTFIN
	}
if (INITIAL = 1)
	{
		return
	}
Loop, Parse, origsys,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		fei1=
		fei2=
		stringsplit,fei,A_LoopField,=,"
		;"
		iniread,aik,Assignments.ini,OVERRIDES,%fei1%
		iniread,aij,emuCfgPresets.ini,%fei1%,SUPEMU
		iniread,aic,emuCfgPresets.ini,%fei1%,SUPCORE
		ifnotinstring,aic,%LNCHPRDDL%
			{
				continue
			}
		inix=
		nwv=
		repx=
		repw=
		Loop,Parse,aij,|
			{
				nwv= %A_LoopField%
				iniread,emx,Apps.ini,EMULATORS,%A_LoopField%
				if (emx = "ERROR")
					{
						continue
					}
				inix= %LNCHPRDDL%|
				repw=
				Loop,Parse,aik,|
					{
						if (A_LoopField = nwv)
							{
								continue
							}
						repx.= A_LoopField . "|"
					}
			}
		repw.= inix . repx
		if (raexefile <> "")
			{
				Loop,Parse,aic,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						ifnotexist,%raexedir%\cores\%A_LoopField%
							{
								continue
							}
						jijv= %A_LoopField%
						Loop,parse,repw,|
							{
								if (A_LoopField = jijv)
									{
										continue
									}										
							}
						repw.= A_LoopField . "|"
					}
			}
		stringreplace,repw,repw,||,|,All	
		iniwrite,"%repw%",Assignments.ini,OVERRIDES,%fei1%
	}
LNCHPTFIN:
SB_SetText("Systems now assigned to " LNCHPRDDL " where possible.")
guicontrol,,SaList,|Systems||Emulators|Utilities|Frontends
gosub, SaList
GuiControl, Choose, SYSINSTLBX, 0
guicontrol,enable,LNCHPT
guicontrol,enable,SaList
guicontrol,enable,RAINSTLBX
guicontrol,enable,SYSINSTLBX
guicontrol,enable,PRGINSTLBX
fileread,aei,Assignments.ini
FileDelete,Assignments.ini
stringreplace,aei,aei,|",",All
stringreplace,aei,aei,"|,",All
FileAppend,%aei%,Assignments.ini
return

getCREN:
szip=
corcfgnam= %ccv%
if (ccv = "glupen64")
	{
		glpndr= OpenGL
		if (videoDriver = "vulkan")
			{
				glpndr= Vulkan
			}
		corcfgnam= GlupeN64 %glpndr%
	    return
	}
Loop,parse,corslk,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		loop,5
			{
				avh%A_index%=
			}
		stringsplit,avh,A_LoopField,|
		if (ccv = avh4)
			{
				corcfgnam= %avh2%
				szip= %avh5%
			}
	}
return

revCREN:
szip=
ASPOP=
corelk= %syslk%
corverlk1=
corverlk2=
corverlk3=
corverlk4=
Loop,Parse,corslk,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		loop,5
			{
				vnr%A_index%=
			}
		stringsplit,vnr,A_LoopField,|
		if (syslk = vnr1)
			{
				ASPOP= % %vnr3%
				corelk= %vnr4%
				szip= %vnr5%
				break
			}
	}
keyin= %ASPOP%
gosub, RevTransformSys
return

AddCore:
sysni=
systyp=
ovfile=
ovdir=
ovextn=
ovdrv=
gui, submit, nohide
guicontrol,hide,SAVNSYS
guicontrol,hide,ADDNSYS
guicontrol,hide,APPOPT
guicontrol,hide,APPARG
guicontrol,hide,NOEXTN
guicontrol,hide,EMUPGC
guicontrol,hide,SYSNICK
guicontrol,hide,SVNICK
guicontrol,hide,DELNICK
guicontrol,hide,ERUN
guicontrol,hide,LRUN
guicontrol,hide,SELAPP
guicontrol,hide,OPTTXT
guicontrol,hide,ARGTXT
guicontrol,hide,OMITQ
guicontrol,hide,EXTARUN
guicontrol,hide,OMITPTH
instog= hide
if (SALIST = "Systems")
	{
			instog= show
	}
guicontrol,%instog%,OVLIST
guicontrol,,EXDISPL,
guicontrol,show,EXDISPL
guicontrol,enable,OPNSYS
guicontrolget,ADDCORE,,ADDCORE
if (ADDCORE = "Select_A_System")
	{
		guicontrol,hide,APPOPT
		guicontrol,hide,APPARG
		guicontrol,hide,NOEXTN
		guicontrol,hide,EMUPGC
		guicontrol,hide,SYSNICK
		guicontrol,hide,SVNICK
		guicontrol,hide,DELNICK
		;;guicontrol,hide,SYSIDENT
		guicontrol,hide,ERUN
		guicontrol,hide,LRUN
		guicontrol,hide,SELAPP
		guicontrol,hide,OPTTXT
		guicontrol,hide,ARGTXT
		return
	}
guicontrol,hide,EXTINP
if (SALIST = "Emulators")
	{
		GuiControl, choose, PRGINSTLBX,0
	}
OVLIST=
guicontrol,,OVLIST,|1|2|3|4
iniread,sysni,Assignments.ini,OVERRIDES,%ADDCORE%
if (sysni = "ERROR")
	{
		sysni= 
	}
if (sysni <> "ERROR")
	{
		;;if sysni is not digit
			;;{
				guicontrol,,EMPRLST,|%sysni%
		;;	}
	}
iniread,systyp,Assignments.ini,ASSIGNMENTS,%ADDCORE%
DETECTCA=0
splitpath,systyp,ovfile,ovdir,ovextn,ovnm,ovdrv
if (sysni = 1)
		{
			return
		}
if (sysni = 0)
		{
			return
		}
	stringsplit,aij,sysni,|
	sysni= %aij1%
	gosub,DApp
ifinstring,ADDCORE,_libretro.dll
	{
	}
return

SysNick:
gui,submit,nohide
SYSPROX= PRGINSTLBX
if (SALIST = "Systems")
	{
		SYSPROX= ADDCORE
	}
guicontrolget,ADDCORE,,%SYSPROX%
guicontrolget,sysni,,SYSNICK
gosub, AppParamPop
return

SvNick:
sysni=
gui,submit,nohide
guicontrolget,SALIST,,SALIST
guicontrolget,sysni,,SYSNICK
SYSPROX= PRGINSTLBX
if (SALIST = "Systems")
	{
		SYSPROX= ADDCORE
	}
guicontrolget,ADDCORE,,%SYSPROX%
guicontrolget,NOEXTN,,NOEXTN
guicontrolget,OMITQ,,OMITQ
guicontrolget,LRUN,,LRUN
guicontrolget,EMUPGC,,EMUPGC
guicontrolget,APPOPT,,APPOPT
guicontrolget,APPARG,,APPARG
guicontrolget,EXTARUN,,EXTARUN
guicontrolget,OMITPTH,,OMITPTH
guicontrolget,DSKMNTCHK,,DSKMNTCHK
guicontrolget,DSKMNTDDL,,DSKMNTDDL
guicontrolget,DSKMNTOVR,,DSKMNTOVR
if (DSKMNTDDL <> "DaemonTools")
	{
		iniread,DSKMNTPRG,AppParams.ini,%sysni%,DSKMNTPRG
	}
if (DSKMNTOVR = 1)
	{
		iniread,DSKMNTOVR,AppParams.ini,%sysni%,DSKMNTOVR
	}
IniRead, EMPRERUN,AppParams.ini,%sysni%,EMPRERUN
if (EMPRERUN = "ERROR")
	{
		IniRead, EMPRERUN,sets\AppParams.set,%sysni%,EMPRERUN
		if (EMPRERUN = "ERROR")
			{
				EMPRERUN= 
			}
	}
IniRead, EMPREW,AppParams.ini,%sysni%,EMPREW
if (EMPREW = "ERROR")
	{
		IniRead, EMPREW,sets\AppParams.set,%sysni%,EMPREW
		if (EMPREW = "ERROR")
			{
				EMPREW= 
			}
	}

IniRead, EMPREOPT,AppParams.ini,%sysni%,EMPREOPT
if (EMPREOPT = "ERROR")
	{
		IniRead, EMPREOPT,sets\AppParams.set,%sysni%,EMPREOPT
		if (EMPREOPT = "ERROR")
			{
				EMPREOPT= 
			}
	}

IniRead, EMPOSTRUN,AppParams.ini,%sysni%,EMPOSTRUN
if (EMPOSTRUN = "ERROR")
	{
		IniRead, EMPOSTRUN,sets\AppParams.set,%sysni%,EMPOSTRUN
		if (EMPOSTRUN = "ERROR")
			{
				EMPOSTRUN= 
			}
	}

IniRead, EMPOSTW,AppParams.ini,%sysni%,EMPOSTW
if (EMPOSTW = "ERROR")
	{
		IniRead, EMPOSTW,sets\AppParams.set,%sysni%,EMPOSTW
		if (EMPOSTW = "ERROR")
			{
				EMPOSTW= 
			}
	}

IniRead, EMPOSTOPT,AppParams.ini,%sysni%,EMPOSTOPT
if (EMPOSTOPT = "ERROR")
	{
		IniRead, EMPOSTOPT,sets\AppParams.set,%sysni%,EMPOSTOPT
		if (EMPOSTOPT = "ERROR")
			{
				EMPOSTOPT= 
			}
	}

sanm:= sysni
gosub, SanitizeN
sysni:= sanm
if (sysni = "")
	{
		SB_SetText("Cannot Save Empty Nickname")
		return
	}
gosub,AppOpt
gosub,AppArg
gosub,OmitQ
gosub,OmitPth
gosub,EXTARUN
gosub,NoExtn
gosub,LRun
if (SALIST = "Systems")
	{
		appasi=
		iniread,appasi,Assignments.ini,ASSIGNMENTS,%sysni%
		if (appasi = "ERROR")
			{
				iniread,appasi,Apps.ini,%sysni%
				if (appsi = "ERROR")
					{
						SB_SetText(" Cannot save " sysni " until an executable has been assigned ")
						return
					}
				iniwrite, "%appasi%",Assignments.ini,ASSIGNMENTS,%sysni%
			}
	}
if (SALIST = "Emulators")
	{
		guicontrolget,ksvel,,EINSTLOC
		if (ksvel = "")
			{
				SB_SetText("You must assign an emulator executable to this nickname to save a system associaiton")
				return
			}
		IniWrite, "%ksvel%",Assignments.ini,ASSIGNMENTS,%sysni%
	}
srin=
if (semu = "")
	{
		semu= %sysni%
	}
Loop, Parse, semu,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		srin= %A_LoopField%
		SB_SetText(" Saving ")
		if (MULTISYS = 1)
			{
				ADDCORE= %A_LoopField%
			}
		iniwrite, "%appopt%",AppParams.ini,%sysni%,options
		if (apopt = "")
			{
				apopt= %A_Space%
				iniwrite, " ",AppParams.ini,%sysni%,options
			}
		if (aparg = "")
			{
				apparg=
			}
		sysnitmp=
		sysninj= %sysni%|
		iniread,sysnitmp,Assignments.ini,OVERRIDES,%ADDCORE%
		if (sysnitmp = "ERROR")
			{
				sysnitmp= 
			}
		nwadmm=
		Loop, Parse, sysnitmp,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (A_LoopField = sysni)
					{
						continue
					}
				ifinstring,sysninj,%A_LoopField%|
					{
						continue
					}
				sysninj.= A_LoopField . "|"
			}
		Loop, Parse, addemu,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				ahri=
				if (A_LoopField = sysni)
					{
						ahri= 1
						break
					}
			}
		if (ahri = "")
			{
				nwadmm.= sysni . "|"
				nwadmi:= sysninj . "|" . sysni
				ifnotinstring,addemu,|%sysni%
					{
						iniread,admutst,Assignments.ini,ASSIGNMENTS,%sysni%
						if ((admutst = "")or(admutst = "ERROR"))
							{
								continue
							}
						addemu.= "|" . sysni
					}
				runlist:= corelist . "|" . addemu
				stringreplace,runlist,runlist,||,|,All
				stringreplace,runlist,runlist,||,|,All
				stringleft,runltmp,runlist,1
				if (runltmp = "|")
					{
						stringtrimleft,runlist,runlist,1
					}
				guicontrol,,LCORE,|%runlist%
				guicontrol,,EMPRDDL,|Emulators||%runlist%
				guicontrol,,PLCORE,|%runlist%
				guicontrol,,ARCCORES,|Emu_Preset||%runlist%
			}
		EMPRLT:= sysni . "|"
		Loop, parse, sysnitmp,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (A_LoopField = srin)
					{
						continue
					}
				EMPRLT.= A_LoopField . "|"
			}
		iniwrite, "%aparg%",AppParams.ini,%sysni%,arguments
		iniwrite, "%NOEXTN%",AppParams.ini,%sysni%,extension
		iniwrite, "%EMUPGC%",AppParams.ini,%sysni%,per_game_configurations
		iniwrite, "%OMITQ%",AppParams.ini,%sysni%,no_quotes
		iniwrite, "%EXTARUN%",AppParams.ini,%sysni%,EXTARUN
		iniwrite, "%OMITPTH%",AppParams.ini,%sysni%,no_path
		iniwrite, "%LRUN%",AppParams.ini,%sysni%,run_location
		iniwrite, "%EMPOSTOPT%",AppParams.ini,%sysni%,EMPOSTOPT
		iniwrite, "%EMPOSTRUN%",AppParams.ini,%sysni%,EMPOSTRUN
		iniwrite, "%EMPOSTW%",AppParams.ini,%sysni%,EMPOSTW
		iniwrite, "%EMPREOPT%",AppParams.ini,%sysni%,EMPREOPT
		iniwrite, "%EMPRERUN%",AppParams.ini,%sysni%,EMPRERUN
		iniwrite, "%EMPREW%",AppParams.ini,%sysni%,EMPREW
		iniwrite, "%DSKMNTCHK%",AppParams.ini,%sysni%,DSKMNTCHK
		iniwrite, "%DSKMNTOVR%",AppParams.ini,%sysni%,DSKMNTOVR
		iniwrite, "%DSKMNTPRG%",AppParams.ini,%sysni%,DSKMNTPRG
	}
gosub, ResetRunList
stringright,ttr,sysni,1
if (ttr = "|")
	{
		stringtrimright,sysni,sysni,1
	}
preEmuCfg.= sysni . "|"
ifnotinstring,sysni,_libretro.dll
	{
		guicontrol,,SYSNICK,|%sysni%||%preEmuCfg%
	}
gosub,AppParamPop
SB_SetText(" Saved ")
return

DelNick:
sysni=
gui,submit,nohide
guicontrolget,INSTEMUDDL,,INSTEMUDDL
guicontrolget,sysni,,SYSNICK
if (sysni = "")
	{
		SB_SetText("select a nickname")
		return
		}
pemu=
Loop, parse, preEmuCfg,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = sysni)
			{
				continue
			}
		pemu.= A_LoopField . "|"
	}
ahri=
Loop, Parse, addemu,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = sysni)
			{
				continue
			}
		ahri.= A_LoopField . "|"
	}
runlist:= corelist . "|" . ahri
stringreplace,runlist,runlist,||,|,All
stringreplace,runlist,runlist,||,|,All
stringleft,runltmp,runlist,1
if (runltmp = "|")
	{
		stringtrimleft,runlist,runlist,1
	}
nodel=
Loop, Parse, origasi,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,ai,A_LoopField,=,"
		;"
		if (ai1 = sysni)
			{
				nodel= 1
				SB_SetText(" Resetting " sysni "")
				Iniread,defaprm,sets\AppParams.set,%sysni%
				Loop, Parse, defaprm,`n
					{
						stringsplit,defp,A_LoopField,"
						;"
						IniWrite,%defp2%,AppParams.ini,%sysni%,%defp1%
					}
				break
			}
	}
if (nodel = "")
	{
		vki=
		IniDelete,%sysni%,Assignments.ini,ASSIGNMENTS
		IniRead,vin,Assignments.ini,OVERRIDES,%sysni%
		Loop, Parse,vin,|
			{
				if (A_LoopField = sysni)
					{
						continue
					}
				vki.= A_LoopField . "|"
			}
		IniWrite,"%vki%",Assignments.ini,OVERRIDES,%ADDCORE%
	}
preemucfg= %pemu%
addemu= %ahri%
guicontrol,,EMPRDDL,|%runlist%
Guicontrol,,SYSNICK,| ||%preEmuCfg%
IniDelete, Assignments.ini,OVERRIDES,%sysni%
IniDelete, Assignments.ini,ASSIGNMENTS,%sysni%
IniDelete, AppParams.ini,%sysni%
if ((sysni = INSTEMUDDL) && (SALIST = "Systems"))
	{
		IniRead,rewa,sets\AppParams.set,%sysni%
		Loop, Parse, rewa,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,avw,A_LoopField,=
				IniWrite,%avw2%,AppParams.ini,%sysni%,%avw1%
			}
		IniRead,ovrob,sets\Assignments.set,OVERRIDES,%sysni%
		if ((ovrob <> "ERROR") and (ovrob <> ""))
			{
				iniwrite,%ovrob%,Assignments.ini,OVERRIDES,%sysni%
			}
		iniread,tmprz,Assignments.ini,OVERRIDES
		Loop,parse,tmprz,`n`r
			{
				vprse=
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,afin,A_LoopField,=
				Loop,Parse,afin2,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						if (A_LoopField = sysni)
							{
								continue
							}
						vprse.= A_LoopField . "|"
					}
				if (vprse <> "")
					{
						iniwrite,"%vprse%",Assignments.ini,OVERRIDES,%afin1%
					}
			}
	}
guicontrol,,EXDISPL,
if (SALIST = "Emulators")
	{
		if (sysni = semu)
			{
				IniRead,redefa,Apps.ini,EMULATORS,%sysni%
				IniWrite,"%sysni%",Assignments.ini,OVERRIDES,%sysni%
				IniWrite,"%redefa%",Assignments.ini,ASSIGNMENTS,%sysni%
				IniRead,bjk,sets\AppParams.set,%sysni%
				Loop, Parse, bjk,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,apw,A_LoopField,=
						iniwrite,%apw2%,AppParams.ini,%sysni%,%apw1%
					}
				gosub, Dapp
				gosub, AppParamPop
				return
			}
	}
gosub, Dapp
gosub, AppParamPop
gosub, SYSINSTLBX
return

ExtInp:
gui,submit,nohide
extenlist=
if (ADDCORE <> "Select_A_System")
	{
		return
	}
guicontrolget, EXTINP,,EXTINP
StringReplace,EXTINP,EXTINP,%A_Space%,,All
StringReplace,EXTINP,EXTINP,.,,All
Loop,Parse,EXTINP,`,
	{
		extenlist .= A_LoopField . "|"
	}
		if (extenlist = "")
			{
				iniwrite, "0",Assignments.ini,OVERRIDES,%OVLIST%
			}
iniwrite, "%extenlist%",Assignments.ini,EXTENSIONS,%OVLIST%
return

DApp:
pthdisp= $ROMPATH\
xdisp= .ext
runfr= $ROMPATH
gui,submit,nohide
SYSPOPD= %OVLIST%
if (ADDCORE <> "Select_A_System")
	{
		guicontrolget, SYSPOPD,,ADDCORE
	}
gosub, AppSetReset
if (Salist = "Emulators")
	{
		PRECFGLIST=
		guicontrolget,SYSPOPD,,PRGINSTLBX
		PRECFGLIST= %SYSPOPD%
		if (PRECFGLIST <> "")
			{
				SYSPOPD= %PRECFGLIST%
			}
		guicontrol,,SYSNICK,|%SYSPOPD%||%preEmuCfg%
	}
iniread, systyp,Assignments.ini,ASSIGNMENTS,%SYSPOPD%
splitpath, systyp,ovfile,ovdir,ovextn,ovnm,ovdrv
iniread, sysni,Assignments.ini,OVERRIDES,%SYSPOPD%
if (sysni = "ERROR")
	{
		sysni=
	}
stringsplit,aij,sysni,|
sysni= %aij1%
guicontrol,enable,SYSNICK
guicontrol,enable,SVNICK
guicontrol,enable,DELNICK
stringright,ttr,sysni,1
if (ttr = "|")
	{
		stringtrimright,sysni,sysni,1
	}
ifnotinstring,sysni,_libretro.dll
	{
		guicontrol,,SYSNICK,|%sysni%||%preEmucfg%
	}
gui, submit, nohide
gosub, AppParamPop
guicontrol,,EXDISPL,"..\%ovfile%"%apopt%%qdisp%%pthdisp%$ROM%xdisp%%qdisp%%aparg%, %runfr%
return

AppOpt:
gui, submit, nohide
guicontrolget, apopt,, APPOPT
if ((apopt = "")or(apopt = ">")or(apopt = "ERROR"))
	{
		apopt= %A_Space%
		guicontrol,,APPOPT,%A_Space%
	}
guicontrol,,EXDISPL,"..\%ovfile%"%apopt%%qdisp%%pthdisp%$ROM%xdisp%%qdisp%%aparg%, %runfr%
return

AppArg:
gui, submit, nohide
guicontrolget, aparg,, APPARG
if ((aparg = "")or(aparg = ">")or(aparg = "ERROR"))
	{
		aparg= %A_Space%
		guicontrol,,APPOPT,%A_Space%
	}
guicontrol,,EXDISPL,"..\%ovfile%"%apopt%%qdisp%%pthdisp%$ROM%xdisp%%qdisp%%aparg%, %runfr%
return

NoExtn:
gui,submit,nohide
xdisp= .ext
if (NOEXTN = 1)
	{
		xdisp=
	}
guicontrol,,EXDISPL,"..\%ovfile%"%apopt%%qdisp%%pthdisp%ROM%xdisp%%qdisp%%aparg%, %runfr%
return

OmitQ:
gui,submit,nohide
guicontrolget,OMITQ,,OMITQ
qdisp= "
;"
if (OMITQ = 1)
	{
		qdisp=
	}
guicontrol,,EXDISPL,"..\%ovfile%"%apopt%%qdisp%%pthdisp%%ROM%%xdisp%%qdisp%%aparg%, %runfr%
return

EXTARUN:
gui,submit,nohide
guicontrolget,EXTARUN,,EXTARUN
pthdisp= $ROMPATH\
return

OmitPth:
gui,submit,nohide
guicontrolget,OMITPTH,,OMITPTH
pthdisp= $ROMPATH\
if (OMITPTH = 1)
	{
		pthdisp=
	}
guicontrol,,EXDISPL,"..\%ovfile%"%apopt%%qdisp%%pthdisp%ROM%xdisp%%qdisp%%aparg%, %runfr%
return

EMUAUTOA:
gui,submit,nohide
return

EmuPGC:
gui,submit,nohide
guicontrolget,EMUPGC,,EMUPGC	
return

GBLpgs:
gui,submit,nohide
seirb= enabling
sbr=1
if (EMUPGC = 0)
	{
		seirb= disabling
		sbr=0
	}
SB_SetText(" "seirb " all  per game settings")
loop,parse,preEmuCfg,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		iniwrite, %sbr%,AppParams.ini,%A_LoopField%,per_game_configurations
	}	
SB_SetText("completed " seirb "  per game settings for all systems.")
return	
ERun:
gui,submit,nohide
guicontrolget,ERUN,,ERUN
runfr= $EMUPATH
guicontrol,,EXDISPL,"..\%ovfile%"%apopt%%qdisp%%pthdisp%ROM%xdisp%%qdisp%%aparg%, %runfr%
return

LRun:
gui,submit,nohide
guicontrolget,LRUN,,LRUN
if (LRUN = 1)
	{
		runfr= $ROMPATH
		guicontrol,,EXDISPL,"..\%ovfile%"%apopt%%qdisp%%pthdisp%ROM%xdisp%%qdisp%%aparg%, %runfr%
		return
	}
guicontrolget,ERUN,,ERUN
runfr= $EMUPATHf
guicontrol,,EXDISPL,"..\%ovfile%"%apopt%%qdisp%%pthdisp%ROM%xdisp%%qdisp%%aparg%, %runfr%
return

AppParamPop:
gui,submit,nohide
if (sysni = "")
	{
	   return
	}
SB_SetText(" ...POPULATING...")
iniread, appasi, Assignments.ini,ASSIGNMENTS,%sysni%
if (appasi = "ERROR")
	{
		iniread,appasi,Apps.ini,EMULATORS,%sysni%
		ovfile= $Executable.exe
		if (appasi <> "ERROR")
			{
				iniwrite,"%appasi%",Assignments.ini,ASSIGNMENTS,%sysni%
			}
	}
ifnotexist,%appasi%
		{
			iniread,appasi,Apps.ini,EMULATORS,%sysni%
			ovfile= $Executable.exe
			if (appasi <> "ERROR")
				{
					iniwrite,"%appasi%",Assignments.ini,ASSIGNMENTS,%sysni%
				}
		}
if (appasi <> "ERROR")
	{
		splitpath, appasi,ovfile
	}
emupgcd=
iniread,emupgcd, AppParams.ini,%sysni%,per_game_configurations
if (emupgcd <> "ERROR")
	{
		if (emupgcd = "")
			{
				emupgcd= 0
			}
		guicontrol,,EMUPGC,%emupgcd%
	}
apopt= %A_Space%
iniread, apopt, AppParams.ini, %sysni%,options
iniread, apoptx, emuCfgPresets.ini, %sysni%,RJEMUOPTS
if (apopt = "ERROR")
	{
		apopt= %A_Space%
	}
apoptv:= apopt . "|"
if (apoptx <> "ERROR")
	{
		apoptn= 
		stringreplace,apoptx,apoptx,<,%A_Space%,All
		Loop,Parse,apoptx,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				apoptn.= A_LoopField "|"
			}
		apoptv.= apoptn
	}
else {
	apoptv.= "|"
 }	
guicontrol,,APPOPT,|%apoptv%%INJOPT%
aparg=
iniread,aparg,AppParams.ini,%sysni%,arguments
iniread,apargx,emuCfgPresets.ini, %sysni%,RJEMUARGS
if (aparg = "ERROR")
	{
		aparg= %A_Space%
	}
apargv:= aparg . "|"
if (apargx <> "ERROR")
	{
		apargn= 
		stringreplace,apargx,apargx,<,%A_Space%,All
		Loop,Parse,apargx,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				apargn.= A_LoopField . "|"
			}
		apargv.= apargn	
	}
else {
	apargv.= "|"
 }	
guicontrol,,APPARG,|%apargv%%INJARG%
apext=
iniread, apext, AppParams.ini,%sysni%,extension
if (apext <> "ERROR")
	{
		if (apext = "")
			{
				apext= 0
			}
		guicontrol,,NOEXTN,%apext%
		if (apext = 1)
			{
				xdisp=
			}
	}
aprun=
iniread, aprun, AppParams.ini,%sysni%,run_location
stringreplace,aprun,aprun,",,All
;"
guicontrol,,ERUN,1
runfr= $EMUPATH
if (aprun = 1)
	{
		guicontrol,,ERUN,0
		guicontrol,,LRUN,1
		runfr= $ROMPATH
	}
tmsnp=
iniread, tmsnp, AppParams.ini,%sysni%,EXTARUN
if (tmsnp <> "ERROR")
	{
		if (tmsnp = "")
			{
				tmsnp= 0
			}
		guicontrol,,EXTARUN,%tmsnp%
	}
tmpnp=
iniread, tmpnp, AppParams.ini,%sysni%,no_path
if (tmpnp <> "ERROR")
	{
		if (tmpnp = "")
			{
				tmpnp= 0
			}
		guicontrol,,OMITPTH,%tmpnp%
		if (tmpnp = 1)
			{
				pthdisp=
			}
	}
tmpq=
iniread, tmpq, AppParams.ini,%sysni%,no_quotes
if (tmpq <> "ERROR")
	{
		if (tmpq = "")
			{
				tmpq= 0
			}
		guicontrol,,OMITQ,%tmpq%
		if (omitq = 1)
			{
				qdisp=
			}
	}
tmpdt=
iniread, tmpdt, AppParams.ini,%sysni%,DSKMNTCHK
guicontrol,,DSKMNTCHK,0
if (tmpdt <> "ERROR")
	{
		if (tmpdt = "")
			{
				tmpdt= 0
			}
		guicontrol,,DSKMNTCHK,%tmpdt%
		if (tmpdt = 1)
			{
				guicontrol,enable,DSKMNTDDL
				guicontrol,enable,DSKMNTOVR
				guicontrol,enable,DSKSELBUT
			}
	}
tmpdp=
iniread, tmpdp, AppParams.ini,%sysni%,DSKMNTPRG
if (tmpdp <> "ERROR")
	{
		if (tmpdp = "")
			{
				tmpdp= DaemonTools
			}
		guicontrol,,DSKMNTDDL,|%tmpdp%||DaemonTools||VirtualCloneDrive|WinCDEmu|%vdskwin%Other
	}
tmpdf=
iniread, tmpdf, AppParams.ini,%sysni%,DSKMNTOVR
if (tmpdf <> "ERROR")
	{
		if (tmpdf = 0)
			{
				guicontrol,,DSKMNTOVR,%tmpdf%
			}
		if (tmpdf <> 0)
			{
				guicontrol,,DSKMNTOVR,1
			}
	}
guicontrol, ,EXDISPL, "..\%ovfile%"%apopt%%qdisp%%pthdisp%ROM%xdisp%%qdisp%%aparg%, %runfr%

return

AppSetReset:
guicontrol, , APPOPT,| ||%INJOPT%
guicontrol, , APPARG,| ||%INJARG%
guicontrol,,EXTARUN,0
guicontrol,,OMITPTH,0
guicontrol,,OMITQ,0
guicontrol,,NOEXTN,0
guicontrol,,EMUPGC,1
guicontrol,,LRUN,0
guicontrol,,ERUN,1
return

SelApp:
gui,submit,nohide
guicontrolget,sysni,,SYSNICK
SYSPROX= PRGINSTLBX
if (SALIST = "Systems")
	{
		SYSPROX= ADDCORE
	}
guicontrolget,ADDCORE,,%SYSPROX%
guicontrolget,NOEXTN,,NOEXTN
guicontrolget,OMITQ,,OMITQ
guicontrolget,OMITPTH,,OMITPTH
guicontrolget,EXTARUN,,EXTARUN
guicontrolget,LRUN,,LRUN
guicontrolget,EMUPGC,,EMUPGC
guicontrolget,APPOPT,,APPOPT
guicontrolget,APPARG,,APPARG
guicontrolget,OMITPTH,,OMITPTH
if (sysni = "")
	{
		SB_SetText("You must enter a nickname to assign an executable")
		return
	}
appasi=
FileSelectFIle,appasi,3,,Select and Executable,*.exe
if (appasi = "")
	{
		return
	}
SplitPath,appasi,ovfile,,,appasn
apopt= %appopt%
qdisp= "
;"
pthdisp= $ROMPATH\
xdisp= .ext
aparg= %apparg%
IniWrite, "%appasi%",Assignments.ini,ASSIGNMENTS,%sysni%
IniRead,avr,Assignments.ini,OVERRIDES,%ADDCORE%
sysniad= %sysni%
ifnotinstring,A_LoopField,%sysni%
	{
		sysniad:= sysni . "|" avr
	}
IniWrite, "%sysniad%",Assignments.ini,OVERRIDES,%ADDCORE%
iniwrite, "%APPOPT%",AppParams.ini,%appasn%,options
iniwrite, "%APPARG%",AppParams.ini,%appasn%,arguments
iniwrite, "%NOEXTN%",AppParams.ini,%appasn%,extension
iniwrite, "%LRUN%",AppParams.ini,%appasn%,run_location
iniwrite, "%EMUPGC%",AppParams.ini,%appasn%,per_game_configurations
iniwrite, "%OMITQ%",AppParams.ini,%appasn%,no_quotes
iniwrite, "%OMITPTH%",AppParams.ini,%appasn%,no_path
iniwrite, "%EXTARUN%",AppParams.ini,%appasn%,EXTARUN
iniwrite, "%EMPREOPT%",AppParams.ini,%sysni%,EMPREOPT
iniwrite, "%EMPOSTOPT%",AppParams.ini,%sysni%,EMPOSTOPT
iniwrite, "%EMPOSTRUN%",AppParams.ini,%sysni%,EMPOSTRUN
iniwrite, "%EMPRERUN%",AppParams.ini,%sysni%,EMPRERUN
iniwrite, "%EMPREW%",AppParams.ini,%sysni%,EMPREW
iniwrite, "%EMPOSTW%",AppParams.ini,%sysni%,EMPOSTW
if (OVLIST <> "")
	{
		iniwrite, "%appasi%",Assignments.ini,ASSIGNMENTS,%OVLIST%
		iniwrite, "%sysni%",Assignments.ini,OVERRIDES,%OVLIST%
	}
guicontrol,,EXDISPL,"..\%ovfile%"%apopt%%qdisp%%pthdisp%$ROM%xdisp%%qdisp%%aparg%, %runfr%
gosub, ResetRunList

guicontrol,,LCORE,|%runlist%
guicontrol,,PLCORE,|%lastcore%||%runlist%
gosub, SYSINSTLBX
return

RJSYSRESET:
systmfldrs=
knownfldrs=
totsys=
allsys=
rjsystmfldrs= 
Loop, %RJSYSTEMS%\*,2
	{
		if A_LoopFileAttrib contains H
			{
				continue
			}
		sysnam= %A_LoopFileName%
		systmfldrs.= A_LoopFileName . "|"
		avnu1=
		allsys+=1
		iniread,efxe,emuCfgPresets.ini,%sysnam%,SUPEMU
		if ((efxe <> "ERROR")&&(efxe <> ""))
			{
				totsys+=1
				knownfldrs.= sysnam . "|"
				rjsystmfldrs.= sysnam . "|"
			}
	}
IniRead,ksvi,SystemLocations.ini,LOCATIONS
Loop,Parse,ksvi,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,sdfj,A_LoopField,=,""
		if (sdfj2 <> "")
			{
				ifnotinstring,knownfldrs,%sdfj1%
					{
						knownfldrs.= sdfj1 . "|"
						systmfldrs.= sdfj1 . "|"
					}
			}
	}
gosub, SYSDETECT
guicontrol,,DWNLPOS,|:=:System List:=:||%systmfldrs%
overplmn=
if (OVDFLDR <> "")
	{
		overplmn= |%OVDFLDR%
	}
guicontrol,,OVDLDS,|Matching%overplmn%||%systmfldrs%
guicontrol,,SKDETSTXT,Detected Systems: %totsys%
guicontrol,,RJSYSDD,|Systems||%rjsystmfldrs%
guicontrol,,SRCHLOCDDL,|:=:System List:=:||%systmfldrs%
guicontrol,,ESDWNLPOS,|%systmfldrs%
return

EmuDetect:
emucnt= 0
fecnt= 0
emuxelst=
fexelst=
utlxelst=
kmpxelst=
guicontrol,disable,LNCHPT
guicontrol,disable,EMUDETECT
SB_SetText("...Indexing Emulator Directory....")
ifexist, Assignments.ini
	{
		if (INITIAL = "")
			{
				Msgbox,3,Re-Index,Re-index the emulator directory?`nThis may take a few minutes depending on the`nnumber of executables in your emulators directory...
					{
						ifmsgbox,yes
							{
								SB_SetText("...Indexing Emulator Directory....")
								FileCopy,sets\Assignments.set, Assignments.ini,1
								FileDelete,Apps.ini
								farvr=
							}
							else {
								return
							}
					}
			}
	}
ptadv=
Loop, Parse, UTLPartSet,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		emunmz=
		emupx1=
		emupx2=
		emupx3=
		emupx4=
		emupx5=
		stringsplit,emupx,A_LoopField,<
		emunmz= %emupx3%
		utlxelst.= emupx1 . ">" . emunmz . "|"
		ifexist, %RJEMUD%\%emupx1%\%emunmz%
			{
				emucnt+=1
				fetmp=
				prgom=
				fecnt+=1
				iniread,fetmp,apps.ini,UTILITIES,%emupx1%
				if (fetmp = "ERROR")
					{
						IniWrite, "%RJEMUD%\%emupx1%\%emunmz%",apps.ini,UTILITIES,%emupx1%
					}
				stringreplace,utlxelst,utlxelst,%emupx1%>%emunmz%,,All
				SB_SetText(" " emupx1 " found ")
				continue
			}
	}
Loop, Parse, KMPPartSet,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		emunmz=
		emupx1=
		emupx2=
		emupx3=
		emupx4=
		emupx5=
		stringsplit,emupx,A_LoopField,=
		emunmz= %emupx3%
		kmpxelst.= emupx1 . ">" . emunmz . "|"
		ifexist, %RJEMUD%\%emupx1%\%emunmz%
			{
				emucnt+=1
				prgom=
				fecnt+=1
				iniread,fetmp,apps.ini,KEYMAPPERS,%emupx1%
				if (fetmp = "ERROR")
					{
						IniWrite, "%RJEMUD%\%emupx1%\%emunmz%",apps.ini,KEYMAPPERS,%emupx1%
					}
				stringreplace,kmpxelst,kmpxelst,%emupx1%>%emunmz%,,All
				SB_SetText(" " emupx1 " found ")
				continue
			}
	}
Loop, Parse, FEPartSet,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		emunmz=
		emupx1=
		emupx2=
		emupx3=
		emupx4=
		emupx5=
		stringsplit,emupx,A_LoopField,<
		emunmz= %emupx3%
		fexelst.= emupx1 . ">" . emunmz . "|"
		ifexist, %RJEMUD%\%emupx1%\%emunmz%
			{
				emucnt+=1
				fetmp=
				fecnt+=1
				iniread,fetmp,apps.ini,FRONTENDS,%emupx1%
				if (fetmp = "ERROR")
					{
						if (instr(fesup,emupx1)&& !instr(fSYSINSTLBX,emupx1))
							{
								Menu, rjscopy, Add, Export to %emupx1%, Export_%emupx1%
								fSYSINSTLBX.= emupx1 . "|"
							}
						IniWrite, "%RJEMUD%\%emupx1%\%emunmz%",apps.ini,FRONTENDS,%emupx1%
					}
				stringreplace,fexelst,fexelst,%emupx1%>%emunmz%,,All
				continue
			}
	}
Loop, Parse, EmuPartSet,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		emunmz=
		emupx1=
		emupx2=
		emupx3=
		emupx4=
		emupx5=
		stringsplit,emupx,A_LoopField,<
		emunmz= %emupx3%
		emuxelst.= emupx1 . ">" . emunmz . "|"
		ifexist, %RJEMUD%\%emupx1%\%emunmz%
			{
				emucnt+=1
				fetmp=
				iniread,fetmp,apps.ini,EMULATORS,%emupx1%
				if (fetmp = "ERROR")
					{
						IniWrite, "%RJEMUD%\%emupx1%\%emunmz%",apps.ini,EMULATORS,%emupx1%
					}
					else {
						ifnotexist,%fetmp%
							{
								IniWrite, "%RJEMUD%\%emupx1%\%emunmz%",apps.ini,EMULATORS,%emupx1%
							}
						}
				fetmp=
				SB_SetText(" " emupx1 " found ")
				fetmploc=
				iniread,fetmploc,Assignments.ini,ASSIGNMENTS,%emupx1%
				if (fetmploc = "")
					{
						IniWrite, "%RJEMUD%\%emupx1%\%emunmz%",Assignments.ini,ASSIGNMENTS,%emupx1%
					}
					else {
						ifnotexist,%fetmploc%
							{
								IniWrite, "%RJEMUD%\%emupx1%\%emunmz%",Assignments.ini,ASSIGNMENTS,%emupx1%
							}
						}
				stringreplace,emuxelst,emuxelst,%emupx1%>%emunmz%|,,All
			}
	}
emuncnt= 0
emucnt=
farvr=
Loop, %RJEMUD%\*.exe,,1
	{
		ifinstring,emuxelst,%A_LoopFileName%|
			{
				continue
			}
		farvr.= A_LoopFileDir "|" A_LoopFileName "|" A_LoopFileFullPath "`n"
	}
SB_SetText("...Parsing indexed executables...")
Loop, parse, farvr,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		evirn1=
		evirn2=
		evirn3=
		stringsplit,evirn,A_LoopField,|
		emuxenm= %evirn2%
		emuxefp= %evirn3%
		Loop, Parse, kmpxelst,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				splemu1=
				splemu2=
				stringsplit,splemu,A_LoopField,>
				if (emuxenm = splemu2)
					{
						emucnt+=1
						emuncnt+=1
						alri=
						alrk=
						alrj=
						iniread,alri,apps.ini,KEYMAPPERS,%splemu1%
						if (alri = "ERROR")
							{
								IniWrite, "%emuxefp%",apps.ini,KEYMAPPERS,%splemu1%
							}
							else {
								ifnotexist,%alri%
									{
										IniWrite, "%emuxefp%",apps.ini,KEYMAPPERS,%splemu1%
									}
							}
					}
			}
		Loop, Parse, utlxelst,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				splemu1=
				splemu2=
				stringsplit,splemu,A_LoopField,>
				if (emuxenm = splemu2)
					{
						emucnt+=1
						emuncnt+=1
						alri=
						alrk=
						alrj=
						iniread,alri,apps.ini,UTILITIES,%splemu1%
						if (alri = "ERROR")
							{
								IniWrite, "%emuxefp%",apps.ini,UTILITIES,%splemu1%
							}
							else {
								ifnotexist,%alri%
									{
										IniWrite, "%emuxefp%",apps.ini,UTILITIES,%splemu1%
									}
							}
					}
			}
		Loop, Parse, fexelst,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				splemu1=
				splemu2=
				stringsplit,splemu,A_LoopField,>
				if (emuxenm = splemu2)
					{
						emucnt+=1
						emuncnt+=1
						alri=
						alrk=
						alrj=
						iniread,alri,apps.ini,FRONTENDS,%splemu1%
						if (alri = "ERROR")
							{
								IniWrite, "%emuxefp%",apps.ini,FRONTENDS,%splemu1%
							}
							else {
								ifnotexist,%alri%
									{
										IniWrite, "%emuxefp%",apps.ini,FRONTENDS,%splemu1%
									}
							}
						if (instr(fesup,splemu1)&& !instr(fSYSINSTLBX,splemu1))
							{
								Menu, rjscopy, Add, Export to %splemu1%, Export_%splemu1%
								fSYSINSTLBX.= splemu1 . "|"
							}	
					}
			}
		Loop, Parse, emuxelst,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				splemu1=
				splemu2=
				stringsplit,splemu,A_LoopField,>
				if (emuxenm = splemu2)
					{
						emucnt+=1
						emuncnt+=1
						alri=
						alrk=
						alrj=
						iniread,alri,apps.ini,EMULATORS,%splemu1%
						if (alri = "ERROR")
							{
								IniWrite, "%emuxefp%",apps.ini,EMULATORS,%splemu1%
							}
							else {
								ifnotexist,%alri%
									{
										IniWrite, "%emuxefp%",apps.ini,EMULATORS,%splemu1%
									}
							}
						iniread, alrk,Assignments.ini,ASSIGNMENTS,%splemu1%
						if (alrk = "")
							{
								IniWrite, "%emuxefp%",Assignments.ini,ASSIGNMENTS,%splemu1%
							}
					}
			}
	}
IniRead,amultmp,apps.ini,EMULATORS
emunumtot:= 0
Loop, Parse, amultmp,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		emunumtot+=1
	}
ratstchk=
IniRead, ratstchk,Apps.ini,GLOBAL,retroarch
if (fileexist(ratstchk))
	{
		if (INITIAL <> 1)
			{
				emunumtot+=1
				iniread,fealn,apps.ini,EMULATORS,retroarch
				if ((fealn <> "")&&(fealn <> "ERROR"))
					{
						ifnotinstring,fSYSINSTLBX,retroarch
							{
								Menu, rjscopy, Add, Export to retroarch, Export_retroarch
								fSYSINSTLBX.= "retroarch" . "|"
							}
					}
				IniWrite, "%raexedir%\%raexefile%",Apps.ini,EMULATORS,retroarch
				IniWrite, "retroarch",Assignments.ini,OVERRIDES,retroarch
				IniWrite, "%raexedir%\%raexefile%",Assignments.ini,Assignments,retroarch
				Guicontrol,,TABMENU,|Settings||:=: MAIN :=:|Emu:=:Sys|Playlists|Frontends|DAT:=:Repo|Jackets|Util|Netplay|Cores
			}
	}
IniRead,mametmp,Apps.ini,EMULATORS,MAME
if (mametmp <> "ERROR")
	{
		iniread,mamearctmp,Apps.ini,EMULATORS,mame_arcade
		if (mamearctmp = "ERROR")
			{
				iniwrite,"%mametmp%",Assignments.ini,ASSIGNMENTS,mame_arcade
				iniwrite,"%mametmp%",Apps.ini,EMULATORS,mame_arcade
			}
			else {
				ifnotexist,%mamearctmp%
					{
						iniwrite,"%mametmp%",Assignments.ini,ASSIGNMENTS,mame_arcade
						iniwrite,"%mametmp%",Apps.ini,EMULATORS,mame_arcade
					}
			}
		iniread,mamesystmp,Apps.ini,EMULATORS,mame_system
		if (mamesystmp = "ERROR")
			{
				iniwrite,"%mametmp%",Assignments.ini,ASSIGNMENTS,mame_system
				iniwrite,"%mametmp%",Apps.ini,EMULATORS,mame_system
			}
			else {
				ifnotexist,%mamesystmp%
					{
						iniwrite,"%mametmp%",Assignments.ini,ASSIGNMENTS,mame_system
						iniwrite,"%mametmp%",Apps.ini,EMULATORS,mame_system
					}
			}
	}
SB_SetText(" " emucnt " emulators found and appended.   TOTAL is:" emunumtot " ")
reasign=
IniRead,asig,Assignments.ini,ASSIGNMENTS
Loop,Parse,asig,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		StringSplit,rasig,A_LoopField,=,"
		;"
		if (rasig1 <> "")
			{
				reasign.= rasig1 . "|"
			}
		iniread,stw,emuCfgPresets.ini,%rasig1%,SUPEMU
		Loop,Parse,stw,|
			{
				iniread,fej,Assignments.ini,OVERRIDES,%rasig1%
				iniread,krtmp,apps.ini,EMULATORS,%A_LoopField%
				if (krtmp <> "ERROR")
					{
						ifinstring,fej,%A_LoopField%|
							{
								continue
							}
						ifnotinstring,fej,%A_LoopField%|
							{
								fej.= A_LoopField . "|"
								stringreplace,fej,fej,||,|,All
								iniwrite, "%fej%",Assignments.ini,OVERRIDES,%rasig1%
								prifnd= 1
								continue
							}
					}
			}
		iniread,stfe,emuCfgPresets.ini,%rasig1%,SUPCORE
		nevfdg= 
		ifexist,%raexedir%\%raexefile%
			{
				Loop, parse,stfe,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						ifexist,%raexedir%\cores\%A_LoopField%
							{
								if (!instr(nevfdg,A_LoopField . "|") && !instr(fej,A_LoopField . "|"))
									{
										nevfdg.= A_LoopField . "|"
									}
							}
					}
				nevfdg.= fej . "|"
				iniwrite,"%nevfdg%",Assignments.ini,OVERRIDES,%rasig1%
			}
	}
fileread,tdk,Assignments.ini
stringreplace,tdk,tdk,"|,",All
filedelete,Assignments.ini
fileappend,%tdk%,Assignments.ini
runlist:= corelist . "|" . addemu
stringreplace,runlist,runlist,||,|,All
stringreplace,runlist,runlist,||,|,All
stringleft,runltmp,runlist,1
if (runltmp = "|")
	{
		stringtrimleft,runlist,runlist,1
	}
guicontrol,,SKDSETXT,%emunumtot% emulators detected
gosub, resetEmuList
gosub, resetRunList
guicontrol,enable,LNCHPT
guicontrol,enable,EMUDETECT
return

OpnSyS:
gui,submit,nohide
guicontrolget,tev,,OpnSyS
guicontrol,,OpnSyS,-
if (tev = "-")
	{
		guicontrol,hide,SAVNSYS
		guicontrol,hide,ADDNSYS
		guicontrol,show,OVLIST
		guicontrol,show,EXDISPL
		guicontrol,,OpnSyS,+
		return
	}
guicontrol,show,SAVNSYS
guicontrol,show,ADDNSYS
guicontrol,hide,OVLIST
guicontrol,hide,APPOPT
guicontrol,hide,SYSNICK
guicontrol,hide,SVNICK
guicontrol,hide,DELNICK
guicontrol,hide,APPARG
guicontrol,hide,NOEXTN
guicontrol,hide,EMUPGC
guicontrol,hide,ERUN
guicontrol,hide,LRUN
guicontrol,hide,OMITQ
guicontrol,hide,OMITPTH
guicontrol,hide,EXTARUN
guicontrol,hide,SELAPP
guicontrol,hide,OPTTXT
guicontrol,hide,ARGTXT
guicontrol,,ADDNSYS,|
return

AddNSys:
gui,submit,nohide
guicontrolget,newaddedsys,,AddNSys
noaddv= 
ifinstring,newaddedsys,`%
	{
		SB_SetText("`% character not permitted")
		guicontrol,,AddNsys,|
		return
	}
ifinstring,newaddedsys,*
	{
		SB_SetText("* character not permitted")
		guicontrol,,AddNsys,|
		return
	}
ifinstring,newaddedsys,`"
;"
	{
		SB_SetText("`'' character not permitted")
		guicontrol,,AddNsys,|
		return
	}
ifinstring,newaddedsys,`\
	{
		SB_SetText("`\ character not permitted")
		guicontrol,,AddNsys,|
		return
	}
ifinstring,newaddedsys,=
	{
		SB_SetText("= character not permitted")
		guicontrol,,AddNsys,|
		return
	}
ifinstring,newaddedsys,`/
	{
		SB_SetText("`/ character not permitted")
		guicontrol,,AddNsys,|
		return
	}
ifinstring,newaddedsys,|
	{
		SB_SetText("| character not permitted")
		guicontrol,,AddNsys,|
		return
	}
ifinstring,newaddedsys,:
	{
		SB_SetText(": character not permitted")
		guicontrol,,AddNsys,|
		return
	}
ifinstring,newaddedsys,>
	{
		SB_SetText("> character not permitted")
		guicontrol,,AddNsys,|
		return
	}
ifinstring,newaddedsys,?
	{
		SB_SetText("? character not permitted")
		guicontrol,,AddNsys,|
		return
	}
ifinstring,newaddedsys,<
	{
		SB_SetText("< character not permitted")
		guicontrol,,AddNsys,|
		return
	}
return

SavNSys:
sysnw=
POPADC=
gui,submit,nohide
guicontrol,hide,SAVNSYS
guicontrol,hide,ADDNSYS
guicontrol,show,OVLIST
guicontrol,show,EXDISPL
guicontrol,,OpnSyS,+
guicontrolget,POPADC,,ADDNSYS
guicontrolget,newaddedsys,,AddNSys
stringreplace,newaddedsys,newaddedsys,:,-,All
stringreplace,newaddedsys,newaddedsys,>,-,All
stringreplace,newaddedsys,newaddedsys,<,-,All
stringreplace,newaddedsys,newaddedsys,?,-,All
stringreplace,newaddedsys,newaddedsys,*,-,All
stringreplace,newaddedsys,newaddedsys,\,-,All
stringreplace,newaddedsys,newaddedsys,/,-,All
stringreplace,newaddedsys,newaddedsys,|,-,All
stringreplace,newaddedsys,newaddedsys,=,-,All
csts_= 1
Loop,parse,SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		hui1=
		hui2=
		stringsplit,hui,A_LoopField,=
		if (newaddedsys = hui1)
			{
				SB_SetText("System Name already exists") 
				return
			}
		if instr(hui2,"_CUSTM")
			{
				csts_+=1 
			}
	}	
SysLLst.=  newaddedsys . "=" . "_CUSTM" . csts_ . "`n"
_CUSTM%csts_%= %newaddedsys%
fileappend,%newaddedsys%=_CUSTM%csts_%`n,lkup.ini
iniwrite,"",Assignments.ini,OVERRIDES,%newaddedsys%
iniwrite,"",Assignments.ini,ASSIGNMENTS,%newaddedsys%
iniwrite,$|1|1|0|1|0,LaunchParams.ini,LAUNCHPARAMS,%newaddedsys%
iniwrite,"",SystemLocations.ini,LOCATIONS,%newaddedsys%
iniwrite,%A_Space%,emuCfgPresets.ini,%newaddedsys%,RJEMUPRESET
iniwrite,0,emuCfgPresets.ini,%newaddedsys%,RJZIPPEEK
iniwrite,_CUSTM%csts_%,emuCfgPresets.ini,%newaddedsys%,SHORTNM
iniwrite,%A_Space%,emuCfgPresets.ini,%newaddedsys%,SUPEMU
iniwrite,%A_Space%,emuCfgPresets.ini,%newaddedsys%,SUPCORE
iniwrite,$|1|1|0|1|0`n,emuCfgPresets.ini,%newaddedsys%,LNCHPRM
SB_SetText(" " newaddedsys " added")
return
if (POPADC = "")
	{
		SB_SetText(" You must assign a name to the new system ")
		return
	}
sanm:= POPADC
gosub, SanitizeN
POPADC:= sanm
nmchkr=
iniread,nmchkr,Assignments.ini,ASSIGNMENTS,%POPADC%
	if (nmchkr <> "ERROR")
		{
			SB_SetText(" This system already exists ")
			return
		}
stringRight,sysnw,POPADC, 25
iniwrite, "%raexedir%\%raexefile%",Assignments.ini,ASSIGNMENTS,%POPADC%
if (sysnw <> "")
	{
		iniwrite, "%sysnw%",Assignments.ini,OVERRIDES,%POPADC%
	}
reasign .= "|" .POPADC
guicontrol,,ADDCORE,|%POPADC%||
gosub, AddCore
guicontrol,,ADDCORE,|%POPADC%||
return

SanitizeN:
stringreplace,sanm,sanm,:,-,All
stringreplace,sanm,sanm,>,-,All
stringreplace,sanm,sanm,<,-,All
stringreplace,sanm,sanm,?,-,All
stringreplace,sanm,sanm,*,-,All
stringreplace,sanm,sanm,\,-,All
stringreplace,sanm,sanm,/,-,All
stringreplace,sanm,sanm,|,-,All
stringreplace,sanm,sanm,=,-,All
return

ChkNetCRC:
dwncrcm=
if (szip = 0)
	{
		return
	}
CrCFLN:= romf
if (szip = 1)
	{
		gosub, CRCfz
		return
	}
linfo=
if (lmxt = "zip")
	{
		concatcmd= "%S_KeyDir%\bin\7za.exe" l -slt "%CrCFLN%"
		StdOut := StdoutToVar_CreateProcess(concatcmd)
		partition=
		gosub, zpcrcproc
	}
return

CRCfz:
gosub, CRC32GET
if (ApndCRC = HOSTINGCRCS)
	{
		dwncrcm= 1
		HOSTFND=
	}
return

PLISTYP:
gui, submit, nohide
guicontrolget,fenam,,PLISTTYP
INPLAYL=

if (fenam = "skeletonKeY")
	{
		xmbtog= show
		opltog= hide
		gosub,HideOtherFEPL
		Loop,Parse,SKPLISTITEMS,|
			{
				guicontrol,%xmbtog%,%A_LoopField%
			}
		guicontrol,hide,EXCLBOOL
		guicontrol,hide,INCLBOOL
		guicontrol,hide,PARSEALL
		guicontrol,hide,EXTPARSED
		guicontrol,hide,FLTXT
		guicontrol,hide,SVASPLST
		guicontrol,,ROMPOP,|
		guicontrol,,CURPLST,|
		return
	}
if (fenam = "EmulationStation")
	{
		ofetog= show
		pltog= hide
		Loop,Parse,SKPLISTITEMS,|
			{
				guicontrol,%pltog%,%A_LoopField%
			}
		Loop,Parse,PGPLITEMS,|
			{
				guicontrol,%pltog%,%A_LoopField%
			}
		Loop,Parse,RFPLITEMS,|
			{
				guicontrol,%pltog%,%A_LoopField%
			}
		opntog= hide
		gosub, ESOPNPL
		ESPLPLST=
		ESPLPLSTA=
		guicontrol,,DETECTCORE,0
		ESHOME= %CURSRPTH%\.emulationstation
		Loop, read, %ESHOME%\es_systems.cfg
			{
				if (A_LoopReadline = "")
					{
			 			continue
					}
				fjf1=
				fjf2=
				fjf3=
				stringsplit,fjf,A_loopreadline,<>
				if (fjf2 = "name")
					{
						ESPLPLST.= fjf3 . "|"
						ESPLPLSTA.= fjf3 . ","
					}
				if (fjf2 = "path")
					{
						ESPLPLSTA.=  fjf3 . ","
					}
				if (fjf2 = "extension")
					{
						ESPLPLSTA.=  fjf3 . "|"
					}
			}
		escommon= %fesyslst%
		stringreplace,ESPLPLST,ESPLPLST,||,|,All
		stringreplace,escommon,escommon,||,|,All
		if (ESRPOPPL = 1)
			{
				guicontrol,%ofetog%,ESMIRSEL
			}
		guicontrol,,ESDWNLPOS,|%systmfldrs%
		guicontrol,,ESPLXMP,|%ESPLPLST%|%systmfldrs%%escommon%
		if (ESRPOPROM = 1)
			{
				guicontrol,,ESPLXMP,|%ESPLPLST%%escommon%
				guicontrol,%ofetog%,ESROMROOT
				guicontrol,%ofetog%,ESRRTXT
			}
		;;Shared plstelements
		Loop,Parse,UNIPLITEMS,|
			{
				guicontrol,%ofetog%,%A_LoopField%
			}
		;;;;;;;;;
		guicontrol,%ofetog%,ESDWNLPOS
		guicontrol,%ofetog%,ESROMONLY
		guicontrol,%ofetog%,ESINCLF
		guicontrol,%ofetog%,ESRPOPDL
		guicontrol,%ofetog%,ESRPOPPL
		guicontrol,%ofetog%,ESRPOPROM
		guicontrol,%ofetog%,ESPLCORE
		guicontrol,%ofetog%,ESBACKUP
		guicontrol,%ofetog%,ESSVPL
		guicontrol,%ofetog%,ESPLXMP
		guicontrol,%ofetog%,ESOPENPL
		guicontrol,%ofetog%,ESUSESCR
		guicontrol,%ofetog%,ESCPYSCR
		guicontrol,%ofetog%,ESBOXSRCHBUT
		guicontrol,%ofetog%,ESBOXCHK
		guicontrol,%ofetog%,ESMRQCHK
		guicontrol,%ofetog%,ESTHMBCHK
		guicontrol,%ofetog%,ESVIDCHK
		guicontrol,%ofetog%,ESMARQSRCHBUT
		guicontrol,%ofetog%,ESTHUMBSRCHBUT
		guicontrol,%ofetog%,ESVIDSRCHBUT
		guicontrol,,ROMPOP,|
		guicontrol,,CURPLST,|
		return
	}
if (fenam = "Pegasus")
	{
		ofetog= show
		pltog= hide
		Loop,Parse,SKPLISTITEMS,|
			{
				guicontrol,%pltog%,%A_LoopField%
			}
		Loop,Parse,ESPLITEMS,|
			{
				guicontrol,%pltog%,%A_LoopField%
			}
		Loop,Parse,RFPLITEMS,|
			{
				guicontrol,%pltog%,%A_LoopField%
			}
		opntog= hide
		gosub, PGOPNPL
		PGPLPLST=
		PGPLPLSTA=
		guicontrol,,DETECTCORE,0
		if (PGHOME = "")
			{
				PGHOME= %RJEMUD%\Pegasus\config
			}
		Loop, read, %PGHOME%\metafiles\collections.pegasus.txt
			{
				if (A_LoopReadline = "")
					{
			 			continue
					}
				FileRead,fij,%A_LoopReadLine%\collections.pegasus.txt
				stringreplace,fij,fij,/,\,All
				Loop,Parse,fij,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,aij,A_LoopField,:
						if (aij1 = "game")
							{
								PGPLPLST.= aij2 . "|"
								PGPLPLSTA.= aij2 . "," . A_LoopReadLine . ","
							}
						if (aij1 = "extensions")
							{
								PGPLPLSTA.= aij2 . "|"
							}
					}
			}
		pgcommon=
		Loop, Parse,fesyslst,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				pgcommon.= A_LoopField . "|"
			}
		stringreplace,PGPLPLST,PGPLPLST,||,|,All
		stringreplace,pgcommon,pgcommon,||,|,All
		if (PGRPOPPL = 1)
			{
				guicontrol,%ofetog%,PGMIRSEL
			}
		guicontrol,,PGDWNLPOS,|%systmfldrs%
		guicontrol,,PGPLXMP,|%PGPLPLST%|%systmfldrs%%pgcommon%
		if (PGRPOPROM = 1)
			{
				guicontrol,,PGPLXMP,|%PGPLPLST%%pgcommon%
				guicontrol,%ofetog%,PGROMROOT
				guicontrol,%ofetog%,PGRRTXT
			}
		;;Shared plstelements
		Loop,Parse,UNIPLITEMS,|
			{
				guicontrol,%ofetog%,%A_LoopField%
			}
		;;;;;;;;;
		guicontrol,%ofetog%,PGDWNLPOS
		guicontrol,%ofetog%,PGRPOPDL
		guicontrol,%ofetog%,PGRPOPPL
		guicontrol,%ofetog%,PGRPOPROM
		guicontrol,%ofetog%,PGPLCORE
		guicontrol,%ofetog%,PGBACKUP
		guicontrol,%ofetog%,PGSVPL
		guicontrol,%ofetog%,PGPLXMP
		guicontrol,%ofetog%,PGOPENPL
		guicontrol,%ofetog%,PGUSPGCR
		guicontrol,%ofetog%,PGCPYSCR
		guicontrol,%ofetog%,PGBOXSRCHBUT
		guicontrol,%ofetog%,PGBOXCHK
		guicontrol,%ofetog%,PGMRQCHK
		guicontrol,%ofetog%,PGTHMBCHK
		guicontrol,%ofetog%,PGVIDCHK
		guicontrol,%ofetog%,PGMARQSRCHBUT
		guicontrol,%ofetog%,PGTHUMBSRCHBUT
		guicontrol,%ofetog%,PGVIDSRCHBUT
		guicontrol,,ROMPOP,|
		guicontrol,,CURPLST,|
		return
	}
if (fenam = "RetroFE")
	{
		ofetog= show
		pltog= hide
		Loop,Parse,SKPLISTITEMS,|
			{
				guicontrol,%pltog%,%A_LoopField%
			}
		Loop,Parse,ESPLITEMS,|
			{
				guicontrol,%pltog%,%A_LoopField%
			}
		Loop,Parse,PGPLITEMS,|
			{
				guicontrol,%pltog%,%A_LoopField%
			}
		opntog= hide
		gosub, RFOPNPL
		guicontrol,%opntog%,PLAPPND
		guicontrol,%opntog%,PLOVR
		guicontrol,%opntog%,RFBACKUP
		guicontrol,show,RFUSESCR
		RFPLPLST=
		RFPLPLSTA=
		guicontrol,,DETECTCORE,0
		if (RFHOME = "")
			{
				RFHOME= %RJEMUD%\RetroFE
			}
		Loop, read, %RFHOME%\collections\Main\menu.txt
			{
				if (A_LoopReadline = "")
					{
			 			continue
					}
				FileRead,fij,%A_LoopReadLine%\###
				stringreplace,fij,fij,/,\,All
				Loop,Parse,fij,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,aij,A_LoopField,:
						if (aij1 = "game")
							{
								RFPLPLST.= aij2 . "|"
								RFPLPLSTA.= aij2 . "," . A_LoopReadLine . ","
							}
						if (aij1 = "extensions")
							{
								RFPLPLSTA.= aij2 . "|"
							}
					}
			}
		rfcommon=
		stringreplace,RFPLPLST,RFPLPLST,||,|,All
		stringreplace,rfcommon,rfcommon,||,|,All
		if (RFRPOPPL = 1)
			{
				guicontrol,%ofetog%,RFMIRSEL
			}
		guicontrol,,RFDWNLPOS,|%systmfldrs%
		guicontrol,,RFPLXMP,|%RFPLPLST%|%systmfldrs%%rfcommon%
		if (RFRPOPROM = 1)
			{
				guicontrol,,RFPLXMP,|%RFPLPLST%%rfcommon%
				guicontrol,%ofetog%,RFROMROOT
				guicontrol,%ofetog%,RFRRTXT
			}
		;;Shared plstelements
		Loop,Parse,UNIPLITEMS,|
			{
				guicontrol,%ofetog%,%A_LoopField%
			}
		;;;;;;;;;
		guicontrol,%ofetog%,RFDWNLPOS
		guicontrol,%ofetog%,RFRPOPDL
		guicontrol,%ofetog%,RFRPOPPL
		guicontrol,%ofetog%,RFRPOPROM
		guicontrol,%ofetog%,RFPLCORE
		guicontrol,%ofetog%,RFBACKUP
		guicontrol,%ofetog%,RFSVPL
		guicontrol,%ofetog%,RFPLXMP
		guicontrol,%ofetog%,RFOPENPL
		guicontrol,%ofetog%,RFUSERFCR
		guicontrol,%ofetog%,RFCPYSCR
		guicontrol,%ofetog%,RFBOXSRCHBUT
		guicontrol,%ofetog%,RFBOXCHK
		guicontrol,%ofetog%,RFMRQCHK
		guicontrol,%ofetog%,RFTHMBCHK
		guicontrol,%ofetog%,RFVIDCHK
		guicontrol,%ofetog%,RFMARQSRCHBUT
		guicontrol,%ofetog%,RFTHUMBSRCHBUT
		guicontrol,%ofetog%,RFVIDSRCHBUT
		guicontrol,,ROMPOP,|
		guicontrol,,CURPLST,|
		return
	}
return

HideOtherFEPL:
guicontrol,,ESPLXMP,|%ESPLPLST%%escommon%%systmfldrs%
Loop,Parse,ESPLITEMS,|
	{
		guicontrol,%opltog%,%A_LoopField%
	}
guicontrol,,PGPLXMP,|%PGPLPLST%%pgcommon%%systmfldrs%
Loop,Parse,PGPLITEMS,|
	{
		guicontrol,%opltog%,%A_LoopField%
	}
guicontrol,,RFPLXMP,|%RFPLPLST%%rfcommon%%systmfldrs%
Loop,Parse,RFPLITEMS,|
	{
		guicontrol,%opltog%,%A_LoopField%
	}
return

CURPLST:
gui,submit,nohide
guicontrolget,CURPLST,,CURPLST
bltoh= %CURPLST%
crpln=
Loop, Parse, CURPLST,|
	{
		crpln+=1
	}
if (fenam = "RetroFE")
	{
		stringsplit,irjv,CURPLST,|
		plsfi= %irjv1%
		gosub, RFEDTPOP
		return
	}
if (fenam = "Pegasus")
	{
		;;gosub, PGEDTPOP
		return
	}
if (fenam = "EmulationStation")
	{
		stringsplit,irjv,CURPLST,|
		plsfi= %irjv1%
		if ((crpln > 1)&&(INPLAYL = 1))
			{
				SB_SetText("Select a single item to populate the editor.")
			}
		if (INPLAYL = 1)
			{
				gosub, ESEDTPOP
			}
		return
	}
if (crpln = 1)
	{
		sefi1=
		sefi2=
		stringsplit,sefi,CURPLST,>
		guicontrol,,PLCORE,|%sefi2%||%runlist%
		crpln=
	}
return

ADDPLSLC:
gui,submit,nohide
itmlst=
guicontrolget,DWNLPOS,,DWNLPOS
guicontrolget, PLISTTYP,,PLISTTYP
guicontrolget,pcorel,,PLCORE
if (pcorel = "")
	{
		pcorel= DETECT
		}
guicontrolget,itmlst,,ROMPOP
if (noadpl = 1)
	{
		return
		SB_SetText("Cannot add items to playlist currently being edited")
	}
IniRead,kiv,SystemLocations.ini,LOCATIONS,%DWNLPOS%
sinnz= 
pldelim= >
if (PLISTTYP = "Pegasus")
	{
		plswap= %systmfldrs%
		pldelim=
		pcorel=
		IDWNLPOS= %PGPLXMP%
	}
if (PLISTTYP = "RetroFE")
	{
		plswap= %systmfldrs%
		pldelim=
		pcorel=
		IDWNLPOS= %RFPLXMP%
	}
if (PLISTTYP = "EmulationStation")
	{
		plswap= %ESPLPLST%
		pldelim= :
		pcorel=
		IDWNLPOS= %ESPLXMP%
	}
if ((DWNLPOS = ":=:System List:=:")or(kiv = "ERROR"))
	{
		insrtsys= %RJSYSTEMS%\%DWNLPOS%
		gosub, itmlstp
		goto, itmlstpc	
	}
Loop,parse,kiv,|
	{
		newn= %A_LoopField%\
		insrtsys= %newn%\
		gosub, itmlstp
	}
itmlstp:
Loop, Parse, itmLst,|
	{
		if (A_LoopField = "")
			{
				continue
			}				
		ifnotinstring,A_LoopField,:
			{
				sinnz:= insrtsys . A_LoopField . pldelim . pcorel
			}
			else {
				sinnz:=  A_LoopField . ">" . pcorel
			}
		ifnotinstring,existlst,%sinnz%|
			{
				existlst.= sinnz . "|"
			}
		stringreplace,itmlst,itmlst,%A_LoopField%,,All
	}
itmlstpc:	
guicontrol,,CURPLST,|%existlst%
ifinstring,sysposb,|%DWNLPOS%|
	{
		guicontrol,,PLNAMEDT,|%DWNLPOS%|%sysposb%
	}
return

DragROM:
if (RPDND = 1)
	{
		Guicontrol,,ESCPYSCR,1
	}
return


Recurse:
gui,submit,nohide
guicontrolget, RECURSE,,RECURSE
gosub, ClearROMPop
return

RPopPl:
gui,submit,nohide
guicontrol, hide, RECURSE
guicontrol, hide, RECURTX
guicontrol,,DWNLPOS,|Playlists||%plistfiles%
return

RPopDl:
gui,submit,nohide
guicontrolget,fenam,,PLISTTYP
guicontrol, show, RECURSE
guicontrol, show, RECURTX
guicontrol,,DWNLPOS,|:=:System List:=:||%systmfldrs%
return

DetectCore:
gui, submit,nohide
guicontrol,disable,PLCORE
if (DETECTCORE = 0)
	{
		guicontrol,enable,SVAPLST
		guicontrol,enable,PLCORE
		gosub, CorePLInfo
		return
	}
guicontrol,disable,PLCORE
guicontrol,,PLCORE,||%runlist%
guicontrol,,PGCONFG,0
CRDETECT= DETECT
NMDETECT= DETECT
return

ClearCurList:
gui, submit, nohide
popPlist=
poptl=
curplist=
newplst=
existlst=
if (plopen = 1)
	{
		guicontrol,enable,ROMPOP
		guicontrol,enable,DWNLPOS
		guicontrol,enable,SVPLST
		guicontrol,enable,BRADD
		guicontrol,enable,CPYPL
		guicontrol,enable,PLAPPND
		guicontrol,enable,PLISTYP
		guicontrol,enable,PLOVR
		guicontrol,enable,PLCORE
		guicontrol,enable,DETECTCORE
		guicontrol,enable,PLNAMEDT
		guicontrol,disable,SVASPLST
		guicontrol,hide,SVASPLST
		guicontrol,show,OPNPLST
		guicontrol,enable,OPNPLST
	}
if (fenam = "RetroFE")
	{
		FileDelete,rj\RF\%syssub%\*.ini
	}
if (fenam = "Pegasus")
	{
		FileDelete,rj\PG\%syssub%\*.ini
	}
if (fenam = "EmulationStation")
	{
		FileDelete,rj\ES\%syssub%\*.ini
	}
guicontrol,,CURPLST,|
existingpop=
POPLDWN=
return

ClearROMPop:
popPlist=
poptl=
curplist=
newplst=
existlst=
if (plopen = 1)
	{
		guicontrol,enable,ROMPOP
		guicontrol,enable,DWNLPOS
		guicontrol,enable,SVPLST
		guicontrol,enable,BRADD
		guicontrol,enable,CPYPL
		guicontrol,enable,PLAPPND
		guicontrol,enable,PLOVR
		guicontrol,enable,PLCORE
		guicontrol,enable,DETECTCORE
		guicontrol,enable,PLNAMEDT
		guicontrol,disable,SVASPLST
		guicontrol,hide,SVASPLST
		guicontrol,show,OPNPLST
		guicontrol,enable,OPNPLST
	}
guicontrol,,ROMPOP,|
existingpop=
POPLDWN=
noadpl=
gui, submit, nohide
return

CorePLInfo:
gui, submit, nohide
guicontrolget,plcortmp,,PLCORE
stringtrimright,ccv,plcortmp,13
splitpath,plcortmp,slkp,,dlx
CRDETECT= %raexedir%\cores\%plcortmp%
NMDETECT= %corcfgnam%
gosub, getCREN
if (dlx <> "dll")
	{
		iniread,RDETECT,Assignments.ini,OVERRIDES,
		lvtd1=
		lvtd2=
		StringSplit,lvtd,RDETECT,=
		stringsplit,aij,lvtd2,|
		lvtd2= %aij2%
		if (lvtd2 = plcortmp)
			{
				iniread,CRDETECT,Assignments.ini,ASSIGNMENTS,%lvtd1%
				NMDETECT= %plcortmp%
			}
		return
	}
if (szip = 1)
	{
		guicontrol,,ZIPSEEK,0
	}
return

PlaylistAppend:
return

SvAsPlst:
SB_SetText("Saving Playlist ... ")
gui,submit,nohide
svplst=
FileSelectFile,svplst,S2,%playlistLoc%,Save Playlist File,*.lpl
if (svplst = "")
	{
		return
	}
noadpl=
splitpath,svplst,svplf,svpld,svplext,SYSNAME
FileMove,%popPlist%,%svplst%,1
SB_SetText(" " svplst " saved")
gosub, ClearROMPop
gosub, ClearCurList
return

OpnPlst:
plopen=
popAlist=
popBPlist=
vividx=
FileSelectFile,popAlist,3,%playlistLoc%,Select a Playlist,*.lpl
if ((popAlist = "")or(popAList = historyloc))
	{
		return
	}
noadpl= 1
SplitPath,popAlist,,popPth,,popPname
FileCopy,%popAList%,tmp.lpl,1
popBPlist= tmp.lpl
plopen= 1
popnum:= 1
vlin= 
SB_SetText(" " popPname ".lpl currently selected ")
guicontrol,,PLOVR,1
guicontrol,disable,PLNAMEDT
guicontrol,disable,PLISTYP
guicontrol,disable,PLOVR
guicontrol,enable,SVASPLST
guicontrol,hide,OPNPLST
guicontrol,disable,OPNPLST
guicontrol,,CURPLST,
Loop, Read, %popBPlist%
	{
		stringsplit,fej,A_LoopReadLine,"
		;"
		vlin+= 1
		popnin:= vlin + 2
		if (fej2 = "path")	
			{
				stringreplace,fej4,fej4,\\,\,All
				filereadline,nppl,%popBPlist%,%popnin%
				stringsplit,eje,nppl,"
				;"
				poptl.= fej4 . ">" . eje4 . "|"
			}			
	}
guicontrol,,CURPLST,|%poptl%
guicontrol,,PLNAMEDT,|%popPname%||%systmfldrs%
existlst= %poptl%
popPlist= %poptl%
newplst= %poptl%
return

ExtParsed:
gui, submit, nohide
guicontrolget,omitxtv,,EXTPARSED
return

EXCLBool:
INCLBool:
gui, submit, nohide
guicontrolget, filtxtnl, ,EXTPARSED
guicontrolget, popfiltlst, ,ROMPOP
guicontrolget, DWNLPOS,,DWNLPOS
guicontrolget, RECURSE,,RECURSE
StringReplace, xtnprs, filtxtnl,`,,|,All
stringsplit,omitxtn,xtnprs,|
guicontrol,,EXTPARSED,|
if (INCLBOOL = 1)
	{
		gosub, ExtParsing
	}
if (EXCLBOOL = 1)
	{
		guicontrol,,EXTPARSED,|%omitxj%||
	}
return

FltXt:
gui,submit,nohide
guicontrol,disable,FLTXT
guicontrol,disable,RPopDl
guicontrol,disable,RPopPl
guicontrol,disable,ROMPOP
guicontrol,disable,PARSEALL
guicontrol,disable,EXTPARSED
guicontrol,disable,RECURSE
guicontrolget,DETECTCORE,,DETECTCORE
guicontrolget,INCLBOOL,,INCLBOOL
guicontrolget,EXCLBOOL,,EXCLBOOL

guicontrolget, filtxtnl, ,EXTPARSED
stringreplace,splfilt,filtxtnl,.,,All
stringsplit,fltselc,splfilt,|
StringReplace, xtnprs, fltselc1,`,,|,All

guicontrolget, DWNLPOS,,DWNLPOS
guicontrolget, RECURSE,,RECURSE
stringsplit,omitxtn,xtnprs,|
POPLDWN=
if (EXCLBOOL = 1)
	{
		gosub, OutList
		guicontrol,enable,RPopDl
		guicontrol,enable,RPopPl
		guicontrol,enable,ROMPOP
		guicontrol,enable,PARSEALL
		guicontrol,enable,EXTPARSED
		guicontrol,enable,RECURSE
		guicontrol,enable,FLTXT
		return
	}
IniRead,kef,SystemLocations.ini,LOCATIONS,%DWNLPOS%
Loop,parse,kef,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		sbn=
		Loop,%A_LoopField%\*.*,,%RECURSE%
			{
				ext= %A_LoopFileExt%|
				noapl=
				if instr(xtnprs,ext)
					{
						sbn+=1
						POPLDWN .= A_LoopFileFullPath . "|"
					}
			}
	}
stringreplace,POPLDWN,POPLDWN,%RJSYSTEMS%\%DWNLPOS%\,,All
guicontrol,,ROMPOP,|%POPLDWN%
SB_SetText(" " sbn " items in the directory")	
guicontrol,enable,RPopDl
guicontrol,enable,RPopPl
guicontrol,enable,ROMPOP
guicontrol,enable,PARSEALL
guicontrol,enable,EXTPARSED
guicontrol,enable,RECURSE
guicontrol,enable,FLTXT
return

PopFolders:
Iniread, RJSYSTEMS, Settings.ini,GLOBAL,systems_directory
if (RJSYSTEMS = "ERROR")
	{
		RJSYSTEMS= %coreassetsdirectory%
		IniWrite, "%coreassetsdirectory%",Settings.ini,GLOBAL,systems_directory
	}
if (RJSYSTEMS = "")
	{
		RJSYSTEMS= %coreassetsdirectory%
		IniWrite, "%coreassetsdirectory%",Settings.ini,GLOBAL,systems_directory
	}
totsys:= 0
allsys=
systmfldrs=
knownfldrs=
dwnlfldrs=
Loop, %RJSYSTEMS%\*,2
	{
		if A_LoopFileAttrib contains H
			{
				continue
			}
		allsys+=1
		sysnam= %A_LoopFileName%
		systmfldrs .= A_LoopFileName . "|"
		dwnlfldrs .= A_LoopFileName . "|"
		Loop,Parse,SysLLst,`n`r
			{
				systmpnm1=
				systmpnm2=
				stringsplit, systmpnm, A_LoopField,=
				if (sysnam = systmpnm1)
					{
						totsys+= 1
						knownfldrs.= sysnam . "|"
					}
			}
	}
IniRead,suvai,SystemLocations.ini,LOCATIONS
Loop,parse,suvai,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,aei,A_LoopField,=,""
		if (aei2 <> "")
			{
				ifnotinstring,knownfldrs,%aei1%|
					{
						totsys+= 1
						systmfldrs.= aei1 . "|"
						dwnlfldrs.= aei1 . "|"
						knownfldrs.= aei1 . "|"
					}
			}
	}
guicontrol,,DWNLPOS,|:=:System List:=:||%systmfldrs%
guicontrol,,SKSYSDISP,%RJSYSTEMS%
guicontrol,,RJSYSDD,|Systems||%systmfldrs%
return

POPLDDL:
gui, submit, nohide

guicontrol, show, RECURTX
guicontrol, show, RECURSE
guicontrol, show, EXCLBOOL
guicontrol, show, FLTXT
guicontrol, show, INCLBOOL
guicontrol, show, RECURSE
guicontrol, show, EXTPARSED
guicontrol,enable,RPopDl
guicontrol,enable,RPopPl
guicontrol,enable,PARSEALL
guicontrol,enable,EXTPARSED
guicontrol,enable,RECURSE
guicontrol,enable,FLTXT
guicontrolget,RPOPDL,,RPOPDL
guicontrolget, DWNLPOS,,DWNLPOS
guicontrol,,PLNAMEDT,|%DWNLPOS%||%sysposb%
guicontrolget, RECURSE,,RECURSED
guicontrol,,EXCLBOOL,0
EXCLBOOL= 0
INCLBOOL= 1
guicontrol,,INCLBOOL,1
guicontrol,,RECURSE,1
guicontrol,,EXTPARSED, |
if (DWNLPOS = ":=:System List:=:")
	{
		guicontrol,,RECURSE,0
		guicontrol, ,EXCLBOOL, 1
		guicontrol, ,EXTPARSED, |
		return
	}
	
ExtParsing:
omitxtv=
listswp=
matchinfo=
POPLDWN=
EXTPARSED=
extoutp1=
extoutp2=
omitxtr= 
allxtn= 
PLCORE=
if (raexeloc <> "")
	{		
		IniRead,stevr,emuCfgPresets.ini,%DWNLPOS%,SUPCORE
		if ((stevr <> "")&&(stevr <> "ERROR"))
			{
				jinj=	
				Loop, Parse, stevr,|
					{						
						if (A_LoopField = "")
							{
								continue
							}
						jinj+=	1
						if (jinj = 1)
							{
								ifExist, %raexedir%\cores\%A_LoopField%
									{
										guicontrol,,PLCORE,|%A_LoopField%||%runlist%
										PLCORE= %A_LoopField%
									}
							}
						stringreplace,matchinfo,A_LoopField,.dll,.info,All
						ifexist,%raexedir%\info\%matchinfo%
							{
								FileRead,nioh,%raexedir%\info\%matchinfo%
								Loop,parse,nioh,`n`r
									{
										if (A_LoopField = "")
											{
												continue
											}
										extoutp1=
										extoutp2=
										stringsplit,extoutp, A_LoopField,=,%A_Space% ""
										if (extoutp1 = "supported_extensions")
											{
												Loop,Parse,extoutp2,|
													{
														ifnotinstring,allxtn,%A_LoopField%
															{
																allxtn.= A_LoopField . ","
															}	
													}
												listswp= 1
												StringReplace, omitxtv, extoutp2,|,`,,All
												libxtn= %omitxtv%	
												break
											}
									}
							}
					}
			}
	}
iniread,fein,emuCfgPresets.ini,%DWNLPOS%,RJROMXT
if ((fein <> "ERROR")&&(fein <> ""))
	{
		stringreplace,fein,fein,.,,All
		omitxtc= 
		Loop,parse,fein,`,
			{
				if (A_LoopField = "")
					{
						continue
					}
				ifnotinstring,omitxtv,`,%A_LoopField%
					{
						if (omitxtc = "")
							{
								omitxtc.= A_LoopField
								continue
							}
						omitxtc.= "," . A_LoopField
						ifnotinstring,omitxtv,%A_LoopField%
							{
								if (A_LoopField = "zip")
									{
										if (noinclz <> 1)
											{
												omitxtc:= A_LoopField . "," . omitxtc											
											}
									}
								else {
										omitxtc:= A_LoopField . "," . omitxtc									
									}
							ifnotinstring,allxtn,%A_LoopField%
								{
									allxtn.= A_LoopField . ","
								}		
							}
					}
			}	
		omitxtv:= omitxtc . "," . omitxtv
		stringreplace,omitxtv,omitxtv,.,,All
	}
if (libxtn <> "")
	{
		omitxtv:= omitxtv . "|" . "|" . libxtn
		if instr(PLCORE,"_libretro.dll")&&(DETECTCORE <> 1)
			{
				omitxtv:= libxtn . "|" . "|" . omitxtv . "|" . allxtn
			}
	}
	else {
		if (omitxtc <> "")
			{
				omitxtv:= omitxtv . "|" . "|" . omitxtc
			}
	}
exclinc:

stringreplace,omitxts,omitxtv,||,|,,All
stringleft,omitxtsv,omitxtv,1
if (omitxtsc = "|")
	{
		stringtrimleft,omitxtv,omitxts,1
	}

PIIPDXTF:
guicontrol,,EXTPARSED,|%omitxtv%|
omitxtva= 
Loop,parse,omitxtv,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		ifnotinstring,omitxtva,%A_LoopField%
			{
				omitxtva.= A_LoopField . "|"
			}
	}
omitxtv= %omitxtva%
return

PopPLpl:
gui,submit,nohide
guicontrol, hide, RECURTX
guicontrol, hide, RECURSE
PLineNum=
PLineAdd=
poptadd=
newPlF=
splitpath,DWNLPOS,,,,DDLUX
Loop, Read, %playlistLoc%\%DWNLPOS%
	{
		if (A_LoopReadLine = "")
			{
				continue
			}
		PLineNum+=1
		PLineAdd+=1
		if (PLineAdd = 1)
			{
				romhn1=
				romhn2=
				if (A_LoopReadLine = "{")
					{
						newPlF= 1
						continue
					}
				if (newPlF = "")
					{
						StringSplit,romhn,A_LoopReadLine,#
						if (romhn2 = "")
							{
								romhn2= %romhn1%
							}
						if (romf = "")
							{
								romf= %romhn1%
							}
						poptadd.= romhn1 . "|"
					}
			}
		if (newPlF = 1)
				{
					Stringreplace,romha,A_LoopReadLine,"path":%A_Space%,,UseErrorLevel
					if (ERRORLEVEL = 1)
						{
							finumb:= A_Index+2
							stringtrimright,romha,romha,1
							stringreplace,romha,romha,\\,\,All
							stringreplace,romha,romha,",,All
							;"
							ifinstring,romha,.zip#
								{
									stringsplit,romhn,romha,#
									romf= %romhn2%
								}
								else {
										romf= %romha%
								}
							poptadd.= romf . "|"
							PLineAdd=
						}
					continue
				}
		if (PLineAdd =  6)
			{
				PLineAdd=
			}
	}

splitpath,DWNLPOS,,,,DWNLPOZ
stringreplace,poptadd,poptadd,%RJSYSTEMS%\%DWNLPOZ%\,,All
guicontrol,,ROMPOP,|%poptadd%
gosub, EDTROM
return

OutList:
listswp=
matchinfo=
EXTPARSED=
extoutp1=
extoutp2=
omitxtd=
ekn=
POPLDWN=
iniread,ebui,SystemLocations.ini,LOCATIONS,%DWNLPOS%
Loop,parse,ebui,|
	{
		if (A_LoopField = "")
			{
				continue
			}	
		Loop,%A_LoopField%\*.*,,%RECURSE%
			{
				ext= %A_LoopFileExt%
				APL=
				Loop,parse,splfilt,`,
					{
						if (A_LoopField = "")
							{
								continue
							}
						if (A_LoopField = ext)
							{
								APL= 1
								break
							}
					}
				if (apl = "")
					{
						ekn+=1
						POPLDWN.= A_LoopFileFullPath . "|"
					}
			}
	}
SB_SetText(" " ekn " items added")	
stringreplace,POPLDWN,POPLDWN,%RJSYSTEMS%\%DWNLPOS%\,,All
guicontrol,,ROMPOP,|%POPLDWN%
return

MVPLOU:
SB_SetText("")
ControlGet, existlst, List, , , ahk_id %insel%
stringreplace,existlst,existlst,`n,|,All
Loop, Parse, CURPLST,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		snfind= %A_LoopField%
		newnum=
		olnum=
		Loop, Parse, existlst,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				olnum+=1
				systmv= A_LoopField
				if (A_LoopField = snfind)
					{
						newnum:= olnum-1
					}
			}
		if (newnum = 0)
			{
				sb_settext("Cannot move up")
				return
			}
		TCURPLST=
		olnum=
		Loop, Parse, existlst,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				olnum+=1
				if (A_LoopField = snfind)
					{
						continue
					}
				if (olnum = newnum)
					{
						TCURPLST.= snfind . "|"
					}
				TCURPLST.= A_LoopField . "|"
			}
	}
existlst= %TCURPLST%
guicontrol,,CURPLST,|%existlst%
LBEX_SetSel(insel,newnum)
LBEX_SetFocus(insel,newnum)
return

MVPLOD:
ControlGet, existlst, List, , , ahk_id %insel%
stringreplace,existlst,existlst,`n,|,All
Loop, Parse, CURPLST,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		SB_SetText("")
		mvnum=
		mvtm=
		snfind= %A_LoopField%
		Loop, Parse, existlst,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				mvnum+=1
				if (A_LoopField = snfind)
					{
						mvtm:= mvnum+1
					}
			}
		totord:= mvnum
		if (mvtm > totord)
			{
				SB_SetText(" Cannot Move further down.")
				return
			}
		TCURPLST=
		mvnum=
		Loop, Parse, existlst,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				mvnum+=1
				if (A_LoopField = snfind)
					{
						continue
					}
				TCURPLST.= A_LoopField . "|"
				if (mvtm = mvnum)
					{
						TCURPLST.= snfind . "|"
					}
			}
	}
existlst= %TCURPLST%
guicontrol,,CURPLST,|%existlst%
LBEX_SetSel(insel,mvtm)
LBEX_SetFocus(insel,mvtm)
return

ParseAll:
gui, submit, nohide
guicontrolget,PARSEALL,,PARSEALL
return

PLPerGameConfig:
gui, submit, nohide
if (PGCONFG = 1)
	{
		gameSpecificOptions= true
		IniWrite, "%gameSpecificOptions%", %curcfg%,OPTIONS,game_specific_options
	}
return

PopulateCore:
gui, submit, nohide
guicontrolget,PLCOREG,,PLCORE
if (PLCOREG = "")
	{
	}
gosub, CorePLInfo
return

RemFromPL:
ifexist,rj\ES\%syssub%\%gamesel%.ini
	{
		FileDelete,rj\ES\%syssub%\%gamesel%.ini
	}
ControlGet,curpllst, List,,,ahk_id %insel%
stringreplace,CURPLLST,CURPLLST,`n,|,All
nwplst=
Loop, Parse, CURPLLST,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		TPLS= %A_LoopField%
		instin=
		Loop, Parse, CURPLST,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (A_LoopField = TPLS)
					{
						instin= 1
					}
			}
		if (instin = "")
			{
				nwplst.= TPLS . "|"
			}
	}
ESINIPOP= %nwplst%
existlst= %nwplst%
guicontrol,,CURPLST,|%existlst%
gosub, CURPLST
return

PLLISTALL:
Gui +LastFound
PostMessage, 0x185, 1, -1, , ahk_id %LFTLSTBX%
return

PLLISTN:
GuiControl, Focus, ROMPOP
GuiControl, Choose, ROMPOP, 0
return

PLLISTSORT:
gui,submit,nohide
PLLISTSORT=
GuiControl, Choose, CURPLST, 0
ControlGet, CURPLST, List, , , ahk_id %insel%
stringreplace,PLLISTSORT,CURPLST,`n,|,All
incr=
pltsrt=
Loop, Parse, PLLISTSORT,|
	{
		incr+= 1
		aie= %A_LoopField%
		splitpath,aie,plrmt,plrmd,plrmx
		pltsrt.= plrmt . ":" . incr . "|"
	}
Sort,pltsrt,D|
CURPLST=
Loop, Parse, pltsrt,|
	{
		stringsplit,inad,A_LoopField,:
		ingr=
		Loop, Parse, PLLISTSORT,|
			{
				ingr+=1
				if (ingr = inad2)
					{
						CURPLST.= A_LoopField . "|"
					}
			}
	}
guicontrol,,CURPLST,|%CURPLST%
return

CopyToPl:
coreInJV= DETECT
stringreplace,IDWNLPOS,DWNLPOS,.lpl,,All
guicontrolget, PLISTTYP,,PLISTTYP
guicontrolget, ESPLXMP,,ESDWNLPOS
guicontrolget, PGPLXMP,,PGDWNLPOS
guicontrolget, RFPLXMP,,RFDWNLPOS
guicontrolget, coreInJV,,plcore
if (coreInJV = "")
	{
		coreInJV= DETECT
	}
pldelim= >
if (PLISTTYP = "Pegasus")
	{
		plswap= %systmfldrs%
		pldelim=
		coreInJV=
		IDWNLPOS= %PGPLXMP%
	}
if (PLISTTYP = "RetroFE")
	{
		plswap= %systmfldrs%
		pldelim=
		coreInJV=
		IDWNLPOS= %RFPLXMP%
	}
if (PLISTTYP = "EmulationStation")
	{
		plswap= %ESPLPLST%
		pldelim= :
		coreInJV= %ESPLXMP%
		IDWNLPOS= %ESPLXMP%
	}
if (DETECTCORE = 1)
	{
		coreInJV= DETECT
	}
ToPlFromSRCH:
passlist=
guicontrolget, passlist, ,ROMPOP
iniread,systpl,SystemLocations.ini,LOCATIONS,%IDWNLPOS%
if ((systpl = "ERROR")or(systpl = ""))
	{
		prtsub= %RJSYSTEMS%\%IDWNLPOS%
		goto,passlist
	}
Loop,parse,systpl,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		prtsub= %A_LoopField%
		gosub,passlist
	}
goto, cplist	
passlist:	
Loop, Parse, passlist,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		ifinstring,A_LoopField,:
			{
				existlst.= A_LoopField . pldelim . coreInJV . "|"
				continue
			}
		existlst.= prtsub . "\" . A_LoopField . pldelim . coreInJV . "|"
	}
cplist:	
guicontrol,,CURPLST, |%existlst%
gui, submit, nohide
return

NiceName:
Loop, Read, sets\MAME - Arcade.set
	{
		stringsplit,romtitl,A_LoopReadLine,|
		if (romn = romtitl1)
			{
				romname= %romtitl2%
			}
	}
return

createPLNAME:
msgbox,,No Playlist Name,A playlist name must be specified to create a playlist.
return

SaveToPl:
gui,submit,nohide
SB_SetText("Creating Playlist ... ")
plsave= %playlistLoc%
if (plsave = "")
	{
		plsave= %raexedir%\playlists
	}
coreloc= %raexedir%\cores
plstdir= %playlistLoc%
ifnotexist, %plstdir%
	{
		FileCreateDir,%plstdir%
	}
ControlGet,curpllst, List,,,ahk_id %insel%
existlst=
Loop, Parse,curplLst,`n`r
	{
		if (A_LoopField <> ",")
			{
				taih1=
				taih2=
				existlst .= (A_Index == 1 ? "" : "|") . A_LoopField
			}
	}
plmatch=
plsep=
plsep1=
plsep2=
coretitle=
SYSNAME= %popPname%
stringreplace,SYSNAME,SYSNAME,.lpl,,All
if (popPname = "")
	{
		guicontrolget,SYSNAME,,PLNAMEDT
		if (SYSNAME = "")
			{
				goto, createPLNAME
			}
	}
guicontrolget,ZIPSEEK,,ZIPSEEK
PlaylistSaving:
guicontrol, disable, CLRPP
guicontrol, disable, PLINIT
guicontrol, disable, MVPLOU
guicontrol, disable, MVPLOD
guicontrol, disable, CLRPL
guicontrol, disable, BRADD
guicontrol, disable, CPYPL
guicontrol, disable, SVAPLST
guicontrol, disable, SVPLST
guicontrol, disable, REMPL
ARCDTYP=
guicontrolget, plmatch, ,PLCORE
stringreplace, plsep,plmatch,_libretro.dll,|,All
stringsplit, plund,plsep,_ |
stringreplace, ccv, plmatch,_libretro.dll, ,All
coretitle= %plund1% %plund2% %plund3%
stringleft,arcdt,plsep,4
if (SYSNAME = "MAME")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "MAME - Arcade")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "Sega - Model 2")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "Sega - Model 3")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "Capcom Play System - CPS III")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "Capcom Play System - CPS II")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "Capcom Play System - CPS")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "SNK - Neo Geo MVS")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "SNK - Neo Geo AES")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "Sega - NAOMI")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "Sammy - Atomiswave")
	{
		ARCDTYP= 1
	}
if (arcdt = "mame")
	{
		ARCDTYP= 1
	}
if (arcdt = "fbal")
	{
		ARCDTYP= 1
	}
FileDelete,tmp.lpl
krnum=
Loop, Parse, existlst,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		INZIP=
		ApndCRC=
		taih1=
		taih2=
		splvar= >
		if (PLISTTYP = "RetroFE")
			{
				splvar= :
			}
		if (PLISTTYP = "Pegasus")
			{
				splvar= :
			}
		if (PLISTTYP = "EmulationStation")
			{
				splvar= :
			}
		krnum+=1
		if (krnum = 1)
			{
				fileappend,{`n,*tmp.lpl
				fileappend,%A_SPace%%A_SPace%"version": "1.0"`,`n,*tmp.lpl
				fileappend,%A_SPace%%A_SPace%"items": [`n,*tmp.lpl
				fileappend,%A_SPace%%A_SPace%%A_SPace%%A_SPace%{`n,*tmp.lpl
			}
			else {
					FileAppend,%pspxe%}`,`n%pspxe%{`n,*tmp.lpl
			}
		stringsplit,taih,A_LoopField,%splvar%
		coreselv= %taih2%
		CrCFLN= %taih1%
		if (A_LoopField = "")
			{
				continue
			}
		if (taih1 = ".")
			{
				continue
			}
		splitpath,taih1,romn,romind,romext,romname
		CRDETECT= %taih2%
		NMDETECT= %taih2%
		if (romext = "zip")
			{
				INZIP= 1
			}
		if (romext = "7z")
			{
				INZIP= 1
			}
		stringreplace,ccv,CRDETECT,_libretro.dll,,All
		gsol= %CRDETECT%
		gosub, GetCren
		NMDETECT= %corcfgnam%
		ifinstring,CRDETECT,_libretro.dll
			{
				stringreplace,CRDETECT,CRDETECT,%raexedir%\cores\,,All
				CRDETECT= %raexedir%\cores\%CRDETECT%
			}
		if (ZIPSEEK = 1)
			{
				frz= 1
				gosub, ZIPCRC
				frz=
			}
		if (ZIPSEEK = 0)
			{
				INZIP=
			}
		if (INZIP = "")
			{
				stringreplace,taih1,taih1,\,\\,All
				Fileappend,%pspce%"path":%A_Space%"%taih1%"`,`n,*tmp.lpl
				if (ARCDTYP = 1)
						{
							gosub, NiceName
						}
				;;stringreplace,romname,romname,[,(,All
				;;stringreplace,romname,romname,],),All
				FileAppend,%pspce%"label":%A_Space%"%romname%"`,`n,*tmp.lpl
				stringreplace,CRDETECT,CRDETECT,\,\\,All
				FileAppend,%pspce%"core_path":%A_Space%"%CRDETECT%"`,`n,*tmp.lpl
				FileAppend,%pspce%"core_name":%A_Space%"%NMDETECT%"`,`n,*tmp.lpl
				ApndCRC= 0000000
				if (CRCENBL = 1)
					{
						gosub, CRC32GET
					}
				FileAppend,%pspce%"crc32":%A_Space%"%ApndCRC%|crc"`,`n,*tmp.lpl
				FileAppend,%pspce%"db_name":%A_Space%"[PLSYS]"`n,*tmp.lpl
			}
	}
FileAppend,%pspxe%}`n%A_Space%%A_Space%]`n}`n,*tmp.lpl
FileRead, planm, tmp.lpl
StringReplace, grb, planm, [PLSYS],%SYSNAME%.lpl, All
rbldb=
ifexist,%plsave%\%SYSNAME%.lpl
	{
		rbldb= 1
	}
guicontrolget,PLCTYP,,PLOVR
if (PLCTYP = 1)
	{
		FileDelete,%plsave%\%SYSNAME%.lpl
	}
FileAppend, %grb%`n,*%plsave%\%SYSNAME%.lpl
if (TmplCfg = "")
	{
		TemplCfg= %curcfg%
	}
if (PGCONFG = 1)
	{
		gosub, getCREN
		ifnotexist,,%raexedir%\config\%corcfgnam%
			{
				FileCreateDir,%raexedir%\config\%corcfgnam%
			}
		Loop,Parse,existlst,|
			{
				taih1=
				taih2=
				stringsplit,taih,A_LoopField,>
				splitpath,taih1,romn, ,romext,romname
				FileCopy,%TemplCfg%,%raexedir%\config\%corcfgnam%\%romname%.cfg,%PLOVR%
			}
	}
guicontrol, enable, CLRPP
guicontrol, enable, CLRPL
guicontrol, enable, MVPLOU
guicontrol, enable, MVPLOD
guicontrol, enable, PLINIT
guicontrol, enable, BRADD
guicontrol, enable, CPYPL
guicontrol, enable, SVAPLST
guicontrol, enable, SVPLST
guicontrol, enable, REMPL
msgbox,0,,"%plsave%\%SYSNAME%.lpl" playlist created.,5
gosub, resetPlaylists
SB_SetText(" Playlsit -" SYSNAME "- created ")
if (rbldb = 1)
	{
		gosub, PlaylistInit
		return
	}
gosub, ApndPL
return

CRCENBL:
gui,submit,nohide
return

ZipSeek:
gui, submit,nohide
return

ApndPL:
FileDelete,tmp.ini
Loop, Read, %plsave%\%SYSNAME%.lpl
	{
			totn+= 1
			anum+= 1
			if (anum = 1)
				{
					fnm= %A_LoopReadLine%
				}
			if (anum = 5)
				{
					gten:= ""
					gten:= totn - 4
					stringsplit, crchsh,A_LoopReadLine,|
					FileAppend,%fnm%|%pln%|%gten%|%crchsh1%`n,tmp.ini
				}
			if (anum = 6)
				{
					anum=
				}
		}
FileRead, newpl,tmp.ini
Runwait, %comspec% cmd /c "copy /b tmp.ini + hashdb.ini fullhash.ini",,Hide
FileMove,fullhash.ini,hashdb.ini,1
return

PlaylistEdit:
SYSNAME= %PLNAMEDT%
gui, submit, nohide
return

MatchEmu:
recore=
if (LNCHPT = 0)
	{
		goto, MatchSyst
	}
oil=
iniread,oil,Assignments.ini,OVERRIDES,%keyout%
if ((oil = "ERROR")or(keyout = ""))
	{
		ARCCORES=
		topcore= ||%runlist%
		goto, INSCOR
	}
if (oil = "")
	{
		iniread,vchk,emuCfgPresets.ini,%keyout%,SUPEMU
		if ((vchk <> "ERROR")&&(vchk <> ""))
			{
				Loop,parse,vchk,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						iniread,vki,Assignments.ini,ASSIGNMENTS,%A_LoopField%
						if ((vki <> "")&&(vki <> "ERROR"))
							{
								oil= %A_LoopField%
								break
							}
							else {
								oil= 
							}
					}
			}
	}
stringsplit,aix,oil,|
oil= %aix1%
coreselv= %oil%
topcore:= oil . "||" runlist
goto,INSCOR
recore=
ARCCORES=
ifinstring,SysLLst,%keyout%=
	{
		iniread,symfc,emuCfgPresets.ini,%keyout%,SUPCORE
		if (raexefile <> "")
			{
				Loop, Parse, symfc,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						ifexist,%raexedir%\cores\%A_LoopField%
							{
								ARCCORES:= A_LoopField . "||"
								librk= 1
								break
							}
					}
				if (librk <> 1)
					{
						iniread,symfe,emuCfgPresets.ini,%keyout%,SUPEMU
						Loop, Parse, symfe,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								iniread,faf,Assignments.ini,ASSIGNMENTS,%A_LoopField%
								if (faf <> "ERROR")
									{
										if (faf = "")
											{
												continue
											}
										if (recore = "")
											{
												ARCCORES= %A_LoopField%||
												coreselv= %A_LoopField%
											}
										recore .= A_LoopField . "|"
									}
							}
					}
			}
	}
topcore:= ARCCORES . recore
INSCOR:
guicontrol,,LCORE,|%topcore%
guicontrol,,ARCCORES,|%topcore%%runlist%
return

MatchSyst:
coretograb=
selctdcore= 
IniRead,stevr,emuCfgPresets.ini,%keyout%,SUPCORE
if ((stevr <> "")&&(stevr <> "ERROR"))
	{
		Loop, Parse, stevr,|
			{
				if (A_Index = 1)
					{
						coretograb= %A_LoopField%
					}
				ifexist, %raexedir%\cores\%A_LoopField%
					{
						recore .= A_LoopField . "|"
						selctdcore= %A_LoopField%
						break
					}
			}
	}
if (selctdcore <> "")
	{
		coreselv= %selctdcore%
	}
topcore .= recore . "|" . runlist
guicontrol,,LCORE, |%topcore%
guicontrol,,ARCCORES, |%topcore%
if (CLActive = 1)
	{
		guicontrol,,NETCORE,|%coreselv%||%corelist%
	}
return

AddToPL:
gui,submit,nohide
guicontrolget,plcore,,PLCORE
addedfiles=
FileSelectFile,AddToPl,M3,,Add ROMs,
pldelim= >
if (PLISTTYP = "Pegasus")
	{
		plswap= %systmfldrs%
		pldelim= :
		coreInJV= %PGPLXMP%
	}
if (PLISTTYP = "RetroFE")
	{
		plswap= %systmfldrs%
		pldelim= :
		coreInJV= %RFPLXMP%
	}
if (PLISTTYP = "EmulationStation")
	{
		plswap= %ESPLPLST%
		pldelim= :
		coreInJV= %ESPLXMP%
	}
if (DETECTCORE = 1)
	{
		coreInJV= DETECT
	}
if (AddToPl = "")
	{
		return
	}
eisv=
Loop, Parse,AddToPl,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		eisv+=1
		if (eisv = 1)
			{
				FPTH= %A_LoopField%
			}
		If (eisv <> 1)
			{
				addedFiles .= FPTH . "\" . A_LoopField . pldelim . plcore . "|"
			}
	}
ControlGet,curpllst, List,,,ahk_id %insel%
existlst=
stringreplace,existlst,curplLst,`n,|,All
newplst .= existlst . "|" . addedFiles
existlst= %nwplst%
guicontrol,,CURPLST, |%existlst%
return

AltTempl:
TemplCfg=
FileSelectFile, TemplCfg, S27, %plstdir%, Select Template Config, retroarch cfg (*.cfg)
if (TemplCfg = "")
	{
		return
	}
splitpath, TemplCfg, Tmplcfgfile, tmplcfgloc, tmplcfgxt, tmplcfgnm, tmplcfgdrv
return

ZIPCRC:
if (ARCDTYP = 1)
	{
		INZIP=
		return
	}
linfo=
ROMZ=
CRCZ=
concatcmd= "%S_KeyDir%\bin\7za.exe" l -slt "%CrCFLN%"
StdOut := StdoutToVar_CreateProcess(concatcmd)
partition=
gosub, zpcrcproc
if (CRCZ <> "")
	{
		aknum=
		afnum=
		Loop, Parse, ROMZ,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				aknum+=1
				Loop, Parse, CRCZI,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						afnum+=1
						if (afnum = aknum)
							{
								CRCZ= %A_LoopField%
								break
							}
					}
				SplitPath,A_LoopField,zipt,zipp,zipxt,ziprn
				stringleft,ziptst,zipt,1
				if (ziptst = A_Space)
					{
						stringtrimleft,zipt,zipt,1
						stringtrimleft,ziprn,ziprn,1
					}
				if (CRCENBL = 0)
					{
						CRCZ= 0000000
					}
				stringreplace,CrCFLN,CrCFLN,\,\\,All
				FileAppend,%pspce%"path":%A_Space%"%CrCFLN%#%zipt%"`,`n,*tmp.lpl
				;;stringreplace,ziprn,ziprn,[,(,All
				;;stringreplace,ziprn,ziprn,],),All
				FileAppend,%pspce%"label":%A_Space%"%ziprn%"`,`n,*tmp.lpl
				stringreplace,CRDETECT,CRDETECT,\,\\,All
				FileAppend,%pspce%"core_path":%A_Space%"%CRDETECT%"`,`n,*tmp.lpl
				FileAppend,%pspce%"core_name":%A_Space%"%NMDETECT%"`,`n,*tmp.lpl
				FileAppend,%pspce%"crc32":%A_Space%"%CRCZ%|crc"`,`n,*tmp.lpl
				FileAppend,%pspce%"db_name":%A_Space%"[PLSYS]"`n,*tmp.lpl
			}
	}
return

ArCnct:
norun= 1
guicontrolget,coreselv,,ARCCORES
guicontrolget,romsys,,ARCSYS
keyin=%romsys%
gosub,TransformSys
guicontrol,,RETROM,0
RETROM= 0
arctvl= 1
gosub, ArcLaunch
arctvl=
if (romtch = "")
	{
		return
	}
guicontrolget,norun,,DOWNONLY
return

DownOnly:
gui,submit,nohide
guicontrolget,ARCCORES,,ARCCORES
guicontrolget,DOWNONLY,,DOWNONLY
if (DOWNONLY = 1)
	{
		guicontrol,,ARCLNCH,Download
		guicontrol,Disable,ARCNCT
		guicontrol,Disable,ARCHOST
		guicontrol,hide,strmvid
		guicontrol,,strmvid,0
		if (tmpsr <> "")
			{
				guicontrol,enable,ARCLNCH
			}
		if (tmprm <> "")
			{
				guicontrol,enable,ARCLNCH
			}
		guicontrol,,RUNXTRACT,0
		guicontrol,,ArcMove,0
		guicontrol,,ArcCull,1
		norun= 1
		ARCSEL= 1
		return
	}
PostMessage, 0x185, 1, -1, SRCHSLT  ; Select all items. 0x185 is LB_SETSEL.
PostMessage, 0x185, 0, -1, SRCHSLT  ; Deselect all items.
GuiControl, Choose, SRCHSLT,0
GuiControl, ChooseString, SRCHSLT, %srchpopcul%
PostMessage, 0x185, 1, -1, ARCPOP  ; Select all items. 0x185 is LB_SETSEL.
PostMessage, 0x185, 0, -1, ARCPOP  ; Deselect all items.
GuiControl, Choose, ARCPOP,0
GuiControl, ChooseString, ARCPOP, %arcpopcul%
guicontrol,,ARCLNCH,PLAY ::>
guicontrol,enable,ARCHOST
if ((ARCCORES = "")&&(ARCCORES <> "Emu_Preset")&&(ARCCORES <> "ERROR"))
	{
		guicontrol,disable,ARCLNCH
	}
norun=
return

STRMVID:
gui,submit,nohide
guicontrolget,STRMVID,,STRMVID
guicontrol,,DOWNONLY,0
guicontrol,,ARCLNCH,STREAM ::>
if (STRMVID = 0)
	{
		guicontrol,,ARCLNCH,PLAY ::>
	}
gosub,DownOnly
return

REPOUrlEdt:
gui,submit,nohide
guicontrol,,MAMESWCHK,0
guicontrol,show,MAMESWCHK
guicontrol,enable,SRCHEDT
guicontrol,enable,ARCSYS
guicontrol,Enable,ADDRPOL
guicontrolget,UrlTxt,,UrlTxt
stringreplace,urlsv,urltxt,',,All
stringreplace,urlsv,urlsv,.,,All
stringreplace,urlsv,urlsv,&,,All
stringreplace,urlsv,urlsv,`%,,All
stringreplace,urlsv,urlsv,-,,All
stringreplace,urlsv,urlsv,`,,,All
stringreplace,urlsv,urlsv,~,,All
stringreplace,urlsv,urlsv,%A_Space%,,All
if (UrlTxt = "Add Repository")
	{
		guicontrol,,ARCSYS,|Select A System||
		goto,ALTURLSET
	}
iniread,olarcnm,Settings.ini,GLOBAL,RemoteRepository
iniread,olarna,Settings.ini,GLOBAL,%urltxt%_EULA
iniread,ArcSitex,%ARCORG%,SOURCES,%UrlTxt%
iniwrite, "%UrlTxt%",Settings.ini,GLOBAL,RemoteRepository
alra=
ifnotexist,gam\%UrlTxt%\Mame - Systems\
	{
		guicontrol,hide,MAMESWCHK
	}
if ((urlTxt <> olarcnm)or(olarna <> 1))
	{
		arcsite= %ArcSiteX%
		ARCSRC= %urlTxt%
		FileDelete,sys.ini
		GAMSRCS= gam\%UrlTxt%
		guicontrol,,ARCSYS,|Select A System||
		gosub,resetSYS
		if (olarna <> 1)
			{
				guicontrol,disable,SRCHEDT
			}
		SB_SetText("Repository source changed")
		return
	}
return

EnableAltURL:
gui, submit, nohide
guicontrolget,ALTURL,,ALTURL
if (ALTURL = 1)
	{
		guicontrol,enable,ARCLOGIN
		guicontrol,enable,ARCPASS
		guicontrol,enable,SAVPASS
		IniRead, ARC_USER,Settings.ini,Global,archive_login
		IniRead, ARC_PASS,Settings.ini,Global,archive_password
	}
if (ALTURL = 0)
	{
		guicontrol,disable,ARCLOGIN
		guicontrol,disable,ARCPASS
		guicontrol,disable,SAVPASS
	}
return

ADDRPOL:
gui,submit,nohide
opndgam= 1
FileSelectFile,addrplst,3,,Open a .gam file,(*.gam)
if (addrplst = "")
	{
		opndgam= 
		return
	}
syslist= 
guicontrol,,URLTxt,|Add DAT:=:Repo||%ARCSRCS%
splitpath,addrplst,,,,addrplstn	
ARCSYS= 
guicontrol,,ARCSYS,|Select a System||
EXTRSYS= %ARCSYS%
ARCSYS= %addrplstn%
ifinstring,SysLLst,%addrplstn%=
	{
		guicontrol,,ARCSYS,|%ARCSYS%||
	}
guicontrol,,ARCCORES,|Emu_Preset||%runlist%
guicontrol,,ENHAK,0
guicontrol,,MAMESWCHK,0
guicontrol,hide,sortoverride
guicontrol,,sortoverride,0
guicontrolget,ENHAK,,ENHAK
HACKAPN=
genlst=
guicontrol,,ARCLNCH,PLAY ::>
guicontrol,disable,ARCLNCH
guicontrol,disable,ARCSYS
guicontrol,disable,ARCNCT
guicontrol, disable, ARCHOST
ARCSEL=
romarray1=
romarray2=
pop_list=
cmdfun=
recore=
norun=
symt1=
symt2=
topcore=
fnne=
tmpsr=
tmprm=
sysddllist= %syslist%
guicontrol,,DOWNONLY,0
guicontrol,,CUSTMOPT,|%INJOPT%
guicontrol,,CUSTMARG,|
guicontrol,hide,CUSTMOPT
guicontrol,hide,CUSTMARG
guicontrol,,REDWN,0
guicontrol,,OVDCHK,0
guicontrol,,EXTRURL,1
guicontrol,,RUNXTRACT,1
guicontrol,,ArcMove,0
guicontrol,,ArcCull,1
guicontrol,,CUSTSWITCH,0
guicontrol,,EXTEXPLD,0
guicontrol,,JACKETMODE,1
guicontrol,,RNMJACK,
guicontrol,,SRCHEDT,
guicontrol,disable,SRCHEDT
guicontrol,show,RNMJACK
BRKO= 1
guicontrol,,SRCHRSLT,|
guicontrol,,ARCPOP,|
guicontrolget,ARCSYS,,ARCSYS
keyin=%ARCSYS%
gosub,TransformSys
guicontrol,,SRCHDDL,|%ARCSYS%||
pop_list=
loop, Read, %addrplst%
	{
		if (A_LoopReadLine = "")
			{
				continue
			}
		romarray2=
		stringsplit,romarray,A_LoopReadLine,|,`n`r
		if (romarray2 = "")
			{
				genlst= 1
				svipth= %romarray1%
				Loop,parse,romarray1,/
					{
						svipth= %A_LoopField%
					}
				splitpath,svipth,,,,sanfile
				gosub, SanURL
				romarray2= %sanfile%
			}
		pop_list .= romarray2 . "|"
	}
pdlist= %pop_list%
pxlist:
Sort,pop_list,D|
jacktshw= hide
guicontrol,,ARCPOP,|%pop_list%
return

AltURLGet:
gui,submit,nohide
guicontrolget,UrlTxt,,UrlTxt
stringreplace,urlsv,urltxt,',,All
stringreplace,urlsv,urlsv,.,,All
stringreplace,urlsv,urlsv,&,,All
stringreplace,urlsv,urlsv,`%,,All
stringreplace,urlsv,urlsv,-,,All
stringreplace,urlsv,urlsv,`,,,All
stringreplace,urlsv,urlsv,~,,All
stringreplace,urlsv,urlsv,%A_Space%,,All
guicontrol,disable,ALTURLGET
guicontrol,disable,ADDRPOL
iniread,urlaloc,%ARCORG%,SOURCES,%UrlTxt%:SET
if ((urlaloc = "ERROR") or (urlaloc = ""))
	{
		SB_SetText(" " URLTXT " repository could not be found")
		guicontrol,enable,ALTURLGET
		;;return
	}
splitpath,urlaloc,urlalocf,,urlaext
iniread,EULA,Settings.ini,Global,%urltxt%_EULA
%urlsv%_EULA= %EULA%
dispeula= %urltxt%
ifnotexist,sets\%urltxt%_eula.set
	{
		dispeula= generic
	}
filecopy,sets\%dispeula%_eula.set,tmp.htm,1
if (EULA <> 1)
	{
		ARCEULA=file:///%S_KeyDir%\tmp.htm
		Options := "Buttons=I Agree/Decline, HtmW=700, HtmH=550, BDefault=2, BEsc=2,Title=" dispeula "_EULA, DlgTopmost=1,DlgStyle="
		viSel := HtmDlg( ARCEULA, "taskbar", Options )
		if (visel <> 1)
			{
				Msgbox,8449,Agree,You Must Click I Agree and accept the terms to enable and use repositories.
				ifmsgbox,OK
					{
						goto,AltURLGet
					}
				guicontrol,enable,ALTURLGET
				guicontrol,disable,SRCHEDT
				guicontrol,,SRCHEDT,
				guicontrol,enable,ADDRPOL
				return
			}
		%urlsv%_EULA= 1	
	}
EULAAGREE:
guicontrol,enable,SRCHEDT
guicontrol,disable,ARCSYS
filedelete,tmp.htm
AUTOBBUT= show
guicontrol,enable,AUTOBIOS
EULA= 1
iniwrite,%urltxt%,Settings.ini,Global,RemoteRepository
iniwrite,1,Settings.ini,Global,%urltxt%_EULA
save= %cacheloc%\%UrlTxt%.%urlaext%
splitpath,save,svaf,svap
exe_get(ARIA,urlaloc,svap,svaf,CURPID,cacheloc)
ifnotexist, %save%
	{
		SB_SetText(" " urltxt " repository could not be found.")
		guicontrol,enable,ARCSYS
		guicontrol,enable,ALTURLGET		
		guicontrol,enable,ADDRPOL		
		;;return
	}
Runwait,"%S_KeyDir%\bin\7za.exe" x -y "%save%" -O"gam",,hide
if (ERRORLEVEL <> 0)
	{
		msgbox,1,Extract Failed,Exraction of Archive list failed
	}
GAMSRCS= gam\%UrlTxt%	
gosub, ResetSys	
SB_SetText(" " UrlTxt " has been added to your repository options")
guicontrol,enable,ARCSYS
guicontrol,enable,ALTURLGET
guicontrol,enable,ADDRPOL
return

sitensan:
SB_SetText("do not include spaces or any other symbols:  Use letters,numbers and the ''-'' dash character only.")	
AltURLSet:
gui, submit, nohide
inputbox,ArcSiteN,Set Repository Name,,,400,100,,,,,
if (ArcSiteN = "")
	{
		guicontrol,,UrlTxt,|%ARCSRC%||%ArcSrcs%Add Repository
		return
	}
If InStr(ArcSiteN, "\") or InStr(ArcSiteN, "[") or InStr(ArcSiteN, "]") or InStr(ArcSiteN, "<") or InStr(ArcSiteN, ">") or InStr(ArcSiteN, "{") or InStr(ArcSiteN, "}") or InStr(ArcSiteN, "|") or InStr(ArcSiteN, "+") or InStr(ArcSiteN, "=") or InStr(ArcSiteN, "!") or InStr(ArcSiteN, "*") or InStr(ArcSiteN, "?") or InStr(ArcSiteN, "&")
	{
		gosub,sitensan
	}
iniread,ddsp,%ARCORG%,SOURCES,%ArcSiteN%
ifinstring,SOURCES,%ArcSiteN%
	{
		SB_SetText("Repository is Added")
		return
	}
inputbox,ArcSitex,Repository Archive URL,,,400,100,,,,,
SB_SetText("Enter the URL to the archive containing repository lists.")
stringsplit,arcvv,arcsitex,/
arcsitev= %arcvv1%//%arcvv2%
if (ArcSitex = "")
	{
		SB_SetText("You must supply a url to the repository archive.")
		guicontrol,,UrlTxt,|%ARCSRC%||%ArcSrcs%Add Repository
		return
	}
SB_SetText("")
ifnotinstring,ARCSRCS,%ArcSiteN%|
	{
		ArcSRCS.= ArcSiteN . "|"
	}
guicontrol,,UrlTxt,|%ArcSiteN%||%ARCSRCS%Add Repository
iniwrite, %ArcSiteN%,%ARCORG%,SOURCES,%arcsitev%
iniwrite, %ArcSiteN%:SET,%ARCORG%,SOURCES,%ArcSiteX%
iniwrite, "%ArcSiteN%",Settings.ini,Global,RemoteRepository
ifnotexist, gam\%ARCSRC%\
	{
		gosub, AltURLGet
	}
return

SearchInp:
gui, submit, nohide
guicontrol,show,SRCHRSLT
guicontrol,enable,ARCSYS
guicontrol,enable,MAMESWCHK
return

EDTROMBTN:
gui,submit,nohide
guicontrolget,MORROM,,MORROM
guicontrolget,EDTROMBTN,,EDTROMBTN
gosub, REHRPO
if (EDTROMBTN = "E")
	{
		guicontrol,,ARCSYS,| ||Select a System|%syslist%
		guicontrol,,RUNROMCBX,|%MORROM%||%poptadd%
		guicontrol,hide,MORROM
		guicontrol,show,RUNROMCBX
		guicontrol,,EDTROMBTN,>
		guicontrol,focus,RUNROMCBX
		Controlfocus,ahk_id %CbxHndl1%
		return	
	}
REHCBX:	
guicontrol,show,MORROM
guicontrol,hide,RUNROMCBX
guicontrol,,EDTROMBTN,E
return	
fltrRpoBtn:
gui,submit,nohide
guicontrolget,fltrRpoBtn,,fltrRpoBtn
gosub, REHCBX
if (fltrRpoBtn = "E")
	{
		guicontrol,,ARCSYS,| ||Select a System|%syslist%
		guicontrol,hide,ARCSYS
		guicontrol,show,ARCCBX
		guicontrol,,fltrRpoBtn,>
		guicontrol,focus,ARCCBX
		Controlfocus,ahk_id %CbxHndl121%
		return	
	}
REHRPO:
guicontrol,show,ARCSYS
guicontrol,hide,ARCCBX
guicontrol,,fltrRpoBtn,E
return	
ARCLRFLT:
gui,submit,nohide
guicontrol,,ARCMFLT,
guicontrol,,ARCPOP,|%pop_list%
return

ARCMFLT:
Sleep, 1100
gui,submit,nohide
guicontrolget,ARCMFLT,,ARCMFLT
if (ARCMFLT = "")
	{
		return
	}
npop_list= 
Loop,Parse,pop_list,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if instr(A_LoopField,ARCMFLT)
			{
				npop_list.= A_LoopField . "|"
			}
	}
guicontrol,,ARCPOP,|%npop_list%	
return

ArchiveCBX:
guicontrolget,RPSYSX,,ARCCBX
if (RPTYP = "")
	{
		ROMSYS=  
	}
Sleep, 1100
gui,submit,nohide
guicontrolget,RPSYS,,ARCCBX
if (RPSYS <> RPSYSX)
	{
		goto,ArchiveCBX
	}
if (RPSYS = "")
	{
		ROMSYS=  
	}
if ((RPSYS = "")or(RPSYS = "Select a System"))
	{
		ROMSYS= Select a System
		main_search= %ROMSYS%||%syslist%
		guicontrol,,ARCSYS,|%main_search%
		guicontrol,show,ARCSYS	
		guicontrol,hide,ARCCBX
		guicontrol,,fltrRpoBtn,E
		return
	}
RPTYP= 
main_search= 
Loop,parse,syslist,|
	{
		if (A_LoopField = RPSYS)
			{
				RPTYP= %A_LoopField%
				EXTRSYS= %A_LoopField%
				main_search= %A_LoopField%||%syslist%
				guicontrol,show,ARCSYS
				guicontrol,hide,ARCCBX
				guicontrol,,ARCCBX,|%main_search%
				guicontrol,,ARCSYS,|%main_search%
				guicontrol,,fltrRpoBtn,E
				goto, ArchiveSystems
			}
	}
Loop,Parse,syslist,|
	{
		if Instr(A_LoopField, RPSYS)
			{
				main_search.=  A_LoopField . "|"
			}
	}
if (main_search = "")
		{
			main_search= %swpparv%
		}
guicontrol,,ARCCBX,|%RPSYS%||%main_search%
Control, ShowDropDown, , ,ahk_id %CbxHndl121%
return

ExpndASrch:
gui,submit,nohide
ExpndTog= show
if (ExpndASrch = "")
	{
		ExpndASrch= 1
		ExpndTog= hide
		guicontrol,hide,urltxt
		guicontrol,hide,ALTURLSET
		guicontrol,hide,ALTURLGET
		guicontrol,hide,ADDRPOL
		guicontrol,hide,ARCPOP
		guicontrol,hide,ALTURL
		guicontrol,hide,OVDTXT
		guicontrol,hide,arclogin
		guicontrol,hide,arcpass
		guicontrol,hide,SavPass
		guicontrol,hide,arcptxt
		guicontrol,hide,ARCGSYS
		guicontrol,move,SETOVD,x360 y136 w59 h17
		guicontrol,move,OVDLDS,x430 y131 w254
		guicontrol,move,ExpndASrch,x19 y480 w15 h15
		guicontrol,move,SRCHRSLT,x24 y157 w710 h325
		guicontrol,move,SRCHEDT,x350 y19 w310 h21
		guicontrol,move,SearchArc,x662 y19 w75 h23
		guicontrol,move,SRCHDDL,x450 y55 w200 h21
		guicontrol,move,AincTog,x350 y43 w62 h18
		guicontrol,move,AexcTog,x350 y60 w62 h18
		guicontrol,,ExpndASrch,X
		return
	}
ExpndASrch=
guicontrol,show,UrlTxt
guicontrol,show,ALTURLSET
guicontrol,show,ALTURLGET
guicontrol,show,ADDRPOL
guicontrol,show,arclogin
guicontrol,show,arcpass
guicontrol,show,SavPass
guicontrol,show,ARCPOP
guicontrol,show,ALTURL
guicontrol,show,OVDTXT
guicontrol,show,ARCPOP
guicontrol,show,ARCGSYS
guicontrol,,ExpndASrch,+
guicontrol,enable,MAMESWCHK
guicontrol,enable,ARCSYS
guicontrol,move,SETOVD,x25 y157 w59 h17
guicontrol,move,OVDLDS,x87 y155 w254
guicontrol,move,AincTog,x32 y287 w62 h13
guicontrol,move,AexcTog,x93 y287 w62 h13
guicontrol,move,ExpndASrch,x329 y326 w15 h15
guicontrol,move,SearchArc,x42 y323 w75 h23
guicontrol,move,SRCHRSLT,x24 y346 w320 h147
guicontrol,move,SRCHEDT,x28 y302 w310 h21
guicontrol,move,SRCHDDL,x124 y324 w199
return

AincTog:
gui,submit,nohide
return

AexcTog:
gui,submit,nohide
return

SearchArc:
gui,submit,nohide
guicontrolget,SRCHEDT,,SRCHEDT
if (SRCHEDT = "")
	{
		SB_SetText("You must enter a search word")
		return
	}
srchpop=
fndgam1=
fndgam2=
guicontrol,disable,SearchArc
guicontrol,disable,ExpndASrch
guicontrol,disable,SRCHDDL
guicontrol,disable,SRCHEDT
guicontrol,,sortoverride,0
guicontrolget,SRCHSYS,,SRCHDDL
sanm:= SRCHEDT
gosub, SanitizeN
SRCHEDT:= sanm
SRCHREC=
SRCHCRI= %SRCHSYS%
if (ENHAK = 1)
		SRCHCRI= #HACKS#%SRCHSYS%
	{
	}
if (SRCHSYS = "All")
	{
		SRCHCRI= *
		SRCHREC= R
	}
SRCHMET= %GAMSRCS%
if (MAMESWCHK = 1)
	{
		SRCHMET= %GAMSRCS%\MAME - Systems
		iniread,ARCTRA,emuCfgPresets.ini,%SRCHSYS%,RJMAMENM
		if (ARCTRA <> "ERROR")
			{
				SRCHSYS= %ARCTRA%
			}
	}
Loop, files,%SRCHMET%\%SRCHCRI%.gam, %SRCHREC%
	{
		sys=
		sysfile=
		sysdir=
		sysxt=
		sysdrv=
		SplitPath,A_LoopFileFullPath,sysfile,sysdir,sysxt,sys,sysdrv
		if (AincTog = 1)
			{
				Loop, read,%A_LoopFileFullPath%
					{
						IfInString, A_LoopReadLine, %SRCHEDT%
							{
								fndgam1=
								fndgam2=
								stringsplit,fndgam,A_loopReadLine,|
								srchpop .= sys . "=" . fndgam2 . "|"							
							}
					}
			}
		if (AexcTog = 1)
			{
				Loop, read,%A_LoopFileFullPath%
					{
						IfInString, A_LoopReadLine, %SRCHEDT%
							{
								continue
							}
						fndgam1=
						fndgam2=
						stringsplit,fndgam,A_loopReadLine,|
						srchpop .= sys . "=" . fndgam2 . "|"							
					}
			}
	}
guicontrol,disable,MAMESWCHK
guicontrol,disable,ARCSYS
guicontrol,,SRCHRSLT, |%srchpop%
guicontrol,show,ExpndASrch
guicontrol,enable,SearchArc
guicontrol,enable,ExpndASrch
guicontrol,enable,SRCHEDT
guicontrol,enable,SRCHDDL
return

SortOverride:
gui,submit,nohide
guicontrolget,OVDCHK,,OVDCHK
if (OVDCHK = 1)
	{
		guicontrolget,OVDFLDR,,OVDTXT
	}
guicontrolget,JACKETMODE,,JACKETMODE
guicontrolget,EXTRURL,,EXTRURL
guicontrolget,EXTEXPLD,,EXTEXPLD
guicontrolget,RUNXTRACT,,RUNXTRACT
guicontrolget,ARCMOVE,,ARCMOVE
guicontrolget,ARCCULL,,ARCCULL
guicontrol,enable,RNMJACK
return

ArcPopulateList:
tmprm=
tmpsr=
srchpopcul=
genlst=
gui,submit,nohide
guicontrol,enable,RNMJACK
guicontrolget,EXTRSYS,,ARCSYS
keyin=%EXTRSYS%
gosub,TransformSys
guicontrolget,DOWNONLY,,DOWNONLY
guicontrolget,tmprm,,ARCPOP
guicontrol,hide,sortoverride
guicontrol,,sortoverride,0
PostMessage, 0x186, -1, 0,,ahk_id %srchpopu%
PostMessage, 0x185, 0, -1, SRCHRSLT  ; Select all items. 0x185 is LB_SETSEL.
GuiControl, Choose, SRCHRSLT, 0
arcpnum=
norun=
Loop, parse, tmprm,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		arcpnum+=1
		if (arcpnum > 1)
			{
				norun= 1
				break
			}
		arcpopcul= %A_LoopField%
		aftpth2= %arcpopcul%
	}
guicontrol,enable,MAMESWCHK
guicontrol,enable,ARCSYS
if (DownOnly = 1)
	{
		guicontrol,enable,ARCLNCH
	}
SRCHMET= %GAMSRCS%
if (MAMESWCHK = 1)
	{
		SRCHMET= %GAMSRCS%\MAME - Systems
	}
if (DownOnly = 0)
	{
		PostMessage, 0x185, 1, -1, ARCPOP  ; Select all items. 0x185 is LB_SETSEL.
		PostMessage, 0x185, 0, -1, ARCPOP  ; Deselect all items.
		GuiControl, Choose, ARCPOP, 0
		guicontrol, show, ARCNCT
		GuiControl, ChooseString, ARCPOP, %arcpopcul%
		krbrk=
		arcpnum=
		searchparams= %SRCHMET%\%HACKAPN%%EXTRSYS%.gam
		if (opndgam = 1)
			{
				searchparams= %addrplst%
			}
		Loop,%searchparams%
			{
				ArcIndxPtr=
				Loop, Read, %A_LoopFileFullPath%
					{
						if (A_LoopReadLine = "")
							{
								continue
							}
						ArcIndxPtr+=1	
						Loop, 12
							{
								aftpth%A_Index%=
							}
						stringsplit,aftpth,A_LoopReadLine,|
						if (aftpth2 = "")
							{
								continue
							}
						if (aftpth8 = "$")
							{
								if (ARC_USER = "")
									{
										SB_SetText(" This item requires a LOGIN/PASSWORD")
										return
									}
							}
						if (aftpth2 = "")
							{
								genlst= 1
								svipth= %aftpth1%
								Loop,parse,aftpth1,/
									{
										svipth= %A_LoopField%
									}
								splitpath,svipth,,,,sanfile
								gosub, SanURL
								aftpth2= %sanfile%
							}
						if (opndgam = 1)
							{
								if ((aftpth5 = "")&&(ARCSYS = "")or(aftpth5 = A_Space) && (ARCSYS = ""))
									{
										EXTRSYS= netplay
									}
								guicontrol,disable,ARCSYS	
							}
						if (aftpth2 = arcpopcul)
							{
								if ((aftpth5 <> "") && (aftpth5 <> " "))
									{
										ARCSYS:= aftpth5
										;;EXTRSYS:= ARCSYS
										guicontrol,,ARCSYS,|%EXTRSYS%||%syslist%
									}
								if (instr(aftpth5,"Movies")or (aftpth5 = "Television - Series")or (aftpth5 = "Video - Media"))
									{
										guicontrol,show,strmvid
									}
								if ((arcpopcul = ARCSYS) && instr(aftpth3,">")&& instr(aftpth3,"<"))
									{
										stringsplit,axrm,aftpth3,|:,<>
										iniread,lnchparam,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
										guicontrol,,DOWNONLY,1
										gosub, DownOnly
										guicontrol,,RNMJACK,
										guicontrol,,JACKETMODE,%axrm2%
										gosub, DWNINJACK
										guicontrol,,EXTRURL,%axrm3%
										gosub, ExtractURL
										guicontrol,,EXTEXPLD,%axrm4%
										gosub, EXTEXPLD
										guicontrol,,RUNXTRACT,%axrm5%
										gosub, RunXtract
										guicontrol,,ARCMOVE,%axrm6%
										gosub, ArcMove
									}
								aftpth= %aftpth1%
								StringCaseSense, On
								stringreplace,aftpth,aftpth,`%2F,/,All
								stringreplace,aftmp,aftpth,/,\,All
								stringreplace,aftmp,aftmp,`%26,&,All
								stringreplace,aftmp,aftmp,`%2B,+,All
								stringreplace,aftmp,aftmp,`%20,%A_Space%,All
								stringreplace,aftmp,aftmp,`%23,#,All
								stringreplace,aftmp,aftmp,`%24,$,All
								stringreplace,aftmp,aftmp,`%21,!,All
								stringreplace,aftmp,aftmp,`%28,(,All
								stringreplace,aftmp,aftmp,`%29,),All
								stringreplace,aftmp,aftmp,`%5B,[,All
								stringreplace,aftmp,aftmp,`%5D,],All
								stringreplace,aftmp,aftmp,`%3D,=,All
								stringreplace,aftmp,aftmp,`%2C,`,,All
								stringreplace,aftmp,aftmp,`%40,@,All
								stringreplace,aftmp,aftmp,`%3B,`;,All
								stringreplace,aftmp,aftmp,`%27,',All
								stringreplace,aftmp,aftmp,`%7E,~,All
								stringreplace,aftmp,aftmp,`%7B,{,All
								stringreplace,aftmp,aftmp,`%7D,},All
								stringreplace,aftmp,aftmp,`%25,`%,All
								StringCaseSense, Off
								Loop, Parse, aftmp,\
									{
										savefile= %A_LoopField%
									}
								afnchk= %savefile%
								splitpath,savefile,,,,romfname
								krbrk=
								ARC_OL:= ArcIndxPtr
								break
							}
					}
				if (krbrk = 1)
					{
						break
					}
			}
	}
if (ARCCULL = 1)
	{
		stringsplit,anv,aftpth2,([
		if (anv1 <> "")
			{
				aftpth2= %anv1%
			}
	}
guicontrol,,RNMJACK,%aftpth2%
if (arcpnum > 1)
	{
		guicontrol,,RNMJACK,
		Loop,parse,tmprm,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,srtm,A_LoopField,([
				vrnm%A_Index%= %srtm1%
				if (A_Index = 1)
					{
						continue
					}
				mindex:= (A_Index - 1)	
				if (vrnm%A_Index% = vrnm%mindex%)
					{
						guicontrol,,RNMJACK,%vrnm1%
					}
					else {
						guicontrol,,RNMJACK,
						break
					}
			}
	}
ARCRCLK= 1
bltoh=
guicontrolget, bltoh,,ARCPOP
ROMTRUN= %bltoh%
if (bltoh = "")
	{
		guicontrol, disable, ARCHOST
	}
TGCN=
EXACTARCFOUND:
guicontrolget,TGCN,,ARCCORES
stringsplit,dlx,TGCN,.
if (dlx2 = "dll")
	{
		if (DOWNONLY = 0)
			{
				guicontrol,enable,ARCHOST
			}
	}
ARCSEL= 1
if (tmprm <> "")
	{
		if (DOWNONLY = 0)
			{
				if (IPADR <> "")
					{
						if (TGCN <> "")
							{
								ARCDET=
								guicontrolget, ARCDET,,ARCDET
								if (ARCDET <> "")
									{
										guicontrol, enable, ARCHOST
										if (dlx2 = "dll")
											{
												guicontrol,enable,ARCNCT
											}
									}
								SB_SetText("")
							}
						if (TGCN = "")
							{
								SB_SetText(" Seletct a core to use and then select a ROM. ")
								if (FRC = "")
									{
										Control, ShowDropDown, , %NetCore%, skeletonKey
										ControlFocus, %NetCore%, skeletonKey
										SB_SetText("you must select a core")
										return
									}
							}
					}
			}
		if (TGCN = "")
			{
				SB_SetText(" Seletct a core/emulator to use. ")
				return
			}
		guicontrol,enable,ARCLNCH
		return
	}
if (TGCN = "")
	{
		guicontrol, disable, ARCHOST
	}
return

ArcSrchRes:
gui, submit, nohide
guicontrol,,sortoverride,0
tmpsr=
ROMSYS=
if (arctvl = "")
	{
		norun=
	}
arcpopcul=
guicontrolget,arccct,,ARCCORES
guicontrolget,tmpsr,,SRCHRSLT
guicontrol,enable,RNMJACK
guicontrol,disable,ARCLNCH
guicontrol,disable,ARCSYS
guicontrol,,ARCLNCH,PLAY ::>
guicontrol,disable,MAMESWCHK
PostMessage, 0x186, -1, 0,,ahk_id %arcpopu%
PostMessage, 0x185, 0, -1, ARCPOP  ; Select all items. 0x185 is LB_SETSEL.
GuiControl, Choose, ARCPOP, 0
arcpnum=
multsrch=
Loop, Parse, tmpsr,|
	{
		srchspl1=
		srchspl2=
		StringSplit,srchspl,SRCHRSLT,=
		EXTRSYS= %srchspl1%
		ifnotinstring,srchspl1,%A_Space%-%A_Space%
			{
				EXTRSYS= % rev_%srchspl1%
				guicontrol,,MAMESWCHK,1
				if (EXTRSYS = "")
					{
						EXTRSYS= %srchspl1%
						guicontrol,,MAMESWCHK,0
					}
			}
		arcpnum+=1
		tmpsrg= %srchspl2%
		if (arcpnum > 1)
			{
				guicontrol,,RNMJACK,
				guicontrol,disable,RNMJACK
				guicontrol,enable,ARCLNCH
				guicontrol,,ARCLNCH,Download
				guicontrol,,downOnly,1
				multsrch= 1
				guicontrol,,ARCSYS,|Select a System||%sysddllist%
				if (SRCHDDL = "All")
					{
						guicontrol,show,SortOverride
					}	
				return
			}
		guicontrol,hide,SortOverride
		guicontrolget,ARCCORES,,ARCCORES
		stringreplace,romsys,EXTRSYS,#HACKS#,,UseErrorLevel
		if (errorlevel = 1)
			{
				guicontrol,,ENHAK,1
			}
		guicontrol,,ARCSYS,|%romsys%||Select a System|%sysddllist%
		guicontrolget,EXTRSYS,,ARCSYS
		keyin=%EXTRSYS%
		gosub,TransformSys
		srchpopcul= %A_LoopField%
		guicontrol,enable,RNMJACK
		if ((arccct <> "")&&(arccct <> "Emu_Preset")&&(arccct <> "ERROR"))
			{
				guicontrol,enable,ARCLNCH
			}
	}
guicontrol,,RNMJACK,%srchspl2%
if (DownOnly = 0)
	{
		ARCSEL= 2
		PostMessage, 0x185, 1, -1, SRCHRSLT  ; Select all items. 0x185 is LB_SETSEL.
		PostMessage, 0x185, 0, -1, SRCHRSLT  ; Deselect all items.
		GuiControl, Choose, SRCHRSLT, 0
		GuiControl, ChooseString, SRCHRSLT, %srchpopcul%
		return
	}
return

GamFIND:
cmdfun=
mlturl= 
SRCHMET= %GAMSRCS%
SRCHGAM= %EXTRSYS%
stringreplace,romsys,EXTRSYS,#HACKS#,,All
ifnotinstring,romsys,%A_Space%-%A_Space%
	{
		ifexist,%GAMSRCS%\MAME - Systems\%SRCHGAM%.gam
			{
				SRCHMET= %GAMSRCS%\MAME - Systems
				if (tmpsr <> "")
					{
						revinc= % rev_%srchspl1%
						if (revinc = "")
							{
								revinc= %EXTRSYS%
							}
						SRCHGAM= %srchspl1%
						romsys= %EXTRSYS%
						EXTRSYS= %revinc%
					}
			}
	}
krbrk=
iniread,cmdfun,emuCfgPresets.ini,%SRCHGAM%,cmdfun
srchgamf= %SRCHMET%\%HACKAPN%%SRCHGAM%.gam
if (opndgam = 1)
	{
		srchgamf= %addrplst%
	}
ifnotinstring,srchgamf,:\
	{
		srchgamf= %S_KeyDir%\%srchgamf%
	}
splitpath,srchgamf,fnew,nesn,aien,krvm	
Loop, %srchgamf%
	{
		Loop, Read, %A_LoopFileFullPath%
			{
				if (A_LoopReadLine = "")
					{
						continue
					}
				Loop,10
					{
						getpth%A_Index%=
					}
				stringsplit,getpth,A_LoopReadLine,|
				URLFILE= %getpth1%
				if (getpth2 = "")
					{
						svipth= %getpth1%
						Loop,parse,getpth1,/
							{
								svipth= %A_LoopField%
							}
						splitpath,svipth,,,,sanfile
						gosub, SanURL
						getpth2= %sanfile%
					}
				if (getpth2 = romfp)
					{
						EXTRAR=
						EXTCHD=
						EXT7Z=
						romshere=
						urlpth= %getpth1%
						StringCaseSense, On
						stringreplace,dwnchk,urlpth,`%2F,/,All
						stringreplace,dwnchk,dwnchk,/,\,All
						stringreplace,dwnchk,dwnchk,`%26,&,All
						stringreplace,dwnchk,dwnchk,`%2B,+,All
						stringreplace,dwnchk,dwnchk,`%20,%A_Space%,All
						stringreplace,dwnchk,dwnchk,`%23,#,All
						stringreplace,dwnchk,dwnchk,`%24,$,All
						stringreplace,dwnchk,dwnchk,`%21,!,All
						stringreplace,dwnchk,dwnchk,`%28,(,All
						stringreplace,dwnchk,dwnchk,`%29,),All
						stringreplace,dwnchk,dwnchk,`%5B,[,All
						stringreplace,dwnchk,dwnchk,`%5D,],All
						stringreplace,dwnchk,dwnchk,`%3D,=,All
						stringreplace,dwnchk,dwnchk,`%2C,`,,All
						stringreplace,dwnchk,dwnchk,`%40,@,All
						stringreplace,dwnchk,dwnchk,`%3B,`;,All
						stringreplace,dwnchk,dwnchk,`%27,',All
						stringreplace,dwnchk,dwnchk,`%7E,~,All
						stringreplace,dwnchk,dwnchk,`%7B,{,All
						stringreplace,dwnchk,dwnchk,`%7D,},All
						stringreplace,dwnchk,dwnchk,`%25,`%,All
						StringCaseSense, Off
						Loop,Parse,dwnchk,\
							{
								savefile= %A_LoopField%
							}
						if (instr(savefile,"?")or instr(savefile,"\")or instr(savefile,"*")or instr(savefile,"|")or instr(savefile,":") or instr(savefile,""""))
							{
								savefile= %getpth2%
							}
						splitpath,savefile,,,chkxt,romfname
						if (chkxt = "")
							{
								chkxt= zip
								savefile.= ".zip"
							}	
						if (cmdfun = 1)
							{
								emucmd= %getpth3%
							}
						romelg= %getpth3%
						if ((romelg <> A_Space)&&(romelg <> ""))
							{
								emucmdf= %romelg%
							}
						afnchk= %savefile%
						romname= %romfp%
						krbrk= 1
						stringsplit,save,fsvfn,fsvmp,fsvmx,fsvnm
						save= %fsvmp%\%romname%.%fsvmx%
						stringsplit,pv,getpth4,>
						Loop, %pv0%
							{
								URLFILE%A_Index%= % pv%A_Index%
								if (A_Index > 1)
									{
										mlturl= 1
									}
							}
						break
					}
			}
		if (krbrk = 1)
			{
				break
			}
	}
return

ArcPPND:
stringreplace,EXTRSYSK,EXTRSYS,#HACKS#,,All
ARCSUBS= %EXTRSYSK%
ifnotinstring,EXTRSYSK,%A_Space%-%A_Space%
	{
		ARCSUBS= MAME - Systems
	}
return

RomSavePPND:
romf:= save
URLFILE= %ArcSite%/%sysurl%%urlpth%
ifinstring,sysurl,://
	{
		URLFILE= %sysurl%%urlpth%
	}
ifinstring,urlpth,://
	{
		URLFILE= %urlpth%
	}
splitpath,urlfile,,,inxck
if (inxck = "inx")
	{
	}
SB_SetText(" " urlfile " ")
return

ENHAK:
gui,submit,nohide
guicontrolget,ENHAK,,ENHAK
if (ENHAK = 1)
	{
		ifinstring,hacksyst,%ARCSYS%
			{
				SB_SetText(" Listing ROM-hacks ")
				gosub, ArchiveSysRefresh
				return
			}
		guicontrol,,ENHAK,0
		SB_SetText(" No ROM-hacks for this system ")
		return
	}
if (ENHAK = 0)
	{
		HACKAPN=
		SB_SetText(" Listing ROMs ")
		goto, archivesystems
	}
return

CLRNETP:
ARCRCLK=
gui,submit,nohide
guicontrol,,ARCDET,
guicontrol,enable,ARCSYS
guicontrol,enable,MAMESWCHK
INTERRUPTDWN= 1
Process,close,%$exeg_pid%
guicontrol,hide,EMUINSC
return

MAMESWCHK:
gui,submit,nohide
guicontrolget,MAMESWCHK,,MAMESWCHK
if (MAMESWCHK = 1)
	{
		ifnotexist,%GAMSRCS%\MAME - Systems\
			{
				SB_SetText("MAME systems not found")
				MAMESWCHK= 0
				guicontrol,,MAMESWCHK,%MAMESWCHK%
				goto, nomameenabled
			}
		guicontrol,,ARCSYS,|Select a System||%mame_sys%
		gosub, ArchiveSystems
		guicontrol,,SRCHDDL,|All||%mame_sys%
		return
	}
nomameenabled:
guicontrol,,ARCLNCH,PLAY ::>
guicontrol,,ARCSYS,|Select a System||%syslist%
guicontrol,,SRCHDDL,|All||%syslist%
gosub, ArchiveSystems
return

SRCHDDL:
gui,submit,nohide
guicontrolget,SRCHDDL,,SRCHDDL
guicontrol,disable,ENHAK
guicontrol,enable,ARCSYS
guicontrol,hide,sortoverride
guicontrol,,sortoverride,0
return

ArcTab:
gui,submit,nohide
Loop,parse,SHOWARCTAB,|
	{
		guicontrol,show,%A_LoopField%
	}
Loop,parse,HIDEARCTAB,|
	{
		guicontrol,hide,%A_LoopField%
	}
Loop,parse,SORTROMTAB,|
	{
		guicontrol,hide,%A_LoopField%
	}
return

DATLBX:
gui,submit,nohide
return

SortRoms:
gui,submit,nohide
Loop,parse,SHOWARCTAB,|
	{
		guicontrol,hide,%A_LoopField%
	}
Loop,parse,HIDEARCTAB,|
	{
		guicontrol,hide,%A_LoopField%
	}
Loop,parse,SORTROMTAB,|
	{
		guicontrol,show,%A_LoopField%
	}
return

MAMEDATYP:
gui,submit,nohide
N_DatTYP=MAME
guicontrol,move,BRWSDAT,y370
return

NOINTDATYP:
gui,submit,nohide
N_DatTYP=NO-INTRO
guicontrol,move,BRWSDAT,y392
return

RDUMPDATYP:
gui,submit,nohide
N_DatTYP=REDUMP
guicontrol,move,BRWSDAT,y414
return

TOSECDATYP:
gui,submit,nohide
N_DatTYP=TOSEC
guicontrol,move,BRWSDAT,y348
return

HLTDATP:
gui,submit,nohide
HLTDATP= 1
return

DATDRPD:
gui,submit,nohide
return

BRWSDAT:
gui,submit,nohide
if (N_DatTYP = "")
	{
		N_DatTYP= TOSEC
	}
FileSelectFile,AddToDatSet,M3,,Add Dats,*.dat
if (AddToDatSet = "")
	{
		return
	}
splitpath,Addtodatset,dat_f,,,dat_n
filecopy,%Addtodatset%,dats\%N_DatTYP%\%dat_f%
if ((ERRORLEVEL = 0)&& !instr(alldats,dat_f))
	{
		alldats.= N_DatTYP . "\" . dat_f
		guicontrol,,DATDRPD,|%alldats%
		iniwrite,%N_DatTYP%\%dat_n%,datlist.ini,%N_DatTYP%,%dat_n%
	}
return

DETECTXTN:
gui,submit,nohide
return

DETHSHSZ:
gui,submit,nohide
return

HASHALLROMS:
gui,submit,nohide
ifexist,all_hash.ini
	{
		fileread,all_hash,all_hash.ini
	}
HLTDATP= 
if (HSH_DISP <> "")
	{
		Gui,ListView,DRPLV
		LV_Delete()	
		Loop,parse,HSH_TBD,|
			{
				LV_Add("+Check",A_LoopField)
			}
		LV_ModifyCol()
	}
guicontrolget,DETECTXTN,,DETECTXTN
guicontrolget,KNOWNDRP,,KNOWNDRP
guicontrolget,MOVDRP,,MOVDRP
guicontrolget,JAKDRP,,JAKDRP
guicontrolget,JAKAFT,,JAKAFT
guicontrolget,SRCHDRP,,SRCHDRP
guicontrolget,EXTDRP,,EXTDRP
guicontrolget,OVRWDRP,,OVRWDRP
guicontrolget,ARCSORT,,ARCSORT
guicontrolget,RENMDRP,,RENMDRP
zipovrw=
if (OVRWDRP = 1)
	{
		zipovrw= -y
	}
Loop,parse,SORTROMTAB,|
	{
		guicontrol,disable,%A_LoopField%
	}
guicontrol,enable,HLTDATP	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
skphash=
Loop,parse,HSH_TBD,|
	{
		if (HLTDATP = 1)
			{
				break
			}
		ZIPSEEK= 
		ApndCRC=
		CrCFLN= %A_LoopField%
		splitpath,CrCFLN,romyu,rompd,romxt,romjn
		filegetsize,hshfz,%A_LoopFileFullPath%
		if InStr(FileExist(A_LoopField), "D")
			{	
				Loop,Files,%A_LoopField%\*.*,R
					{						
						CrCFLN= %A_LoopFileFullPath%
						splitpath,CrCFLN,romyu,rompd,romxt,romjn
						filegetsize,hshfz,%A_LoopFileFullPath%
						gosub, HSH_FILE
						continue
					}
			}
		gosub, HSH_FILE
	}
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SB_SetText("sorting complete")
Gui,Listview,DRPLV
LV_Delete()
Loop,parse,HSH_TBD,|
	{
		LV_Add("+Check",A_LoopField)
	}
LV_ModifyCol()
Loop,parse,SORTROMTAB,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

DRP_PARSE:
splitpath,drp_in,drpmyu,drppd,drpxt,drpjn
skpdrp=
if (KNOWNDRP = 1)
	{
		Loop,parse,parxti,|
			{
				if (drpxt = A_LoopField)
					{
						skpdrp=1
						break
					}
			}
	}
if (skpdrp = "")
	{
		LV_Add(LVACHK,drp_in)
		HSH_TBD.= drp_in . "|"												
	}
return

HSH_FILE:
if (HLTDATP = 1)
		{
			return
		}
	ZIPSEEK= 
	ApndCRC=
	if (DETECTXTN = 1)
		{
			detxtu= 
			fileread,nvxti,emucfgpresets.ini,%DRPSEL%,RJROMXT
			stringreplace,nvxti,nvxti,.,,All
			stringreplace,nvxti,nvxti,`,,|,All
			Loop,parse,nvxti,|
				{
					if (A_LoopField = romxt)
						{
							detxtu= 1
							break
						}
				}
			if (detxtu = "")
				{
					return
				}
		}
	if ((romxt = "zip")or(romxt = "7z")or(romxt = "rar")&&(SRCHDRP = 1))
		{
			ZIPSEEK= 1
			if instr(incldats,"ARCADE\")
				{
					ZIPSEEK= 0
				}
		}
	if (ZIPSEEK = 1)
		{
			concatcmd= "%S_KeyDir%\bin\7za.exe" l -slt "%CrCFLN%"
			StdOut := StdoutToVar_CreateProcess(concatcmd)
			partition=
			gosub, zpcrcproc
			ApndCRC= %CRCZ%
			hshfz=%ZPSZ%
			if (ApndCRC = 0000000)
				{
					return
				}
			gosub, hashproc
			return
		}
	else {
			gosub, CRC32GET
			if (ApndCRC = "-1")
				{
					return
				}
			gosub, hashproc
			return
	}
return

HASHPROC:
pszy= 
dat_inc= 	
Loop,parse,incldats,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		dat_inc+=1	
		dat_nm= % incl%dat_inc%	
		splitpath,A_LoopField,datfn,datpth,datxtn,datjn
		stringsplit,datcl,datjn,([
		SYS_K= %datcl1%
		SB_SetText("Parsing " SYS_K " datfile")
		dat_in= dats\%A_LoopField%
		ifinstring,sysllst,=%SYS_K%`n
			{
				goto, SYS_FND
			}
		Loop,parse,fuzsys,`n`r
			{
				ssysin= 
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,eig,A_LoopField,>
				HASH_SYS= % %eig2%
				stringreplace,repn,eig1,*,.*,All
				stringsplit,aig,repn,|
				Loop,%aig0%
					{
						prt= % aig%A_index%
						stringleft,prto,prt,1
						if (prto <> ".*")
							{
								prt:= "^" . prt
							}
						stringright,prte,prt,1
						if (prte <> ".*")
							{
								prt.= "$"
							}
						tosys:= RegExMatch(SYS_K,"i)"prt,sni)
						if (sni <> "")
							{
								SYS_K= %HASH_SYS%
								ssysin= 1
								break
							}
					}
				if (ssysin = 1)
					{
						break
					}
			}
		SYS_FND:	
		if (DETHSHSZ = 1)
			{
				Loop,parse,syssize,`n`r
					{
						stringsplit,niz,A_LoopField,>|
						chkszy= % %niz1%
						if (chkszy = "")
							{
								chkszy= %niz1%
							}
						if (chkszy = SYS_K)
							{
								if ((hshfz > niz3)or(hshfz < niz2)&&(romxt <> "zip")&&(romxt <> "7z")&&(romxt <> "rar"))
									{
										pszy= 1
										break
									}
							}
					}
				if (pszy = 1)
					{
						continue
					}
			}
		if (HLTDATP = 1)
			{
				break
			}
		if (dat_nm = "")
			{
				Fileread,incl%dat_inc%,%dat_in%
				dat_nm= % incl%dat_inc%
			}
		DAT_TST:	
		ifinstring,dat_nm,crc="%ApndCRC%"		
			{
				Loop,parse,dat_nm,`n`r
					{
						stringsplit,aeb,A_LoopField,<
						ifinstring,A_LoopField,<description>
							{
								stringsplit,ggnm,A_LoopField,<>
								G_N=%ggnm3%
								stringreplace,G_N,G_N,&amp;,&,All
								stringreplace,G_N,G_N,:,-,All
								stringreplace,G_N,G_N,>,-,All
								stringreplace,G_N,G_N,<,-,All
								stringreplace,G_N,G_N,?,-,All
								stringreplace,G_N,G_N,*,-,All
								stringreplace,G_N,G_N,\,-,All
								stringreplace,G_N,G_N,/,-,All
								stringreplace,G_N,G_N,|,-,All
								stringreplace,G_N,G_N,=,-,All
								continue
							}
						ifinstring,aeb2,rom name=
							{
								stringsplit,rgnm,aeb2,=>"
								;"	
								rgnum= 1	
								R_N= %rgnm3%
								Loop,%rgnm0%
									{
										nvnm= % rgnm%A_Index%
										newnv= %nvnm%
										;;if ((newnv = "size")or(newnv = "crc")or(newnv = "md5")or(newnv = "sha1"))
										if (newnv = "crc")
											{
												kprt:= A_index + 2
												hsh_%newnv%= % rgnm%kprt%
											}
									}
								if (hsh_crc = ApndCRC)
									{
										gosub, PROCHASH
										break
									}
							}
					}
			}
	}
return

PROCHASH:
fldrnm= 
if (JAKDRP = 1)
	{
		fldrnm= %G_N%\
		if (JAKDRP = 1)
			{
				if (JAKAFT = 1)
						{
							stringleft,tmb,G_N,1
							if ((tmb <> "(")&&(tmb <> "["))
								{
									stringsplit,nma,G_N,([
									NG_N= %nma1%
									fldrnm= %NG_N%\
								}
						}
			}
	}
if (RENMDRP = 1)
	{
		romyu= %R_N%
	}
hsh_dest= %fldrnm%%romyu%
iniread,hashsysfl,SystemLocations.ini,%SYS_K%
if ((hashsysfl = "")or(hashsysfl = "ERROR"))
	{
		iniwrite,%RJSYSTEMS%\%SYS_K%|,SystemLocations.ini,%SYS_K%
	}
if (ZIPSEEK = 1)
	{
		if ((ApndCRC <> "-1")&&(ApndCRC <> 0000000))
			{
				aknum=
				afnum=
				Loop, Parse, ROMZ,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						aknum+=1
						Loop, Parse, CRCZI,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								afnum+=1
								if (afnum = aknum)
									{
										CRCZ= %A_LoopField%
										break
									}
							}
						SplitPath,A_LoopField,zipt,zipp,zipxt,ziprn
						stringleft,ziptst,zipt,1
						if (ziptst = A_Space)
							{
								stringtrimleft,zipt,zipt,1
								stringtrimleft,ziprn,ziprn,1
							}
						Runwait,"%S_KeyDir%\bin\7za.exe" x %zipovrw% "%CrCFLN%" "%zipt%" -O"%RJSYSTEMS%\%SYS_K%\%fldrnm%",,hide
						if (ERRORLEVEL = 0)
							{
								if (RENMDRP = 1)
									{
										FileMove,%RJSYSTEMS%\%SYS_K%\%fldrnm%%zipt%,%RJSYSTEMS%\%SYS_K%\%fldrnm%%hsh_dest%,R
									}
								stringreplace,HSH_TBD,HSH_TBD,%CrcFLN%|,,All
							}
					}
			}
	}
if (ZIPSEEK <> 1)
	{
		if (MOVDRP = 1)
			{
				if !FileExist(RJSYSTEMS . "\" SYS_K . "\" fldrnm)
					{
						filecreatedir,%RJSYSTEMS%\%SYS_K%\%fldrnm%
					}
				FileMove,%CrCFLN%,%RJSYSTEMS%\%SYS_K%\%hsh_dest%,%ovrwdrp%
				if (ERRORLEVEL = 0)
					{
						stringreplace,HSH_TBD,HSH_TBD,%CrcFLN%|,,All
					}
				return
			}
		if !FileExist(RJSYSTEMS . "\" SYS_K . "\" fldrnm)
				{
					filecreatedir,%RJSYSTEMS%\%SYS_K%\%fldrnm%
				}
		FileCopy,%CrCFLN%,%RJSYSTEMS%\%SYS_K%\%hsh_dest%,%ovrwdrp%
		if (ERRORLEVEL = 0)
			{
				stringreplace,HSH_TBD,HSH_TBD,%CrcFLN%|,,All
			}
		return
	}
return

ADDATS:
gui,submit,nohide
guicontrolget,DATDRPD,,DATDRPD
stringleft,datdrc,DATDRPD,3
if (datdrc = "ALL")
	{
		stringsplit,datinc,datdrpd,%A_Space%
		iniread,ebs,datlist.ini,%datinc2%
		Loop,parse,ebs,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,feba,A_LoopField,=,"
				;"
				ifnotinstring,incldats,feba2
					{
						incldats.= feba2 . "|"
					}
			}
		guicontrol,,DATLBX,|%incldats%
		return
	}
incldats.= DATDRPD . "|"
guicontrol,,DATLBX,|%incldats%
return

ADDSRTFILE:
gui,submit,nohide
FileSelectFile,AddToDRP,M3,,Add ROMs,
if (AddToDRP = "")
	{
		return
	}
Gui,ListView,DRPLV
LVACHK= +Check
Loop, Parse,AddToPl,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		LV_Add(LVACHK,HASHDIR)
	}
return

REMADAT:
guicontrol,,DATLBX,|
incldats=
return

MOVEHSH:
gui,submit,nohide
guicontrolget,MOVDRP,,MOVDRP
guicontrolget,JAKDRP,,JAKDRP
guicontrolget,OVRWDRP,,OVRWDRP
guicontrolget,JAKAFT,,JAKAFT
Menu, MOVE_HSH, Add
Loop,Parse,sysllst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,abe,A_LoopField,=
		Menu, MOVE_HSH, Add, %abe1%, MOVE_TOSYS
	}
mousegetpos,Ngx,Ngy
MENU_X:= ngx*(A_ScreenDPI/96)
MENU_Y:= ngy*(A_ScreenDPI/96)
Menu,MOVE_HSH, Show, %MENU_X% %MENU_Y%
Menu,MOVE_HSH,DeleteAll
return

MOVE_TOSYS:
gui,submit,nohide
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curhash, RowNumber)
	}
splitpath,curhash,curfn,curpth,curxt,curjn
ISFLDR=
ifexist,%curhash%\
	{
		ISFLDR= 1
	}
fldrnm= 
if ((JAKDRP = 1)&&(ISFLDR = ""))
	{
		fldrnm= %curjn%\
		if (JAKAFT = 1)
			{
				stringleft,tmb,curjn,1
				if ((tmb <> "(")&&(tmb <> "["))
					{
						stringsplit,nma,curjn,([
						NG_N= %nma1%
						fldrnm= %NG_N%\
					}
			}
	}
ifnotexist,%RJSYSTEMS%\%A_ThisMenuItem%\%fldrnm%
	{
		filecreatedir,%RJSYSTEMS%\%A_ThisMenuItem%\%fldrnm%
	}	
if (MOVDRP = 1)
	{
		if (ISFLDR = 1)
			{
				FileMoveDir,%curhash%,%RJSYSTEMS%\%A_ThisMenuItem%\%fldrnm%%curfn%,%OVRWDRP%
			}
			else {
				FileMove,%curhash%,%RJSYSTEMS%\%A_ThisMenuItem%\%fldrnm%%curfn%,%OVRWDRP%
			}
		if (ERRORLEVEL = 0)
			{
				stringreplace,HSH_TBD,HSH_TBD,%curhash%|,,All
				gosub, INITHSHLV
			}
	}
	else {
			if (ISFLDR = 1)
				{
					FileCopyDir,%curhash%,%RJSYSTEMS%\%A_ThisMenuItem%\%fldrnm%%curfn%,%OVRWDRP%
				}
			else {
				FileCopy,%curhash%,%RJSYSTEMS%\%A_ThisMenuItem%\%fldrnm%%curfn%,%OVRWDRP%
			}
	}
return

REMDAT:
gui,submit,nohide
guicontrolget,datlbxlist,,DATLBX
Loop,parse,datlbxlist,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringreplace,incldats,incldats,%A_LoopField%|,,All	
	}
guicontrol,,DATLBX,|%incldats%
return

REMAHSH:
gui,submit,nohide
Gui,ListView,DRPLV
LV_Delete()
return

REMHSH:
gui,submit,nohide
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
				LV_Modify(RowNumber, "-Check")
				stringreplace,HSH_TBD,HSH_TBD,%curtxt%,,All
			}
		Else
			{
			}
	}
INITHSHLV:	
Gui,ListView,DRPLV
LVACHK= +Check
LV_Delete()
Loop,parse,HSH_TBD,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		LV_Add(LVACHK,A_LoopField)			
	}
LV_ModifyCol()	
return

ADDSRTDIR:
gui,submit,nohide
FileSelectFolder,HASHDIR,,3,Select a Folder
if (HASHDIR = "")
	{
		return
	}
Gui,ListView,DRPLV
LVACHK= +Check
LV_Add(LVACHK,HASHDIR)
LV_ModifyCol()
HSH_TBD.= HASHDIR . "|"
return

SRTFLT:
gui,submit,nohide
HSH_DISP=
guicontrolget,SRTFLTa,,SRTFLT
sleep,1500
guicontrolget,SRTFLT,,SRTFLT
blockinput,on
if (SRTFLT = "")
	{		
		Gui,ListView,DRPLV
		LV_Delete()	
		Loop,parse,HSH_TBD,|
			{
				LV_Add("+Check",A_LoopField)
			}
		LV_ModifyCol()	
		blockinput,off
		return
	}
if (SRTFLTa <> SRTFLT)
	{
		goto,SRTFLT
	}	
Loop,parse,HSH_TBD,|
	{
		if instr(A_LoopField,SRTFLT)
			{
				HSH_DISP.= A_LoopField . "|"
			}
	}
Gui,ListView,DRPLV
LV_Delete()	
Loop,parse,HSH_DISP,|
	{
		LV_Add("+Check",A_LoopField)
	}
LV_ModifyCol()	
blockinput,off
return

SRTCLRFLT:
HSH_DISP=
gui,submit,nohide
guicontrol,,SRTFLT,
Gui,ListView,DRPLV
LV_Delete()	
Loop,parse,HSH_TBD,|
	{
		LV_Add("+Check",A_LoopField)
	}
LV_ModifyCol()
return

DETSORT:
gui,submit,nohide
guicontrol,,DRPSEL,|Select a System||%allsupport%
guicontrol,disable,DRPSEL
guicontrol,disable,DETECTXTN
guicontrol,,DETECTXTN,0
return

SELSORT:
gui,submit,nohide
guicontrol,enable,DRPSEL
return

DRPSEL:
gui,submit,nohide
guicontrolget,DRPSEL,,DRPSEL
if (DRPSEL = "Select a System")
	{
		guicontrol,,DETECTXTN,0
		guicontrol,,DETSORT,1
		guicontrol,disable,DRPSEL
		guicontrol,disable,DETECTXTN
	}
	else {
		guicontrol,enable,DETECTXTN
	}
return

KEEPSORT:
gui,submit,nohide
return

JAKBF:
gui,submit,nohide
return

JAKAFT:
gui,submit,nohide
return

ARCSORT:
gui,submit,nohide
return

MOVDRP:
gui,submit,nohide
return

OVRWDRP:
gui,submit,nohide
return

KNOWNDRP:
gui,submit,nohide
return

SRCHDRP:
gui,submit,nohide
return

RENMDRP:
gui,submit,nohide
return

EXTDRP:
gui,submit,nohide
return

GETDATREP:
gui,submit,nohide
guicontrolget,hubtget,,DATREPO
URLFILE= %DATHUB%/%hubtget%/%hubtget%.zip
save= %cacheloc%\%hubtget%.zip
splitpath,save,svaf,svap
exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
ifnotexist,%save%
	{
		SB_SetText(" " hubtget " download failed")
		Msgbox,8196,Download Failed,Download failed.`nRetry?
		ifmsgbox,yes
			{
				goto,GETDATREP
			}
		return	
	}
SB_SetText(" " hubtget " downloaded and extracting")
Runwait, %comspec% cmd /c  " "%S_KeyDir%\bin\7za.exe" e -y "%save%" -O"dats\%hubtget%" ",,hide
SB_SetText(" " hubtget " extracted")
gosub, getdatlist
return

DATREPO:
gui,submit,nohide
return

JAKDRP:
gui,submit,nohide
guicontrol,enable,JAKBF
guicontrol,enable,JAKAFT
if (JAKDRP = 0)
	{
		guicontrol,disable,JAKBF
		guicontrol,disable,JAKAFT
	}
return

DRPLV:
gui,submit,nohide
return

getDATLIST:
filedelete,datlist.ini
alldats=ALL TOSEC|ALL NO-INTRO|ALL REDUMP|ALL MAME|
redumpdatset=
tosecdatset=
nointrodatset=
hyperspindatset=
mamedatset=
fileappend,[DATLIST]`n,datlist.ini
Loop,Files,dats\*.*,R
	{
		splitpath,A_LoopFileFullPath,DATname,DatPath,DatXtn,DatFN
		stringreplace,ccnpth,A_LoopFileFullPath,dats\,,All
		ifinstring,A_LoopFileDir,TOSEC
			{
				alldats.= A_LoopFileFullPath . "|"
				tosecdatset.= A_LoopFileFullPath . "|"
				iniwrite,"%ccnpth%",datlist.ini,TOSEC,%DatFN%
				continue
			}
		ifinstring,A_LoopFileDir,No-Intro
			{
				alldats.= A_LoopFileFullPath . "|"
				nointrodatset.= A_LoopFileFullPath . "|"
				iniwrite,"%ccnpth%",datlist.ini,NO-INTRO,%DatFN%
				continue
			}	
		ifinstring,A_LoopFileDir,REDUMP
			{
				alldats.= A_LoopFileFullPath . "|"
				redumpdatset.= A_LoopFileFullPath . "|"
				iniwrite,"%ccnpth%",datlist.ini,REDUMP,%DatFN%
				continue
			}
		ifinstring,A_LoopFileDir,MAME
			{
				alldats.= A_LoopFileFullPath . "|"
				mamedatset.= A_LoopFileFullPath . "|"
				iniwrite,"%ccnpth%",datlist.ini,MAME,%DatFN%
				continue
			}
	}
stringreplace,alldats,alldats,dats\,,All	
guicontrol,,DATDRPD,|%alldats%	
return

ArchiveSystems:
opndgam= 
gui, submit, nohide
sleep, 500
guicontrol,,ARCCORES,|Emu_Preset||%runlist%
guicontrolget,ARC_ON,,UrlTxt
NetArcSystem:
guicontrol,hide,ENHAK
overrdx:= % (%urlsv%_EULA)
guicontrol,,STRMVID,0
guicontrol,hide,STRMVID
guicontrol,,ENHAK,0
guicontrol,,ARCMFLT,
ifinstring,hacksyst,%ARCSYS%
	{
		guicontrol,show,ENHAK
	}
guicontrol,hide,sortoverride
guicontrol,,sortoverride,0
guicontrolget,ENHAK,,ENHAK	
HACKAPN=
genlst=
ArchiveSysRefresh:
guicontrol,enable,ENHAK
if (ENHAK = 1)
	{
		HACKAPN= #HACKS#
	}
if (ENHAK <> 1)
	{
		ifnotexist,%GAMSRCS%\#HACKS#%ARCSYS%.gam
			{
				guicontrol,disable,ENHAK
			}
	}	
guicontrol,,ARCLNCH,PLAY ::>
guicontrol,disable,ARCLNCH
guicontrol,disable,ARCNCT
guicontrol, disable, ARCHOST
keyin= %ARCSYS%
gosub, InvTransformSys
ARCSEL=
romarray1=
romarray2=
pop_list=
cmdfun=
recore=
if (arctvl = "")
	{
		norun=
	}
symt1=
symt2=
topcore=
fnne=
tmpsr=
tmprm=
sysddllist= %syslist%
if (MAMESWCHK = 1)
	{
		sysddllist= %mame_sys%
	}
guicontrol,,DOWNONLY,0
guicontrol,,CUSTMOPT,|%INJOPT%
guicontrol,,CUSTMARG,|
guicontrol,hide,CUSTMOPT
guicontrol,hide,CUSTMARG
guicontrol,,REDWN,0
guicontrol,,OVDCHK,0
guicontrol,,EXTRURL,0
guicontrol,,RUNXTRACT,0
guicontrol,,ArcMove,0
guicontrol,,ArcCull,1
guicontrol,,CUSTSWITCH,0
guicontrol,,EXTEXPLD,0
guicontrol,,JACKETMODE,0
guicontrol,,RNMJACK,
guicontrol,hide,RNMJACK
BRKO= 1
guicontrol,,SRCHRSLT,|
guicontrol,,ARCPOP,|
gui, submit, nohide
guicontrolget,ARCSYS,,ARCSYS
keyin=%ARCSYS%
gosub,TransformSys
if (ARCSYS = "")
	{
		return
	}
EXTRSYS= %ARCSYS%
if (ARCSYS = "Select a System")
	{
		guicontrol,,ARCCORES,|Emu_Preset||%runlist%
		guicontrol,,SRCHDDL,|All||%sysddllist%
		guicontrol,,ARCPOP,|
		return
	}
guicontrol,,SRCHDDL,|All|%ARCSYS%||%sysddllist%
pop_list=
if (MAMESWCHK = 1)
	{
		ifinstring,afep,|%ARCSYS%|
			{
				iniread,ARCTRA,emuCfgPresets.ini,%ARCSYS%,RJMAMENM
				loop, Read, %GAMSRCS%\MAME - Systems\%ARCTRA%.gam
					{
						if (A_LoopReadLine = "")
							{
								continue
							}
						romarray2=
						stringsplit,romarray,A_LoopReadLine,|,`n`r
						if (romarray2 = "")
							{
								genlst= 1
								svipth= %romarray1%
								Loop,parse,romarray1,/
									{
										svipth= %A_LoopField%
									}
								splitpath,svipth,,,,sanfile
								gosub, SanURL
								romarray2= %sanfile%
							}
						pop_list .= romarray2 . "|"
					}
				pdlist= %pop_list%
				goto, pdlist
			}
		loop, Read, %GAMSRCS%\MAME - Systems\%ARCSYS%.gam
			{
				if (A_LoopReadLine = "")
					{
						continue
					}
				romarray2=
				stringsplit,romarray,A_LoopReadLine,|,`n`r
					if (romarray2 = "")
						{
							genlst= 1
							svipth= %romarray1%
							Loop,parse,romarray1,/
								{
									svipth= %A_LoopField%
								}
							splitpath,svipth,,,,sanfile
							gosub, SanURL
							romarray2= %sanfile%
						}
				pop_list .= romarray2 . "|"
			}
		pdlist= %pop_list%
		goto, pdlist
	}
Loop,%GAMSRCS%\%HACKAPN%%ARCSYS%.gam
	{
		loop, Read, %A_LoopFileFullPath%
			{
				if (A_LoopReadLine = "")
					{
						continue
					}
				romarray2=
				stringsplit,romarray,A_LoopReadLine,|,`n`r
				if (romarray2 = "")
					{
						genlst= 1
						svipth= %romarray1%
						Loop,parse,romarray1,/
							{
								svipth= %A_LoopField%
							}
						splitpath,svipth,,,,sanfile
						gosub, SanURL
						romarray2= %sanfile%
					}
				pop_list .= romarray2 . "|"
			}
	}
pdlist= %pop_list%
pdlist:
Sort,pop_list,D|
EXTRSYS= %ARCSYS%
GetCoreFromSys:
if (GLBLRUN = "")
	{
		gosub, MatchEmu
	}
if ((NPLC = "")&&(GLBLRUN = 1))
	{
		gosub, MatchSyst
	}
if (ARCSEL = 2)
	{
		return
	}
jacktshw= hide
guicontrol,,ARCPOP,|%pop_list%
OVDCHKB= $	
iniread,lnchparam,launchparams.ini,LAUNCHPARAMS,%keyout%
if (lnchparam = "ERROR")
	{
		guicontrol,,JACKETMODE,1
		guicontrol,,EXTRURL,1
		guicontrol,,EXTEXPLD,0
		guicontrol,,RUNXTRACT,1
		guicontrol,show,RNMJACK
		guicontrol,,ARCMOVE,0
		if (instr(EXTRSYS,"Movies")or instr(EXTRSYS,"Anime") or (EXTRSYS = "Television - Series") or (EXTRSYS = "Video - Media")or instr(ARCSRC,"Media"))
			{
				iniread,lnchparam,launchparams.ini,LAUNCHPARAMS,Video - Media
				guicontrol,show,strmvid
			}
			else {
				lnchparam=	$|1|1|0|1|0
				goto, arlnchprm
			}
	}
if ((lnchparam <> "ERROR")&&(lnchparam <> ""))
	{
		stringsplit,aprm,lnchparam,|
		if (aprm1 <> "$")
			{
				OVDCHKB= %aprm1%
				guicontrol,,OVDCHK,1
				guicontrol,,OVDLDS,|Other||Matching|Netplay|%systmfldrs%
				guicontrol,,OVDTXT,%aprm1%
			}
		guicontrol,,JACKETMODE,%aprm2%
		guicontrol,,EXTRURL,%aprm3%
		guicontrol,,EXTEXPLD,%aprm4%
		guicontrol,,RUNXTRACT,%aprm5%
		RUNXTRACT= %aprm5%
		if (aprm3 = 1)
			{
				jacktshw= show
			}
		guicontrol,%jacktshw%,RNMJACK
		if (sortoverride = 0)
			{
				gosub, ExtractURL
			}
		guicontrol,,ARCMOVE,%aprm6%
	}
arlnchprm:
if (EXTRSYS = "MAME - Arcade")
	{
		guicontrol,,OVDTXT,%RJSYSTEMS%\MAME - Arcade
	}
if (EXTRSYS = "BIOS - BIOS")
	{
		OVDCHK= MAME - Arcade
		iniread,mame_verx,Apps.ini,EMULATORS,MAME
		splitpath,mame_verx,,mamepth
		mambpri=
		if (mamepth <> "")
			{
				ifnotexist,%mamepth%\roms\
					{
						filecreatedir,%mamepth%\roms
					}
				mambpri= %mamepth%\roms|
			}
		OVDFLDR= %cacheloc%\bios
		guicontrol,,OVDTXT,%OVDFLDR%
		guicontrol,,OVDLDS,|%mambpri%%OVDFLDR%||Matching|%systmfldrs%
		guicontrol,,OVDCHK,1
		guicontrol,enable,OVDLDS
		guicontrol,enable,SETOVD
		guicontrol,,DOWNONLY,1
		gosub, DOWNONLY
		guicontrol,,EXTRURL,0
		guicontrol,,ARCCORES,||%runlist%
	}
if (MAMESWCHK = 1)
	{
		guicontrol,,ARCMOVE,0
		guicontrol,,ARCCULL,0
		guicontrol,,EXTRURL,0
		guicontrol,,EXTEXPLD,0
		guicontrol,,RUNXTRACT,0
		guicontrol,,JACKETMODE,0				  
	}
if (EXTRSYS = "- firmware -")
	{
		gosub, MAMEBIOSFIRM
	}
return

ArcCores:
loadedjoy=
APLA=
dlx2=
guicontrol,show,CUSTSWITCH
guicontrol, enable, ARCHOST
gui, submit, nohide
guicontrolget, ARCCORES,,ARCCORES
coreselv= %ARCCORES%
stringsplit,dlx,coreselv,.
if (dlx2 <> "dll")
	{
		guicontrol,disable,ARCHOST
		APLA= 1
	}
if (dlx2 = "dll")
	{
		guicontrol,,CUSTMOPT,
		guicontrol,,CUSTMARG,
		guicontrol,,CUSTSWITCH,0
		guicontrol,hide,CUSTMOPT
		guicontrol,hide,CUSTMARG
		guicontrol,hide,CUSTSWITCH
	}
if (coreselv = "")
	{
		if (DOWNONLY = 1)
			{
				guicontrol,enable,ARCLNCH
				return
			}
		guicontrol,disable,ARCLNCH
		return
	}
if (tmpsr <> "")
	{
		guicontrol,enable,ARCLNCH
	}
if (tmprm <> "")
	{
		guicontrol,enable,ARCLNCH
	}
if (core_gui <> ARCCORES)
	{
	}
return

ARCEDURA:
gui,submit,nohide
IniDelete,%ARCORG%,SOURCES
IniRead,RESZEDA,sets\Arcorg.set,SOURCES
Loop,parse,RESZEDA,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,vin,A_LoopField,=
		iniwrite,%vin2%,%ARCORG%,SOURCES,%vin1%
	}
return

ARCEDURL:
gui,submit,nohide
guicontrolget,urltxt,,urltxt
stringreplace,urlsv,urltxt,',,All
stringreplace,urlsv,urlsv,.,,All
stringreplace,urlsv,urlsv,&,,All
stringreplace,urlsv,urlsv,`%,,All
stringreplace,urlsv,urlsv,-,,All
stringreplace,urlsv,urlsv,`,,,All
stringreplace,urlsv,urlsv,~,,All
stringreplace,urlsv,urlsv,%A_Space%,,All
IniRead,RESZEDT,sets\Arcorg.set,SOURCES,%urltxt%
if (RESZEDT <> "ERROR")
	{
		IniWrite,RESZEDT,%ARCORG%,REPOSITORIES,%urltxt%
		return
	}
iniDelete,%ARCORG%,SOURCES,%urlTxt%	
return

ARCPCFG:
gui,submit,nohide
guicontrolget,ARCCORES,,ARCCORES
if (arcpnum > 1)
	{
		return
	}
if (tmprm = "")
	{
		return
	}
ifnotinstring,systmfldrs,%keyout%
systmfldrs.= keyout . "|"
guicontrol,,RUNFLRAD,1
guicontrol,,RUNSYSDDL,|%keyout%||%INITFLDRS%
guicontrol,,MORROM,|%afnchk%||
guicontrol,,LCORE,|%ARCCORES%||
EXTRSYS= %keyout%
ROMSYS= %keyout%
EDTRMFN= %romfname%
aemcfg= 1
return

ARSRST:
gui,submit,nohide
iniread,tofv,sets\launchparams.set,LAUNCHPARAMS,%keyout%
iniwrite,%tofv%,launchparams.ini,LAUNCHPARAMS,%keyout%
SB_SetText(" " keyout " sytem paramaters reset")
gosub, ArchiveSystems
return

ARSCFG:
gui,submit,nohide
guicontrolget,RCLSYSTEM,,ARCSYS
keyin=%RCLSYSTEM%
gosub,TransformSys
goto, ARCFGCONT
MULTIDISCETECT:
return

SetOvd:
gui,submit,nohide
iniread,tmpsw,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
stringsplit,tmpsx,tmpsw,|
OVDFLDR=
FileSelectFolder,OVDFLDR,,3
if (OVDFLDR = "")
	{
		return
	}
stringright,efi,OVDFLDR,2
stringLeft,efix,OVDFLDR,2
if (efi = ":\")
	{
		OVDFLDR= %efix%
	}		
guicontrol,,OVDCHK,1
guicontrol,enable,OVDLDS
guicontrol,enable,SETOVD
guicontrol,,OVDLDS,|Other||%systmfldrs%
guicontrol,,OVDTXT,%OVDFLDR%
iniwrite,%OVDFLDR%|%tmpsx2%|%tmpsx3%|%tmpsx4%|%tmpsx5%|%tmpsx6%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
return

DWNINJACK:
gui,submit,nohide
guicontrol,enable,RNMJACK
guicontrolget,JACKETMODE,,JACKETMODE
guicontrol,,sortoverride,0
if (JACKETMODE = 0)
	{
		guicontrol,,EXTEXPLD,0
		guicontrol,hide,RNMJACK
		guicontrol,,RNMJACK,
	}
if (JACKETMODE = 1)
	{
		guicontrol,,EXTEXPLD,1
		OVDFLDR= %OVDFLDR%
		guicontrol,show,RNMJACK
	}
IniWrite, "%JACKETMODE%", Settings.ini,GLOBAL,jacket_mode
iniread,tmpsw,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
stringsplit,tmpsx,tmpsw,|
iniwrite,%tmpsx1%|%JACKETMODE%|%tmpsx3%|%tmpsx4%|%tmpsx5%|%tmpsx6%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
return

RNMJACK:
gui,submit,nohide
if (DWNINJACK = 0)
	{
		guicontrol,,RNMJACK,
		RNMJACK=
		return
	}
guicontrolget,RNMJACK,,RNMJACK
stringreplace,RNMJACK,RNMJACK,*,-,All
stringreplace,RNMJACK,RNMJACK,?,-,All
stringreplace,RNMJACK,RNMJACK,\,-,All
stringreplace,RNMJACK,RNMJACK,/,-,All
stringreplace,RNMJACK,RNMJACK,>,-,All
stringreplace,RNMJACK,RNMJACK,<,-,All
stringreplace,RNMJACK,RNMJACK,:,-,All
return

OvdChk:
gui,submit,nohide
guicontrol,,sortoverride,0
guicontrolget,OVDHCK,,OVDCHK
iniread,tmpsw,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
stringsplit,tmpsx,tmpsw,|
if (OVDCHK = 1)
	{
		guicontrol,enable,SETOVD
		guicontrol,enable,OVDLDS
		guicontrolget,OVDLDS,,OVDLDS
		guicontrolget,OVDTXT,,OVDTXT
		if (OVDLDS = "Matching")
			{
				OVDFLDR= %RJSYSTEMS%\%OVDLDS%
				iniwrite,$|%tmpsx2%|%tmpsx3%|%tmpsx4%|%tmpsx5%|%tmpsx6%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
				guicontrol,,OVDLDS,|Matching||Netplay|%systmfldrs%
				guicontrol,,OVDTXT,
			}
		else
			{
				guicontrolget,OVDFLDR,,OVDTXT
				iniwrite,%OVDFLDR%|%tmpsx2%|%tmpsx3%|%tmpsx4%|%tmpsx5%|%tmpsx6%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
				guicontrol,,OVDLDS,|Other||Matching|Netplay|%systmfldrs%
				guicontrol,,OVDTXT,%OVDFLDR%
			}
	}
if (OVDCHK = 0)
	{
		guicontrol,disable,SETOVD
		guicontrol,disable,OVDLDS
		guicontrol,,OVDLDS,|Matching||Netplay|%systmfldrs%
		guicontrol,,OVDTXT,
		OVDFLDR=
		iniwrite,$|%tmpsx2%|%tmpsx3%|%tmpsx4%|%tmpsx5%|%tmpsx6%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
	}
return

OvDlds:
gui, submit, nohide
guicontrol,,OVDCHK,1
guicontrol,,sortoverride,0
guicontrol,enable,OVDLDS
guicontrol,enable,SETOVD
guicontrolget,ovdnm,,OVDLDS
guicontrolget,OVDTXT,,OVDTXT
iniread,tmpsw,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
iniread,ksr,SystemLocations.ini,LOCATIONS,%EXTRSYS%
if (ksr = "")
	{
		OVDFLDR= %RJSYSTEMS%\%ovdnm%
	}
	else {
		stringsplit,fir,ksr,|
		OVDFLDR= %fir1%
	}
stringsplit,tmpsx,tmpsw,|
if (ovdnm = "Other")
	{
		OVDFLDR= %OVDTXT%
		iniwrite,%OVDFLDR%|%tmpsx2%|%tmpsx3%|%tmpsx4%|%tmpsx5%|%tmpsx6%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
	}
if (ovdnm = "Matching")
	{
		OVDFLDR= %RJSYSTEMS%\%EXTRSYS%
		iniwrite,$|%tmpsx2%|%tmpsx3%|%tmpsx4%|%tmpsx5%|%tmpsx6%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
	}
return

ReDownload:
gui, submit, nohide
REDWN= 0
if REDWN= 1
	{
		REDOWN= 1
	}
return

URLCRC:
GAMCRC=
ApndCRC=
CrCFLN= %ROMCRC%
gosub, CRC32GET
GAMCRC= %ApndCRC%
if (GAMCRC = "")
	{
		GAMCRC= 000000
	}
return

ExtractURL:
gui,submit,nohide
guicontrol,,sortoverride,0
guicontrolget,EXTRURL,,EXTRURL
iniread,tmpsw,launchparams.ini,LAUNCHPARAMS,%keyout%
stringsplit,tmpsx,tmpsw,|
if (EXTRURL = 0)
	{
		guicontrol,hide,EXTEXPLD
		EXTEXPLD= 0
		guicontrol, hide, RUNXTRACT
		RUNXTRACT= 0
		guicontrol,, ArcMove,0
		ARCMOVE= 0
		guicontrol, hide, ArcMove
		guicontrol, hide, ArcCull
	}
if (EXTRURL = 1)
	{
		guicontrol,show,EXTEXPLD
		guicontrol, show, RUNXTRACT
		guicontrol, show, ArcMove
		guicontrol, show, ArcCull
		EXTEXPLD= %tmpsx4%
		RUNXTRACT= %tmpsx5%
		ARCMOVE= %tmpsx6%
	}
iniwrite,%tmpsx1%|%tmpsx2%|%EXTRURL%|%EXTEXPLD%|%RUNXTRACT%|%ARCMOVE%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
return

EXTEXPLD:
gui,submit,nohide
guicontrol,,sortoverride,0
guicontrolget,EXTEXPLD,,EXTEXPLD
iniread,tmpsw,launchparams.ini,LAUNCHPARAMS,%ARCSYS%
stringsplit,tmpsx,tmpsw,|
iniwrite,%tmpsx1%|%tmpsx2%|%tmpsx3%|%EXTEXPLD%|%tmpsx5%|%tmpsx6%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
return

ArcCull:
gui,submit,nohide
guicontrolget,ArcCull,,ArcCull
guicontrolget,RJNMJACK,,RNMJACK
if (ARCCULL = 1)
	{
		stringsplit,nnn,RNMJACK,([
		if (nnn <> "")
			{
				RNMJACK= %nnn1%
			}
		guicontrol,,RNMJACK,%RNMJACK%
		return
	}
ifinstring,aftpth2,%RNMJACK%
	{
		guicontrol,,RNMJACK,%aftpth2%
	}
return

ArcMove:
gui,submit,nohide
guicontrol,,sortoverride,0
guicontrolget,ARCMOVE,,ARCMOVE
guicontrolget,ARCCULL,,ARCCULL
iniread,tmpsw,launchparams.ini,LAUNCHPARAMS,%ARCSYS%
stringsplit,tmpsx,tmpsw,|
iniwrite,%tmpsx1%|%tmpsx2%|%tmpsx3%|%tmpsx4%|%tmpsx5%|%ARCMOVE%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
RunXtract:
gui, submit,nohide
guicontrolget,RUNXTRACT,,RUNXTRACT
guicontrol,,sortoverride,0
if (RUNXTRACT = 1)
	{
		guicontrol,,DOWNONLY,0
		gosub, DownOnly
	}
iniread,tmpsw,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
stringsplit,tmpsx,tmpsw,|
iniwrite,%tmpsx1%|%tmpsx2%|%tmpsx3%|%tmpsx4%|%RUNXTRACT%|%tmpsx6%,launchparams.ini,LAUNCHPARAMS,%EXTRSYS%
return

ClipURL:
GETURL=1
gosub, GetArcURL
Clipboard= %URLFILE%
GETURL=
return

ArcGet:
HOSTING= 1
ArcLaunch:
gui,submit,nohide
guicontrolget,LCORE,,LCORE
guicontrolget,coreselv,,ARCCORES
guicontrolget,RNMJACK,,RNMJACK
guicontrolget,JACKETMODE,,JACKETMODE
guicontrolget,MAMESWCHK,,MAMESWCHK
if (arctvl = "")
	{
		norun=
	}
if (DOWNONLY = 1)
	{
		norun= 1
	}
if (coreselv = "")
	{
	}
APLN=
HACKAPN=
romf=
guicontrol,disable,ARCSYS
guicontrol,disable,RNMJACK
guicontrol,disable,ARCPOP
guicontrol,disable,SRCHRSLT
guicontrol,disable,ARCEDSRCH
guicontrol,disable,ARCNCT
guicontrol,disable,NETCONNECT
guicontrol,disable,ARCHOST
guicontrol,disable,ARCLNCH
guicontrol,disable,ARCCORES
if (tmpsr <> "")
	{
		Loop, Parse, tmpsr,|
			{
				sysddlist= %syslist%
				stringsplit,srchspl,A_LoopField,=
				romfp= %srchspl2%
				EXTRSYS= %srchspl1%
				OVDFLDR=
				ifnotinstring,srchspl1,%A_Space%-%A_Space%
					{
						sysddlist= %mame_syst%
						EXTRSYS= % rev_%srchspl1%
						if (EXTRSYS = "")
							{
								EXTRSYS= %srchspl1%
							}
					}
				stringreplace,EXTRSYSNH,EXTRSYS,#HACKS#,,All
				romsys= %EXTRSYSNH%
				updtguirst=
				iniread,ksr,SystemLocations.ini,LOCATIONS,%EXTRSYS%
				if ((ksr = "")or(ksr = "ERROR"))
					{
						ksr=
						ACSVDEST= %RJSYSTEMS%\%romsys%
						if (instr(EXTRSYS,"Movies")or instr(EXTRSYS,"Anime")or (EXTRSYS = "Television - Series")or (EXTRSYS = "Video - Media")or instr(ARCSRC,"Media"))
							{
								iniread,ksr,launchparams.ini,LAUNCHPARAMS,Video - Media
							}
							ELSE {
								ksr=$|1|1|0|1|0
							}
					}
					else {
						stringsplit,fir,ksr,|
						ACSVDEST= %fir1%
					}
				ifnotexist,%ACSVDEST%\
					{
						apndx= 
						iniread,supemz,emuCfgPresets.ini,%EXTRSYS%,SUPEMU
						Loop,parse,supemz,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								krvr= %A_LoopField%
								iniread,supemx,Apps.ini,EMULATORS,%krvr%
								iniread,supemv,Assignments.ini,OVERRIDES,%EXTRSYS%
								if ((supemx <> "ERROR")&&(supemx <> "")&&(supemv = ""))
									{
										apndx.= supemx . "|"
									}
							}
						iniwrite,"%apndx%",Assignments.ini,OVERRIDES,%EXTRSYS%
					}
				guicontrol,,ARCSYS,|%EXTRSYSNH%||Select a System|%sysddllist%
				gosub, GamFIND
				gosub, ArcPPND
				guicontrolget,OVDLDS,,OVDLDS
				guicontrolget,OVDFLDR,,OVDTXT
				iniread,ksr,SystemLocations.ini,LOCATIONS,%EXTRSYS%
				if ((ksr = "")or(ksr = "ERROR"))
					{
						ACSVDEST= %RJSYSTEMS%\%romsys%
						if (instr(EXTRSYS,"Movies")or instr(EXTRSYS,"Anime")or(EXTRSYS = "Television - Series")or (EXTRSYS = "Video - Media")or instr(ARCSRC,"Media"))
							{
								iniread,ksr,launchparams.ini,LAUNCHPARAMS,Video - Media
							}
							ELSE {
								ksr=$|1|1|0|1|0
							}
					}
					else {
						stringsplit,fir,ksr,|
						ACSVDEST= %fir1%
					}
				if (sortoverride = 0)
					{
						iniread,jkspl,Launchparams.ini,LAUNCHPARAMS,%romsys%
						if ((jkspl = "")or(jkspl = "ERROR"))
							{
								if (instr(EXTRSYS,"Movies")or instr(EXTRSYS,"Anime")or(EXTRSYS = "Television - Series")or (EXTRSYS = "Video - Media")or instr(ARCSRC,"Media"))
									{
										iniread,jkspl,launchparams.ini,LAUNCHPARAMS,Video - Media
									}
									ELSE {
										jkspl=$|1|1|0|1|0
									}
							}
						stringsplit,aprm,jkspl,|
						OVDFLDR= %aprm1%
						if (OVDFLDR <> "$")
							{
								OVDCHK= 1
								ifinstring,OVDFLDR,:\
									{
										ACSVDEST= %OVDFLDR%
									}
									else
										{
											iniread,ksr,SystemLocations.ini,LOCATIONS,%OVDFLDR%
											if ((ksr = "ERROR") or (ksr = ""))
												{
													ACSVDEST= %RJSYSTEMS%\%OVDFLDR%
													if (instr(EXTRSYS,"Movies")or instr(EXTRSYS,"Anime")or(EXTRSYS = "Television - Series")or (EXTRSYS = "Video - Media")or instr(ARCSRC,"Media"))
														{
															iniread,ksr,launchparams.ini,LAUNCHPARAMS,Video - Media
														}
														ELSE {
															ksr=$|1|1|0|1|0
														}
												}
												else {
													stringsplit,fir,ksr,|
													ACSVDEST= %fir1%
												}
										}
							}
							else
								{
									OVDCHK= 0
									OVDFLDR=
									if (romsys = "- firmware -")
										{
											iniread,mame_verx,Apps.ini,EMULATORS,MAME
											splitpath,mame_verx,,mamepth
											ACSVDEST= %mamepth%\roms
										}
									if (romsys = "BIOS - BIOS")
										{
											iniread,mame_verx,Apps.ini,EMULATORS,MAME
											splitpath,mame_verx,,mamepth
											mambpri=
											if (mamepth <> "")
												{
													ifnotexist,%mamepth%\roms\
														{
															filecreatedir,%mamepth%\roms
														}
												}
											ACSVDEST= %cacheloc%
										}
								}
						JACKETMODE= %aprm2%
						EXTRURL= %aprm3%
						EXTEXPLD= %aprm4%
						RUNXTRACT= %aprm5%
						ARCMOVE= %aprm6%
						if (JACKETMODE = 1)
							{
								rjinsfldr= %romname%
								if (RNMJACK <> "")
									{
										rjinsfldr= %RNMJACK%
									}
								if (romsys = "Open - Beats of Rage")
									{
										rjinsfldr.= "\Paks"
									}
								ACSVDEST= %ACSVDEST%\%rjinsfldr%
							}
					}
					else
						{
							if (OVDCHK = 0)
								{
									if (romsys = "- firmware -")
										{
											iniread,mame_verx,Apps.ini,EMULATORS,MAME
											splitpath,mame_verx,,mamepth
											ACSVDEST= %mamepth%\roms
										}
									if (romsys = "BIOS - BIOS")
										{
											OVDCHK= MAME - Arcade
											iniread,mame_verx,Apps.ini,EMULATORS,MAME
											splitpath,mame_verx,,mamepth
											mambpri=
											if (mamepth <> "")
												{
													ifnotexist,%mamepth%\roms\
														{
															filecreatedir,%mamepth%\roms
														}
													mambpri= %mamepth%\roms|
												}
											ACSVDEST= %cacheloc%
										}
									ifnotexist,%ACSVDEST%\
										{
											updtguirst= 1
										}
								}
								else
									{
										if (OVDLDS = "Matching")
											{
												OVDCHK= 0
												ACSVDEST= %RJSYSTEMS%\%romsys%
												iniread,ksr,SystemLocations.ini,LOCATIONS,%romsys%
												if ((ksr = "ERROR") or (ksr = ""))
													{
														if (instr(EXTRSYS,"Movies")or instr(EXTRSYS,"Anime")or(EXTRSYS = "Television - Series")or (EXTRSYS = "Video - Media")or instr(ARCSRC,"Media"))
															{
																iniread,ksr,launchparams.ini,LAUNCHPARAMS,Video - Media
															}
															ELSE {
																ksr=$|1|1|0|1|0
															}
													}
													else {
														stringsplit,fir,ksr,|
														ACSVDEST= %fir1%
													}
											}
											else
												{
													if (OVDFLDR = "Other")
														{
															ACSVDEST= %OVDFLDR%
														}
														else
															{
																iniread,ksr,SystemLocations.ini,LOCATIONS,%OVDLDS%
																if ((ksr = "ERROR") or (ksr = ""))
																	{
																		ACSVDEST= %RJSYSTEMS%\%OVDLDS%
																		if (instr(EXTRSYS,"Movies")or instr(EXTRSYS,"Anime")or(EXTRSYS = "Television - Series")or (EXTRSYS = "Video - Media")or instr(ARCSRC,"Media"))
																			{
																				iniread,ksr,launchparams.ini,LAUNCHPARAMS,Video - Media
																			}
																			ELSE {
																				ksr=$|1|1|0|1|0
																			}
																	}
																	else {
																		stringsplit,fir,ksr,|
																		ACSVDEST= %fir1%
																	}
																;;ACSVDEST= %RJSYSTEMS%\%OVDLDS%
															}
												}
								}
							if (JACKETMODE = 1)
								{
									rjinsfldr= %romname%
									if (RNMJACK <> "")
										{
											rjinsfldr= %RNMJACK%
										}
									if (romsys = "Open - Beats of Rage")
										{
											rjinsfldr.= "\Paks"
										}
									IfNotExist,%ACSVDEST%\%rjinsfldr%
										{
											if ((romsys <> "BIOS - BIOS")&& if (romsys <> "- firmware -"))
												{
													FileCreateDir,%ACSVDEST%\%rjinsfldr%
													updtguirst= 1
												}
										}
									ACSVDEST= %ACSVDEST%\%rjinsfldr%
								}
							ifnotexist,%ACSVDEST%\
								{
									updtguirst= 1
								}
						}
				IfNotExist,%ACSVDEST%\
					{
						updtguirst= 1
						FileCreateDir,%ACSVDEST%\%rjinsfldr%
					}
				save= %ACSVDEST%\%savefile%
				splitpath,save,svaf,svap,svax,svaj
				gosub, RomSavePPND
				if (updtguirst = 1)
					{
						gosub, RJSYSRESET
					}
				if (mlturl = 1)
					{
						kimx= 
						Loop,
							{
								kj= % URLFILE%kim%
								URLFILE= %kj%
								if (kj = "")
									{
										break
									}
								splitpath,kj,inm,inp,inx,ine
								if (ine <> inx)
									{
										save= %svaf%\%svaj%.%inx%
									}
									else {
										save= %svaf%\%inm%
									}
								gosub, RomDownload
								kimx+= 1
							}
						goto, EVEIS
					}	
				gosub, RomDownload
			}
		EVEIS:	
		tmpsr=
		guicontrol,enable,ARCSYS
		guicontrol,enable,RNMJACK
		guicontrol,enable,ARCPOP
		guicontrol,enable,SRCHRSLT
		guicontrol,enable,ARCLNCH
		guicontrol,enable,ARCHOST
		guicontrol,enable,ARCCORES
		return
	}
romtch=
srcharcs=
romdwnlst=
guicontrolget,EXTRSYS,,ARCSYS
keyin=%EXTRSYS%
gosub,TransformSys
if (ENHAK = 1)
	{
		HACKAPN= #HACKS#
	}
guicontrolget,ArcMove,,ArcMove
guicontrolget,ArcCull,,ArcCull
guicontrolget,OVDLDS,,OVDLDS
guicontrolget,romdwnlst,,ARCPOP
if (romdwnlst = "")
	{
		srcharcs= 1
		guicontrolget,romdwnlst,,SRCHRSLT
	}
sysddlist= %syslist%
stringreplace,EXTRSYSNH,EXTRSYS,#HACKS#,,All
stringreplace,keyout,keyout,#HACKS#,,All
romsys= %EXTRSYSNH%
Loop, parse, romdwnlst,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		romfp= %A_LoopField%
		gosub, GamFIND
		gosub, ArcPPND
		guicontrolget,OVDLDS,,OVDLDS
		guicontrolget,OVDFLDR,,OVDTXT
		iniread,ksr,SystemLocations.ini,LOCATIONS,%keyout%
		if (ksr = "ERROR")
			{
				ksr=
			}
		if (ksr = "")
			{
				ACSVDEST= %RJSYSTEMS%\%keyout%
			}
			else {
				stringsplit,fir,ksr,|
				ACSVDEST= %fir1%
			}
		ifnotexist,%ACSVDEST%\
			{
				apndx= 
				iniread,supemz,emuCfgPresets.ini,%keyout%,SUPEMU
				Loop,parse,supemz,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						krvr= %A_LoopField%
						iniread,supemx,Apps.ini,EMULATORS,%krvr%
						iniread,supemv,Assignments.ini,OVERRIDES,%keyout%
						if ((supemx <> "ERROR")&&(supemx <> "")&&(supemv = ""))
							{
								apndx.= supemx . "|"
							}
					}
				iniwrite,"%apndx%",Assignments.ini,OVERRIDES,%keyout%
				if ((romsys <> "BIOS - BIOS") && (romsys <> "- firmware -"))
					{
						FileCreateDir,%ACSVDEST%
						gosub, RJSYSRESET
					}
			}
		if (sortoverride = 0)
			{
				iniread,jkspl,Launchparams.ini,LAUNCHPARAMS,%keyout%
				stringsplit,aprm,jkspl,|
				OVDFLDR= %aprm1%
				if (OVDFLDR <> "$")
					{
						OVDCHK= 1
						ifinstring,OVDFLDR,:\
							{
								ACSVDEST= %OVDFLDR%
							}
							else
								{
									iniread,ksr,SystemLocations.ini,LOCATIONS,%OVDFLDR%
									if ((ksr = "ERROR")or(ksr = ""))
										{
											ACSVDEST= %RJSYSTEMS%\%OVDFLDR%
										}
										else {
											stringsplit,fir,ksr,|
											ACSVDEST= %fir1%
										}
									;;ACSVDEST= %RJSYSTEMS%\%OVDFLDR%
								}
					}
					else
						{
							OVDCHK= 0
							OVDFLDR=
						}
				iniread,ksr,SystemLocations.ini,LOCATIONS,%keyout%
				if (ksr = "ERROR")
					{
						ksr=
					}
				if ((ksr = "")&&(OVDCHK <> 1))
					{
						ACSVDEST= %RJSYSTEMS%\%keyout%
					}
					else {
						if (ksr <> "")
							{
								stringsplit,fir,ksr,|
								ACSVDEST= %fir1%
							}
					}
				;;ACSVDEST= %RJSYSTEMS%\%keyout%
				JACKETMODE= %aprm2%
				EXTRURL= %aprm3%
				EXTEXPLD= %aprm4%
				RUNXTRACT= %aprm5%
				ARCMOVE= %aprm6%
				if (JACKETMODE = 1)
					{
						rjinsfldr= %romname%
						if (RNMJACK <> "")
							{
								rjinsfldr= %RNMJACK%
							}
						if (EXTRSYS = "Open - Beats of Rage")
							{
								rjinsfldr.= "\Paks"
							}
						IfNotExist,%ACSVDEST%\%rjinsfldr%
							{
								FileCreateDir,%ACSVDEST%\%rjinsfldr%
							}
						ACSVDEST.= "\" . rjinsfldr
					}
			}
				else
					{
						if (OVDCHK = 0)
							{
								iniread,ksr,SystemLocations.ini,LOCATIONS,%keyout%
								if (ksr = "ERROR")
									{
										ksr=
									}
								if (ksr = "")
									{
										ACSVDEST= %RJSYSTEMS%\%keyout%
									}
									else {
										stringsplit,fir,ksr,|
										ACSVDEST= %fir1%
									}
								;;ACSVDEST= %RJSYSTEMS%\%keyout%
								if (EXTRSYS = "- firmware -")
									{
										iniread,mame_verx,Apps.ini,EMULATORS,MAME
										splitpath,mame_verx,,mamepth
										ACSVDEST= %mamepth%\roms
									}
								if (EXTRSYS = "BIOS - BIOS")
									{
										OVDCHK= MAME - Arcade
										iniread,mame_verx,Apps.ini,EMULATORS,MAME
										splitpath,mame_verx,,mamepth
										mambpri=
										if (mamepth <> "")
											{
												ifnotexist,%mamepth%\roms\
													{
														filecreatedir,%mamepth%\roms
													}
												mambpri= %mamepth%\roms|
											}
										ACSVDEST= %cacheloc%
									}
							}
						if (OVDCHK = 1)
							{
								if (OVDLDS = "Matching")
									{
										OVDCHK= 0
										iniread,ksr,SystemLocations.ini,LOCATIONS,%keyout%
										if (ksr = "ERROR")
											{
												ksr=
											}
										if (ksr = "")
											{
												ACSVDEST= %RJSYSTEMS%\%keyout%
											}
											else {
												stringsplit,fir,ksr,|
												ACSVDEST= %fir1%
											}
										;;ACSVDEST= %RJSYSTEMS%\%keyout%
										;;ACSVDEST= %RJSYSTEMS%\%keyout%
										;;ACSVDEST= %RJSYSTEMS%\%keyout%
										;;ACSVDEST= %RJSYSTEMS%\%keyout%
									}
									else
										{
											if (OVDLDS = "Other")
												{
													ACSVDEST= %OVDFLDR%
												}
												else
													{
														iniread,ksr,SystemLocations.ini,LOCATIONS,%OVDLDS%
														if (ksr = "ERROR")
															{
																ksr=
															}
														if ((ksr = "")&&(OVDCHK <> 1))
															{
																ACSVDEST= %RJSYSTEMS%\%OVDLDS%
															}
															else {
																if (ksr <> "")
																	{
																		stringsplit,fir,ksr,|
																		ACSVDEST= %fir1%
																	}
															}
														;;ACSVDEST= %RJSYSTEMS%\%OVDLDS%
													}
										}
							}
						if (JACKETMODE = 1)
							{
								rjinsfldr= %romname%
								if (RNMJACK <> "")
									{
										rjinsfldr= %RNMJACK%
									}
								if (EXTRSYS = "Open - Beats of Rage")
									{
										rjinsfldr.= "\Paks"
									}
								IfNotExist,%ACSVDEST%\%rjinsfldr%
									{
										FileCreateDir,%ACSVDEST%\%rjinsfldr%
									}
								ACSVDEST= %ACSVDEST%\%rjinsfldr%
							}
				}
		if instr(savefile,"?")or instr(savefile,"\")or instr(savefile,"*")or instr(savefile,"|")or instr(savefile,":") or instr(savefile,"""")or (savefile = "")
			{
				savefile= %romfp%
			}
		splitpath,savefile,rojnm,rojnp,chkxt,romfname
		if (chkxt = "")
			{
				chkxt= zip
				savefile.= ".zip"
			}
		if (romfname = "")
			{
				romfname=%romjnm%
			}
		save= %ACSVDEST%\%savefile%
		splitpath,save,svaf,svap,svax,svaj
		gosub, RomSavePPND
		gosub, GetArcURL
		stringsplit,axrm,lnchparam,|,<>
		guicontrol,,JACKETMODE,%axrm2%
		guicontrol,,EXTRURL,%axrm3%
		guicontrol,,EXTEXPLD,%axrm4%
		guicontrol,,RUNXTRACT,%axrm5%
		guicontrol,,RNMJACK,
		guicontrol,,ARCMOVE,%axrm6%
		if (mlturl = 1)
			{
				kimx= 
				Loop,
					{
						kj= % URLFILE%kim%
						URLFILE= %kj%
						if (kj = "")
							{
								break
							}
						splitpath,kj,inm,inp,inx,ine
						if (ine <> inx)
							{
								save= %svaf%\%svaj%.%inx%
							}
							else {
								save= %svaf%\%inm%
								splitpath,save,svaf,svap,svax,svaj
							}
						gosub, RomDownload
						kimx+= 1
					}
				goto, EVEI
			}
		gosub, RomDownload
		EVEI:
		guicontrol,enable,ARCSYS
		guicontrol,enable,RNMJACK
		guicontrol,enable,ARCPOP
		guicontrol,enable,SRCHRSLT
		guicontrol,enable,ARCLNCH
		guicontrol,enable,ARCHOST
		guicontrol,enable,ARCCORES
	}
return

GetArcURL:
mlturl= 
if (arcpnum > 1)
	{
		SB_SetText("select a single item")
		return
	}
srchgmf= %SRCHMET%\%HACKAPN%%keyout%.gam	
if (opndgam = 1)
	{
		srchgmf= %addrplst%
	}
if (tmprm <> "")
	{
		if (MAMESWCHK = 1)
			{
				Loop, Parse, mamesplit,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,ji,A_LoopField,|
						if (keyout = ji2)
							{
								srchgmf= %SRCHMET%\%ji1%.gam
								Loop, read, %SRCHMET%\%ji1%.gam
									{
										Loop,10
											{
												ave%A_index%=
												URLFILE%A_index%=
											}
										stringsplit,ave,A_LoopReadLine,|
										if (ave2 = arcpopcul)
											{
												;;URLFILE= %ArcSite%/%sysurl%%ave1%
												URLFILE1= %URLFILE%
												abnum:= 1
												Loop,parse,ave4,>
													{
														abnum+=1
														URLFILE%abnum%= %A_LoopField%
													}
												ifinstring,ave4,://
													{
														;;URLFILE= %sysurl%%ave1%
														URLFILE2= %ave4%
														ifinstring,ave4,http
															{
																ariadltyp=http
															}
														ifinstring,ave4,ftp
															{
																ariadltyp=ftp
															}
														ifinstring,ave4,magnet
															{
																ariadltyp=magnet
															}
													}
												if (instr(ave3,"<") && instr(ave3,">"))
													{
														stringsplit,axrm,ave3,|:,<>
														iniread,lnchparam,launchparams.ini,LAUNCHPARAMS,%keyout%
														guicontrol,,DOWNONLY,1
														gosub, DownOnly
														guicontrol,,JACKETMODE,%axrm2%
														guicontrol,,EXTRURL,%axrm3%
														guicontrol,,EXTEXPLD,%axrm4%
														guicontrol,,RUNXTRACT,%axrm5%
														guicontrol,,RNMJACK,
														guicontrol,,ARCMOVE,%axrm6%
														;;special extraction instructions
													}
												ifinstring,ave1,://
													{
														URLFILE= %ave1%
													}
												if (ave2 = "")
													{
														splitpath,ave1,,,,sanfile
														gosub, SanUrl
														stringreplace,sanfile,sanfile,_,%A_space%,All
														ave2= %sanfile%
													}
												break
											}
									}
							}
						continue
					}
			}
		Loop, read, %srchgmf%
			{
				Loop,10
					{
						ave%A_Index%=
					}
				stringsplit,ave,A_LoopReadLine,|
				if (ave8 = "$")
					{
						if (ARC_USER = "")
							{
								SB_SetText(" This item requires a LOGIN/PASSWORD ")
								;;break
							}
					}
				;;URLFILE= %sysurl%%ave1%
				URLFILE1= %URLFILE%
				abnum:= 1
				Loop,parse,ave4,>
					{
						abnum+=1
						URLFILE%abnum%= %A_LoopField%
					}
				ifinstring,ave4,http
					{
						ariadltyp=http
					}
				ifinstring,ave4,ftp
					{
						ariadltyp=ftp
					}
				ifinstring,ave4,magnet:
					{
						ariadltyp=magnet
					}
				ifinstring,ave1,://
					{
						URLFILE= %ave1%
					}
				if (abnum > 1)
					{
						mlturl= 1
					}
				if (ave2 = "")
					{
						splitpath,ave1,,,,sanfile
						gosub, SanUrl
						stringreplace,sanfile,sanfile,_,%A_space%,All
						ave2= %sanfile%
					}
				if (ave2 = arcpopcul)
					{
						;;URLFILE= %ArcSite%/%sysurl%%ave1%
						ifinstring,ave4,://
							{
								;;URLFILE= %sysurl%%ave1%
								URLFILE1= %URLFILE%
								abnum:= 1
								Loop,parse,ave4,>
									{
										abnum+=1
										URLFILE%abnum%= %A_LoopField%
									}
								ifinstring,ave4,http
									{
										ariadltyp=http
									}
								ifinstring,ave4,ftp
									{
										ariadltyp=ftp
									}
								ifinstring,ave4,magnet:
									{
										ariadltyp=magnet
									}
							}
						if ((ave3 <> "")&&(ave3 <> A_Space))
							{
								if (instr(ave3,">")&& instr(ave3,"<"))
									{
										stringsplit,axrm,ave3,:|,<>
										iniread,lnchparam,launchparams.ini,LAUNCHPARAMS,%keyout%
										guicontrol,,DOWNONLY,1
										gosub,DownOnly
										guicontrol,,JACKETMODE,%axrm2%
										guicontrol,,EXTRURL,%axrm3%
										guicontrol,,EXTEXPLD,%axrm4%
										guicontrol,,RUNXTRACT,%axrm5%
										guicontrol,,RNMJACK,
										guicontrol,,ARCMOVE,%axrm6%
									}
									else {
											iniwrite,%ave3%,%ACSVDEST%\settings.ini,Run,cmd							
									}
							}
						ifinstring,ave1,://
							{
								URLFILE= %ave1%
							}
						break
					}
			}
	}
if (tmpsr <> "")
	{
		Loop, read, %srchgmf%
			{
				Loop,10
					{
						ave%A_Index%=
					}
				stringsplit,ave,A_LoopReadLine,|
				if (ave2 = tmpsrg)
					{
						;;URLFILE= %ArcSite%/%sysurl%%ave1%
						if ((ave3 <> "")&&(ave3 <> A_Space))
							{
								if (instr(ave3,">")&& instr(ave3,"<"))
									{
										stringsplit,avtst,ave3,:,<>
										iniread,lnchparam,launchparams.ini,LAUNCHPARAMS,%keyout%
										iniread,lnchparam,launchparams.ini,LAUNCHPARAMS,%keyout%
										iniread,lnchparam,launchparams.ini,LAUNCHPARAMS,%keyout%
										iniread,lnchparam,launchparams.ini,LAUNCHPARAMS,%keyout%
										iniread,lnchparam,launchparams.ini,LAUNCHPARAMS,%keyout%
										guicontrol,,DOWNONLY,1
										gosub,DownOnly
										guicontrol,,JACKETMODE,%axrm2%
										guicontrol,,EXTRURL,%axrm3%
										guicontrol,,EXTEXPLD,%axrm4%
										guicontrol,,RUNXTRACT,%axrm5%
										guicontrol,,RNMJACK,
										guicontrol,,ARCMOVE,%axrm6%
									}
									else {
										iniwrite,%ave3%,%ACSVDEST%\settings.ini,Run,cmd
									}
							}
						ifinstring,ave4,://
							{
								;;URLFILE= %sysurl%%ave1%
								URLFILE1= %URLFILE%
								abnum:= 1
								Loop,parse,ave4,>
									{
										abnum+=1
										URLFILE%abnum%= %A_LoopField%
									}
								ifinstring,ave4,http
									{
										ariadltyp=http
									}
								ifinstring,ave4,ftp 
									{
										ariadltyp=ftp
									}
								ifinstring,ave4,magnet
									{
										ariadltyp=magnet
									}
								if (abnum > 1)
									{
										mlturl= 1
									}
							}
						break
					}
			}
	}
SB_SetText(" " URLFILE " in clipboard ")
return

RomDownload:
rtryn:= 1
RETRYTHR= 10
DWNFLD=
if (REDOWN = 1)
	{
		ifexist,%save%
			{
				filemove,%save%,%cacheloc%\%romname%\%romtitle%.bak,1
			}
	}
if (STRMVID = 1)
	{
		goto, ROMSTREAM
	}	
ifnotexist, %save%
	{
		if (REDOWN = 0)
			{
				ifexist,%cacheloc%\%romname%\%romtitle%
					{
						filemove,%cacheloc%\%romname%\%romtitle%,%save%
						goto, RomDowned
					}
			}
		saveloc= %ACSVDEST%
		if (romelg = "$")
			{
				gosub, LoginWall
				goto, DWNLOADTST
			}
		klp=
		iniread,ksr,SystemLocations.ini,LOCATIONS,%keyout%
		fndpath= %ksr%\%rjinsfldr%%romname%
		if (ksr = "ERROR")
			{
				ksr=
			}
		if (ksr = "")
			{
				fndpath= %RJSYSTEMS%\%keyout%\%rjinsfldr%%romname%
				if (MAMESWCHK = 1)
					{
						iniread,carnsys,emuCfgPresets.ini,%romsys%,RJMAMENM
						if ((carnsys = "")or(crnsys = "ERROR"))
							{
								carnsys= %romsys%
							}
						fndpath= %RJSYSTEMS%\%MESSYS%\%carnsys%
					}
			}
		;;fndpath= %RJSYSTEMS%\%keyout%\%rjinsfldr%%romname%
		gosub, LkExtrExt
		if (romshere = "X")
			{
				if (REDOWN <> 1)
					{
						goto, romdowned
					}
			}
		RETRYTHR:
		Sleep, %RETRYTHR%
		magfile= 
		meganz= 
		splitpath,save,svaf,svap,svax
		stringleft,magchk,URLFILE,7
		if (magchk = "magnet:")
			{
				magfile= 1	
				URLFILE= "%URLFILE%"
			}
		ifinstring,URLFILE,mega.nz/#
			{
				meganz= 1
			}
		if (svax = "torrent")
			{
				sttm= %cacheloc%\%svaf%
				DownloadFile(URLFILE,sttm, True, True)
				ifnotexist,%sttm%
					{
						SB_SetText("torrent could not be downloaded")
						return
					}
				magfile= 1	
				URLFILE= -T"%sttm%"	
			}
		if (meganz = 1)	
			{
				stringreplace,MEGALINK,URLFILE,https://mega.nz/,,All
				concatcmd= "%S_KeyDir%\bin\megadl.exe" --path="%save%" "%MEGALINK%"
				meganzOut := StdoutToVar_CreateProcess(concatcmd)
				Loop,parse,meganzOut,`n`r
					{
						stringsplit,abz,A_LoopField,%A_Space%
					}
				sb_settext(" " abz3 "`% complete")
				goto, DWNLOADTST
			}
		if (magfile = 1)
			{
				torfail= 
				Loop,parse,ave6,:
					{
						stringsplit,kindx,A_LoopField,?
						TORINDEX.= kindx1 . "|"
						svaf.= kindx2 . "|"
					}
				if (ave6 = "")
					{
						TORINDEX= 1
						concatcmd= "%ARIA%" -S "%sttm%"
						svaprs := StdoutToVar_CreateProcess(concatcmd)
						loop,parse,svaprs,`n`r
							{
								ifinstring,A_LoopField,1|
									{
										Loop,parse,A_LoopField,/
											{
												svaf= %A_LoopField%
											}
									}
							}
					}
				iniread,TORRANGE,Settings.ini,GLOBAL,tcp_listen_port
				iniread,METRANGE,Settings.ini,GLOBAL,dht_listen_port
				met_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc,METRANGE,TORRANGE,TORINDEX)
				if (torfail = "")
					{
						;;FileMove,
					}
			}
			else {
				exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
			}
		;;DownloadFile(URLFILE,save, True, True)
		DWNLOADTST:
		filereadline,doct,%save%,1
		if (doct = "<html>")
			{
				DWNFLD= 1
			}
		if (doct = "<!DOCTYPE html>")
			{
				DWNFLD= 1
			}
		FileGetSize,dwnfszt,%save%
		if (dwnfszt < 15)
			{
				DWNFLD= 1
			}
		if (DWNFLD = 1)
			{
				if (RETRYTHR > 1499)
					{
						rtryn+= 1
						MsgBox,4421,Download Failed,"%savefile% could not be retrieved`n%URLFILE%`nto`n%save%",8
						ifmsgbox,Retry
							{
								batchdl=
								Filedelete, %save%
								urlnumberx= % URLFILE%rtryn%
								if (urlnumberx = "")
									{
										urlnumber= %URLFILE%
									}
								if (urlnumberx <> "")
									{
										URLFILE= %urlnumber%
										splitpath,urlfile,,,url2x
										if (url2x = "torrent")
											{
												svax= torrent
											}
									}
								goto, RomDownload
							}
						DWNFLD=
						norun= 1
						FileDelete, %save%
						guicontrol,enable,ARCSYS
						guicontrol,enable,ARCPOP
						guicontrol,enable,SRCHRSLT
						guicontrol,enable,ARCLNCH
						guicontrol,enable,ARCHOST
						guicontrol,hide,ARCNCT
						guicontrol,show,ARCHOST
						guicontrol,enable,ARCCORES
						romtch= 
						return
					}
				RETRYTHR+=500
				Filedelete, %save%
				SB_SetText(" Retrying " URLFILE " to " save " ")
				goto, RETRYTHR
			}
	}
romtch= 1
RomDowned:
if (chkxt = "chd")
	{
		ifnotinstring,coreselv,mame
			{
				gosub, ChdXtr
			}
	}
if ((chkxt = "rar") or (chkxt = "r01"))
	{
		gosub, RarXtr
	}
if ((chkxt = "7z") or (chkxt = "001"))
	{
		gosub, 7zXtr
	}
if (cmdfun = 1)
	{
		gosub, 7zXtr
	}
if (chkxt = "zip")
	{
		if (EXTRURL = 1)
			{
				Gosub, ZipXtr
			}
	}
if (chkxt = "tar")
	{
		if (EXTRURL = 1)
			{
				Gosub, ZipXtr
			}
	}
if (klp <> 1)
	{
		ifexist, %save%
			{
				romshere= 1
				goto, RunArc
			}
	}
RunArc:
if (romf = "")
	{
		romf= %save%
		lastrom= %save%
	}
lastcore= %coreselv%
guicontrol,,RUNFLRAD,1
guicontrol,,RUNSYSDDL,|%keyout%||%INITFLDRS%
guicontrol,,MORROM, |%romf%||
guicontrol,,LCORE, |%lastcore%||%runlist%
ifnotexist, %save%
	{
		if (ARCMOVE = 0)
			{
				msgbox,0,,"could not locate %save%",3
			}
	}
Guicontrol, ,ARCDPRGRS, 0
SB_SetText(" ")
ROMSTREAM:
if (cmdfun = 1)
	{
		If InStr(coreselv, "dosbox") or InStr(coreselv, "winbox")
			{
				Loop,%svap%\*.*
					{
						splitpath,A_LoopFileShortPath,snv,spn,,spo
						dospth= %spn%
						break
					}
				if (emucmdf <> "")
					{
						stringreplace,emucmdf,emucmdf,/,\,All
						SplitPath,emucmdf,exen,dospthv
						dospthx= %dospthv%
						if (dospthx = "")
							{
								splitpath,svaf,,,,svajn
								ifexist, %dospth%\%svajn%\
									{
										dospthx= %svajn%
									}
							}
					}
				if (dospth = "")
					{
						dospth= %spn%
						Loop,%dospth%\*.*,1,2
							{
								if ((A_LoopFileExt = "bat")or(A_LoopFileExt = "exe"))
									{
										splitpath,A_LoopFileShortPath,,dospthv
										stringreplace,dospthv,dospthv,%dospth%,,All
										if (dospthv <> "")
											{
												dospthx= %dospthv%
											}
										exen= %A_LoopFileShortName%
										break
									}
							}
					}
				FileCopy,sets\dosbox.set,%ACSVDEST%\dosbox.conf,1
				FileAppend,Mount C: "%dospth%"`nC:`ncd %dospthx%`n%exen%,%ACSVDEST%\dosbox.conf
				romf= %ACSVDEST%\dosbox.conf
			}
		if instr(coreselv, "scummvm")
			{
				FileAppend,%emucmdf%,%ACSVDEST%\%romname%.scummvm
				romf= %ACSVDEST%\%romname%.scummvm
			}
	}
if (HOSTING = 1)
	{
		return
	}
if (URLDWN = 1)
	{
		return
	}
if (APLA = 1)
	{
		if (norun = "")
			{
				if (aemcfg = 1)
					{
						aemcfg=
						refrae= 1
					}
				gosub, SKLNCH
			}
	}
if (APLA <> 1)
	{
		if (norun = "")
			{
				if (aemcfg = 1)
					{
						aemcfg=
						refrae= 1
					}
				gosub, SUBLNCH
			}
	}
guicontrol,enable,ARCSYS
guicontrol,enable,ARCPOP
guicontrol,enable,SRCHRSLT
guicontrol,enable,ARCLNCH
guicontrol,enable,ARCHOST
guicontrol,enable,ARCCORES
iniwrite, "%lastcore%",Settings.ini,GLOBAL,last_core
iniwrite, "%romf%",Settings.ini,GLOBAL,last_rom
return

ChdXtr:
if (EXTRURL = 0)
	{
		return
	}
xtrdir= %ACSVDEST%
ifnotexist, %xtrdir%
	{
		filecreatedir,%xtrdir%
	}
SB_SetText(" extracting and converting chd ")
RunWait, %comspec% cmd /c "bin\chdman.exe extractcd -i "%save%" -o "%xtrdir%\%romname%.cue" -ob "%xtrdir%\%romname%.bin" ",,hide
SB_SetText(" extraction and conversion complete ")
if (RUNXTRACT = 1)
	{
		romf= %xtrdir%\%romname%.cue
	}
return

RarXtr:
if (EXTRURL = 0)
	{
		return
	}
SB_SetText(" extracting " savefile " ")
xtrdir= %ACSVDEST%
xtrvar= x
if (EXTEXPLD = 1)
	{
		xtrvar= e
	}
runwait, %comspec% cmd /c "bin\UnRAR.exe %xtrvar% -y "%romf%" "*" +o "%xtrdir%" ",,hide
sleep 2000
FileMove, %save%, %ACSVDEST%\%romname%.bak
SB_SetText(" extraction complete to " xtrdir " ")
Loop, files, %ACSVDEST%\*.rar
	{
		Runwait, %comspec% cmd /c "bin\UnRAR.exe %xtrvar% -y "%A_LoopFileFullPath%" "*" +o "%xtrdir%" ",,hide
		FileMove, %A_LoopFileFullPath%,%A_LoopFileFullPath%.bak
		if (ArcMove = 1)
			{
				FileCreatedir,%cacheloc%\%keyout%\%romname%
				fileMove,%A_LoopFileFullPath%.bak,%cacheloc%\%keyout%\%romname%,1
			}
	}
Loop, Files, %xtrdir%\*.*,R
	{
		gosub, GetXtr
	}
FileMove,%ACSVDEST%\%romname%.bak, %ACSVDEST%\%romname%.rar, 1
if (ArcMove = 1)
	{
		FileCreatedir,%cacheloc%\%keyout%\%romname%
		fileMove, %ACSVDEST%\%romname%.rar,%cacheloc%\%keyout%\%romname%,1
	}
return

7zXtr:
if (EXTRURL = 0)
	{
		return
	}
SB_SetText(" extracting " savefile " ")
xtrdir= %ACSVDEST%
xtrvar= x
if (EXTEXPLD = 1)
	{
		xtrvar= e
	}
runwait, %comspec% cmd /c " "%S_KeyDir%\bin\7za.exe" %xtrvar% -y "%save%" -O"%xtrdir%" ", ,hide
SB_SetText(" extraction complete to " xtrdir " ")
gosub, ArcExtract
return

ZipXtr:
if (EXTRURL = 0)
	{
		return
	}
SB_SetText(" extracting " savefile " ")
xtrdir= %ACSVDEST%
xtrvar= x
if (EXTEXPLD = 1)
	{
		xtrvar= e
	}
srvn= 
runwait, %comspec% cmd /c " "%S_KeyDir%\bin\7za.exe" %xtrvar% -y "%save%" -O"%xtrdir%" ", ,hide
srvn= %ERRORLEVEL%
SB_SetText(" extraction complete to " xtrdir " ")
if (RUNXTRACT = 1)
	{
		goto, ArcExtract
	}
goto, ArcMtst	
return

ArcExtract:
fndpath= %xtrdir%
gosub, LkExtrExt
if (klp = "")
	{
		Loop, %xtrdir%\*.*
			{
				if (A_LoopFileSize > 10)
					{
						romf= %A_LoopFileFullPath%
						break
					}
			}
	}
ArcMtst:
if (ArcMove = 1)
	{
		FileCreateDir,%cacheloc%\%keyout%\%romname%
		if ((save <> romf)or(srvn = 0))
			{
				FileMove,%save%,%cacheloc%\%keyout%\%romname%,1
			}
	}
return

LkExtrExt:
klp=
iniread,lookf,emuCfgPresets.ini,%keyout%,RJROMXT
if (lookf = "ERROR")
	{
		klp= 1
		return
	}
lkrec=
if (EXTEXPLD = 1)
	{
		lkrec= R
	}
Loop, Parse, lookf,`,
	{
		matchdxt= %A_LoopField%
		if (A_LoopField = "")
			{
				continue
			}
		if (RUNXTRACT = 1)
			{
				Loop, files,%fndpath%\*.*,%lkrec%
					{
						ext= .%A_LoopFileExt%
						if ((ext = matchdxt)&&(ext <> ".zip")&&(ext <> ".rar")&&(ext <> ".chd")&&(ext <> ".7z"))
							{
								romf= %A_LoopFileFullPath%
								ifnotexist,%save%
									{
										save= %romf%
									}
								romshere= X
								klp= 1
								break
							}
					}
				if (klp = 1)
					{
						break
					}
			}
	}
return

GetXtr:
stringsplit,coreslc,coreslv,.
if (coreslc2 = "dll")
	{
		loop, read, %libretroInfoPath%\%coreslc1%.info
			{
				stringsplit, sext, A_loopreadline,_ | =, ""
				if (sext1 = "supported")
					{
						lookf= %sext3%|%sext4%|%sext5%|%sext6%|%sext7%|%sext8%|%sext9%|%sext10%|%sext11%|%sext12%|%sext13%|%sext14%|%sext15%|%sext16%|%sext17%|%sext18%
					}
			}
		stringsplit,lookfor,lookf,= | ""
		adk := Object()
		Loop, %lookfor0%
		{
			new= % (lookfor%a_index%)
			if (lookfor%a_index% <> "")
				{
					adk.insert(new)
				}
		}
		extrpth= %ACSVDEST%
		loop,files,%extrpth%\*.*,R
			{
				ext= %A_LoopFileExt%
				for k, v in adk
					{
						extm:= v
						if (ext = extm)
							{
								romshere= X
								romf= A_LoopFileFullPath
								EXT7Z=
								EXTRAR=
							}
					}
			}
			return
	}
LkXtrRom:
iniread,lookf,emuCfgPresets.ini,%keyout%,RJROMXT
if (lookf = "ERROR")
	{
		return
	}
extrpth= %ACSVDEST%
Loop, Parse, lookf,`,
	{
		matchdxt= %A_LoopField%
		if (A_LoopField = "")
			{
				continue
			}
		Loop, files,%extrpth%\*.*,R
			{
				ext= .%A_LoopFileExt%
				if (ext = matchdxt)
					{
						romshere= X
						romf= %A_LoopFileFullPath%
						EXT7Z=
						EXTRAR=
						break
					}
			}
	}
return

CustmOpt:
gui, submit, nohide
CUSTMOPT=
if (CUSTSWITCH = 1)
	{
		guicontrolget,CUSTMOPT,,CUSTMOPT
		guicontrol,,CUSTMOPTS,|%CUSTMOPT%||%INJOPT%
		return
	}
return

CustmArg:
gui, submit, nohide
CUSTMARG=
if (CUSTSWITCH = 1)
	{
		guicontrolget,CUSTMARG,,CUSTMARG
		guicontrol,,CUSTMARGS,|%CUSTMARG%||%INJOPT%
		return
	}
return

CustSwitch:
iscor=
iscorext=
guicontrolget,iscor,,ARCCORES
splitpath,iscor,,,iscorext
if (iscorext = "dll")
	{
		guicontrol,,CUSTSWITCH,0
	}
gui, submit, nohide
guicontrolget,CUSTSWITCH,,CUSTSWITCH
if (CUSTSWITCH = 0)
	{
		guicontrol, hide, CUSTMOPT
		guicontrol, show, DOWNONLY
		guicontrol, hide, CUSTMARG
		guicontrol, hide, CUSTMOPTS
		guicontrol, hide, CUSTMARGS
		guicontrol,,CUSTSWITCHS,0
		guicontrol,,DOWNONLY,0
		guicontrol, move, RUNROMCBX, x39 y24 w604
		guicontrol, move, MORROM, x39 y24 w377
		CUSTMARG=
		CUSTMOPT=
		return
	}
guicontrol, show, CUSTMOPT
guicontrol, show, CUSTMARG
guicontrol, hide, DOWNONLY
guicontrol, show, CUSTMOPTS
guicontrol, show, CUSTMARGS
guicontrol,,CUSTSWITCHS,1
guicontrol,,DOWNONLY,0
guicontrol, move, RUNROMCBX, x39 y24 w377
guicontrol, move, MORROM, x39 y24 w377
return

ArcLogin:
gui, submit,nohide
guicontrolget,ARC_USER,,ARCLOGIN
IniWrite, %ARC_USER%,Settings.ini,GLOBAL,archive_login
return

ArcPass:
gui, submit,nohide
if (SAVPASS = 0)
	{
		IniWrite,%A_Space%,Settings.ini,GLOBAL,archive_password
		return
	}
guicontrolget,ARC_PASS,,ARCPASS
IniWrite,%ARC_PASS%,Settings.ini,GLOBAL,archive_password
return

SavPass:
gui,submit,nohide
guicontrolget,SAVPASS,,SAVPASS
if (SAVPASS = 0)
	{
		IniWrite,%A_Space%,Settings.ini,GLOBAL,archive_password
		return
	}
guicontrolget,ARC_PASS,,ARCPASS
IniWrite,%ARC_PASS%,Settings.ini,GLOBAL,archive_password
return

LoginWall:
if (ARC_USER = "")
	{
		SB_SetText(" You must enter a valid email login for archive.org to use this repository ")
		return
	}
if (ARC_USER = "Login Not Set")
	{
		SB_SetText(" You must enter a valid email login for archive.org to use this repository ")
		return
	}
if (ARC_PASS = "")
	{
		SB_SetText(" You must enter a valid password for archive.org to use this repository ")
		return
	}
splitpath,save,,savetmp
filetmp= %savetmp%\tmp.tmp
filedelete, %savetmp%\tmp.tmp
filedelete, %savetmp%\old.del
bgn:= 0
dnd:= 5000000
username_str= %ARC_USER%
password_str= %ARC_PASS%
file_save_location:= save
Overwrite:=True
get_site:= URLFILE
SB_SetText(" Downloading " romname " to " save " ")
post_site:="https://archive.org/account/login.php"
post_data:="username=" username_str "&password=" password_str "&remember=CHECKED&referer=https://archive.org&action=login&submit=Log in"
Loop,
	{
		arcfinz=
		WebRequest := ComObjCreate("WinHttp.WinHttpRequest.5.1")
		WebRequest.Open("POST", post_site)
		WebRequest.SetRequestHeader("Content-Type", "application/x-www-form-urlencoded")
		WebRequest.SetRequestHeader("Cookie", "test-cookie=1")
		WebRequest.Send(post_data)
		WebRequest.Open("HEAD",get_site)
		WebRequest.Send()
		arcfz= % WebRequest.GetResponseHeader("Content-Length")
		WebRequest.Open("GET",get_site)
		WebRequest.SetRequestHeader("Range", "bytes=" bgn "-" dnd "")
		WebRequest.Send()
		WebRequest.WaitForResponse(5)
		ADODBObj := ComObjCreate( "ADODB.Stream" )
		ADODBObj.Type := 1
		ADODBObj.Open()
		ADODBObj.Position := 0
		ADODBObj.Write( WebRequest.ResponseBody )
		ADODBObj.SaveToFile(filetmp, Overwrite ? 2:1)
		ADODBObj.Close()
		ADODBObj:=""
		WebRequest:=""
		if FileExist(savetmp "\tmp.tmp")
				{
					if (dnd <> arcfz)
						{
							filegetsize,fmtmp,%savetmp%\tmp.tmp
							if ((fmtmp < 20000)&&(finv > 20000))
								{
									msgbox,1,too small,filesize is %fmtmp%
									goto, logindwnfail
								}
							bgn+=5000001
							dnd+=5000000
							if (dnd > arcfz)
								{
									arcfinz= 1
									dnd:= arcfz
								}
							finv:= dnd - bgn
						}
					if FileExist(savetmp "\old.del")
						{
							RunWait,%comspec% cmd /c copy /b "%savetmp%\old.del"+"%filetmp%" "%save%",,hide
							filedelete, "%filetmp%"
							filedelete, "%savetmp%\old.del"
							if (arcfinz = 2)
								{
									break
								}
							filemove,%save%,%savetmp%\old.del,1
							filegetsize,oldtmp,%savetmp%\old.del
							mvmult:= dnd / arcfz
							stringsplit,percn,mvmult,.
							stringLeft,percentDone,percn2,2
							Guicontrol, ,utlPRGA, %PercentDone%
							Guicontrol, ,ARCDPRGRS, %PercentDone%
							Guicontrol, ,DWNPRGRS, %PercentDone%
							Guicontrol, ,FEPRGA, %PercentDone%
							SB_SetText(" " PercentDone "`% completed. " dnd " bytes downloaded ")
						}
						else
							{
								filemove, %filetmp%,%savetmp%\old.del,1
							}
				}
				else{
						SB_SetText("File Not Downloaded")
						MsgBox,1,Not Found,%save%`nnot found
						goto, logindwnfail
					}
		filegetsize,oldtmp,%savetmp%\old.del
		if (fmtmp < 20000)
			{
				if (arcfz <= oldtmp)
					{
						filemove,%savetmp%\old.del,%save%,1
						break
					}
				SB_SetText("File Not Downloaded")
				goto, logindwnfail
			}
		mvmult:= dnd / arcfz
		stringsplit,percn,mvmult,.
		stringLeft,percentDone,percn2,2
		Guicontrol, ,utlPRGA, %PercentDone%
		Guicontrol, ,ARCDPRGRS, %PercentDone%
		Guicontrol, ,DWNPRGRS, %PercentDone%
		Guicontrol, ,FEPRGA, %PercentDone%
		SB_SetText(" " PercentDone "`% completed. " dnd " bytes downloaded ")
		if ((PercentDone >= 100) or (arcfinz = 1))
			{
				break
			}
		if (arcfinz <> "")
			{
				arcfinz+=1
			}
	}
SB_SetText(" Download Complete ")
filegetsize,oldtmp,%savetmp%\old.del
if (arcfz <= oldtmp)
	{
		filemove,%savetmp%\old.del,%save%,1
	}
Guicontrol, ,utlPRGA, 0
Guicontrol, ,ARCDPRGRS, 0
Guicontrol, ,DWNPRGRS, 0
Guicontrol, ,FEPRGA, 0
return

logindwnfail:
Msgbox,1,Error,File Not Found
Guicontrol, ,utlPRGA, 0
Guicontrol, ,ARCDPRGRS, 0
Guicontrol, ,DWNPRGRS, 0
Guicontrol, ,FEPRGA, 0
return

createcscr:
filedelete,tmp.vbs
stringreplace,vbs_out,vbs_tmp,post_site,"%post_site%",All
stringreplace,vbs_out,vbs_out,post_data,"%post_data%",All
stringreplace,vbs_out,vbs_out,save_data,"%save%",All
stringreplace,vbs_out,vbs_out,username_str,"%username_str%",All
stringreplace,vbs_out,vbs_out,password_str,"%password_str%",All
RunWait, %comspec% cmd /c "cscript tmp.vbs",,hide
filedelete, tmp.vbs
SB_SetText(" Download Complete ")
return

ARCGBOX:
gui,submit,nohide
guicontrol,,feDDLJ,|Media||Mirrored_Links|EmulationStation|Pegasus
gosub, feDDLJ
if (GFERYP = 1)
	{
		guicontrol,,FERAD2C,1
	}
	else {
		guicontrol,show,FERAD2B
		guicontrol,,FERAD2B,1
	}
gosub, ferad2c
fromcfg= 1
GuiControl,Choose,TABMENU,6
guicontrol,,feDDLA,|%SYSLKUP%||Systems|%systmfldrs%
FEDDLA= %SYSLKUP%
gui,ListView,FELVA
arcgsa= +Check
LV_Delete()
krv= 
Loop, Parse, bltoadd,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		krv= %A_LoopField%	
		LV_Add(arcgsa,krv)
	}
LV_ModifyCol()
guicontrol,,FECHKA,0
guicontrol,,FECHKB,1
guicontrol,,FECHKC,0
guicontrol,,FECHKD,0
guicontrol,,FECHKE,0
guicontrol,,FECHKG,0
guicontrol,,FECHKH,0
guicontrol,,FECHKI,0
guicontrol,,FECHKJ,0
guicontrol,,FECHKK,0
guicontrol,,FECHKL,0
guicontrol,,FECHKM,0
getboxart= 1
getbackdrop=
getsnapshot=
getvideo=
getmetadata=
getlogo=
goto, ARCARTDWN
return

ARCARTDWN:
if (ROMTRUN = "")
	{
		SB_SetText("You must select a ROM to download assets")
		return
	}
if (ARCRCLK = "")
	{
		stringsplit,romsplit,ROMTRUN,=
		FEDDLA= %romsplit1%
		ROMTRUN= %romsplit2%
	}
jaktit= %ROMTRUN%
SYSLKUP= %FEDDLA%
if (SYSLKUP = "Capcom Play System - CPS")
	{
		SYSLKUP= MAME - Arcade
	}
if (SYSLKUP = "MAME - Arcade")
	{
		SYSLKUP= MAME - Arcade
	}
if (SYSLKUP = "MAME")
	{
		SYSLKUP= MAME - Arcade
	}
if (SYSLKUP = "Capcom Play System - CPS II")
	{
		SYSLKUP= MAME - Arcade
	}
if (SYSLKUP = "SNK - Neo Geo MVS")
	{
		SYSLKUP= MAME - Arcade
	}
if (SYSLKUP = "Sega - NAOMI")
	{
		SYSLKUP= MAME - Arcade
	}
if (SYSLKUP = "Sega - Hikaru")
	{
		SYSLKUP= MAME - Arcade
	}
if (SYSLKUP = "Sega - Model 2")
	{
		SYSLKUP= MAME - Arcade
	}
if (SYSLKUP = "Galeco - Galeco")
	{
		SYSLKUP= MAME - Arcade
	}
if (SYSLKUP = "Sega - Model 3")
	{
		SYSLKUP= MAME - Arcade
	}
if (SYSLKUP = "Cave Systems - Cave")
	{
		SYSLKUP= MAME - Arcade
	}
stringReplace,nsjak,jaktit,%A_Space%,,All
stringReplace,nsjak,nsjak,',,All
stringReplace,nsjak,nsjak,.,,All
stringReplace,nsjak,nsjak,`,,,All
stringReplace,nsjak,nsjak,-,,All
alanum:= 0
DWNFLD=
REALSYS= %ARCSYS%
SYSLKUP= %ARCSYS%
if (mediaorder = "")
	{
		TMEDO=
		mediaorder= %mediordert%
		curmedord= %mediorder%
		Loop, Parse, metaimages,|
			{
				GRANDORDER= %A_LoopField%
				Gosub, MEDFEGLRMV
				INARCL=
			}
	}
INARCL= 1
ifExist, rj\scrapeArt\%SYSLKUP%\
	{
		ifinstring,jaktit,|
			{
				Loop, parse, bltoh,|
					{
						jaktit= %A_LoopField%
						stringReplace,nsjak,jaktit,%A_Space%,,All
						stringReplace,nsjak,nsjak,',,All
						stringReplace,nsjak,nsjak,.,,All
						stringReplace,nsjak,nsjak,`,,,All
						stringReplace,nsjak,nsjak,-,,All
						gosub, JAKTITLOOP
					}
			}
		JAKTITLOOP:
		ifexist,rj\scrapeArt\%SYSLKUP%\%jaktit%.xml
			{
				realname= %jaktit%
				xmlf= %jaktit%.xml
				gosub, DBSCRAPE
			}
		if (DWNFLD = 1)
			{
				SB_SetText("Some items could not be retrieved.")
			}
		DWNFLD=
		getboxart=
		getbackdrop=
		getsnapshot=
		getvideo=
		getmetadata=
		getlogo=
	}
return

ASEMUOVR:
gui,submit,nohide
guicontrolget,RUNRTST,,MORROM
guicontrolget,RUNSYSTST,,RUNSYSDDL
guicontrolget,LCORE,,LCORE
splitpath,RUNRTST,,,,ROMTOVR
iniread,thebb,Assignments.ini,OVERRIDES,%RUNSYSTST%
apt= 
Loop,parse,thebb,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		apt+=1
		if ((apt = 1)&&(A_LoopField = LCORE))
			{
				SB_SetText(" " LCORE " already assigned to " RUNSYSTST "")
				return
			}
		break
	}
iniread,emuovt,AppParams.ini,%LCORE%,per_game_configurations
if ((emuovt = 0)or(emuovt = "ERROR")or(emuvt = ""))
	{
		SB_SetText("" LCORE " does not currently have per-game settings enabled.")
		return
	}	
Menu, MASOCREA, Add,Create Emulator Override, ASOCREA
Menu, MASOCREA, Add,Delete Emulator Override, ASOCDEL

MENU_X:= A_GuiX*(A_ScreenDPI/96)
MENU_Y:= A_GuiY*(A_ScreenDPI/96)
Menu,MASOCREA, Show, %MENU_X% %MENU_Y%
Menu,MASOCREA,DeleteAll
return

ASOCREA:
splitpath,RUNRTST,,,,ROMTOVR
iniwrite,%LCORE%,GameOverrides.ini,%RUNSYSTST%,%ROMTOVR%
SB_SetText(" " LCORE " set as override for " ROMTOVR "")
return

ASOCDEL:
guicontrolget,RUNRTST,,MORROM
guicontrolget,RUNSYSTST,,RUNSYSDDL
inidelete,GameOverrides.ini,%RUNSYSTST%,%ROMTOVR%
SB_SetText(" " LCORE " override for " ROMTOVR " deleted")
return

ARCGSNP:
gui,submit,nohide
ifinstring,SYSLKUP,:=:
	{
		return
	}
ifinstring,SYSLKUP,.lpl
	{
		splitpath,SYSLKUP,,,,SYSLKUPN
		Loop,Parse,allsupsys,|
			{
				if (A_LoopField = SYSLKUPN)
					{
						SYSLKUP= %A_LoopField%
						goto, ContAddAssets
					}
			}
		return
	}
ContAddAssets:
gosub, AddAssetType
MENU_X:= A_GuiX*(A_ScreenDPI/96)
MENU_Y:= A_GuiY*(A_ScreenDPI/96)
Menu,ARCGSNP, Show, %MENU_X% %MENU_Y%
Menu,ARCGSNP,DeleteAll
return

AddAssetType:
Menu, ARCGSNP, Add, Download All, ARCGALL
Menu, ARCGSNP, Add
Menu, ARCGSNP, Add, Download BoxArt, ARCGBOX
Menu, ARCGSNP, Add
Menu, ARCGSNP, Add, Download Fan-Art, ARCGFAN
Menu, ARCGSNP, Add
Menu, ARCGSNP, Add, Download Logo, ARCGLOG
Menu, ARCGSNP, Add
Menu, ARCGSNP, Add, Download Video, ARCGVID
bltoadd= 
Loop, Parse, bltoh,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringreplace,din,A_LoopField,%RJSYSTEMS%\%SYSLKUP%\,,All
		stringsplit,rivn,din,%pldelim%
		stringleft,rivntst,rivn2,1
		bltox= %rivn1%
		if (rivntst = "\")
			{
				bltox= %rivn1%:%rivn2%
			}
		splitpath,bltox,blton
		splitpath,blton,,,,bltoa
		if (GFERYP = 1)
			{
				bltoa= %blton%
			}
		bltoadd.= bltoa . "|"
	}
return

ARCGALL:
guicontrol,,feDDLJ,|Media||Mirrored_Links|EmulationStation|Pegasus
gosub, feDDLJ
if (GFERYP = 1)
	{
		guicontrol,,FERAD2C,1
		gosub, ferad2c
	}
	else {
		guicontrol,show,FERAD2B
		guicontrol,,FERAD2B,1
		gosub, ferad2c
	}
fromcfg= 1
GuiControl,Choose,TABMENU,6
guicontrol,,feDDLA,|%SYSLKUP%||Systems|%systmfldrs%
FEDDLA= %SYSLKUP%
gui,ListView,FELVA
arcgsa= +Check
LV_Delete()
krv= 
Loop, Parse, bltoadd,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		krv= %A_LoopField%	
		LV_Add(arcgsa,krv)
	}
LV_ModifyCol()
guicontrol,,FECHKA,1
guicontrol,,FECHKB,1
guicontrol,,FECHKC,1
guicontrol,,FECHKD,1
guicontrol,,FECHKE,1
guicontrol,,FECHKG,1
guicontrol,,FECHKH,1
guicontrol,,FECHKI,1
guicontrol,,FECHKJ,1
guicontrol,,FECHKK,1
guicontrol,,FECHKL,1
guicontrol,,FECHKM,1
SB_SetText("Use the checkboxes to add items to your scrape.")
ifnotinstring,scrsup,/%FEDDLA%/
	{
		SB_SetText("Scraping MetaData Not Available for that system.  Select one from the dropdown.")
		;;Control, ShowDropDown, , %FEDDLA%, skeletonKey
		;;ControlFocus, %FEDDLA%,skeletonKey
	}
return

ARCGFAN:
gui,submit,nohide
guicontrol,,feDDLJ,|Media||Mirrored_Links|EmulationStation|Pegasus
gosub, feDDLJ
if (GFERYP = 1)
	{
		guicontrol,,FERAD2C,1
		gosub, ferad2c
	}
	else {
		guicontrol,show,FERAD2B
		guicontrol,,FERAD2B,1
		gosub, ferad2c
	}
fromcfg= 1
GuiControl,Choose,TABMENU,6
guicontrol,,feDDLA,|%SYSLKUP%||Systems|%systmfldrs%
FEDDLA= %SYSLKUP%
gui,ListView,FELVA
arcgsa= +Check
LV_Delete()
krv= 
Loop, Parse, bltoadd,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		krv= %A_LoopField%	
		LV_Add(arcgsa,krv)
	}
LV_ModifyCol()
guicontrol,,FECHKA,1
guicontrol,,FECHKB,0
guicontrol,,FECHKC,0
guicontrol,,FECHKD,0
guicontrol,,FECHKE,0
guicontrol,,FECHKG,0
guicontrol,,FECHKH,0
guicontrol,,FECHKI,0
guicontrol,,FECHKJ,0
guicontrol,,FECHKK,0
guicontrol,,FECHKL,0
guicontrol,,FECHKM,0
getboxart=
getbackdrop= 1
getsnapshot=
getvideo=
getmetadata=
getlogo=
goto, ARCARTDWN
return

ARCGLOG:
gui,submit,nohide
guicontrol,,feDDLJ,|Media||Mirrored_Links|EmulationStation|Pegasus
gosub, feDDLJ
if (GFERYP = 1)
	{
		guicontrol,,FERAD2C,1
		gosub, ferad2c
	}
	else {
		guicontrol,show,FERAD2B
		guicontrol,,FERAD2B,1
		gosub, ferad2c
	}
fromcfg= 1
GuiControl,Choose,TABMENU,6
guicontrol,,feDDLA,|%SYSLKUP%||Systems|%systmfldrs%
FEDDLA= %SYSLKUP%
gui,ListView,FELVA
arcgsa= +Check
LV_Delete()
krv= 
Loop, Parse, bltoadd,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		krv= %A_LoopField%	
		LV_Add(arcgsa,krv)
	}
LV_ModifyCol()
guicontrol,,FECHKA,0
guicontrol,,FECHKB,0
guicontrol,,FECHKC,1
guicontrol,,FECHKD,0
guicontrol,,FECHKE,0
guicontrol,,FECHKG,0
guicontrol,,FECHKH,0
guicontrol,,FECHKI,0
guicontrol,,FECHKJ,0
guicontrol,,FECHKK,0♣
guicontrol,,FECHKL,0
guicontrol,,FECHKM,0
getboxart=
getbackdrop=
getsnapshot=
getvideo=
getmetadata=
getlogo= 1
goto, ARCARTDWN
return

ARCGVID:
gui,submit,nohide
guicontrol,,feDDLJ,|Media||Mirrored_Links|EmulationStation|Pegasus
gosub, feDDLJ
if (GFERYP = 1)
	{
		guicontrol,,FERAD2C,1
		gosub, ferad2c
	}
	else {
		guicontrol,show,FERAD2B
		guicontrol,,FERAD2B,1
		gosub, ferad2c
	}
fromcfg= 1
GuiControl,Choose,TABMENU,6
guicontrol,,feDDLA,|%SYSLKUP%||Systems|%systmfldrs%
FEDDLA= %SYSLKUP%
gui,ListView,FELVA
arcgsa= +Check
LV_Delete()
krv= 
Loop, Parse, bltoadd,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		krv= %A_LoopField%	
		LV_Add(arcgsa,krv)
	}
LV_ModifyCol()
guicontrol,,FECHKA,0
guicontrol,,FECHKB,0
guicontrol,,FECHKC,0
guicontrol,,FECHKD,1
guicontrol,,FECHKE,0
guicontrol,,FECHKG,0
guicontrol,,FECHKH,0
guicontrol,,FECHKI,0
guicontrol,,FECHKJ,0
guicontrol,,FECHKK,0
guicontrol,,FECHKL,0
guicontrol,,FECHKM,0
getboxart=
getbackdrop=
getsnapshot=
getvideo= 1
getmetadata=
getlogo=
goto, ARCARTDWN
return

NOTOG:
;;;;;;;;;
return

RELOADCFG:
gui,submit,nohide
guicontrolget,LCORE,,LCORE
return
;;;; RESET OVERRIDE TOGGLE ;;;
EMUCFGOVRTGL= 1
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
EMUCFGCOPY:
EMUDFL=
guicontrolget,MORROM,,MORROM
splitpath,MORROM,EDTRMF,EDTRMP,EDTRMX,EDTRMFN
if (SK_MODE = "")
	{
		;filedelete,%indvcp%\mednafen.cf*
		RVLKUP= %RJSYSDD%
		indvcp= rj\sysCfgs\%curjf%
		if (EXEMODE = 1)
			{
				indvcp= %S_KeyDir%\executable\emu\%curjf%
			}
	}
if (SK_MODE = 2)
		{
			indvcp= rj\sysCfgs\%curjf%
			RVLKUP= %curjf%
		}
if (SK_MODE = 1)
	{
		guicontrolget,nicktst,,LCORE
		guicontrolget,EXTRSYS,,RUNSYSDDL
		ifinstring,nicktst,.dll
			{
				EXTRSYS=
				SB_SetText("Select a System")
				return
			}
		ifinstring,EXTRSYS,:=:
			{
				EXTRSYS=
				SB_SetText("Select a System")
				return
			}
		if (RUNPLRAD = 1)
			{
				stringtrimright,EXTRSYST,EXTRSYS,4
				if (EXTRSYST = "His")
					{
						splitpath,EDTRMP,EXTRSYS
						ifinstring,EDTRMFN,%EXTRSYS%
							{
								splitpath,EDTRMP,,EDTRMZ
								splitpath,EDTRMZ,EXTRSYS
							}
						if (aemcfg = 1)
							{
								EXTRSYS= %EXTRSYS%
							}
					}
			}
		if (EXTRSYS <> "")
			{
				RVLKUP= %EXTRSYS%
			}
		indvcp= %S_KeyDir%\cfg\%EXTRSYS%\%nicktst%\%EDTRMFN%
		RVLKUP= %EXTRSYS%	
		iniread,indvcpx,Apps.ini,EMULATORS,%nicktst%
		if ((indvcpx <> "ERROR")or(indvcpx = ""))
			{
				splitpath,indvcpx,,indvcp
				nickpath= %indvcp%
			}
		if (mednafxf = 1)
			{
				emucfgloc= cfg\%EXTRSYS%\%nicktst%\%EDTRMFN%\%medcfg%
				indvcp= %S_KeyDir%\cfg\%EXTRSYS%\%nicktst%\%EDTRMFN%
			}
	}
gosub, SHRTNMLkUp
%SHRTNM%CFGF=
%SHRTNM%CFGR=
%SHRTNM%NFP=
IfNotExist, %indvcp%\
	{
		FileCreateDir,%indvcp%
	}
meminj= 
maninj= 
snapinj=
cheatinj=
stateinj=
if (SK_MODE = 2)
		{			
			meminj= .Mem
			maninj= .Man
			snapinj= .snaps
			cheatinj= .cheats
			stateinj= .sstates
			IfNotExist, %indvcp%\.Mem\
				{
					FileCreateDir,%indvcp%\.Mem
				}
			IfNotExist, %indvcp%\.sstates\
				{
					FileCreateDir,%indvcp%\.sstates
				}
			IfNotExist, %indvcp%\.snaps\
				{
					FileCreateDir,%indvcp%\.snaps
				}
			ifinstring,supguiitems,%emuname%
				{
					if (CFG2PROP = "ERROR")
						{
								goto, CFGITER
							}
						ifnotexist,%indvcp%\%CFG2PROP%
							{
								goto, CFGITER
							}
						Loop, Parse, CFG2PROP,|
							{
								%SHRTNM%CFGR.= A_LoopField . "|"
						}
					return
				}
		}
if (EMUSN = "")
	{
		;FileCopy, rj\emuCfgs\*.set, %indvcp%
		guicontrol,enable,MORROM
		return
	}
CFGITER:
Loop, rj\emuCfgs\%EMUSN%\*.*
	{
		appndum=
		CFGFPATH= %A_LoopFileFullPath%
		SplitPath,CFGFPATH,cfgtc,cfgpth,cfgext,thecfg
		if (cfgext = "get")
			{
				continue
			}
		if (cfgext = "dfl")
			{
				EMUDFL= 1
				continue
			}
		if (cfgext = "ret")
			{
				snmr=
				SplitPath,cfgtc,,,,snmr
				%SHRTNM%CFGR.= snmr . "|"
				ifnotexist, %indvcp%\%thecfg%
					{
						FileRead,cfgp,%CFGFPATH%
						stringreplace,cfgp,cfgp,[ROMPATH],%indvcp%,All
						stringreplace,cfgp,cfgp,[MEM],%meminj%,All
						stringreplace,cfgp,cfgp,[MAN],%maninj%,All
						stringreplace,cfgp,cfgp,[SNAPS],%snapinj%,All
						stringreplace,cfgp,cfgp,[SSTATES],%statinj%,All
						stringreplace,cfgp,cfgp,[CHEATS],%cheatinj%,All
						stringreplace,cfgp,cfgp,[EMUPATH],%nickpath%,All
						FileAppend,%cfgp%,%indvcp%\%thecfg%
						appndum= 1
						continue
					}
			}
		if (cfgext = "set")
			{
				snmf=
				SplitPath,cfgtc,,,,snmf
				%SHRTNM%CFGR.= snmf . "|"
				ifnotexist, %indvcp%\%thecfg%
					{
						FileRead,cfgp,%CFGFPATH%
						stringreplace,cfgp,cfgp,[ROMPATH],%indvcp%,All
						stringreplace,cfgp,cfgp,[MEM],%meminj%,All
						stringreplace,cfgp,cfgp,[MAN],%maninj%,All
						stringreplace,cfgp,cfgp,[SNAPS],%snapinj%,All
						stringreplace,cfgp,cfgp,[SSTATES],%statinj%,All
						stringreplace,cfgp,cfgp,[CHEATS],%cheatinj%,All
						stringreplace,cfgp,cfgp,[EMUPATH],%nickpath%,All
						FileAppend,%cfgp%,%indvcp%\%thecfg%
						appndum= 1
						continue
					}
			}
		if (appndum = "")
			{
				%SHRTNM%CFGF.= CFGFPATH . "|"
			}
		FileCopy,%CFGFPATH%,%indvcp%\%cfgtc%
		FileCreateDir,%indvcp%\.Man
		FileCreateDir,%indvcp%\.Mem
		FileCreateDir,%indvcp%\.sstates
		FileCreateDir,%indvcp%\.snaps
		ifexist, %indvcp%\%cfgtc%
			{
				continue
			}
	}
guicontrol,enable,MORROM
return

PEREMUINJ:
try, gosub, inj%emuname%cfg
	catch
		{
		}
return

InitEmuOpts:
gosub, EMUCFGCOPY
return

MAMEBIOSFIRM:
OVDCHK= MAME - Arcade
iniread,mame_verx,Apps.ini,EMULATORS,MAME
splitpath,mame_verx,,mamepth
OVDFLDR= %mamepth%\roms
guicontrol,,OVDTXT,%OVDFLDR%
guicontrol,,OVDLDS,|%OVDFLDR%||Matching|%systmfldrs%
guicontrol,,OVDCHK,1
guicontrol,enable,OVDLDS
guicontrol,enable,SETOVD
guicontrol,,DOWNONLY,1
gosub, DOWNONLY
guicontrol,,EXTRURL,0
return

injMAMEcfg:
Loop, Parse, jsinvr,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		FileRead,romrpl%A_Index%,rj\sysCfgs\%curjf%\%A_LoopField%
		ini_%A_Index%= %A_LoopField%
	}
rjgdsk= %inclfspl2%
dskinc=
Loop,15
	{
		gamDISK%A_Index%=
	}
if (inclfspl1 = inclfspl2)
	{
		rjgdsk=
		sb_settext("match " inclfspl1 " = " inclfspl2 "")
		ifexist,%RJSYSTEMS%\%curjf%\%curomfd%\
			{
				stringleft,shtls,inclfspl1,2
				Loop, %RJSYSTEMS%\%curjf%\%curomfd%\*.*
					{
						if (A_LoopFileExt = "zip")
							{
								inclfspl2= %A_LoopFileName%
								break
							}
						ifinstring,RJROMSPL,%A_LoopFileExt%
							{
								inclfspl2= %A_LoopFileName%
								xtnv= %A_LoopFileExt%
								rjgdsk.= A_LoopFileName . "|"
								if (RJMULTIDISC <> 1)
									{
										break
									}
								dskinc+=1
								GamDsk%dskinc%= %A_LoopFileName%
								continue
							}
						ifnotinstring,omtiall,%A_LoopFileExt%
							{
								inclfspl2= %A_LoopFileName%
								xtnv= %A_LoopFileExt%
								rjgdsk.= A_LoopFileName . "|"
								if (RJMULTIDISC <> 1)
									{
										break
									}
								dskinc+=1
								gamDISK%dskinc%= %A_LoopFileName%
								continue
							}
					}
			}
	}
splitpath,inclfspl2,fnm,,fext
xtnv= %fext%
Loop
	{
		curininx= % (ini_%A_Index%)
		curomcpl= % (romrpl%A_Index%)
		if (curomcpl = "")
			{
				break
			}
		SRCREPLS= %emulocd%\roms
		ifinstring,RJEMUARGS,[ROMPATH]
			{
				SRCREPLS= %RJSYSTEMS%\%curjf%\SOURCE
			}
		stringreplace,curomcpl,curomcpl,[SOURCE],%SRCREPLS%,All
		stringreplace,curomcpl,curomcpl,[EMUPATH],%emulocd%,All
		stringreplace,curomcpl,curomcpl,[ROMPATH],%RJSYSTEMS%\%curjf%\%curomfd%,All
		if (inclfspl1 <> inclfspl2)
			{
				stringreplace,curomcpl,curomcpl,[ROMF],%cinjr%,All
			}
		FileAppend,%curomcpl%,%RJSYSTEMS%\%curjf%\%curomfd%\%curininx%
		CFGCOMPLETE= 1
	}
if (RJZIPPEEK = 1)
	{
		if (fext = "zip")
			{
				exeu= "%S_KeyDir%\bin\7za.exe"
				lstyp= l -slt
				fiel= "%RJSYSTEMS%\%curjf%\%inclfspl1%\%fnm%"
				concatcmd= "%S_KeyDir%\bin\7za.exe" l -slt "%RJSYSTEMS%\%curjf%\%inclfspl1%\%inclfspl2%"
				StdOut := StdoutToVar_CreateProcess(concatcmd)
				partition=
				gosub, zpkproc
			}
	}
nwextfnd= % (MAME_%RJMAMENM%_medtyps)
if (RJMAMENM = "")
	{
		stringsplit,grjdr,RJEMUOPTS,%A_Space%-,<
		RJMAMENM= %grjdr1%
		ifinstring,RJMAMENM,[
			{
				SB_SetText(" SYSTEM NOT FOUND ")
				return
			}
	}
Loop, Parse, rjgdsk,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		Loop, Parse, nwextfnd,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				MEDP= %A_LoopField%
				stringreplace,MEDP,MEDP,%A_Space%,,All
				stringreplace,MEDP,MEDP,`n,,All
				stringreplace,MEDP,MEDP,`r,,All
				nweinxtf= % (MAME_%RJMAMENM%_%MEDP%_extyp)
				batchfile= %RJSYSTEMS%\%curjf%\%curomfd%\%curomfd%.bat
				if (nweinxtf = "")
					{
						SB_SetText(" SYSTEM NOT FOUND ")
						continue
					}
				ifinstring,nweinxtf,%xtnv%
					{
						if (RJLNCHCFGOW = 1)
							{
								FileRead, sysrep, %batchfile%
								curMameOpt= %A_LoopField%
								stringreplace,sysrep,sysrep,[RJRTYP],%A_LoopField%,All
								stringreplace,sysrep,sysrep,[RJMAMESYS],%RJMAMENM%,All
								FileDelete, %batchfile%
								fileappend,%sysrep%,%batchfile%
								break
							}
					}
			}
	}
return

MAMETOG:
iniread,supmamejoys,sets\EmuCfgPresets.set,MAME
stringreplace,supmamejoys,supmamejoys,[ARCH],%ARCH%,All
SB_SetText(" Creating MAME database ")
emuprgpl=0
emuprgpl+=10
ifnotexist,lm.ini
	{
		;guicontrol,,emuPRGA,%emuprgpl%
		iniread,mame_verx,Apps.ini,EMULATORS,MAME
		splitpath,mame_verx,,mamevpth
		if (mame_verx = "ERROR")
			{
				SB_SetText(" MAME NOT FOUND ")
				return
			}
		RunWait,%comspec% cmd /c " "%mame_verx%" -lm >"%S_KeyDir%\lm.ini"",,Min
		RunWait,%comspec% cmd /c " "%mame_verx%" -cc",%mamevpth%,Min
	}
emuprgpl+=40
ifexist,lm.ini
	{
		FileGetSize,lmsz,lm.ini,K
		if (lmsz < 500)
			{
				SB_SetText(" media database not created properly.")
				FileDelete,lm.ini
				return
			}
		fileread,mamelistedmedia,lm.ini
		if (mlmame = "")
			{
				gosub, MAMELMREAD
			}
	}
SB_SetText(" COMPLETE ")
return

MAMELMREAD:
SB_SetText(" Reading mame listed media ")
loop,parse,mamelistedmedia,`n`r
	{
		if (A_index < 3)
			{
				continue
			}
		ifinstring,A_LoopField,-
			{
				continue
			}
		ifinstring,A_LoopField,(none)
			{
				continue
			}
		af= %A_LoopField%
		Loop, 20
			{
				stringreplace,af,af,%A_Space%%A_Space%,%A_space%,All
			}
		sysk1=
		sysk2=
		sysk3=
		stringsplit,sysk,af,%A_Space%
		stringsplit,and,af,)
		stringsplit,vir,and1,(
		stringsplit,mediatype,vir2,)
		ifinstring,sysk3,(
			{
				sysname= %sysk1%
				MAME_%sysname%_SHRTN= %sysname%
				ifinstring,A_LoopField,(prin
					{
						continue
					}
				ifinstring,A_LoopField,(serl
					{
						continue
					}
				MAME_%sysname%_medtyps= %mediatype1%|
				MAME_%sysname%_%mediatype1%_extyp= %and2%
			}
			else
				{
					MAME_%sysname%_medtyps.= mediatype1 . "|"
					MAME_%sysname%_%mediatype1%_extyp= %and2%
				}
	}
SB_SetText(" Mame listed media indexing complete ")
mlmame= 1
return

PegasusToggle:
gosub, FEUNPOP
PGINIT:
iniread,Pegasus,apps.ini,FRONTENDS,Pegasus
if (Pegasus = "ERROR")
	{
		SB_SetText("Use the Install tab to install Pegasus.")
		guicontrol,choose,TABMENU,3
		guicontrol,,SALIST,|Frontends||Systems|Emulators|Utilities
		SALIST= Frontends
		guicontrol,enable,SALIST
		gosub, SALIST
		Guicontrol,choose,PRGINSTLBX,|5
		guicontrol, ChooseString, PRGINSTLBX,Pegasus
		return
	}
filecreateDir,rj\PG
ifnotexist,PGcfg.ini
	{
		FileAppend,[CONFIG]`n,PGcfg.ini
		FileAppend,[ORDER]`n,PGcfg.ini
		IniWrite,true,PGcfg.ini,CONFIG,scraper
		pgscr= 1
		IniWrite,true,PGcfg.ini,CONFIG,Fullscreen
		pgfscr= 1
		IniWrite,gameOS,PGcfg.ini,CONFIG,theme
		pgtheme= gameOS
	}
splitpath,Pegasus,PGFEXE,PGPROG
ifnotexist,%PGPROG%\pegasus_portable.lnk
	{
		FileCreateShortcut, %pegasus%, pegasus_portable.lnk, %PGPROG%, --portable, portable_mode, %pegasus%, , ,
	}
iniread,PGHOME,pgcfg.ini,CONFIG,home
if (PGHOME = "ERROR")
	{
		PGHOME= %PGPROG%\config
		iniwrite,%PGHOME%,pgcfg.ini,CONFIG,home
	}
ifnotexist,%PGHOME%
	{
		FileCreateDir,%PGHOME%\metafiles
	}
ifnotexist,%PGHOME%\metafiles
	{
		FileCreateDir,%PGHOME%\metafiles
	}
pgthemes=
IniRead,pginitheme,sets\Themes.set
Loop, Parse, pginitheme,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		iniread,pgt,sets\Themes.set,%A_LoopField%,PGTHEME
		if (pgt <> "ERROR")
			{
				pgthemes.= A_LoopField . "|"
			}
	}
Loop, %pghome%\themes\*,2
	{
		ifinstring,pgthemes,%A_LoopFileName%|
			{
				continue
			}
		pgthemes.= A_LoopFileName . "|"
	}
stringreplace,pgthemes,pgthemes,||,|,All
ifexist,%pghome%\settings.txt
setheme=RJ
Loop,read,settings.txt
	{
		ifinstring,A_LoopReadLine,general.theme
			{
				stringsplit,ebb,A_LoopReadLIne,:,/
				Loop,parse,ebb2,\
					{
						setheme= %A_LoopField%
					}
				break	
			}
	}
fetog= show
PGCURPL=
guicontrol,,FELBXA,|
IniRead,pgglobal,PGcfg.ini,GLOBAL
Loop,parse,pgglobal,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,knni,A_LoopField,=
		PGCURPL.= knni1 . "|"
	}
iniread,sysordr,PGcfg.ini,ORDER,system_order
if (sysordr <> "ERROR")
	{
		PGCURPL= %sysordr%
	}
insttheme=
Loop,%PGHOME%\themes\*,2
	{
		insttheme= %A_LoopFileName%
		ifexist,%PGHOME%\themes\gameOS
			{
				insttheme= gameOS
			}
		break
	}
cursysthemelist= %fesyslst%
avblnk=
guicontrol,,FELBXA,%PGCURPL%
IniRead, pgmirloc,PGcfg.ini,CONFIG,Mirror_Links
if (pgmirloc = "ERROR")
	{
		pgmirloc= %S_KeyDir%\mirrors
	}
IniRead, pgtheme,PGcfg.ini,CONFIG,theme
if (pgtheme = "ERROR")
	{
		pgtheme= gameOS
	}
pgfscr= 1
IniRead, pgfullscreen,PGcfg.ini,CONFIG,Fullscreen
if ((pgfullscreen = "ERROR")(pgfullscreen = "false"))
	{
		pgfscr= 0
		pgfullscreen= false
	}
pgdet= 1
IniRead, pgDetectPlaylists,PGcfg.ini,CONFIG,DetectPlaylists
if ((pgDetectPlaylists = "ERROR")or(pgDetectPlaylists= "false"))
	{
		pgdet= 0
		pgDetectPlaylists= false
	}
pgscr= 1
IniRead,pgscraper,PGcfg.ini,CONFIG,scraper
if ((pgscraper = "ERROR")(pgscraper = "false"))
	{
		pgscr= 0
		pgscraper= false
	}
altnms=Folder|Back|spine|4mix|cart|logo|marquee|bezel|panel|cab_L|cab_R|tile|banner|steam|poster|fanart|snap
Loop,parse,altnms,|
	{
		altpg%A_Index%:= A_LoopField
	}
PGGUIITEMS=FEBUTA|FEBUTB|FEBUTC|FEBUTD|FEBUTE|FEBUTF|FEBUTG|FEBUTH|FEBUTI|FEBUTJ|FEBUTK|FECBXB|FECBXC|FECBXD|FECHKB|FECHKC|FECHKD|FECHKE|FECHKF|FEDDLA|FEDDLD|FEDDLF|FEDDLG|FEEDTA|FEEDTB|FELBXA|FELVA|FEPRGA|FERAD5A|FERAD5B|FERAD5C
peg_fetog=FEPRGA|FETXTP|FETXTO|FETXTM|FETXTL|FETXTJ|FETXTI|FETXTH|FETXTG|FELBXA|FETXTC|FETXTK|FETXTB|FETXTA|FERAD5C|FERAD5B|FERAD5A|FELVA|FECBXD|FECBXC|FECBXB|FEDDLG|FEDDLA|FEDDLD|FEEDTB|FEEDTA|FECHKF|FECHKE|FECHKD|FECHKC|FECHKB|FEBUTA|FEBUTB|FEBUTC|FEBUTD|FEBUTE|FEBUTH|FEBUTF|FEBUTG|FEBUTJ|FEBUTI|FEBUTK
peg_etog=FEBUTA|FEBUTB|FEBUTC|FEBUTD|FEBUTE|FEBUTF|FEBUTH|FEBUTG|FEBUTI|FEBUTJ|FEBUTK|FECHKB|FECHKC|FECHKD|FECHKE|FECHKF|FEEDTA|FEEDTB|FEDDLD|FEDDLA|FEDDLF|FEDDLG|FECBXB|FECBXC|FECBXD|FELVA|FERAD5A|FERAD5B|FERAD5C|FETXTA|FETXTB|FETXTK|FETXTC|FELBXA|FETXTG|FETXTH|FETXTI|FETXTJ|FETXTL|FETXTM|FETXTO|FETXTP|FEPRGA
guicontrol,,FEBUTJ,^
guicontrol,move,FEBUTA, x527 y33 w70 h19
guicontrol,,FEBUTA,Download
guicontrol,move,FEBUTB,x659 y473 w93 h23
guicontrol,,FEBUTB,CREATE
guicontrol,move,FEBUTC,x505 y456 w46 h17
guicontrol,,FEBUTC,delete
guicontrol,move,FEBUTD,x355 y105 w37 h19
guicontrol,,FEBUTD,. . .
guicontrol,move,FEBUTE,x262 y475 w52 h22
guicontrol,,FEBUTE,Add
guicontrol,move,FEBUTF,x704 y451 w46 h17
guicontrol,,FEBUTF,Load
guicontrol,move,FEBUTH,x261 y130 w62 h20
guicontrol,,FEBUTH,Emulator
guicontrol,move,FEBUTG,x506 y477 w46 h17
guicontrol,,FEBUTG,clear
guicontrol,move,FEBUTI,x508 y352 w18 h18
guicontrol,,FEBUTI,v
guicontrol,move,FEBUTJ,x508 y334 w18 h18
guicontrol,move,FEBUTK,x419 y4 w18 h18
gui, font, %fontXlg% bold
guicontrol, font, FEBUTK
guicontrol,,FEBUTK,>
gui, font, %fontXmed% normal
guicontrol,move,FECHKB,x643 y424 w111 h13
guicontrol,,FECHKB,Create Backups
guicontrol,,FECHKB,1
guicontrol,move,FECHKC,x521 y55 w74 h13
guicontrol,,FECHKC,Overwrite
guicontrol,move,FECHKD,x642 y357 w120 h23
guicontrol,,FECHKD,Fullscreen
guicontrol,,FECHKD,%pgfscr%
guicontrol,move,FECHKE,x642 y378 w120 h23
guicontrol,,FECHKE,Scraper Enabled
guicontrol,,FECHKF,%pgscr%
guicontrol,move,FECHKF,x642 y398 w120 h23
guicontrol,,FECHKF,Detect Playlists
guicontrol,,FECHKE,%pgdet%
guicontrol,move,FEEDTA,x428 y130 w145 h21
guicontrol,,FEEDTA,%A_SPACE%>[ROMPATH]>
guicontrol,-password,FEEDTB
guicontrol,move,FEEDTB,x578 y130 w120 h21
guicontrol,,FEEDTB,
guicontrol,move,FEDDLD,x599 y32 w162
guicontrol,,FEDDLD,|%pgtheme%||%pgthemes%
guicontrol,move,FEDDLA,x9 y41 w249
guicontrol,,FEDDLA,|Systems||
guicontrol,hide,FEDDLF
guicontrol,move,FEDDLF,x324 y79 w100
guicontrol,,FEDDLF,|%pgmirloc%||
guicontrol,move,FEDDLG,x325 y130 w100
guicontrol,,FEDDLG,|other||%runlist%
guicontrol,move,FECBXB,x263 y153 w217
guicontrol,,FECBXB,|%systmfldrs%
guicontrol,move,FECBXC,x263 y176 w217
guicontrol,,FECBXC,|%avblnk%%fesyslst%
guicontrol,move,FECBXD,x264 y199 w217
guicontrol,,FECBXD,|%avblnk%%fesyslst%
guicontrol,,FELVA,Mirrors
guicontrol,move,FELVA,x10 y64 w247 h433
guicontrol,+altsubmit,FELVA
guicontrol,-checked,FELVA
gui,ListView,FELVA
LV_Delete()
Loop, Parse, systmfldrs,|
	{
		ifnotinstring,SysLLst,%A_LoopField%=
			{
				continue
			}
		LV_Add("",A_LoopField)
	}
LV_ModifyCol()
guicontrol,move,FERAD5A,x701 y151 w56 h15
guicontrol,,FERAD5A, Jackets
guicontrol,,FERAD5A, 0
guicontrol,move,FERAD5B,x701 y171 w53 h15
guicontrol,,FERAD5B, Mirrors
guicontrol,,FERAD5B, 0
guicontrol,move,FERAD5C,x701 y133 w53 h15
guicontrol,,FERAD5C,ROMs
guicontrol,,FERAD5C, 1
guicontrol,move,FETXTA,x643 y55 w110 h13
guicontrol,,FETXTA,Global Theme
guicontrol,move,FETXTB,x508 y437 w120 h15
guicontrol,,FETXTB,Remove
guicontrol,move,FETXTK,x597 y452 w106 h15
guicontrol,,FETXTK,Load System List
guicontrol,move,FETXTC,x14 y23 w512 h16
guicontrol,,FETXTC,System
guicontrol,move,FELBXA,x263 y223 w240 h251
guicontrol,move,FETXTG,x424 y478 w80 h20
guicontrol,,FETXTG, Current
guicontrol,move,FETXTH, x316 y480 w85 h19
guicontrol,,FETXTH, Add system
guicontrol,move,FETXTI,x588 y115 w146 h13
guicontrol,,FETXTI, Extensions (comma sperated)
guicontrol,move,FETXTJ,x424 y82 w326 h31
guicontrol,,FETXTJ,
guicontrol,move,FETXTL,x488 y155 w62 h13
guicontrol,,FETXTL,Full-Name
guicontrol,move,FETXTM, x490 y178 w89 h13
guicontrol,,FETXTM,Platform-Ident
guicontrol,move,FETXTO, x491 y201 w89 h13
guicontrol,,FETXTO,Short-Name
guicontrol,move,FETXTP, x441 y6 w47 h15
guicontrol,,FETXTP,Launch
guicontrol,move,FEPRGA,x15 y500 w736 h7
guicontrol,,FEPRGA,0
gosub, PGPOPULATESYS
Loop,parse,peg_fetog,|
	{
		guicontrol,%fetog%,%A_LoopField%
	}
Loop,parse,peg_etog,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

pgenable:
Loop,parse,PGGUIITEMS,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

PegasusFEBUTA:
guicontrolget,FEDDLD,,FEDDLD
if (FEDDLD = "")
	{
		SB_SetText("You need select a theme!")
		return
	}
Loop,parse,PGGUIITEMS,|
	{
		guicontrol,disable,%A_LoopField%
	}	
pgteo=
dwnovr= false
if (FECHKC = 1)
	{
		dwnovr= true
	}
ifexist, %PGHOME%\themes\%FEDDLD%
	{
		pgteo= 1
		if (FECHKC = 1)
			{
				pgteo=
			}
	}
iniRead,URLFILE,sets\themes.set,%FEDDLD%,PGTHEME
if (URLFILE = "ERROR")
	{
		SB_SetText("This theme is not avaiable from the skeletonKey repository")
		guicontrol,,FEDDLD,|gameOS||%pgthemes%
		gosub,FEDDLD
		gosub,pgenable
		return
	}
save= rj\PG\%FEDDLD%.7z
extractpath= %PGHOME%\themes
splitpath,save,svaf,svap
exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
filegetsize,pgtsz,%save%,K
if (pgtsz < 1)
	{
		SB_SetText("Download Failed")
		guicontrol,,FEDDLD,|gameOS||%pgthemes%
		gosub,FEDDLD
		gosub,pgenable
		return
	}
ifnotexist,%save%
	{
		SB_SetText("Download Failed")
		guicontrol,,FEDDLD,|gameOS||%pgthemes%
		gosub,FEDDLD
		gosub,pgenable
		return
	}
if (pgteo = "")
	{
		RunWait, %comspec% cmd /c " "%S_KeyDir%\bin\7za.exe" x -y "%save%" -O"%extractpath%" ",,hide
	}
guicontrol,,FECBXA,|%fesyslst%
guicontrol,enable,FEBUTA
ifnotexist,%pghome%\settings.txt
	{
		SB_SetText("configuration must be created")
		gosub,pgenable
		return
	}
Loop,files,rj\pg\%pgtheme%.*
	{
		fileread,pgcfgf,%pghome%\settings.txt
		filedelete,%pghome%\settings.txt
		Loop,parse,pgcfgf,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,fez,A_LoopField,:
				if (fez1 = "general.theme")
					{
						fileappend,%fez1%: %pghome%\themes\%FEDDLD%/`n,%pghome%\settings.txt
						continue
					}
				fileappend,%A_LoopField%`n,%pghome%\settings.txt
				SB_SetText(" theme changed to " pgtheme "")
			}
		gosub,pgenable
		return	
	}
SB_SetText("Current theme is " PGTHEME " ")
gosub,pgenable
return

PegasusFEBUTB:
Loop,parse,PGGUIITEMS,|
	{
		guicontrol,disable,%A_LoopField%
	}
guicontrolget,FEDDLF,,FEDDLF
guicontrolget,FEDDLC,,FEDDLC
guicontrolget,FEDDLD,,FEDDLD
FileCopy,%PGHOME%\settings.txt,%PGHOME%\settings.txt.bak,1
TCURPL=
IniRead,prsy,PGcfg.ini,ORDER,system_order
FileDelete,rj\PG\cursys.cfg
FileDelete,rj\PG\GD.cfg
Loop, Parse, prsy,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		IniRead,c_sysp,PGcfg.ini,%A_LoopField%,syspath
		IniRead,c_emun,PGcfg.ini,%A_LoopField%,emuname
		IniRead,c_emuo,PGcfg.ini,%A_LoopField%,emuoptions
		stringreplace,c_emuo,c_emuo,> ,",All
		;"
		stringreplace,c_emuo,c_emuo,[ROMNAME],{file.basename},All
		stringreplace,c_emuo,c_emuo,[ROMPATH],{file.path},All
		IniRead,c_extn,PGcfg.ini,%A_LoopField%,extensions
		IniRead,c_shrt,PGcfg.ini,%A_LoopField%,shortname
		IniRead,c_full,PGcfg.ini,%A_LoopField%,fullname
		IniRead,c_plfi,PGcfg.ini,%A_LoopField%,platformid
		if instr(c_sysp,":")
			{
				sysplfw= %c_sysp%
				gosub, gpsysit
			}
		else {
			iniread,sysplfp,SystemLocations.ini,LOCATIONS,%c_sysp%
			Loop,parse,sysplfp,|
				{
					if (A_LoopField = "")
						{
							continue
						}
					sysplfw= %A_LoopField%
					gosub, gpsysit
				}
			continue
			}
	}
FileRead,pgcfg,sets\pgsettings.set
pgthemeloc= %PGPROG%\config\themes\%FEDDLD%
stringreplace,pgthemeloc,pgthemeloc,\r,/,All
stringreplace,pgcfg,pgcfg,[THEME],%pgthemeloc%,All
stringreplace,pgcfg,pgcfg,[PGSCR],%pgscraper%,All
stringreplace,pgcfg,pgcfg,[PGFS],%pgfullscreen%,All
stringreplace,pgcfg,pgcfg,[PGGOG],%pgDetectPlaylists%,All
stringreplace,pgcfg,pgcfg,[PGSTM],%pgDetectPlaylists%,All
stringreplace,pgcfg,pgcfg,[PGES],%pgDetectPlaylists%,All
stringreplace,pgcfg,pgcfg,[PGLB],%pgDetectPlaylists%,All
stringreplace,pgcfg,pgcfg,[PGAND],%pgDetectPlaylists%,All
stringreplace,PGHOMER,PGHOME,\,/,All
stringreplace,pgcfg,pgcfg,[PGHOME],%PGHOMER%,All
if (FECHKB = 1)
	{
		FileMove,%PGHOME%\settings.txt,%PGHOME%\settings.txt.bak,1
		FileMove,%PGHOME%\metafiles\collections.pegasus.txt,%PGHOME%\metafiles\collections.pegasus.txt.bak,1
	}
FileDelete,%PGHOME%\metafiles\collections.pegasus.txt
filecopy,rj\PG\collections.pegasus.txt,%PGHOME%\metafiles,%FECHKB%
FileDelete,%PGHOME%\settings.txt
FileAppend,%pgcfg%,%PGHOME%\settings.txt
msgbox,,Complete,PG configuration created,5
Loop,parse,PGGUIITEMS,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

gpsysit:
FileDelete,%sysplfw%\collections.pegasus.txt
iniread,emushrtn,apps.ini,EMULATORS,%c_emun%
ifinstring,c_emun,:
	{
		emushrtn= %c_emun%
	}
FileAppend,collection: %c_plfi%`n,%sysplfw%\collections.pegasus.txt
FileAppend,shortname: %c_shrt%`n,%sysplfw%\collections.pegasus.txt
stringreplace,extn,c_extn,.,%A_Space%,All
FileAppend,extensions: %extn%`n,%sysplfw%\collections.pegasus.txt
stringreplace,emushrtn,emushrtn,",,All
;"
FileAppend,launch: "%emushrtn%" %c_emuo% `n,%sysplfw%\collections.pegasus.txt
stringreplace,injvnp,sysplfw,\,/,All
FileAppend,directory: %injvnp%`n,%sysplfw%\collections.pegasus.txt
FileAppend,`n,%sysplfw%\collections.pegasus.txt
Loop,files,%sysplfw%\*,FD
	{
		pgdir= %A_LoopFileName%
		splitpath,A_LoopFileFullPath,pginf,pgind,pginx,pginn
		extnum= 
		extvidn= 
		pgimp= 
		pgimgapnd= 
		pgvidapnd= 
		Loop,parse,extn,`,,%A_Space%
			{
				pinv= 
				ifexist,%A_LoopFileFullPath%\
					{
						pgind= %sysplfw%\%pgdir%
						pinv= R
					}
					else {
						pgimp= 
					}
/*
				Loop,files,%pgind%\*.%A_LoopField%,%pinv%
					{
						splitpath,A_LoopFileFullPath,pgf,pgd,pgx,pgn
						stringreplace,pgfullpth,A_LoopFileFullPath,\,/,All
						stringreplace,pgad,pgd,\,/,All
						if ((A_Index = 1) && (pgimp <> 1))
							{
								fileappend,game:%A_Space%%pgn%`nfiles:%A_Space%%pgfullpth%`n,%sysplfw%\collections.pegasus.txt
								goto, ParsePGIMGS
							}													
						fileappend,%pgfullpth%`n,%sysplfw%\collections.pegasus.txt
						ParsePGIMGS:
						pgimgs= boxFront|boxBack|boxSpine|boxFull|cartridge|logo|marquee|bezel|panel|cabinetLeft|cabinetRight|tile|banner|steam|poster|background|screenshot
						if (extnum = 1)
							{
								continue
							}
						Loop,parse,imgonl,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								cextm= %A_LoopField%
								Loop,parse,pgimgs,|
									{
										irnm= %A_LoopField%
										iimmbn= %pgd%\%irnm%.%cextm%
										ifexist,%iimmbn%
											{
												stringreplace,pgcpth,iimmbn,\,/,All
												stringreplace,pgimgs,pgimgs,%irnm%|,,All
												pgimgapnd.= "assets." . irnm . ":" . A_Space . pgcpth . "`n"
												extnum= 1
												continue
											}
										etxx= % altpg%A_Index%
										if (etxx <> irnm)
											{
												iimmbn= %pgd%\%etxx%.%cextm%
												stringreplace,pgcpth,iimmbn,\,/,All
												stringreplace,pgimgs,pgimgs,%irnm%|,,All
												ifexist,%pgd%\%etxx%.%cextm%
													{
														stringreplace,pgimgs,pgimgs,%irnm%|,,All
														pgimgapnd.= "assets." . irnm . ":" . A_Space . pgcpth . "`n"
														extnum= 1
														continue
													}
											}
										iimmbn= %pghome%\%pgdir%\%irnm%.%cextm%
										ifexist,%iimmbn%
											{
												stringreplace,pgcpth,iimmbn,\,/,All
												stringreplace,pgimgs,pgimgs,%A_LoopField%|,,All
												pgimgapnd.= "assets." . irnm . ":" . A_Space . pgcpth . "`n"
												extnum= 1
											}
									}
							}
						if (extvidn = 1)
							{
								continue
							}
						pgvidtyp=mp4|mkv|m4a|avi
						Loop,parse,pgvidtyp,|
							{
							Loop,files,%pgind%\*.%A_LoopField%
								{
									iimmbn= %A_LoopFileFullPath%
									ifexist,%iimmbn%
										{
											stringreplace,pgcpth,iimmbn,\,/,All
											stringreplace,pgimgs,pgimgs,%irnm%|,,All
											pgvidapnd.= "assets.video:" . A_Space . pgcpth . "`n"
											extvidn= 1
											continue
										}
								}
						}
						pgimp= 1
					}
	*/
			}
		if (pgimgapnd <> "")
			{
				fileappend,%pgimgapnd%,%sysplfw%\collections.pegasus.txt
			}
		if (pgvidapnd <> "")
			{
				fileappend,%pgvidapnd%,%sysplfw%\collections.pegasus.txt
			}
	}
fileread,pgsys,%pghome%\game_dirs.txt
ifnotinstring,pgsys,%injvnp%
	{
		FileAppend,%injvnp%`n,%pghome%\game_dirs.txt
	}
return

PegasusFEBUTC:
if (sysfnd = "")
	{
		return
	}
TCURPL=
Loop, Parse, PGCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = curtxt)
			{
				inidelete,PGcfg.ini,%curtxt%
				continue
			}
		TCURPL.= A_LoopField . "|"
	}
PGCURPL= %TCURPL%
iniwrite,%PGCURPL%,PGcfg.ini,ORDER,system_order
guicontrol,,FELBXA,|%PGCURPL%
return

PEGRSWIN:
FileDelete,PGcfg.ini
Goto, FEDDLJ
return

PegasusFEBUTD:
/*
*/	
selctsystmp=
guicontrolget,FETXTJ,,FETXTJ
FileSelectFolder,selctsystmp,,3,Select a ROM Directory for %curtxt%
if ((selctsystmp = "")&&(sysfnd = ""))
	{
		guicontrol,,FETXTJ,%selctsystmp%
		return
	}
if (sysfnd = "")
	{
		return
	}
if ((FETXTJ <> selctsystmp)&&(selctsystmp = ""))
	{
		guicontrol,,FETXTJ,
		selctsystmp= %FECBXB%
	}
iniwrite,%selctsystmp%,PGCfg.ini,%curtxt%,syspath
return	
return

PegasusFEBUTE:
SNFEITMS=
NFEITMS=
FEItems=
FEItems:= LVGetCheckedItems("", "ahk_id" . FELSTVA)
guicontrolget,SYSTHM,,FECBXA
IniRead,syso,PGcfg.ini,ORDER,system_order
if (syso = "ERROR")
	{
		syso=
	}
if (sysfnd = 1)
	{
		SB_SetText("Current system is already added")
		return
	}
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)  ; Resume the search at the row after that found by the previous iteration.
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
	}
Loop, Parse, PGCURPL,|
	{
		if (A_LoopField = curtxt)
			{
				SB_SetText("Current system is already in the playlist.")
				return
			}
	}
PGCURPL.= curtxt . "|"
guicontrolget,FECBXB,,FECBXB
if (FECBXB = "")
	{
		FECBXB= %curtxt%
	}
guicontrolget,FECBXD,,FECBXD
if (FECBXD = "")
	{
		FECBXD= %curtxt%
	}
guicontrolget,FECBXA,,FECBXA
if (FECBXA = "")
	{
		FECBXA= %curtxt%
	}
if (SLCTDSN = "")
	{
		SLCTDSN= other
	}
guicontrolget,SLCTDRW,,FEEDTA
if (SLCTDRW = "")
	{
		SB_SetText("You must desgnate an execution paramater, eg: ''[ROMPATH]''")
		return
	}
guicontrolget,SLCTDEMU,,FEDDLG
if (SLCTDEMU = "other")
	{		
		SB_SetText("You must assign an Emulator")
		return
	}
ifinstring,SLCTDEMU,_libretro.dll
	{		
		SLCTDRW= -L "%raexedir%\cores\%SLCTDEMU%" >[ROMPATH]>
		SLCTDEMU= retroarch
	}
guicontrolget,SLCTDEXT,,FEEDTB
if (SLCTDEXT = "")
	{
		SLCTDEXT= .*
	}
guicontrolget,selctsyst,,FETXTJ
if (selctsyst = "")
	{
		iniread,selctsystl,SystemLocations.ini,LOCATIONS,%fecbxb%
		if ((selctsystl = "")or(selctsystl = "ERROR"))
			{
				selctsyst= %RJSYSTEMS%
			}
			else {
				Loop,parse,selctsystl,|
					{
						selctsyst= %A_LoopField%
						break
					}
			}
	}
SLCTDRW=%A_SPACE%%SLCTDRW%
iniwrite,%fecbxb%,PGCfg.ini,%curtxt%,fullname
iniwrite,%fecbxc%,PGCfg.ini,%curtxt%,platformid
iniwrite,%fecbxd%,PGCfg.ini,%curtxt%,shortname
iniwrite,%SLCTDEXT%,PGCfg.ini,%curtxt%,extensions
iniwrite,%SLCTDRW%,PGCfg.ini,%curtxt%,emuoptions
iniwrite,%SLCTDEMU%,PGCfg.ini,%curtxt%,emuname
iniwrite,%fecbxb%,PGCfg.ini,%curtxt%,syspath
iniread,sysordr,PGcfg.ini,ORDER,system_order
if (sysordr <> "ERROR")
	{
		PGCURPL= %sysordr%%curtxt%|
	}
guicontrol,,FELBXA,|%PGCURPL%
iniwrite,%PGCURPL%,PGcfg.ini,ORDER,system_order
Gui,ListView,FELVA
LV_Modify(0, "-Check")
return

PegasusFECBXA:
if (sysfnd = "")
	{
		return
	}
guicontrolget,SYSTHM,,FECBXA
guicontrolget,SYSNAM,,FECBXD
extpop=
Loop, Read, PGcfg.ini
	{
		if (A_LoopReadLine = "[CONFIG]")
			{
				continue
			}
		extpov1=
		extpov2=
		extpon1=
		extpon2=
		stringsplit,extpov,A_LoopReadLine,=
		stringsplit,extpon,extpov2,|
		if (extpon1 = curtxt)
			{
				extpop= %extpov1%
				break
			}
	}
ifinstring,curtxt,_
	{
		extpop= %curtxt%
	}
iniread,pgtv,PGcfg.ini,GLOBAL,%extpop%
avi=
kkv=
pt1=
pt2=
pt3=
pt4=
pt5=
pt6=
pt7=
pt8=
Loop, Parse, pgtv,|
	{
		pt%A_index%= %A_LoopField%
	}
pgtv= %pt1%|%pt2%|%pt3%|%pt4%|%pt5%|%pt6%|%SYSTHM%
iniwrite,%pgtv%,PGcfg.ini,GLOBAL,%extpop%
cursysthemelist= %fesyslst%
PegasusFECBXC:
if (sysfnd = "")
	{
		return
	}
guicontrolget,FECBXC,,FECBXC
iniwrite,%FECBXC%,PGcfg.ini,%curtxt%,platformid
return

PegasusFECBXD:
gui,submit,nohide
if (sysfnd = "")
	{
		return
	}
sleep, 2500
guicontrolget,curtxtmm,,FECBXD
if (curtxtmm <> curtxtm)
	{
		Msgbox,8196,Rename System,Rename the %curtxtm% to %curtxtmm%?
		ifmsgbox,yes
			{
				blockinput, on
				iniread,ebeb,PgCfg.ini,%curtxtm%
				iniread,PG,PgCfg.ini,order,system_order
				if ((ebeb <> "")&&(ebeb <> "ERROR"))
					{
						Loop,parse,ebeb,`n`r
							{
								if (A_LoopField = "")
									{
										continue
									}
								stringsplit,ebu,A_LoopField,=
								if (ebu1 = "platformid")
									{
										iniwrite,%curtxtmm%,PGcfg.ini,%curtxtmm%,%ebu1%
										continue
									}
								iniwrite,%ebu2%,PGcfg.ini,%curtxtmm%,%ebu1%
							}
						inidelete,PgCfg.ini,%curtxtm%
						sysord=
						Loop,parse,PGCURPL,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								if (A_LoopField = curtxtm)
									{
										sysord.= curtxtmm . "|"
										continue
									}
								sysord.= A_LoopField . "|"
							}
							PGCURPL= %sysord%
							iniwrite,%PGCURPL%,PGcfg.ini,order,system_order
							guicontrol,,FELBXA,|%PGCURPL%
					}
				blockinput, off
			}
	}
return

PegasusFEDDLD:
guicontrolget,pgtheme,,FEDDLD
iniwrite,%pgtheme%,PGcfg.ini,CONFIG,theme	
cursysthemelist=
guicontrol,,FECBXA,|%fesyslst%
ifnotexist,%pghome%\settings.txt
	{
		SB_SetText("configuration must be created")
		return
	}
Loop,files,rj\pg\%pgtheme%.*
	{
		fileread,pgcfgf,%pghome%\settings.txt
		filedelete,%pghome%\settings.txt
		Loop,parse,pgcfgf,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,fez,A_LoopField,:
				if (fez1 = "general.theme")
					{
						fileappend,%fez1%: %pghome%\themes\%FEDDLD%/`n,%pghome%\settings.txt
						continue
					}
				fileappend,%A_LoopField%`n,%pghome%\settings.txt
				SB_SetText(" theme changed to " pgtheme "")
			}
		return	
	}
SB_SetText(" " Pgtheme " not downloaded")
return
return

PegasusFECBXB:
if (curtxt = "")
	{
		SB_SetText("You must select an added system to configure the ROM path")
		return
	}
if (sysfnd = "")
	{
		return
	}
guicontrolget,FECBXB,,FECBXB
extpop=
iniwrite,%FECBXB%,PGcfg.ini,%curtxt%,fullname
return

PegasusFEDDLG:
/*
if (sysfnd = "")
	{
		return
	}
*/	
guicontrolget,FEDDLG,,FEDDLG
pto=
if (FEDDLG = "other")
	{
		pto= 1
		pgemu= other
		gosub,FEBUTH
		guicontrol,,FEDDLG,|other||%runlist%
		return
	}
ifinstring,FEDDLG,_libretro.dll
	{
		iniwrite,%A_SPace%-L "%raexedir%\cores\%FEDDLG%" >[ROMPATH]>,PgCfg.ini,%curtxt%,emuoptions
		iniwrite,retroarch,PgCfg.ini,%curtxt%,emuname
	}
	else {
		iniwrite,%FEDDLG%,PGCfg.ini,%curtxt%,emuname
	}
iniread,pgemt,apps.ini,EMULATORS,%FEDDLG%
if (pgemt = "ERROR")
	{
		pgemu=
		gosub, FEBUTH
		if (pgemu = "")
			{
				iniwrite,%FEDDLG%,PGCfg.ini,%curtxt%,emuname
				return
			}
		iniwrite, "%pgemu%",apps.ini,EMULATORS,%FEDDLG%
	}
PegasusFEDDLF:
guicontrolget,FEDDLF,,FEDDLF
iniread,mirtmp,Settings.ini,GLOBAL,%FEDDLF%
PGMIRROR= %mirtmp%
Gui,ListView,FELVA
LV_Delete()
Loop, %PGMIRROR%\*,2
		{
			LV_Add("",A_LoopFileName)
		}
LV_ModifyCol()
return

PegasusFEBUTH:
guicontrolget,FEDDLG,,FEDDLG
/*
if (sysfnd = "")
	{
		return
	}
*/	
if (FEDDLG <> "other")
	{
		return 
	}
FileSelectFile,pgemutmp,3,,Select an emulator for %addsystm%
if (pgemutmp = "")
	{
		return
	}
pgemu= %pgemutmp%
guicontrol,,FEDDLG,|%pgemutmp%||other|%runlist%
return

PegasusFEDDLC:
guicontrolget,FEDDLC,,FEDDLC
iniwrite,%FEDDLC%,PGcfg.ini,CONFIG,GameList
return

PegasusFEBUTK:
RPGZRUN:= A_SPace . "--portable"
SB_SetText(" " Pegasus "" RPGZRUN "")
Run, %comspec% /c "%Pegasus%"%RPGZRUN%,,hide
return

PegasusFEBUTJ:
SB_SetText("")
iniDelete,PGcfg.ini,ORDER,system_order
newnum=
olnum=
Loop, Parse, PGCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		olnum+=1
		systmv= A_LoopField
		if (A_LoopField = curtxt)
			{
				newnum:= olnum-1
			}
	}
if (newnum = 0)
	{
		sb_settext("Cannot move up")
		return
	}
TPGCURPL=
olnum=
Loop, Parse, PGCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		olnum+=1
		if (A_LoopField = curtxt)
			{
				continue
			}
		if (olnum = newnum)
			{
				TPGCURPL.= curtxt . "|"
			}
		TPGCURPL.= A_LoopField . "|"
	}
PGCURPL= %TPGCURPL%
iniwrite,%TPGCURPL%,PGcfg.ini,ORDER,system_order
guicontrol,,FELBXA,|%PGCURPL%
return

PegasusFESLDA:
guicontrolget,FESLDA,,FESLDA
iniwrite,%FESLDA%,PGcfg.ini,CONFIG,VRAM
pgvideoram= %FESLDA%
guicontrol,,FETXTE,VRAM Limit : %FESLDA%
return

PegasusFEBUTI:
SB_SetText("")
iniDelete,PGcfg.ini,ORDER,system_order
mvnum=
mvtm=
Loop, Parse, PGCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		mvnum+=1
		if (A_LoopField = curtxt)
			{
				mvtm:= mvnum+1
			}
	}
totord:= mvnum
if (mvtm > totord)
	{
		SB_SetText("Cannot Move further down.")
		return
	}
TPGCURPL=
mvnum=
Loop, Parse, PGCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		mvnum+=1
		if (A_LoopField = curtxt)
			{
				continue
			}
		TPGCURPL.= A_LoopField . "|"
		if (mvtm = mvnum)
			{
				TPGCURPL.= curtxt . "|"
			}
	}
PGCURPL= %TPGCURPL%
guicontrol,,FELBXA,|%PGCURPL%
iniwrite,%TPGCURPL%,PGcfg.ini,ORDER,system_order
return

PegasusFEBUTF:
pgcfgtmp=
FileSelectFile,pgcfgtmp,3,%pghome%,Select the game_dirs.txt,*.txt
if (pgcfgtmp = "")
	{
		return
	}
gosub, loadpgcfg
return

loadpgcfg:
fileread,pgsd,%pgcfgtmp%
Loop,parse,pgsd,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringreplace,pgsdir,A_LoopField,/,\,All
		Fileread,pgcolc,%A_LoopField%\collections.pegasus.txt
		Loop,parse,pgcolc,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,ner,A_LoopField,:
				sber= %ner1%
				kber= %ner2%
				if (sber = "collection")
					{
						plfrmid= %kber%
						longn= % fe_%plfrmid%
					}
				if (sber = "shortname")
					{
						shrtnm= %kber%
					}
				if (sber = "extensions")
					{
						extns= %kber%
					}
				if (sber = "launch")
					{
						stringsplit,prts,A_LoopField,"
						;"
						execu= %prts2%
						minx:= StrReplace(A_LoopField, """{file.path}""", ">[ROMPATH]>", xCount)
						if (xCount = 0)
							{
								minx:= StrReplace(A_LoopField, "{file.basename}", "[ROMNAME]", nCount)
							}
						stringreplace,minx,minx,%prts2%,,All
						stringreplace,minx,minx,",,All
						;"
					}
				if (sber = "directory")
					{
						syspath= 
						syspatht= 
						Loop,%ner0%
							{
								if (A_index = 1)
									{
										continue
									}
								stringtrimleft,vmt,A_LoopField,1
								if (vmt = "")
									{
										syspath= %A_LoopField%:
										continue
									}
								syspatht.= A_LoopField	
							}
						syspath.= syspatht	
					}
			}
			/*
		guicontrol,,FEEDTA,%minx%	
		guicontrol,,FEEDTB,%extns%
		guicontrol,,FEDDLG,%execu%
		guicontrol,,FECBXB,%longn%
		guicontrol,,FECBXC,%plfrmid%
		guicontrol,,FECBXD,%shrtn%
		*/
		iniread,sysord,PGcfg.ini,order,system_order
		PGCURPL=	
		noaddin= 
		Loop,sysord,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				PGCURPL.= A_LoopField . "|"
				if (A_LoopField = plfrmid)
					{
						noaddin= 1
					}
			}
		if (noaddin = "")
			{
				PGCURPL.= plfrmid . "|"
			}
		iniwrite,%longn%,PGCfg.ini,%plfrmid%,fullname
		iniwrite,%minx%,PGCfg.ini,%plfrmid%,emuoptions
		iniwrite,%syspath%,PGCfg.ini,%plfrmid%,syspath
		iniwrite,%execu%,PGCfg.ini,%plfrmid%,emuname
		iniwrite,%extns%,PGCfg.ini,%plfrmid%,extensions
		iniwrite,%shrtn%,PGCfg.ini,%plfrmid%,shortname
		iniwrite,%plfrmid%,PGCfg.ini,%plfrmid%,platformid
	}
PGLDPL=
LOADEDCFG=
PGTOPOP=
Loop, read, %pgcfgtmp%
	{
		if (A_LoopReadline = "")
			{
				continue
			}
		pgmsys=
		stringreplace,pgmp,A_LoopReadLine,/,\,All
		Loop,Parse,A_LoopReadLine,/
			{
				ifinstring,A_LoopField,%A_Space%-%A_Space%
					{
						pgmsys= %A_LoopField%
						break
					}
			}
		Loop,Parse,SysLLst,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,fjf,A_LoopField,=
				if (pgmsys = fjf1)
					{
						LOADEDCFG.= fjf3 . "=" fjf1 . "|" . fjf3 . "|"
						break
					}
			}
		FileRead,zmr,%pgmp%\%fjf1%.pegasus.txt
		Loop,Read,zmr,`n`r
			{
				if (A_LoopReadline = "")
					{
						continue
					}
				stringsplit,efx,A_LoopReadLine,:,"
				;"
				if (efx1 = "directory")
					{
						pgdpth= %efx2%
					}
				if (efx1 = "collection")
					{
						pgcol= %efx2%
					}
				if (efx1 = "shortname")
					{
						pgssn= %efx2%
					}
				if (efx1 = "extensions")
					{
						pglt= %efx2%
					}
				if (efx1 = "launch")
					{
						pgln=
						ark1=
						ark2=
						ark3=
						ark4=
						stringsplit,ark,A_LoopReadLine,{}
						Loop,%efx0%
							{
								if (A_Index = 1)
									{
										continue
									}
								simr= % efx%A_Index%
								if (A_Index = 2)
									{
										pgln.= efx2 . ":"
									}
								pgln.= simr
							}
						Loop,%ark0%
							{
								if (A_Index = 1)
									{
										continue
									}
								sefv= % ark%A_Index%
								stringleft,atyk,sefv,1
								if (atyk = "f")
									{
										eikad= {%sefv%}
									}
							}
					}
			}
		PGTOPOP.= fjf1 . "|"
		LOADEDCFG.= pglt . "|" . pgln . "|" . """ . eikad . """ . "|" . fjf3 . "|" . fjf1 . "`n"
	}
iniwrite, %LOADEDCFG%,rj\PG\loadsys.ini,GLOBAL
iniwrite,%pgfullscreen%,rj\PG\loadsys.ini,CONFIG,FullScreen
iniwrite,%pgscraper%,rj\PG\loadsys.ini,CONFIG,scraper
iniwrite,%pgtheme%,rj\PG\loadsys.ini,CONFIG,theme
iniwrite,%pgtheme%,rj\PG\loadsys.ini,CONFIG,DetectPlaylists
iniwrite,%PGHOME%,rj\PG\loadsys.ini,CONFIG,home
guicontrol,,FELBXA,|%PGTOPOP%
iniwrite,%PGTOPOP%,rj\PG\loadsys.ini,ORDER,system_order
PGCURPL= %PGTOPOP%
fileCopy,PGcfg.ini,PGcfg.ini.bak,1
fileMove,rj\PG\loadsys.ini,PGcfg.ini,1
return

PegasusFEEDTA:
if (sysfnd = "")
	{
		return
	}
guicontrolget,FEEDTA,,FEEDTA
newemuopts= %FEEDTA%
iniwrite,%A_Space%%newemuopts%,PGCfg.ini,%curtxt%,emuoptions
return

PegasusFEEDTB:
if (sysfnd = "")
	{
		return
	}
guicontrolget,FEEDTB,,FEEDTB
extpop=
iniwrite,%FEEDTB%,PGcfg.ini,%curtxt%,extensions
return

PegasusFERAD5A:
guicontrol,,FEEDTB,.bat
guicontrol,,FEDDLG,|bsl||%runlist%
return

PegasusFERAD5B:
guicontrol,,FEEDTB,.lnk
guicontrol,,FEDDLG,|bsl||%runlist%
return

PegasusFERAD5C:
ksysp= % fe_%curtxt%
pgpopem= 
iniread,allxtn,EmuCfgPresets.ini,%ksysp%,RJROMXT
iniread,pgemuas,Assignments.ini,OVERRIDES,%ksysp%
if (pgemuas = "")
	{
		iniread,pgemudef,EmuCfgPresets.ini,%ksysp%,SUPEMU
		Loop,parse,pgemudef,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				iniread,pgapx,Apps.ini,Emulators,%A_LoopField%
				if ((pgapx <> "ERROR")&&(pgapx <> ""))
					{	
						if (pgpopem = "")
							{
								pgpopem.= A_LoopField . "||"
								continue
							}
						pgpopem.= A_LoopField . "|"
					}
			}
	}
	else {
		Loop,parse,pgemuas,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (pgpopem = "")
					{
						pgpopem.= A_LoopField . "||"
						continue
					}
				pgpopem.= A_LoopField . "|"
			}
	}
guicontrol,,FEDDLG,|%pgpopem%%runlist%
guicontrol,,FEEDTB,%allxtn%
return

PGPOPULATESYS:
Gui,ListView,FELVA
Guicontrol,-checked,FELVA
Guicontrol,-Multi,FELVA
LV_Delete()
Loop, Parse, SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,syslk,A_LoopField,=
		iniread,sysxst,SystemLocations.ini,LOCATIONS,%syslk1%
		if ((sysxst <> "")&&(sysxst <> "ERROR"))
			{
				LV_Add("",syslk1)
			}
	}
LV_ModifyCol()
guicontrol,hide,FEDDLF
guicontrol,,FEDDLA,|Systems||ALL
return

PegasusFELVA:
gui,listview,FELVA
curtxt=
sysfnd=
guicontrol,,FETXTJ,
guicontrol,,FERAD5C, 1
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
	}
	/*
Loop, parse, SysLLst,`n`r
		{
			if (A_Loopfield = "")
				{
					continue
				}
		ebvm3= 		
		stringsplit,ebvm,A_LoopField,=
		if (ebvm1 = curtxtr)
			{
				if (ebvm3 = "")
					{
						fe_curtxt= %ebvm2%
						ebvm3= %ebvm2%
						stringreplace,SysLLst,SysLLst,%A_LoopField%,%A_LoopField%=%ebvm3%`n
					}
				stringreplace,curtxt,ebvm3,-,_,All
				break
			}
		}
	*/ 		
Loop, Parse, PGCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = curtxt)
			{
				iniread,pgsnid,PGcfg.ini,GLOBAL,%curtxt%
				Loop,parse,pgsnid,|
					{
						if (A_LoopField = curtxt)
							{
								curtxt=
								SB_SetText("Current system is already in the playlist.")
								LV_Modify(RowNumber, "-Select")
								curtxt=
								return
							}
					}
			}
	}
if (curtxt = "other")
	{
		SB_SetText("Define OTHER")
		curtxt=
		return
	}
stringreplace,curstxt,curtxt,-,_,All
fesn= %curtxt%
krbz= %curtxt%
Loop,paRSe,sysllst,`n`r
	{
		if (a_loopfield = "")
			{
				continue
			}
			stringsplit,fesplkrbz,A_LoopField,=
			if (fesplkrbz1 = curtxt)
				{
					fesn= %fesplkrbz3%
					break
				}
	}
if (krbz <> "")
	{
		inemuinp= 
		inra= 
		ingr= 
		iniread,emuinp,Assignments.ini,OVERRIDES,%krbz%
		if ((emuinp <> "")&&(emuinp <> "ERROR"))
			{
				Loop,parse,emuinp,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						if (A_Index = 1)
							{
								ingr= %A_LoopField%
								ifinstring,ingr,_libretro
									{
										inra= 1
										inemuinp= retroarch||
										continue
									}
								inemuinp=%ingr%||
								continue
							}
						inemuinp.= ingr . "|"	
					}
			}
			else {
				iniread,emuinx,EmuCfgPresets.ini,%krbz%,SUPEMU
				if ((emuinx <> "")&&(emuinx <> "ERROR"))
					{
						loop,parse,emuinx,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								INIREAD,TBST,Assignments.ini,ASSIGNMENTS,%A_LoopField%
								if ((tbst = "ERROR")or(tbst = ""))
									{
										continue
									}
								if !instr(inemuinp,A_LoopField)
									{
										if (inemuinp = "")
											{
												inemuinp= %A_LoopField%||
												continue
											}
										inemuinp.= A_LoopField . "|"
									}
							}
					}
					else {
						iniread,emuinc,EmuCfgPresets.ini,%krbz%,SUPCORE
						if ((emuinc <> "")&&(emuinc <> "ERROR"))
							{
								loop,parse,emuinc,|
									{
										if (A_LoopField = "")
											{
												continue
											}
										ifnotexist,%raexedir%\cores\%A_LoopField%
											{
												continue	
											}
										if !instr(inemuinp,A_LoopField)
											{
												if (inemuinp = "")
													{
														inra= 1
														ingr= %A_LoopField%
														inemuinp= %A_LoopField%||
														continue
													}
												inemuinp.= A_LoopField . "|"
											}
									}
							}	
					}
			}
			if (inemuinp = "")
				{
					inemuinp= MAME - Systems||
				}
		iniread,emupxt,EmuCfgPresets.ini,%krbz%,RJROMXT
		if ((emupxt = "")or(emupxt = "ERROR"))
			{
				emupxt= .zip
			}
		iniread,emuppp,EmuCfgPresets.ini,%krbz%,FEPARAM
		iniread,evr,Assignments.ini,ASSIGNMENTS,retroarch
		;;stringreplace,emuppp,emuppp,[ROMPATH],{file.path}
		;;stringreplace,emuppp,emuppp,[ROMNAME],{file.basename}
		;;stringreplace,emuppp,emuppp,>,",All
		;"
		if (inra = 1)
			{
				emuppp= -L%A_Space%>%raexedir%\cores\%ingr%>%A_space%%emuppp%
			}
		guicontrol,,FEEDTA,%A_Space%%emuppp%
		guicontrol,,FEEDTB,%emupxt%
		guicontrol,,FEDDLG,|other|%inemuinp%%runlist%
		guicontrol,,FECBXB,%krbz%||
		guicontrol,,FECBXD,%fesn%||
		guicontrol,,FECBXC,%fesn%||
		/*
		guicontrol,,FECBXB,|%krbz%||%systmfldrs%%fesyslst%
		guicontrol,,FECBXD,|%fesn%||%fesyslst%%systmfldrs%
		guicontrol,,FECBXC,|%fesn%||%fesyslst%%systmfldrs%
		*/
	}
	else {
		;;guicontrol,,FECBXA,|%kvmax%%fesyslst%
		guicontrol,,FECBXB,|%curtxt%||%systmfldrs%%fesyslst%
		guicontrol,,FECBXD,|%curtxt%||%fesyslst%%systmfldrs%
		guicontrol,,FECBXC,|%curtxt%||%fesyslst%%systmfldrs%
		guicontrol,,FEEDTA,%a_space%>[ROMPATH]>
		guicontrol,,FEEDTB,.zip
		guicontrol,,FEDDLG,|other|%inemuinp%%runlist%
	}
return

PegasusFELBXA:
gui,submit,nohide
guicontrolget,curtxt,,FELBXA
guicontrol,,FERAD5A,0
guicontrol,,FERAD5B,0
guicontrol,,FERAD5C,0
iniread,cgpspl,Pgcfg.ini,%curtxt%
iniread,cpgfn,PGcfg.ini,%curtxt%,fullname
iniread,cpgsn,PGcfg.ini,%curtxt%,shortname
iniread,cpgpn,PGcfg.ini,%curtxt%,platformid
iniread,cpgxtn,PGcfg.ini,%curtxt%,extensions
iniread,cpgemo,PGcfg.ini,%curtxt%,emuoptions
iniread,cpgemu,PGcfg.ini,%curtxt%,emuname	
iniread,cpgsyp,PGcfg.ini,%curtxt%,syspath	
guicontrol,,fecbxb,%cpgfn%||
guicontrol,,fecbxc,%cpgpn%||
guicontrol,,fecbxd,%cpgsn%||
guicontrol,,FEEDTA,%A_SPACE%%cpgemo%
guicontrol,,FEEDTB,%cpgxtn%
guicontrol,,FEEDTB,%cpgxtn%
guicontrol,,FEDDLG,|other|%cpgemu%||%runlist%
guicontrolget,curtxtm,,FECBXD
guicontrolget,curtxtp,,FECBXC
sysfnd= 1
return

PegasusFEBUTG:
MsgBox, 260, Clear List, Are you sure you want to clear all systems from the configuration list?
ifmsgbox, Yes
	{
		PGCURPL=
		PGTOPOP=
		guicontrol,,FELBXA,|
		filedelete,PGcfg.ini
		gosub,PGINIT
	}
return

PegasusFERAD2A:
gui,submit,nohide
return

PegasusFECHKB:
return

PegasusFECHKE:
gui,submit,nohide
pgscraper= false
if (FECHKE = 1)
	{
		pgscraper= true
	}
iniwrite,%pgscraper%,PGcfg.ini,CONFIG,scraper
ifnotexist,%pghome%\settings.txt
	{
		SB_SetText("configuration must be created")
		return
	}
fileread,pgcfgf,%pghome%\settings.txt
filedelete,%pghome%\settings.txt
Loop,parse,pgcfgf,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,fez,A_LoopField,:
		if (fez1 = "providers.skraper.enabled")
			{
				fileappend,%fez1%: %pgscraper%`n,%pghome%\settings.txt
				continue
			}
		fileappend,%A_LoopField%`n,%pghome%\settings.txt
		SB_SetText(" scrapers enabled changed to " pgscraper "")
	}
return

PegasusFECHKD:
gui,submit,nohide
pgfullscreen= false
if (FECHKD = 1)
	{
		pgfullscreen= true
	}
iniwrite,%pgfullscreen%,PGcfg.ini,CONFIG,fullscreen
ifnotexist,%pghome%\settings.txt
	{
		SB_SetText("configuration must be created")
		return
	}
fileread,pgcfgf,%pghome%\settings.txt
filedelete,%pghome%\settings.txt
Loop,parse,pgcfgf,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,fez,A_LoopField,:
		if (fez1 = "general.fullscreen")
			{
				fileappend,%fez1%: %pgfullscreen%`n,%pghome%\settings.txt
				continue
			}
		fileappend,%A_LoopField%`n,%pghome%\settings.txt
		SB_SetText(" fullscreen changed to " pgfullscreen "")
	}
return

PegasusFECHKF:
gui,submit,nohide
pgDetectPlaylists= false
if (FECHKF = 1)
	{
		pgDetectPlaylists= true
	}
iniwrite,%pgDetectPlaylists%,PGcfg.ini,CONFIG,DetectPlaylists
ifnotexist,%pghome%\settings.txt
	{
		SB_SetText("configuration must be created")
		return
	}
fileread,pgcfgf,%pghome%\settings.txt
filedelete,%pghome%\settings.txt
Loop,parse,pgcfgf,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,fez,A_LoopField,:
		if (fez1 = "providers.androidapps.enabled")
			{
				fileappend,%fez1%: %pgDetectPlaylists%`n,%pghome%\settings.txt
				continue
			}
		if (fez1 = "providers.gog.enabled")
			{
				fileappend,%fez1%: %pgDetectPlaylists%`n,%pghome%\settings.txt
				continue
			}
		if (fez1 = "providers.steam.enabled")
			{
				fileappend,%fez1%: %pgDetectPlaylists%`n,%pghome%\settings.txt
				continue
			}
		if (fez1 = "providers.launchbox.enabled")
			{
				fileappend,%fez1%: %pgDetectPlaylists%`n,%pghome%\settings.txt
				continue
			}
		if (fez1 = "providers.es2.enabled")
			{
				fileappend,%fez1%: %pgDetectPlaylists%`n,%pghome%\settings.txt
				continue
			}
		fileappend,%A_LoopField%`n,%pghome%\settings.txt
		SB_SetText(" detect playlists changed to " pgDetectPlaylists "")
	}
return

PegasusFERAD2B:
return

PegasusFEDDLA:
guicontrolget,FEDDLA,,FEDDLA
goto,pg%FEDDLA%
return

PegasusFECHKA:
return

PegasusFECHKC:
return

PGOPNPL:
Loop,Parse,PGPLSWAP,|
	{
		guicontrol,%opntog%,%A_LoopField%
	}
return

PGROMROOT:
gui,submit,nohide
PGROOTFLDTMP=
SB_SetText("Current ROM folder is set to " PGROOTFLD "")
FileSelectFolder,PGROOTFLDTMP,,3,Select the ROM folder
if (PGROOTFLDTMP = "")
	{
		return
	}
stringright,efi,PGROOTFLDTMP,2
stringLeft,efix,PGROOTFLDTMP,2
if (efi = ":\")
	{
		PGROOTFLDTMP= %efix%
	}
PGROOTFLD= %PGROOTFLDTMP%
SB_SetText("Current ROM folder is set to " PGROOTFLD "")
guicontrol,,PGRRTXT, ROM Directory is SET
PGROMLST=
Loop, %PGROOTFLD%\*.*
	{
		PGROMLST.= A_LoopFileFullPath . "|"
	}
guicontrol,,ROMPOP,|%PGROMLST%
return

PGPOPCORE:
gui,submit,nohide
return

PGBackupPl:
gui,submit,nohide
return

PGSavePl:
gui,submit,nohide
SB_SetText("Creating Playlist ... ")
SYSNAME=
guicontrolget,SYSNAME,,PGPLXMP
if (SYSNAME = "")
	{
		SB_SetText("You Must have a name for your playlist.")
		return
	}
plsave=
if (plsave = "")
	{
		plsave= %PGHOME%\gamelists
	}
plstdir= %plsave%\%SYSNAME%
ifnotexist, %plstdir%
	{
		FileCreateDir,%plstdir%
	}
ControlGet,curpllst, List,,,ahk_id %insel%
existlst=
Loop, Parse,curplLst,`n`r
	{
		if (A_LoopField <> ",")
		{
			taih1=
			taih2=
			stringsplit,taih,A_LoopField,>
			existlst .= (A_Index == 1 ? "" : "|") . taih1
		}
	}
plmatch=
plsep=
plsep1=
plsep2=
coretitle=
PGPlaylistSaving:
guicontrol, disable, SVAPLST
guicontrol, disable, SVPLST
guicontrol,disable,PGPLCORE
guicontrol,disable,ROMPOP
guicontrol,disable,CURPLST
guicontrol,disable,CLRPP
guicontrol,disable,PLINIT
guicontrol,disable,MVPLOD
guicontrol,disable,MVPLOU
guicontrol,disable,CLRPL
guicontrol,disable,BRADD
guicontrol,disable,CPYPL
guicontrol,disable,REMPL
guicontrol,disable,PGSVPL
guicontrol,disable,PGOPENPL
guicontrol,disable,PGTHUMBSRCHBUT
guicontrol,disable,PGMARQSRCHBUT
guicontrol,disable,PGVIDSRCHBUT
ARCDTYP=
guicontrolget, PGPLCORE, ,PGPLCORE
if (SYSNAME = "MAME")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "MAME - Aracade")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "arcade")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "model2")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "model3")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "cps3")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "cps2")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "cps")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "neogeo")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "neocd")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "naomi")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "atomiswave")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "fba")
	{
		ARCDTYP= 1
	}
FileDelete,tmp.txt
if (PGCPYSCR = 1)
	{
		FileCreateDir, %PGHOME%\downloaded_images\%SYSNAME%
		FileCreateDir, %PGHOME%\downloaded_videos\%SYSNAME%
	}
Loop, Parse, existlst,|
	{
		TOTPTH= %PGROOTFLD%\%A_LoopField%
		splitpath,TOTPTH,romn,romind,romext,romname,romdd
		imgetn= %romname%
		if (PGPLCORE = "Fuzzy-Match")
			{
				stringsplit,romspl,romname,([
				imgetn= %romspl1%*
			}
		PGK=
		imgetb= %imgetn%
		if (PGUSESCR = 1)
			{
				PGBOXPATH= %ASSETS%\%SYSNAME%\%romname%\BoxArt
				imgetb= %imgetn%
			}
		if (PGBOXPATH = "")
			{
				PGBOX= 1
				PGBOXPATH= %PGHOME%\downloaded_images\%SYSNAME%
				imgetb= %imgetn%-image
			}
		ROMIMAGEMATCH=
		  Loop, %PGBOXPATH%\%imgetb%.*
			{
				ROMIMAGEMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMIMAGEMATCH,,,newxt
				if (PGCPYSCR = 1)
					{
						PGIMG= 1
						FileCopy, %ROMIMAGEMATCH%, %PGHOME%\downloaded_images\%SYSNAME%\%romname%-image.%newxt%
					}
				break
			}
		PGMARQ=
		imgetm= %imgetn%
		if (PGUSESCR = 1)
			{
				PGMARQUEEPATH= %ASSETS%\%SYSNAME%\%romname%\Marquees
				imgetb= %imgetn%
			}
		if (PGMARQUEEPATH = "")
			{
				PGMARQ= 1
				PGMARQUEEPATH= %PGHOME%\downloaded_images\%SYSNAME%
				imgetm= %imgetn%-marquee
			}
		ROMMARQUEEMATCH=
		Loop, %PGMARQUEEPATH%\%imgetm%.*
			{
				ROMMARQUEEMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMMARQUEEMATCH,,,newxt
				if (PGCPYSCR = 1)
					{
						PGMARQ= 1
						FileCopy, %ROMMARQUEEMATCH%, %PGHOME%\downloaded_images\%SYSNAME%\%romname%-marquee.%newxt%
					}
				break
			}
		PGTHU=
		imgett= %imgetn%
		if (PGUSESCR = 1)
			{
				PGTHUMBNAILPATH= %ASSETS%\%SYSNAME%\%romname%\Snapshots
				imgetb= %imgetn%
			}
		if (PGTHUMBNAILPATH = "")
			{
				PGTHU= 1
				PGTHUMBNAILPATH= %PGHOME%\downloaded_images\%SYSNAME%
				imgett= %imgetn%-thumb
			}
		ROMTHUMBNAILMATCH=
		Loop, %PGTHUMBNAILPATH%\%imgett%.*
			{
				ROMTHUMBNAILMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMTHUMBNAILMATCH,,,newxt
				if (PGCPYSCR = 1)
					{
						PGTHU= 1
						FileCopy, %ROMTHUMBNAILMATCH%, %PGHOME%\downloaded_images\%SYSNAME%\%romname%-thumb.%newxt%
					}
				break
			}
		PGVID=
		imgetv= %imgetn%
		if (PGUSESCR = 1)
			{
				PGVIDEOPATH= %ASSETS%\%SYSNAME%\%romname%\Videos
				imgetb= %imgetn%
			}
		if (PGVIDEOPATH = "")
			{
				PGVID= 1
				PGVIDEOPATH= %PGHOME%\download_videos\%SYSNAME%
				imgetv= %imgetn%-video
			}
		ROMVIDEOMATCH=
		Loop, %PGVIDEOPATH%\%imgetv%.*
			{
				ROMVIDEOEMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMVIDEOEMATCH,,,newxt
				if (PGCPYSCR = 1)
					{
						PGVID= 1
						FileCreateDir, %PGHOME%\downloaded_videos\%SYSNAME%\
						FileCopy, %ROMVIDEOEMATCH%, %PGHOME%\downloaded_videos\%SYSNAME%\%romname%-video.%newxt%
					}
				break
			}
		if (PGUSESCR = 1)
			{
				pulmeta=
				pulrate=
				puldate=
				pulhid=
				puldev=
				pulpub=
				pulgen=
				pulpl=
				pulkid=
				pulfav=
				metaspl1=
				metaspl2=
				metaspl3=
				Loop, %ASSETS%\%SYSNAME%\%romname%\MetaData\*.xml
					{
						fndmet=
						FileRead,metadt,%A_LoopFileFullPath%
						Loop, Parse, metadt,`n`r
							{
								if (A_LoopField = "")
									{
										continue
									}
								stringsplit,metaspl,A_LoopField,<>
								if (metaspl2 = "released")
									{
										puldate= %metaspl3%
									}
								if (metaspl2 = "developer")
									{
										puldev= %metaspl3%
									}
								if (metaspl2 = "publisher")
									{
										pulpub= %metaspl3%
									}
								if (metaspl2 = "genre")
									{
										pulgen= %metaspl3%
									}
								if (metaspl2 = "players")
									{
										pulpl= %metaspl3%
									}
								if (metaspl2 = "rating")
									{
										pulrate= %metaspl3%
									}
								if (metaspl2 = "desc")
									{
										fndmet= 1
										pulmeta.= metaspl3
										if (metaspl4 = "/desc")
											{
												fndmet=
											}
									}
							if (metaspl2 = "plot")
									{
										fndmet= 1
										pulmeta.= metaspl3
										if (metaspl4 = "/plot")
											{
												fndmet=
											}
									}
							if (metaspl2 = "overview")
									{
										fndmet= 1
										pulmeta.= metaspl3
										if (metaspl4 = "/overview")
											{
												fndmet=
											}
									}
							if (metaspl2 = "notes")
									{
										fndmet= 1
										pulmeta.= metaspl3
										if (metaspl4 = "/notes")
											{
												fndmet=
											}
									}
								if (fndmet = 1)
									{
										pulmeta.= A_LoopField . "`n"
										ifinstring, pulmeta,</desc>
											{
												fndmet=
											}
									}
							}
				break
					}
			}
		pthrom= %A_LoopField%
		if (PGVID = 1)
			{
				stringreplace,ROMVIDEOMATCH,ROMVIDEOMATCH,%PGVIDEOPATH%,/.pegasus/downloaded_videos/%SYSNAME%,All
			}
		if (PGMARQ = 1)
			{
				stringreplace,ROMMARQUEEMATCH,ROMMARQUEEMATCH,%PGMARQUEEPATH%,/.pegasus/downloaded_images/%SYSNAME%,All
			}
		if (PGTHU = 1)
			{
				stringreplace,ROMTHUMBNAILMATCH,ROMTHUMBNAILMATCH,%PGTHUMBNAILPATH%,/.pegasus/downloaded_images/%SYSNAME%,All
			}
		if (PGBOX = 1)
			{
				stringreplace,ROMIMAGEMATCH,ROMIMAGEMATCH,%PGBOXPATH%,/.pegasus/downloaded_images/%SYSNAME%,All
			}
		ifinstring,pthrom,:
			{
				stringreplace,pthrom,pthrom,%RJSYSTEMS%\%SYSNAME%\,,All
			}
		stringreplace,pthrom,pthrom,\,/,All
		romsfi= ./%romn%
		if (pulfav = "")
			{
				pulfav= false
			}
		if (pulkid = "")
			{
				pulkid= false
			}
		if (pulhid = "")
			{
				pulhid= false
			}
		FileAppend,game: %romname%`n,tmp.txt
		FileAppend,files: %romn%`n,tmp.txt
		FileAppend,assets.boxfront: %ROMIMAGEMATCH%`n,tmp.txt
		FileAppend,assets.screenshot: %ROMTHUMBNAILMATCH%`n,tmp.txt
		FileAppend,assets.marquee: %ROMBANMATCH%`n,tmp.txt
		FileAppend,assets.video: %ROMVIDMATCH%`n,tmp.txt
		FileAppend,rating: %pulrate%`n,tmp.txt
		FileAppend,release: %puldate%`n,tmp.txt
		FileAppend,developer: %puldev%`n,tmp.txt
		FileAppend,publisher: %pulpub%`n,tmp.txt
		FileAppend,description: %pulmeta%`n,tmp.txt
		FileAppend,genre: %pulgen%`n,tmp.txt
		FileAppend,players: %pulpl%`n,tmp.txt
		FileAppend,`n,tmp.txt
	}
if (PGBACKUP = 1)
	{
		FileCopy,%plstdir%\collections.pegasus.txt,%plstdir%\%SYSNAME%collections.pegasus.txt.bak,1
	}
FileCopy,tmp.txt,%plstdir%\collections.pegasus.txt,1
MsgBox,1,GameList Created,Created %plstdir%`nGamelist created.
SB_SetText(" " plstdir " gamelist created")
guicontrol, enable, SVAPLST
guicontrol, enable, SVPLST
guicontrol,enable,PGPLCORE
guicontrol,enable,ROMPOP
guicontrol,enable,CURPLST
guicontrol,enable,CLRPP
guicontrol,enable,PLINIT
guicontrol,enable,MVPLOU
guicontrol,enable,MVPLOD
guicontrol,enable,CLRPL
guicontrol,enable,BRADD
guicontrol,enable,CPYPL
guicontrol,enable,REMPL
guicontrol,enable,PGSVPL
guicontrol,enable,PGOPENPL
guicontrol,enable,PGTHUMBSRCHBUT
guicontrol,enable,PGMARQSRCHBUT
guicontrol,enable,PGVIDSRCHBUT
return

PgPlaylistNames:
gui,submit,nohide
return

PgOpenPl:
gui,submit,nohide
PGGAMLOTMP=
guicontrolget,SYSNAME,,PGPLXMP
FileSelectFile,PGGAMLOTMP,3,%pghome%\gamelists\%SYSNAME%,Select a gamelist file, gamelist (metadata*.txt)
if (PGGAMLOTMP = "")
	{
		return
	}
splitpath,PGGAMLOTMP,PGGAMLOMN,PGGAMLOD,,PGGAMLODIR
splitpath,PGGAMLOD,,,,syspfl
ifnotexist,rj\PG\%syspfl%
	{
		FileCreateDir,rj\PG\%syspfl%
	}
splitpath,PGGSAMLOD,PgGamLstF,
ifinstring,SysLLst,%syspfl%=
	{
		syssub= %gaminsl1%
	}
FileDelete,rj\PG\%syspfl%\*.ini
FileDelete,rj\PG\n.txt
PGGAMLO= %PGGAMLOTMP%
PGGAMX=
FileRead, PGGAMX,%PGGAMLO%
SB_SetText("POPULATING")
PGINIPOP=
ngame=
ren=
agame=
Loop, Parse, PGGAMX,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,:
		if (clut1 = "game")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				ren= %ngame%
				stringreplace,ren,ren,\,,All
				stringreplace,ren,ren,/,,All
				stringreplace,ren,ren,?,-,All
				stringreplace,ren,ren,<,-,All
				stringreplace,ren,ren,>,-,All
				stringreplace,ren,ren,=,-,All
				stringreplace,ren,ren,`%,-,All
				stringreplace,ren,ren,*,-,All
				stringreplace,ren,ren,:,-,All
				stringreplace,ren,ren,&#39;,',All
				stringreplace,ren,ren,&amp;,&,All
				continue
			}
		if (clut1 = "assets.boxfront")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "assets.marquee")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt
					}
				continue
			}
		if (clut1 = "assets.video")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "description")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "rating")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "release")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "assets.screenshot")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "developer")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "publisher")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "genre")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "players")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
	}
ngame.= "`n"
if (ren = "")
	{
		stringreplace,pgfpath,pgfpath,/,\,All
		splitpath,pgfpath,,,,ren
	}
incv=
inc=
INCMOVPGEG:
FileAppend,%ngame%`n,rj\PG\n.txt
fileMove,rj\PG\n.txt,rj\PG\%syspfl%\%ren%%incv%.ini
if (ERRORLEVEL > 0)
	{
		inc+=1
		incv= _%inc%
		if (inc < 10)
			{
				goto, INCMOVPGEG
			}
	}
PGINIPOP.= ren . incv . ":" . syspfl . "|"
ren=
pgfpath=
guicontrol,,CURPLST,|%PGINIPOP%
SB_SetText("COMPLETE")
opltog= hide
gosub, REMSYSTOG
opntog= show
gosub, PGOPNPL
return

PGCPYSCR:
gui,submit,nohide
return

PGUSESCR:
gui,submit,nohide
guicontrol,disable,PGCPYSCR
if (PGUSESCR = 1)
{
guicontrol,enable,PGCPYSCR
return
}
guicontrol,,PGCPYSCR,0
return

PGMARQSRCHBUT:
gui,submit,nohide
PGMARQUEEPATHTMP=
FileSelectFolder,PGMARQUEEPATHTMP,,3,Select the path to banners for this system
if (PGMARQUEEPATHTMP = "")
	{
		if (PGMARQUEEPATH <> "")
			{
				MsgBox,260,Reset Maquee Path,Would you like to clear the current banner path?
				ifmsgbox,OK
					{
						PGMARQUEEPATH=
						SB_SetText("Marquee path cleared")
						guicontrol,,PGMRQCHK,0
					}
			}
		return
	}
stringright,efi,PGMARQUEEPATHTMP,2
stringLeft,efix,PGMARQUEEPATHTMP,2
if (efi = ":\")
	{
		PGMARQUEEPATHTMP= %efix%
	}	
PGMARQUEEPATH= %PGMARQUEEPATHTMP%
SB_SetText("Marquee path set to " PGMARQUEEPATH " ")
guicontrol,,PGMRQCHK,1
return

PGVIDSRCHBUT:
gui,submit,nohide
PGVIDEOPATHTMP=
FileSelectFolder,PGVIDEOPATHTMP,,3,Select the path to videos for this system
if (PGVIDEOPATHTMP = "")
	{
		if (PGVIDEOPATH <> "")
			{
				MsgBox,260,Reset Video Path,Would you like to clear the current Video path?
				ifmsgbox,OK
					{
						PGVIDEOPATH=
						SB_SetText("VIDEO path cleared")
						guicontrol,,PGVIDCHK,0
					}
			}
		return
	}
stringright,efi,PGVIDEOPATHTMP,2
stringLeft,efix,PGVIDEOPATHTMP,2
if (efi = ":\")
	{
		PGVIDEOPATHTMP= %efix%
	}	
PGVIDEOPATH= %PGVIDEOPATHTMP%
SB_SetText("VIDEO path set to " PGVIDEOPATH " ")
guicontrol,,PGVIDCHK,1
return

PGTHUMBSRCHBUT:
gui,submit,nohide
PGTHUMBNAILPATHTMP=
FileSelectFolder,PGTHUMBNAILPATHTMP,,3,Select the path to thumbnails for this system
if (PGTHUMBNAILPATHTMP = "")
	{
		if (PGTHUMBNAILPATH <> "")
			{
				MsgBox,260,Reset Thumnails Path,Would you like to clear the current thumbnail path?
				ifmsgbox,OK
					{
						PGTHUMBNAILPATH=
						SB_SetText("thumbnail path cleared")
						guicontrol,,PGTHMBCHK,0
					}
			}
		return
	}
stringright,efi,PGTHUMBNAILPATHTMP,2
stringLeft,efix,PGTHUMBNAILPATHTMP,2
if (efi = ":\")
	{
		PGTHUMBNAILPATHTMP= %efix%
	}	
PGTHUMBNAILPATH= %PGTHUMBNAILPATHTMP%
SB_SetText("Thumbnails path set to " PGTHUMBNAILPATH " ")
guicontrol,,PGTHMBCHK,1
return

PGBOXSRCHBUT:
gui,submit,nohide
PGBOXPATHTMP=
FileSelectFolder,PGBOXPATHTMP,,3,Select the path to boxarts for this system
if (PGBOXPATHTMP = "")
	{
		if (PGBOXPATH <> "")
			{
				MsgBox,260,Reset Box-Art Path,Would you like to clear the current Box-Art path?
				ifmsgbox,OK
					{
						PGBOXPATH=
						SB_SetText("Box-Art path cleared")
						guicontrol,,PGBOXCHK,0
					}
			}
		return
	}
stringright,efi,PGBOXPATHTMP,2
stringLeft,efix,PGBOXPATHTMP,2
if (efi = ":\")
	{
		PGBOXPATHTMP= %efix%
	}	
PGBOXPATH= %PGBOXPATHTMP%
SB_SetText("Box-Art path set to " PGBOXPATH " ")
guicontrol,,PGBOXCHK,1
return

PGPopDownloads:
gui,submit,nohide
LNKLSTP=
guicontrolget,PGDWNLPOS,,PGDWNLPOS
guicontrol,,ROMPOP,|
if (PGRPOPPL = 1)
	{
		guicontrol,,PGPLXMP,|%PGDWNLPOS%||%PGPLPLST%%pgcommon%%systmfldrs%
		Loop, %CMIRLOC%\%PGDWNLPOS%\*.lnk,,1
			{
				LNKLSTP.= A_LoopFileFullPath . "|"
			}
		PGROOTFLD= %CMIRLOC%\%PGDWNLPOS%
		stringreplace,LNKLSTP,LNKLSTP,%PGROOTFLD%\,,All
		guicontrol,,ROMPOP,|%LNKLSTP%
		return
	}
if (PGRPOPDL = 1)
	{
		guicontrol,,PGPLXMP,|%PGDWNLPOS%||%PGPLPLST%%pgcommon%%systmfldrs%
		Loop, %RJSYSTEMS%\%PGDWNLPOS%\*.bat,,1
			{
				LNKLSTP.= A_LoopFileFullPath . "|"
			}
		PGROOTFLD= %RJSYSTEMS%\%PGDWNLPOS%
		stringreplace,LNKLSTP,LNKLSTP,%PGROOTFLD%\,,All
		guicontrol,,ROMPOP,|%LNKLSTP%
		return
	}
if (PGRPOPROM = 1)
	{
		guicontrol,,PGPLXMP,|%PGDWNLPOS%||%PGPLPLST%%pgcommon%%systmfldrs%
		IniRead,sysexlst,emuCfgPresets.ini,%PGDWNLPOS%,RJROMXT
		if (sysexlst = "ERROR")
			{
				sysexlst= .*
			}
		Loop,Parse,sysexlst,`,
			{
				Loop, %RJSYSTEMS%\%PGDWNLPOS%\*%A_LoopField%,,1
					{
						LNKLSTP.= A_LoopFileFullPath . "|"
					}
			}
		PGROOTFLD= %RJSYSTEMS%\%PGDWNLPOS%
		stringreplace,LNKLSTP,LNKLSTP,%PGROOTFLD%\,,All
		guicontrol,,ROMPOP,|%LNKLSTP%
		return
	}
return

PGRPopJ:
gui,submit,nohide
RPDND=
guicontrol,hide,PGMIRSEL
guicontrol,hide,PGRRTXT
guicontrol,hide,PGROMROOT
guicontrol,,PGPLXMP,|%PGPLPLST%%pgcommon%%systmfldrs%
guicontrol,,PGDWNLPOS,|%systmfldrs%
guicontrol,,ROMPOP,|
return

PGRPopMir:
gui,submit,nohide
gosub, PGMIRSEL
RPDND=
guicontrol,show,PGMIRSEL
guicontrol,hide,PGRRTXT
guicontrol,hide,PGROMROOT
guicontrol,,PGPLXMP,|%PGPLPLST%%pgcommon%%systmfldrs%
guicontrol,,ROMPOP,|
return

PGRPopRom:
gui,submit,nohide
RPDND=
guicontrol,,PGDWNLPOS,|
guicontrol,show,PGRRTXT
guicontrol,show,PGROMROOT
guicontrol,hide,PGMIRSEL
guicontrol,,PGDWNLPOS,|%systmfldrs%
stringleft,pgptr,PGPLPLST,1
if (pgptr = "|")
	{
		stringtrimleft,PGPLPLST,PGPLPLST,1
	}
guicontrol,,PGPLXMP,|%PGPLPLST%%pgcommon%
guicontrol,,ROMPOP,|
if (PGROOTFLD = "")
	{
		SB_SetText("ROM FOLDER IS NOT SET")
		return
	}
splitpath,PGROOTFLD,PGRFLN
SB_SetText("Current ROM folder is set to " PGROOTFLD "")
PGROMLST=
Loop, %PGROOTFLD%\*.*
	{
		if (A_LoopFileName = "")
			{
				continue
			}
		PGROMLST.= A_LoopFileFullPath . "|"
	}
guicontrol,,ROMPOP,|%PGROMLST%
return

PGMIRSEL:
gui,submit,nohide
guicontrolget,PGMIRSEL,,PGMIRSEL
iniread,CMIRLOC,Settings.ini,GLOBAL,%PGMIRSEL%
if (CMIRLOC = "ERROR")
	{
		SB_SetText("Mirrors must be created using the ''Mirrored_links'' dropdown of the Frontends tab.")
		return
	}
MIRLSTLOC=
Loop, %CMIRLOC%\*,2
	{
		if (A_LoopFileName = "")
			{
				continue
			}
		if (A_Index = 1)
			{
				GMIR= %A_LoopFileName%
			}
		MIRLSTLOC.= A_LoopFileName . "|"
	}
guicontrol,,PGDWNLPOS,|%GMIR%||%MIRLSTLOC%
return

PGTHUMBBUT:
gui,submit,nohide
PGTHTMP=
FileSelectFile,PGTHTMP,3,,Select a Thumbnail
if (PGTHTMP = "")
	{
		return
	}
pgpethumbnail= %PGTHTMP%
stringreplace,pgpethumbnailx,pgpethumbnail,\,/,All
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "thumbnail")
			{
				PGREPL.= "<thumbnail>" . pgpethumbnailx . "</thumbnail>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
imgprev= %pgpethumbnail%
guicontrol,,PGTHUMBP,%pgpethumbnail%
return

PGMARQBUT:
gui,submit,nohide
PGTHTMP=
FileSelectFile,PGTHTMP,3,,Select a marquee
if (PGTHTMP = "")
	{
		return
	}
pgpemarquee= %PGTHTMP%
stringreplace,pgpemarqueex,pgpemarquee,\,/,All
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "marquee")
			{
				PGREPL.= "<marquee>" . pgpemarqueex . "</marquee>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
imgprev= %pgpemarquee%
guicontrol,,PGMARQPTHTXT,%pgpemarquee%
return

PGVIDBUT:
gui,submit,nohide
PGTHTMP=
FileSelectFile,PGTHTMP,3,,Select a video
if (PGTHTMP = "")
	{
		return
	}
pgpevideo= %PGTHTMP%
stringreplace,pgpevideo,pgpevideo,\,/,All
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "video")
			{
				PGREPL.= "<video>" . pgpevideo . "</video>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
guicontrol,,PGVIDPTHTXT,%pgpevideo%
return

PGIMGBUT:
gui,submit,nohide
PGTHTMP=
FileSelectFile,PGTHTMP,3,Select a image
if (PGTHTMP = "")
	{
		return
	}
pgpeimage= %PGTHTMP%
stringreplace,pgpeimagex,pgpeimage,\,/,All
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "image")
			{
				PGREPL.= "<image>" . pgpeimagex . "</image>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
imgprev= %pgpeimage%
guicontrol,,PGOPNIMGPTHTXT,%pgpeimage%
return

PGDESCEDT:
gui,submit,nohide
guicontrolget,pgpedesc,,PGDESCEDT
stringreplace,pgpedesc,pgpedesc,`n,[CR],All
stringreplace,pgpedesc,pgpedesc,[CR][CR][CR],[CR],All
stringreplace,pgpedesc,pgpedesc,[CR][CR],[CR],All
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "desc")
			{
				PGREPL.= "<desc>" . pgpedesc . "</desc>" . "`n"
				continue
			}
		if (clut2 = "plot")
			{
				PGREPL.= "<desc>" . pgpedesc . "</desc>" . "`n"
				continue
			}
		if (clut2 = "overview")
			{
				PGREPL.= "<desc>" . pgpedesc . "</desc>" . "`n"
				continue
			}
		if (clut2 = "notes")
			{
				PGREPL.= "<desc>" . pgpedesc . "</desc>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
return

PGNAMEDT:
gui,submit,nohide
ControlGet,curpllst, List,,,ahk_id %insel%
PGRNMCHK:
guicontrolget,pgpename,,PGNAMEDT
stringreplace,PGINIPOP,PGINIPOP,%gamesel%:,%pgpename%:
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "name")
				{
				PGREPL.= "<name>" . pgpename . "</name>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
gui,submit,nohide
guicontrolget,pgrnmchk,,PGNAMEDT
if (pgrnmchk <> pgpename)
	{
		goto, PGRNMCHK
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
gamesel:= pgpename
FileAppend,%PGGAMP%,rj\PG\%syssub%\%pgpename%.ini
guicontrol,,CURPLST,|%PGINIPOP%
return

PGPTHEDT:
gui,submit,nohide
guicontrolget,pgpepath,,PGPTHEDT
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "path")
			{
				PGREPL.= "<path>" . pgpepath . "</path>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
return

PGPUBEDT:
gui,submit,nohide
guicontrolget,pgpepublisher,,PGPUBEDT
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "publisher")
			{
				PGREPL.= "<publisher>" . pgpepublisher . "</publisher>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
return

PGGENEDT:
gui,submit,nohide
guicontrolget,pgpegenre,,PGGENEDT
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "genre")
			{
				PGREPL.= "<genre>" . pgpegenre . "</genre>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
return

PGDEVEDT:
guicontrolget,pgpedeveloper,,PGDEVEDT
gui,submit,nohide
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "developer")
			{
				PGREPL.= "<developer>" . pgpedeveloper . "</developer>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
return

PGRLSDG:
return

PGDDPLNUM:
gui,submit,nohide
guicontrolget,PGDDPLNUM,,PGDDPLNUM
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "players")
			{
				PGREPL.= "<players>" . PGDDPLNUM . "</players>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
		}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
guicontrol,,PGDDPLNUM,%PGDDPLNUM%
return

PGRATSLD:
gui,submit,nohide
ERATTSLD=
PGREPL=
guicontrolget,PGRATSLD,,PGRATSLD
PGRATSLD:= (PGRATSLD / 10)
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "rating")
			{
				PGREPL.= "rating: " . PGRATSLD . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
return

PGEDTPOP:
vvi1=
vvi2=
stringsplit,vvi,CURPLST,:
if (vvi1 = "")
	{
		return
		gamesel=
	}
syssub= %vvi2%
if (gamesel <> vvi1)
	{
		if (vvi1 <> "")
			{
				if (gamesel <> "")
					{
						FileDelete,rj\PG\%syssub%\%gamesel%.ini
						FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
					}
			}
		gamesel=
	}
if (crpln <> 1)
	{
		guicontrol,,PGFAV,0
		guicontrol,,PGKIDG,0
		guicontrol,,PGHIDDEN,0
		guicontrol,,PGPUBEDT,
		guicontrol,,PGDEVEDT,
		guicontrol,,PGGENEDT,
		guicontrol,,PGPTHEDT,
		guicontrol,,PGNAMEDT,
		guicontrol,,PGRATSLD,
		guicontrol,,PGTHUMBP,
		guicontrol,,PGOPNIMGPTHTXT,
		guicontrol,,PGVIDPTHTXT,
		guicontrol,,PGMARQPTHTXT,
		guicontrol,,PGDDPLNUM,|1||2|3|4|5|6|7|8
		guicontrol,,PGDESCEDT,
		return
	}
gamesel:= vvi1
FileRead,PGGAMP,rj\PG\%syssub%\%gamesel%.ini
Loop, Parse, PGGAMP,`n`r
	{
		cmpl=
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,:
		if (clut1 = "name")
			{
				pgpepublisher=
				pgpedeveloper=
				pgpegenre=
				pgpepath=
				pgpename=
				pgperating=
				pgpethumbnail=
				pgpeimage=
				pgpevideo=
				pgpemarquee=
				pgpelayers=
				pgpedesc=
				pgpekidg= 0
				pghide= 0
				pgpefav= 0
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ren.= fprt
					}
				stringreplace,ren,ren,&#39;,',All
				stringreplace,ren,ren,&amp;,&,All
				pgpename= %ren%
				continue
			}
		if (clut1 = "assets.boxfront")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgpeimage.= fprt
					}
				stringreplace,pgpeimagex,pgpeimage,/,\,All
				continue
			}
		if (clut1 = "assets.screenshot")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgpethumbnail.= fprt
					}
				stringreplace,pgpethumbnailx,pgpethumbnail,/,\,All
				continue
			}
		if (clut1 = "assets.marquee")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgpemarquee.= fprt
					}
				stringreplace,pgpemarqueex,pgpemarquee,/,\,All
				continue
			}
		if (clut1 = "assets.video")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgpevideo.= fprt
					}
				stringreplace,pgpevideox,pgpevideo,/,\,All
				continue
			}
		if (clut1 = "description")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgpedesc.= fprt
					}
				stringreplace,pgpedeedt,pgpedesc,&#39;,',All
				stringreplace,pgpedeedt,pgpedeedt,&amp;,&,All
				continue
			}
		if (clut1 = "rating")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgperating.= fprt
					}
				pgperating= %clut3%
				pgperatsld:= (pgperating * 10)
				continue
			}
		if (clut1 = "release")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgpereleasedate.= fprt
					}
				continue
			}
		if (clut1 = "developer")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgpedeveloper.= fprt
					}
				continue
			}
		if (clut1 = "publisher")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgpepublisher.= fprt
					}
				continue
			}
		if (clut1 = "genre")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgpegenre.= fprt
					}
				continue
			}
		if (clut2 = "players")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						pgpeplayers.= fprt
					}
				continue
			}
	}
guicontrol,,PGPUBEDT,%pgpepublisher%
guicontrol,,PGDEVEDT,%pgpedeveloper%
guicontrol,,PGGENEDT,%pgpegenre%
stringreplace,systid,syssub,_,,All
pgperpath= %pgpepath%
guicontrol,,PGNAMEDT,%ren%
guicontrol,,PGRATSLD,%pgperatsld%
guicontrol,,PGTHUMBP,%pgpethumbnailx%
guicontrol,,PGOPNIMGPTHTXT,%pgpeimagex%
guicontrol,,PGVIDPTHTXT,%pgpevideox%
guicontrol,,PGMARQPTHTXT,%pgpemarqueex%
guicontrol,,PGDDPLNUM,%pgpelayers%||1|2|3|4|5|6|7|8
guicontrol,,PGDESCEDT,%pgpedeedt%
if (pgpename = "")
		{
			stringreplace,pgptmp,pgpepath,/,\,All
			splitpath,pgptmp,,,,pgpename
		}
splitpath,pgptmp,,,,pgpename
PGGAMTMP=
PGGAMTMP.= "game: " . pgpename . "`n"
PGGAMTMP.= "files: " . pgpepath . "`n"
PGGAMTMP.= "boxfront: " . pgpeimage . "`n"
PGGAMTMP.= "assets.marquee: " . pgpemarquee . "`n"
PGGAMTMP.= "assets.video: " . pgpevideo . "`n"
PGGAMTMP.= "description: " . pgpedesc . "`n"
PGGAMTMP.= "assets.boxfront: " . pgpethumbnail . "`n"
PGGAMTMP.= "developer: " . pgpedeveloper . "`n"
PGGAMTMP.= "publisher: " . pgpepublisher . "`n"
PGGAMTMP.= "genre: " . pgpegenre . "`n"
PGGAMTMP.= "release: " . pgpereleasedate . "`n"
PGGAMTMP.= "rating: " . pgperating . "`n"
PGGAMP= %PGGAMTMP%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
return

PGSAVEOPL:
guicontrol,,CURPLST,|
gamesel=
curtxt=
PGGAMP=
gosub, curplst
gui,submit,nohide
guicontrol,,PGFAV,0
guicontrol,,PGKIDG,0
guicontrol,,PGHIDDEN,0
guicontrol,,PGPUBEDT,
guicontrol,,PGDEVEDT,
guicontrol,,PGGENEDT,
guicontrol,,PGPTHEDT,
guicontrol,,PGNAMEDT,
guicontrol,,PGRATSLD,
guicontrol,,PGTHUMBP,
guicontrol,,PGOPNIMGPTHTXT,
guicontrol,,PGVIDPTHTXT,
guicontrol,,PGMARQPTHTXT,
guicontrol,,PGDDPLNUM,|1||2|3|4|5|6|7|8
guicontrol,,PGDESCEDT,
FileMove,%PGHOME%\gamelists\%syssub%\collections.pegasus.txt,%PGHOME%\gamelists\%syssub%\collections.pegasus.txt.bak,1
FileDelete,rj\PG\%syssub%\collections.pegasus.txt
ControlGet,curpllst, List,,,ahk_id %insel%
stringreplace,curpllst,curpllst,`n,|,All
Loop, rj\PG\%syssub%\*.ini
	{
		splitpath,A_LoopField,,,,ftap1
		fileread,ftap,%A_LoopFileFullPath%
		FileAppend,%ftap%,rj\PG\%syssub%\gamelist.xml
	}
FileAppend,`n,rj\PG\%syssub%\gamelist.xml
FileMove,rj\PG\%syssub%\collections.pegasus.txt,%PGHOME%\gamelists\%syssub%\collections.pegasus.txt,1
Msgbox,1,CREATED,%syssub% gamelist created.,5
gamesel=
guicontrol,,CURPLST,|
FileDelete,rj\PG\%syssub%\*.ini
return

PGROMADDBUT:
gui,submit,nohide
gamesel=
curtxt=
guicontrol,,PGNAMEDT,
guicontrol,,PGPTHEDT,
guicontrol,,PGDESCEDT,
guicontrol,,PGPUBEDT,
guicontrol,,PGDEVEDT,
guicontrol,,PGGENEDT,
presel= %RJSYSTEMS%\%syssub%
PGROMRSEL:
PGTHTMP=
FileSelectFile,PGTHTMP,3,,Select a ROM
if (PGTHTMP = "")
	{
			if ((presel = "") && (PGTHTMP = ""))
			{
				return
			}
		presel=
		goto, PGROMRSEL
return
	}
pgpepath= %PGTHTMP%
splitpath,pgpepath,pgpefile,,,pgpepnam
gamesel= %pgpepnam%
if (syssub = "")
	{
		guicontrolget,syssub,,PGPLXMP
	}
PGINIPOP.= gamesel . ":" . syssub . "|"
FileAppend,game: %pgpepnam%`n,rj\PG\%syssub%\%gamesel%.ini
FileAppend,file: %pgpefile%`n,rj\PG\%syssub%\%gamesel%.ini
pgperpath= %pgpepath%
guicontrol,,PGPTHEDT,%pgpepath%
stringreplace,systid,syssub,_
stringreplace,pgperpath,pgpepath,%RJSYSTEMS%\%systid%,.,All
if (epserpath <> pgpepath)
	{
		stringreplace,pgperpath,pgperpath,\,/,All
		guicontrol,,PGPTHEDT,%pgperpath%
	}
guicontrol,,PGNAMEDT,%pgpepnam%
guicontrol,,CURPLST,|%PGINIPOP%
gosub, CURPLST
return

PGFLDADDBUT:
gui,submit,nohide
gamesel=
curtxt=
guicontrol,,PGNAMEDT,
guicontrol,,PGPTHEDT,
guicontrol,,PGDESCEDT,
guicontrol,,PGPUBEDT,
guicontrol,,PGDEVEDT,
guicontrol,,PGGENEDT,
presel= %RJSYSTEMS%\%syssub%
PGFLDRSEL:
PGTHTMP=
FileSelectFolder,PGTHTMP,*%presel%,3,Select a FOLDER
sysrepth= %syssub%
if (PGTHTMP = "")
	{
		if ((presel = "") && (PGTHTMP = ""))
			{
				return
			}
		presel=
		goto, PGFLDRSEL
	}
stringright,efi,PGTHTMP,2
stringLeft,efix,PGTHTMP,2
if (efi = ":\")
	{
		PGTHTMP= %efix%
	}	
pgperpath= %PGTHTMP%
splitpath,pgperpath,,,,pgpepnam
ifnotinstring,syssub,%pgperpnam%
	{
		sysrrepth= %pgperpnam%
	}
stringreplace,systid,syssub,_,,All
stringreplace,pgperpath,pgperpath,%RJSYSTEMS%\%systid%,,All
stringreplace,pgperpath,pgperpath,%RJSYSTEMS%\%sysrepth%,,All
if (pgperpath <> PGTHTMP)
	{
		stringreplace,pgperpath,pgperpath,\,/,All
		pgperpath= .%pgperpath%
	}
gamesel= %pgperpnam%
if (syssub = "")
	{
		guicontrolget,syssub,,PGPLXMP
	}
PGINIPOP.= gamesel . ":" . syssub . "|"
FileAppend,<folder>`n,rj\PG\%syssub%\%gamesel%.ini
FileAppend,<name>%pgpepnam%</name>`n,rj\PG\%syssub%\%gamesel%.ini
FileAppend,<path>%pgpepath%</path>`n,rj\PG\%syssub%\%gamesel%.ini
FileAppend,</folder>`n,rj\PG\%syssub%\%gamesel%.ini
stringreplace,systid,syssub,_,,All
pgperpath= %pgpepath%
guicontrol,,PGPTHEDT,.%pgpepath%
stringreplace,pgperpath,pgpepath,%RJSYSTEMS%\%systid%,.,All
if (pgperpath <> pgpepath)
	{
		stringreplace,pgperpath,pgperpath,\,/,All
		guicontrol,,PGPTHEDT,%pgperpath%
	}
guicontrol,,PGNAMEDT,%pgpepnam%
guicontrol,,CURPLST,|%PGINIPOP%
gosub, CURPLST
return

PGROMPTHBUT:
jtf=
gui,submit,nohide
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "folder")
			{
				jtf= 1
			}
	}
PGTHTMP=
if (jtf = 1)
	{
		goto, PGFSFLD
	}
FileSelectFile,PGTHTMP,3,,Select a ROM
if (PGTHTMP = "")
	{
		return
	}
pgpepath= %PGTHTMP%
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "path")
			{
				PGREPL.= "<path>" . pgpepath . "</path>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
stringreplace,systid,syssub,_,,All
pgperpath= %pgpepath%
ifexist,%RJSYSTEMS%\%systid%\
	{
		stringreplace,pgperpath,pgpepath,%RJSYSTEMS%\%systid%,,All
		stringreplace,pgperpath,pgperpath,\,/,All
	}
guicontrol,,PGPTHEDT,%pgperpath%
return

PGFSFLD:
FileSelectFolder,PGTHTMP,,3,Select a path
if (PGTHTMP = "")
	{
		return
	}
stringright,efi,PGTHTMP,2
stringLeft,efix,PGTHTMP,2
if (efi = ":\")
	{
		PGTHTMP= %efix%
	}	
pgpepath= %PGTHTMP%
PGREPL=
Loop, Parse, PGGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "path")
			{
				PGREPL.= "<path>" . pgpepath . "</path>" . "`n"
				continue
			}
		PGREPL.= A_LoopField . "`n"
	}
PGGAMP= %PGREPL%
FileDelete,rj\PG\%syssub%\%gamesel%.ini
FileAppend,%PGGAMP%,rj\PG\%syssub%\%gamesel%.ini
previmg= %pgpepath%
stringreplace,systid,syssub,_,,All
pgperpath= %pgpepath%
ifexist,%RJSYSTEMS%\%systid%\
	{
		stringreplace,pgperpath,pgpepath,%RJSYSTEMS%\%systid%,,All
		stringreplace,pgperpath,pgperpath,\,/,All
	}
guicontrol,,PGPTHEDT,.%pgperpath%
return

RetroFEToggle:
gosub, FEUNPOP
RFINIT:
rfthemes=
iniread,RetroFE,apps.ini,FRONTENDS,RetroFE
if (RetroFE = "ERROR")
	{
		SB_SetText("Use the Install tab to install RetroFE.")
		guicontrol,choose,TABMENU,3
		guicontrol,,SALIST,|Frontends||Systems|Emulators|Utilities
		guicontrol,enable,SALIST
		SALIST= Frontends
		gosub, SALIST
		Guicontrol,choose,PRGINSTLBX,|5
		guicontrol, ChooseString, PRGINSTLBX,RetroFE
		return
	}
filecreateDir,rj\RF
ifnotexist,RFcfg.ini
	{
		FileAppend,[CONFIG]`n,RFcfg.ini
		FileAppend,[ORDER]`n,RFcfg.ini
		IniWrite,stretch,RFcfg.ini,CONFIG,rfxrez
		rfxrez= %A_ScreenWidth%
		IniWrite,stretch,RFcfg.ini,CONFIG,rfyrez
		rfyrez= %A_ScreenHeight%
		IniWrite,yes,RFcfg.ini,CONFIG,rfvideoen
		rfven= 1
		IniWrite,no,RFcfg.ini,CONFIG,cleantitle
		rfcleant= 1
		IniWrite,yes,RFcfg.ini,CONFIG,Fullscreen
		rffscr= 1
		IniWrite,rj,RFcfg.ini,CONFIG,theme
		rftheme= Aeon Nox
	}
splitpath,RetroFE,RFFEXE,RFPROGD
splitpath,rfprogd,,rfprog
iniread,RFHOME,rfcfg.ini,CONFIG,home_directory
if ((RFHOME = "ERROR")or(RFHOME = ""))
	{
		RFHOME= %rfprog%
		iniwrite,%RFHOME%,rfcfg.ini,CONFIG,home_directory
	}
IniRead,rfinitheme,sets\themes.set
Loop,Parse,rfinitheme,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		iniread,rft,sets\themes.set,%A_LoopField%,RFTHEME
		if (rft <> "ERROR")
			{
				rfthemes.= A_LoopField . "|"
			}
	}
Loop, %rfhome%\layouts\*,2
	{
		ifinstring,rfthemes,%A_LoopFileName%|
			{
				continue
			}
		rfthemes.= A_LoopFileName . "|"
	}
fetog= show
RFCURPL=
guicontrol,,FELBXA,|
Loop,Read,RFcfg.ini
	{
		ccpl1=
		ccpl2=
		gotsy1=
		stringsplit,ccpl,A_LoopReadLine,=
		stringsplit,gotsy,ccpl2,|
		if (ccpl1 = "[CONFIG]")
			{
				break
			}
		RFCURPL.= gotsy1 . "|"
	}
iniread,sysordr,RFcfg.ini,ORDER,system_order
if (sysordr <> "ERROR")
	{
		RFCURPL= %sysordr%
	}
insttheme=
Loop,%RFHOME%\layouts\*,2
	{
		insttheme= %A_LoopFileName%
		ifexist,%RFHOME%\layouts\rj
			{
				insttheme= rj
			}
		break
	}
cursysthemelist= %fesyslst%
avblnk=
guicontrol,,FELBXA,%RFCURPL%
IniRead, rfmirloc,RFcfg.ini,CONFIG,Mirror_Links
if (rfmirloc = "ERROR")
	{
		rfmirloc= %S_KeyDir%\mirrors
	}
IniRead, rftheme,RFcfg.ini,CONFIG,theme
if (rftheme = "ERROR")
	{
		rftheme= Aeon Nox
	}
rfcleant= 1
IniRead, rfcleantitle,RFcfg.ini,CONFIG,rfcleantitle
if (rffullscreen = "ERROR")
	{
		rfcleant= 1
		rfcleantitle= no
	}
rffscr= 1
IniRead, rffullscreen,RFcfg.ini,CONFIG,Fullscreen
if (rffullscreen = "ERROR")
	{
		rffscr= 0
		rffullscreen= no
	}
rfXREZ= %A_ScreenWidth%
rfYREZ= %A_ScreenHeight%
rfrez= %rfXREZ%x%rfYREZ%
IniRead, rfXREZt,RFcfg.ini,CONFIG,rfXREZ
if (rfXREZt = "ERROR")
	{
		rfXREZ= stretch
		rfYREZ= stretch
		rfrez= stretch
	}
IniRead, rfYREZt,RFcfg.ini,CONFIG,rfYREZ
if (rfYREZt = "ERROR")
	{
		rfYREZ= stretch
		rfXREZ= stretch
		rfrez= stretch
	}
if ((rfYREZ = "stretch") or (rfXREZ = "stretch"))
	{
		rfrez= stretch
	}
rfven= 1
IniRead, rfvideoen,RFcfg.ini,CONFIG,rfvideoen
if (rfvideoen = "ERROR")
	{
		rfven= 0
		rfvideoen= no
	}
ifnotexist,%RFHOME%\controls.conf
	{
		filecopy,sets\rfsettings.set,%RFHOME%\controls.conf
	}
ifnotexist,%RFHOME%\settings.conf
	{
		filecopy,sets\rfsettings.set,%RFHOME%\settings.conf
	}
rfsetcfg= %RFHOME%\settings.conf
gosub, rfgpsetcfg
RFGUIITEMS=FEBUTA|FEBUTB|FEBUTC|FEBUTD|FEBUTE|FEBUTF|FEBUTG|FEBUTH|FEBUTI|FEBUTJ|FEBUTK|FECBXA|FECBXB|FECBXC|FECBXD|FECHKB|FECHKC|FECHKD|FECHKE|FEDDLA|FEDDLD|FEDDLF|FEDDLG|FEEDTA|FEEDTB|FELBXA|FELVA|FEPRGA|FERAD2A|FERAD2B|FERAD5A|FERAD5B|FERAD5
rfe_tog=FEBUTA|FEBUTB|FEBUTC|FEBUTD|FEBUTE|FEBUTF|FEBUTH|FEBUTG|FEBUTI|FEBUTJ|FEBUTK|FECHKB|FECHKC|FECHKD|FECHKE|FEEDTA|FEEDTB|FEDDLD|FEDDLG|FECBXB|FECBXC|FECBXD|FECBXA|FELVA|FERAD5A|FERAD5B|FERAD5C|FERAD2A|FERAD2B|FETXTA|FETXTK|FETXTC|FETXTD|FELBXA|FETXTG|FETXTH|FETXTN|FETXTI|FETXTJ|FETXTL|FETXTM|FETXTO|FETXTP|FEPRGA
rft_entog=FEBUTA|FEBUTB|FEBUTC|FEBUTD|FEBUTE|FEBUTF|FEBUTH|FEBUTG|FEBUTI|FEBUTJ|FEBUTK|FECHKB|FECHKC|FECHKD|FECHKE|FEEDTA|FEEDTB|FEDDLD|FEDDLG|FECBXB|FECBXC|FECBXD|FECBXA|FELVA|FERAD5A|FERAD5B|FERAD5C|FERAD2A|FERAD2B|FETXTA|FETXTK|FETXTC|FETXTD|FELBXA|FETXTG|FETXTH|FETXTN|FETXTI|FETXTJ|FETXTL|FETXTM|FETXTO|FETXTP|FEPRGA
guicontrol,move,FEBUTA, x530 y28 w65 h20
guicontrol,,FEBUTA,Download
guicontrol,move,FEBUTB,x659 y473 w93 h23
guicontrol,,FEBUTB,CREATE
guicontrol,move,FEBUTC,x505 y456 w46 h17
guicontrol,,FEBUTC,delete
guicontrol,move,FEBUTD,x355 y105 w37 h19
guicontrol,,FEBUTD,. . .
guicontrol,move,FEBUTE,x262 y475 w52 h22
guicontrol,,FEBUTE,Add
guicontrol,move,FEBUTF,x704 y451 w46 h17
guicontrol,,FEBUTF,Load
guicontrol,move,FEBUTH,x261 y130 w62 h20
guicontrol,,FEBUTH,Emulator
guicontrol,move,FEBUTG,x506 y477 w46 h17
guicontrol,,FEBUTG,clear
guicontrol,move,FEBUTI,x508 y352 w18 h18
guicontrol,,FEBUTI,v
guicontrol,move,FEBUTJ,x508 y334 w18 h18
guicontrol,,FEBUTJ,^
guicontrol,move,FEBUTK,x419 y4 w18 h18
gui, font, %fontXlg% bold
guicontrol, font, FEBUTK
guicontrol,,FEBUTK,>
gui, font, %fontXmed% normal
guicontrol,move,FECHKB,x643 y424 w111 h13
guicontrol,,FECHKB,Create Backups
guicontrol,,FECHKB,1
guicontrol,move,FECHKC,x521 y55 w74 h13
guicontrol,,FECHKC,Overwrite
guicontrol,move,FECHKD,x642 y357 w120 h23
guicontrol,,FECHKD,Fullscreen
guicontrol,,FECHKD,%rffscr%
guicontrol,move,FECHKE,x642 y378 w120 h23
guicontrol,,FECHKE,Video Enabled
guicontrol,,FECHKE,%rfven%
guicontrol,move,FEEDTA,x428 y130 w145 h21
guicontrol,,FEEDTA,
guicontrol,-password,FEEDTB
guicontrol,move,FEEDTB,x578 y130 w120 h21
guicontrol,,FEEDTB,
guicontrol,move,FEDDLD,x599 y32 w162
guicontrol,,FEDDLD,|%rftheme%||%rfthemes%
guicontrol,move,FEDDLF,x324 y79 w100
guicontrol,,FEDDLF,|%rfmirloc%||
guicontrol,move,FEDDLG,x325 y130 w100
guicontrol,,FEDDLG,|other||%emuinstpop%
guicontrol,move,FECBXB,x263 y153 w217
guicontrol,,FECBXB,|%systmfldrs%
guicontrol,move,FECBXC,x263 y176 w217
guicontrol,,FECBXC,|%systmfldrs%
guicontrol,move,FECBXD,x264 y199 w217
guicontrol,,FECBXD,|%fesyslst%
guicontrol,move,FECBXA,x641 y266 w104
guicontrol,,FECBXA,|%rfrez%||stretch|%qres%
guicontrol,,FELVA,Mirrors
guicontrol,move,FELVA,x10 y64 w247 h433
Gui,ListView,FELVA
Guicontrol,-checked,FELVA
Guicontrol,-Multi,FELVA
LV_Delete()
Loop, Parse, systmfldrs,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		LV_Add("",A_LoopField)
	}
LV_ModifyCol()
guicontrol,move,FERAD5A,x701 y151 w56 h15
guicontrol,,FERAD5A, Jackets
guicontrol,,FERAD5A, 0
guicontrol,move,FERAD5B,x701 y171 w53 h15
guicontrol,,FERAD5B, Mirrors
guicontrol,,FERAD5B, 0
guicontrol,move,FERAD5C,x701 y133 w53 h15
guicontrol,,FERAD5C,ROMs
guicontrol,,FERAD5C, 1
guicontrol,move,FERAD2A,x635 y241 w62 h13
guicontrol,,FERAD2A,cleaned
guicontrol,,FERAD2A, %rfcleant%
guicontrol,move,FERAD2B,x710 y242 w50 h13
guicontrol,,FERAD2B,[]()
guicontrol,move,FETXTA,x643 y55 w110 h13
guicontrol,,FETXTA,Global Theme
guicontrol,move,FETXTB,x508 y437 w120 h15
guicontrol,,FETXTB,Remove
guicontrol,move,FETXTK,x660 y452 w45 h15
guicontrol,,FETXTK,menu.txt
guicontrol,move,FETXTC,x14 y23 w512 h16
guicontrol,,FETXTC,Mirror Location
guicontrol,move,FETXTD,x577 y220 w90 h13
guicontrol,,FETXTD,Clean Titles
guicontrol,move,FELBXA,x263 y223 w240 h251
guicontrol,move,FETXTG,x424 y478 w80 h20
guicontrol,,FETXTG, Current
guicontrol,move,FETXTH, x316 y480 w85 h19
guicontrol,,FETXTH, Add system
guicontrol,move,FETXTN,x587 y271 w50 h16
guicontrol,,FETXTN,resolution
guicontrol,move,FETXTI,x588 y115 w146 h13
guicontrol,,FETXTI, Extensions (comma sperated)
guicontrol,move,FETXTJ,x424 y82 w326 h31
guicontrol,,FETXTJ,
guicontrol,move,FETXTL,x488 y155 w62 h13
guicontrol,,FETXTL,Full-Name
guicontrol,move,FETXTM, x490 y178 w49 h13
guicontrol,,FETXTM,Platform
guicontrol,move,FETXTO, x491 y201 w49 h13
guicontrol,,FETXTO,Name
guicontrol,move,FETXTP, x441 y6 w47 h15
guicontrol,,FETXTP,Launch
guicontrol,move,FEPRGA,x15 y500 w736 h7
guicontrol,,FEPRGA,0
gosub, RFPOPULATESYS
Loop,parse,rfe_tog,|
	{
		guicontrol,%fetog%,%A_LoopField%
	}
return
Loop,parse,rft_entog,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

RetroFEFEBUTA:
guicontrolget,FEDDLD,,FEDDLD
if (FEDDLD = "")
	{
		SB_SetText("You need select a theme!")
		return
	}
rfitmt= disable
gosub,enablerfgui	
rfteo=
dwnovr= false
if (FECHKC = 1)
	{
		dwnovr= true
	}
ifexist, %RFHOME%\layouts\%FEDDLD%
	{
		rfteo= 1
		if (FECHKC = 1)
			{
				rfteo=
			}
	}
iniRead,URLFILE,sets\themes.set,%FEDDLD%,RFTHEME
iniRead,extractpthadd,sets\themes.set,%FEDDLD%,RFEXPTH
if (URLFILE = "ERROR")
	{
		SB_SetText("This theme is not available from the skeletonKey repository")
		rfitmt= enable
		gosub,enablerfgui
		return
	}
save= rj\RF\%FEDDLD%.7z
extractpath= %RFHOME%\%extractpthadd%
splitpath,save,svaf,svap
exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
filegetsize,rftsz,%save%,K
if (rftsz < 200)
	{
		SB_SetText("Download Failed")
		rfitmt= enable
		gosub,enablerfgui
		return
	}
ifnotexist,%save%
	{
		SB_SetText("Download Failed")
		rfitmt= enable
		gosub,enablerfgui
		return
	}
ovextinj=
if (FECHKC = 1)
	{
		ovextinj= -y
	}
if (rfteo = "")
	{
		RunWait, %comspec% cmd /c " "%S_KeyDir%\bin\7za.exe" x -y "%save%" -O"%extractpath%" ",,hide
	}
SB_SetText("Current theme is " RFTHEME " ")
rfitmt= enable
gosub,enablerfgui
return

enablerfgui:
Loop,parse,RFGUIITEMS,|
	{
		guicontrol,%rfitmt%,%A_LoopField%
	}
return

RetroFEFEBUTB:
rfitmt= disable
gosub, enablerfgui
guicontrolget,FEDDLF,,FEDDLF
guicontrolget,FEDDLC,,FEDDLC
guicontrolget,FEDDLD,,FEDDLD
FileCopy,%rfsetcfg%,%rfsetcfg%.bak,1
TCURPL=
IniRead,prsy,RFcfg.ini,ORDER,system_order
FileDelete,rj\RF\cursys.cfg
FileDelete,rj\RF\*.conf
ifnotexist,%rfhome%\layouts\%FEDDLD%\
	{
		SB_SetText("The current theme is not installed/downloaded.")
		rfitmt= enable
		gosub,enablerfgui
		return
	}
FileDelete,rj\RF\menu.txt
cfulld= 
Loop, Parse, prsy,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		sysfin=
		sysesc= %A_LoopField%
		IniRead,c_sysp,RFCfg.ini,%A_LoopField%,syspath
		IniRead,c_emun,RFCfg.ini,%A_LoopField%,emuname
		IniRead,c_emuo,RFCfg.ini,%A_LoopField%,emuoptions
		stringreplace,c_emuo,c_emuo,> ,",All
		;"
		stringreplace,c_emuo,c_emuo,[ROMNAME],`%ITEM_NAME`%,All
		stringreplace,c_emuo,c_emuo,[ROMPATH],`%ITEM_FILEPATH`%,All
		IniRead,c_extn,RFCfg.ini,%A_LoopField%,extensions
		IniRead,c_shrt,RFCfg.ini,%A_LoopField%,shortname
		IniRead,c_full,RFCfg.ini,%A_LoopField%,fullname
		IniRead,c_plfi,RFCfg.ini,%A_LoopField%,platformid	
		if instr(c_sysp,":")
			{
				sysplfw= %c_sysp%
				gosub, frsysit
			}
		else {
			iniread,sysplfp,SystemLocations.ini,LOCATIONS,%c_sysp%
			Loop,parse,sysplfp,|
				{
					if (A_LoopField = "")
						{
							continue
						}
					sysplfw= %A_LoopField%
					gosub, frsysit
				}
			continue
			}
	}
FileRead,rfcfg,sets\rfsettings.set
stringreplace,rfcfg,rfcfg,[THEME],%FEDDLD%,All
stringreplace,RJSYSTEMX,RJSYSTEMS,\,/,All
stringreplace,rfcfg,rfcfg,[RJSYSTEMS],%RJSYSTEMX%,All
stringreplace,rfcfg,rfcfg,[VIDEOEN],%rfvideoen%,All
stringreplace,rfcfg,rfcfg,[RFFS],%rffullscreen%,All
stringreplace,rfcfg,rfcfg,[CLEANTITLE],%rfcleantitle%,All
stringreplace,rfcfg,rfcfg,[XREZ],%rfXREZ%,All
stringreplace,rfcfg,rfcfg,[YREZ],%rfYREZ%,All
if (FECHKB = 1)
	{
		Filecopy,rj\RF\menu.txt,rj\RF\menu.txt.bak,1
		FileMove,%rfsetcfg%,%rfsetcfg%.bak,1
	}
FileDelete,%rfsetcfg%
fileappend,%rfcfg%,rj\RF\settings.conf
filecopy,rj\RF\settings.conf,%RFHOME%,%FECHKB%
filecopy,rj\RF\menu.txt,%RFHOME%\collections\Main,%FECHKB%
msgbox,,Complete,RF configuration created,5
rfitmt= enable
gosub,enablerfgui
return

frsysit:
iniread,emushrtn,apps.ini,EMULATORS,%c_emun%
ifinstring,c_emun,:
	{
		stringsplit,c_emun,emushrtn
		emunmc=
		emushrtn= %c_emun%
	}
stringreplace,injvnp,sysplfw,\,/,All
FileAppend,list.path = %injvnp%`n,rj\RF\%c_full%.settings.conf
FileAppend,list.includeMissingItems = true`n,rj\RF\%c_full%.settings.conf
stringreplace,extn,c_extn,.,,All
FileAppend,list.extensions = %extn%`n,rj\RF\%c_full%.settings.conf
FileAppend,list.menuSort = true`n,rj\RF\%c_full%.settings.conf
FileAppend,list.romHierarchy = true`n,rj\RF\%c_full%.settings.conf
FileAppend,launcher = %c_emun%`n,rj\RF\%c_full%.settings.conf
FileAppend,executable = %emushrtn%`n,rj\RF\%c_emun%.conf
FileAppend,arguments = %c_emuo%`n,rj\RF\%c_emun%.conf
ifnotinstring,cfulld,%c_full%|
{
cfulld.= c_full . "|"
FileAppend,%c_full%`n,rj\RF\menu.txt
}
RunWait,"core\retrofe.exe" -createcollection "%c_full%",%rfprog%,hide
if (FECHKB = 1)
	{
		filecopy,%RFHOME%\launchers\%c_emun%.conf,%RFHOME%\launchers\%c_emun%.conf.bak,1
	}
filemove,rj\RF\%c_emun%.conf,%RFHOME%\launchers\%c_emun%.conf,1
filemove,rj\RF\%c_full%.settings.conf,%RFHOME%\collections\%c_full%\settings.conf,1
SYSNAME= %ans1%
return

RetroFEFEBUTC:
if (sysfnd = "")
	{
		return
	}
TCURPL=
Loop, Parse, RFCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = curtnm)
			{
				inidelete,RFcfg.ini,%curtnm%
				continue
			}
		TCURPL.= A_LoopField . "|"
	}
RFCURPL= %TCURPL%
iniwrite,%RFCURPL%,RFcfg.ini,ORDER,system_order
guicontrol,,FELBXA,|%RFCURPL%
return

RetroFEFEBUTD:
selctsystmp=
FileSelectFolder,selctsystmp,,3,Select a ROM Directory for %curtxt%
if ((selctsystmp = "")&&(sysfnd = ""))
	{
		guicontrol,,FETXTJ,%selctsystmp%
		return
	}
if (sysfnd = "")
	{
		return
	}
if ((FETXTJ <> selctsystmp)&&(selctsystmp = ""))
	{
		guicontrol,,FETXTJ,
		selctsystmp= %FECBXB%
	}
iniwrite,%selctsystmp%,RFCfg.ini,%curtnm%,syspath
return	
RetroFEFEBUTE:
SNFEITMS=
NFEITMS=
FEItems=
FEItems:= LVGetCheckedItems("", "ahk_id" . FELSTVA)
IniRead,syso,RFcfg.ini,ORDER,system_order
if (syso = "ERROR")
	{
		syso=
	}
if (sysfnd = 1)
	{
		SB_SetText("Current system is already added")
		return
	}
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)  ; Resume the search at the row after that found by the previous iteration.
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
	}
Loop,parse,SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,rfnb,A_LoopField,=
		if (rfnb1 = curtxt)
			{
				curtnm= %rfnb3%
				break
			}
	}		
Loop, Parse, RFCURPL,|
	{
		if (A_LoopField = curtnm)
			{
				SB_SetText("Current system is already in the playlist.")
				return
			}
	}
PGCURPL.= curtnm . "|"
guicontrolget,FECBXC,,FECBXC
if (FECBXC = "")
	{
		FECBXC= %curtnm%
	}
guicontrolget,FECBXB,,FECBXB
if (FECBXB = "")
	{
		FECBXB= %curtxt%
	}
guicontrolget,FECBXD,,FECBXD
if (FECBXD = "")
	{
		FECBXD= %curtnm%
	}
guicontrolget,FECBXA,,FECBXA
if (FECBXA = "")
	{
		FECBXA= %curtnm%
	}
if (SLCTDSN = "")
	{
		SLCTDSN= other
	}
guicontrolget,SLCTDRW,,FEEDTA
if (SLCTDRW = "")
	{
		SB_SetText("You must desgnate an execution paramater, eg: ''[ROMPATH]''")
		return
	}
guicontrolget,SLCTDEMU,,FEDDLG
if (SLCTDEMU = "other")
	{		
		SB_SetText("You must assign an Emulator")
		return
	}
ifinstring,SLCTDEMU,_libretro.dll
	{		
		SLCTDRW= -L "%raexedir%\cores\%SLCTDEMU%" >[ROMPATH]>
		SLCTDEMU= retroarch
	}
guicontrolget,SLCTDEXT,,FEEDTB
if (SLCTDEXT = "")
	{
		SLCTDEXT= .*
	}
guicontrolget,selctsyst,,FETXTJ
if (selctsyst = "")
	{
		iniread,selctsystl,SystemLocations.ini,LOCATIONS,%fecbxb%
		if ((selctsystl = "")or(selctsystl = "ERROR"))
			{
				selctsyst= %RJSYSTEMS%
			}
			else {
				Loop,parse,selctsystl,|
					{
						selctsyst= %A_LoopField%
						break
					}
			}
	}
SLCTDRW=%A_SPACE%%SLCTDRW%
iniwrite,%fecbxb%,RFCfg.ini,%curtnm%,fullname
iniwrite,%fecbxc%,RFCfg.ini,%curtnm%,platformid
iniwrite,%fecbxd%,RFCfg.ini,%curtnm%,shortname
iniwrite,%SLCTDEXT%,RFCfg.ini,%curtnm%,extensions
iniwrite,%SLCTDRW%,RFCfg.ini,%curtnm%,emuoptions
iniwrite,%SLCTDEMU%,RFCfg.ini,%curtnm%,emuname
iniwrite,%fecbxb%,RFCfg.ini,%curtnm%,syspath
iniread,sysordr,RFCfg.ini,ORDER,system_order
if (sysordr <> "ERROR")
	{
		PGCURPL= %sysordr%%curtnm%|
	}
guicontrol,,FELBXA,|%PGCURPL%
iniwrite,%PGCURPL%,RFCfg.ini,ORDER,system_order
Gui,ListView,FELVA
LV_Modify(0, "-Check")
return

RetroFEFECBXA:
gui,submit,nohide
guicontrolget,rfresp,,FECBXA
if (rfresp = "stretch")
	{
		rfXREZ= stretch
		rfYREZ= stretch
		return
	}
stringsplit,rfpr,rfresp,x
rfXREZ= %rfpr1%
stringreplace,rfXREZ,rfXREZ,%A_Space%,,All
rfYREZ= %rfpr2%
stringreplace,rfYREZ,rfYREZ,%A_Space%,,All
if rfXREZ is not digit
	{
		guicontrol,,FECBXA,|stretch||%qres%
	}
if rfYREZ is not digit
	{
		guicontrol,,FECBXA,|stretch||%qres%
	}
guicontrol,,FECBXA,|%rfXREZ%x%rfYREZ%||stretch|%qres%
TF_replaceline("!"rfsetcfg,rf_YRNUM,rf_YRNUM,"vertical = " rfYREZ "")
TF_replaceline("!"rfsetcfg,rf_XRNUM,rf_XRNUM,"horizontal = " rfXREZ "")
iniwrite,%rfYREZ%,rfcfg.ini,CONFIG,rfYREZ
iniwrite,%rfXREZ%,rfcfg.ini,CONFIG,rfXREZ
return

RetroFEFECBXC:
if (sysfnd = "")
	{
		return
	}
guicontrolget,FECBXC,,FECBXC
guicontrolget,FECBXD,,FECBXD
iniread,rftv,RFcfg.ini,GLOBAL,%FECBXD%
avi=
kkv=
Loop, Parse, rftv,|
	{
		avi+=1
		if (avi = 1)
			{
				kkv.= FECBXC . "|"
				continue
			}
		kkv.= A_LoopField . "|"
	}
iniwrite,%kkv%,RFcfg.ini,GLOBAL,%FECBXD%
return

RetroFEFECBXD:
guicontrolget,SYSREORDER,,FELBXA
guicontrolget,SYSNAMEREP,,FECBXD
if (sysfnd = "")
	{
		return
	}
blockinput,on
iniread,sysreplace,RFcfg.ini,GLOBAL,%SYSREORDER%
inidelete,RFcfg.ini,GLOBAL,%FECBXD%
blockinput,off
FECBXD= %SYSNAMEREP%
RFRELST=
IniRead, RFQLIST,RFcfg.ini,ORDER,system_order
IniDelete,RFcfg.ini,GLOBAL,%SYSREORDER%
IniWrite,%sysreplace%,RFcfg.ini,GLOBAL,%SYSNAMEREP%
Loop, Parse, RFQLIST,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = SYSREORDER)
			{
				RFRELST.= SYSNAMEREP . "|"
			}
		RFRELST.= A_LoopField . "|"
	}
guicontrolget,FECBXD,,FECBXD
guicontrol,,FELBXA,|%RFRELST%
return

RetroFEFEDDLD:
guicontrolget,rftheme,,FEDDLD
iniwrite,%rftheme%,RFcfg.ini,CONFIG,theme
cursysthemelist=
TF_replaceline("!"rfsetcfg,rf_THNUM,rf_THNUM,"layout = "  rftheme "")
return

RetroFEFECBXB:
if (curtxt = "")
	{
		SB_SetText("You must select an added system to configure the ROM path")
		return
	}
if (sysfnd = "")
	{
		return
	}
guicontrolget,FECBXB,,FECBXB
extpop=
Loop, Read, RFcfg.ini
	{
		if (A_LoopReadLine = "[CONFIG]")
			{
				continue
			}
		extpov1=
		extpov2=
		extpon1=
		extpon2=
		stringsplit,extpov,A_LoopReadLine,=
		stringsplit,extpon,extpov2,|
		if (extpon1 = curtxt)
			{
				extpop= %extpov1%
				break
			}
	}
ifinstring,curtxt,_
	{
		extpop= %curtxt%
	}
iniread,rftv,RFcfg.ini,GLOBAL,%extpop%
avi=
kkv=
Loop, Parse, rftv,|
	{
		avi+=1
		if (avi = 2)
			{
				kkv= %A_LoopField%
				continue
			}
			kkv.= A_LoopField . "|"
	}
iniwrite,%kkv%,RFcfg.ini,GLOBAL,%extpop%
return

RFERSWIN:
FileDelete,RFcfg.ini
goto, FEDDLJ
return

RetroFEFEDDLG:
if (sysfnd = "")
	{
		return
	}
pto=
guicontrolget,FEDDLG,,FEDDLG
if (FEDDLG = "other")
	{
		pto= 1
		rfemu= other
		gosub,FEBUTH
		guicontrol,,FEDDLG,|other||%emuinstpop%
		return
	}
ifinstring,FEDDLG,_libretro.dll
	{
		iniwrite,%A_SPace%-L "%raexedir%\cores\%FEDDLG%" >[ROMPATH]>,RFCfg.ini,%curtnm%,emuoptions
		iniwrite,retroarch,RFCfg.ini,%curtnm%,emuname
	}
	else {
		iniwrite,%FEDDLG%,RFCfg.ini,%curtnm%,emuname
	}
iniread,rfemt,apps.ini,EMULATORS,%FEDDLG%
if (rfemt = "ERROR")
	{
		rfemu=
		gosub, FEBUTH
		if (rfemu = "")
			{
				return
			}
		iniwrite, "%rfemu%",apps.ini,EMULATORS,%FEDDLG%
	}
return

RetroFEFEDDLF:
guicontrolget,FEDDLF,,FEDDLF
iniread,mirtmp,Settings.ini,GLOBAL,%FEDDLF%
RFMIRROR= %mirtmp%
Gui,ListView,FELVA
LV_Delete()
Loop, %RFMIRROR%\*,2
		{
			LV_Add("",A_LoopFileName)
		}
LV_ModifyCol()
return

RetroFEFEBUTH:
guicontrolget,sysfnd,,
if (sysfnd = "")
	{
		return
	}
FileSelectFile,rfemutmp,3,,Select an emulator for %addsystm%
if (rfemutmp = "")
	{
		return
	}
rfemu= %rfemutmp%
extpop=
Loop, Read, RFcfg.ini
	{
		if (A_LoopReadLine = "[CONFIG]")
			{
				continue
			}
		extpov1=
		extpov2=
		extpon1=
		extpon2=
		stringsplit,extpov,A_LoopReadLine,=
		stringsplit,extpon,extpov2,|
		if (extpon1 = curtxt)
			{
				extpop= %extpov1%
				break
			}
	}
ifinstring,curtxt,_
	{
		extpop= %curtxt%
	}
iniread,rftv,RFcfg.ini,GLOBAL,%extpop%
avi=
kka=
kkb=
kkc=
kkd=
kke=
kkf=
Loop, Parse, rftv,|
	{
		avi+=1
		if (avi = 1)
			{
				kka= %A_LoopField%
			}
		if (avi = 2)
			{
				kkb= %A_LoopField%
			}
		if (avi = 3)
			{
				kkc= %A_LoopField%
			}
		if (avi = 4)
			{
				kkd= %rfemu%
			}
		if (avi = 5)
			{
				kke= %A_LoopField%
			}
		if (avi = 6)
			{
				kkf= %A_LoopField%
			}
		if (avi = 7)
			{
				kkg= %A_LoopField%
			}
				iniwrite,%kka%|%kkb%|%kkc%|%kkd%|%kke%|%kkf%|%kkg%,RFcfg.ini,GLOBAL,%extpop%
	}
guicontrol,,FEDDLG,|other||%emuinstpop%
return

RetroFEFEDDLC:
guicontrolget,FEDDLC,,FEDDLC
iniwrite,%FEDDLC%,RFcfg.ini,CONFIG,GameList
return

RetroFEFEBUTK:
RRFZRUN:=
SB_SetText(" " RetroFE "" RRFZRUN "")
Run, %comspec% /c "%RetroFE%"%RRFZRUN%,,hide
return

RetroFEFEBUTJ:
SB_SetText("")
iniDelete,RFcfg.ini,ORDER,system_order
newnum=
olnum=
Loop, Parse, RFCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		olnum+=1
		systmv= A_LoopField
		if (A_LoopField = curtxt)
			{
				newnum:= olnum-1
			}
	}
if (newnum = 0)
	{
		sb_settext("Cannot move up")
		return
	}
TRFCURPL=
olnum=
Loop, Parse, RFCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		olnum+=1
		if (A_LoopField = curtxt)
			{
				continue
			}
		if (olnum = newnum)
			{
				TRFCURPL.= curtxt . "|"
			}
		TRFCURPL.= A_LoopField . "|"
	}
RFCURPL= %TRFCURPL%
iniwrite,%TRFCURPL%,RFcfg.ini,ORDER,system_order
guicontrol,,FELBXA,|%RFCURPL%
return

RetroFEFESLDA:
guicontrolget,FESLDA,,FESLDA
iniwrite,%FESLDA%,RFcfg.ini,CONFIG,VRAM
rfvideoram= %FESLDA%
guicontrol,,FETXTE,VRAM Limit : %FESLDA%
return

RetroFEFEBUTI:
SB_SetText("")
iniDelete,RFcfg.ini,ORDER,system_order
mvnum=
mvtm=
Loop, Parse, RFCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		mvnum+=1
		if (A_LoopField = curtxt)
			{
				mvtm:= mvnum+1
			}
	}
totord:= mvnum
if (mvtm > totord)
	{
		SB_SetText("Cannot Move further down.")
		return
	}
TRFCURPL=
mvnum=
Loop, Parse, RFCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		mvnum+=1
		if (A_LoopField = curtxt)
			{
				continue
			}
		TRFCURPL.= A_LoopField . "|"
		if (mvtm = mvnum)
			{
				TRFCURPL.= curtxt . "|"
			}
	}
RFCURPL= %TRFCURPL%
guicontrol,,FELBXA,|%RFCURPL%
iniwrite,%TRFCURPL%,RFcfg.ini,ORDER,system_order
return

RetroFEFEBUTF:
rfcfgtmp=
FileSelectFile,rfcfgtmp,3,,Select the menu.txt,
if (rfcfgtmp = "")
	{
		return
	}
gosub,loadrfcfg
gosub, rfgpsetcfg
return

rfgpsetcfg:
FileRead,rfsetmp,%rfsetcfg%
Loop,Parse,rfsetmp,`n
	{
		stringsplit,jik,A_LoopField,=
		stringreplace,jik1,jik1,%A_Space%,,All
		if (jik1 = "fullscreen")
			{
				rf_FSNUM:= A_Index
			}
		if (jik1 = "horizontal")
			{
				rf_XRNUM:= A_Index
			}
		if (jik1 = "vertical")
			{
				rf_YRNUM:= A_Index
			}
		if (jik1 = "layout")
			{
				rf_THNUM:= A_Index
			}
		if (jik1 = "showParenthesis")
			{
				rf_PRNUM:= A_Index
			}
		if (jik1 = "showSquareBrackets")
			{
				rf_BRNUM:= A_Index
			}
		if (jik1 = "videoEnable")
			{
				rf_VENUM:= A_Index
			}
	}
return

loadrfcfg:
RFLDPL=
LOADEDCFG=
RFTOPOP=
Loop, read, %rfcfgtmp%
	{
		if (A_LoopReadline = "")
			{
				continue
			}
		ldsy=
		FileRead,ccfj,%RFHOME%\collections\%A_LoopReadLine%\settings.conf
		Loop,parse,ccfj,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				ldsy= %A_LoopReadLine%
				loop,parse,rflkup,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringreplace,ldsn,ldsy,%A_Space%,,All
						stringreplace,ldsn,ldsn,-,,All
						stringsplit,kkr,A_LoopField,=
						if (kkr2 = ldsy)
							{
								ldsn= %kkr1%
								break
							}
					}
				stringsplit,arj,A_LoopField,=
				ldpn= %RJSYSTEMS%\%ldsy%
				if (arj1 = "list.path")
					{
						ldpn= %arj2%
					}
				ldxt= .zip,.bin
				if (arj1 = "list.extensions")
					{
						ldxt= %arj2%
					}
				if (arj1 = "launcher")
					{
						ldln= %arj2%
						ifinstring,ldln,.exe
							{
								splitpath,ldln,,,ldlnn
								ldln= %ldlnn%
							}
						ldqn= "%ITEM_FILEPATH%"
						fileread,fin,%RFHOME%\launchers\%ldln%.conf
						loop,parse,fin,`n`r
							{
								if (A_LoopField = "")
									{
										continue
									}
								stringsplit,fjf,A_LoopField,=
								if (fjf1 = "arguments")
									{
										ldqn= %fjf2%
									}
							}
					}
			}
		RFTOPOP.= fjf1 . "|"
		LOADEDCFG.= ldsy . "=" . ldsn . "|" . ldsy . "|" . ldxt . "|" . ldln . "|" . ldqn . "|" . ldpn . "|" . ldsn . "`n"
	}
iniwrite, %LOADEDCFG%,rj\RF\loadsys.ini,GLOBAL
iniwrite,%rffullscreen%,rj\RF\loadsys.ini,CONFIG,FullScreen
iniwrite,%rfvideoen%,rj\RF\loadsys.ini,CONFIG,rfvideoen
iniwrite,%rftheme%,rj\RF\loadsys.ini,CONFIG,theme
iniwrite,%RFHOME%,rj\RF\loadsys.ini,CONFIG,home_directory
guicontrol,,FELBXA,|%RFTOPOP%
iniwrite,%RFTOPOP%,rj\RF\loadsys.ini,ORDER,system_order
RFCURPL= %RFTOPOP%
fileCopy,RFcfg.ini,RFcfg.ini.bak,1
fileMove,rj\RF\loadsys.ini,RFcfg.ini,1
return

RetroFEFEEDTA:
guicontrolget,FEEDTA,,FEEDTA
if (sysfnd = "")
	{
		return
	}
newemuopts= %FEEDTA%
iniwrite,%A_Space%%newemuopts%,RFCfg.ini,%curtnm%,emuoptions
return

RetroFEFEEDTB:
if (sysfnd = "")
	{
		return
	}
guicontrolget,FEEDTB,,FEEDTB
extpop=
iniwrite,%FEEDTB%,RFcfg.ini,%curtnm%,extensions
return

RetroFEFERAD5A:
guicontrol,,FEEDTB,.bat
guicontrol,,FEDDLG,|bsl||%runlist%
return

RetroFEFERAD5B:
guicontrol,,FEEDTB,.lnk
guicontrol,,FEDDLG,|bsl||%runlist%
return

RetroFEFERAD5C:
rfpopem= 
iniread,allxtn,EmuCfgPresets.ini,%curtxt%,RJROMXT
iniread,rfemuas,Assignments.ini,OVERRIDES,%curtxt%
if (rfemuas = "")
	{
		iniread,rfemudef,EmuCfgPresets.ini,%curtxt%,SUPEMU
		Loop,parse,rfemudef,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				iniread,rfapx,Apps.ini,Emulators,%A_LoopField%
				if ((rfapx <> "ERROR")&&(rfapx <> ""))
					{	
						if (rfpopem = "")
							{
								rfpopem.= A_LoopField . "||"
								continue
							}
						rfpopem.= A_LoopField . "|"
					}
			}
	}
	else {
		Loop,parse,rfemuas,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (rfpopem = "")
					{
						rfpopem.= A_LoopField . "||"
						continue
					}
				rfpopem.= A_LoopField . "|"
			}
	}
guicontrol,,FEDDLG,|%rfpopem%%runlist%
guicontrol,,FEEDTB,%allxtn%
return

RFPOPULATESYS:
Gui,ListView,FELVA
Guicontrol,-checked,FELVA
Guicontrol,-Multi,FELVA
LV_Delete()
Loop, Parse, SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,syslk,A_LoopField,=
		iniread,sysxst,SystemLocations.ini,LOCATIONS,%syslk1%
		if ((sysxst <> "")&&(sysxst <> "ERROR"))
			{
				LV_Add("",syslk1)
			}
	}
LV_ModifyCol()
guicontrol,hide,FEDDLF
guicontrol,,FEDDLA,|Systems||ALL
return

RetroFEFELVA:
gui,listview,FELVA
curtxt=
sysfnd=
guicontrol,,FETXTJ,
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
	}
Loop,parse,SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,rfnb,A_LoopField,=
		if (rfnb1 = curtxt)
			{
				curtnm= %rfnb3%
				break
			}
	}	
Loop, Parse, RFCURPL,|
	{
		if (A_LoopField = curtnm)
			{
				curtnm=
				SB_SetText("Current system is already in the playlist.")
				LV_Modify(RowNumber, "-Select")
				curtnm=
				return
			}
	}
if (curtnm = "other")
	{
		SB_SetText("Define OTHER")
		curtnm=
		return
	}
if (curtnm <> "")
	{
		inemuinp= 
		inra= 
		ingr= 
		iniread,emuinp,Assignments.ini,OVERRIDES,%curtxt%
		if ((emuinp <> "")&&(emuinp <> "ERROR"))
			{
				Loop,parse,emuinp,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						if (A_Index = 1)
							{
								ingr= %A_LoopField%
								ifinstring,ingr,_libretro
									{
										inra= 1
										inemuinp= retroarch||
										continue
									}
								inemuinp=%ingr%||
								continue
							}
						inemuinp.= ingr . "|"	
					}
			}
			else {
				iniread,emuinx,EmuCfgPresets.ini,%curtxt%,SUPEMU
				if ((emuinx <> "")&&(emuinx <> "ERROR"))
					{
						loop,parse,emuinx,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								INIREAD,TBST,Assignments.ini,ASSIGNMENTS,%A_LoopField%
								if ((tbst = "ERROR")or(tbst = ""))
									{
										continue
									}
								if !instr(inemuinp,A_LoopField)
									{
										if (inemuinp = "")
											{
												inemuinp= %A_LoopField%||
												continue
											}
										inemuinp.= A_LoopField . "|"
									}
							}
					}
					else {
						iniread,emuinc,EmuCfgPresets.ini,%curtxt%,SUPCORE
						if ((emuinc <> "")&&(emuinc <> "ERROR"))
							{
								loop,parse,emuinc,|
									{
										if (A_LoopField = "")
											{
												continue
											}
										ifnotexist,%raexedir%\cores\%A_LoopField%
											{
												continue	
											}
										if !instr(inemuinp,A_LoopField)
											{
												if (inemuinp = "")
													{
														ingr= %A_LoopField%
														inemuinp= %A_LoopField%||
														continue
													}
												inemuinp.= A_LoopField . "|"
											}
									}
							}	
					}
			}
		if (inemuinp = "")
			{
				inemuinp= MAME - Systems||
			}
		iniread,emupxt,EmuCfgPresets.ini,%curtxt%,RJROMXT
		if ((emupxt = "")or(emupxt = "ERROR"))
			{
				emupxt= .zip
			}
		iniread,emuppp,EmuCfgPresets.ini,%curtxt%,FEPARAM
		iniread,evr,Assignments.ini,ASSIGNMENTS,retroarch
		if (inra = 1)
			{
				emuppp= -L%A_Space%>%raexedir%\cores\%ingr%>%A_space%%emuppp%
			}
		guicontrol,,FEEDTA,%A_Space%%emuppp%
		guicontrol,,FEEDTB,%emupxt%
		guicontrol,,FEDDLG,|other|%inemuinp%%runlist%
		guicontrol,,FECBXB,|%curtxt%||%systmfldrs%
		guicontrol,,FECBXD,|%curtnm%||%systmfldrs%
		guicontrol,,FECBXC,|%curtxt%||%systmfldrs%
	}
	else {
		guicontrol,,FECBXB,|%curtxt%||%systmfldrs%
		guicontrol,,FECBXD,|%curtxt%||%systmfldrs%
		guicontrol,,FECBXC,|%curtxt%||%systmfldrs%
		guicontrol,,FEEDTA,%a_space%>[ROMPATH]>
		guicontrol,,FEEDTB,.zip
		guicontrol,,FEDDLG,|other|%inemuinp%%runlist%
	}
return	
RetroFEFELBXA:
gui,submit,nohide
guicontrolget,curtnm,,FELBXA
guicontrol,,FERAD5A,0
guicontrol,,FERAD5B,0
guicontrol,,FERAD5C,0
iniread,cgpspl,RFcfg.ini,%curtnm%
iniread,crffn,RFcfg.ini,%curtnm%,fullname
iniread,crfsn,RFcfg.ini,%curtnm%,shortname
iniread,crfpn,RFcfg.ini,%curtnm%,platformid
iniread,crfxtn,RFcfg.ini,%curtnm%,extensions
iniread,crfemo,RFcfg.ini,%curtnm%,emuoptions
iniread,crfemu,RFcfg.ini,%curtnm%,emuname	
iniread,crfsyp,RFcfg.ini,%curtnm%,syspath	
guicontrol,,fecbxb,%crffn%||
guicontrol,,fecbxc,%crfpn%||
guicontrol,,fecbxd,%crfsn%||
guicontrol,,FEEDTA,%A_SPACE%%crfemo%
guicontrol,,FEEDTB,%crfxtn%
guicontrol,,FEEDTB,%crfxtn%
guicontrol,,FEDDLG,|other|%crfemu%||%runlist%
curtxt=%crffn%
guicontrolget,curtnmm,,FECBXD
guicontrolget,curtnmp,,FECBXC
sysfnd= 1
return

RetroFEFEBUTG:
MsgBox, 260, Clear List, Are you sure you want to clear all systems from the configuration list?
ifmsgbox, Yes
	{
		RFCURPL=
		RFTOPOP=
		filedelete,RFcfg.ini
		gosub,RFINIT
	}
return

RetroFEFERAD2A:
gui,submit,nohide
rfcleant= %FERAD2A%
rfcleantitle= no
iniwrite,%rfcleantitle%,RfCfg.ini,CONFIG,rfcleantitle
TF_replaceline("!"rfsetcfg,rf_PRNUM,rf_PRNUM,"showParenthesis = " rfcleantitle "")
TF_replaceline("!"rfsetcfg,rf_BRNUM,rf_BRNUM,"showSquareBrackets = " rfcleantitle "")
return

RetroFEFERAD2B:
rfcleant= 0
rfcleantitle= yes
iniwrite,%rfcleantitle%,RfCfg.ini,CONFIG,rfcleantitle
TF_replaceline("!"rfsetcfg,rf_PRNUM,rf_PRNUM,"showParenthesis = " rfcleantitle "")
TF_replaceline("!"rfsetcfg,rf_BRNUM,rf_BRNUM,"showSquareBrackets = " rfcleantitle "")
return

RetroFEFECHKB:
return

RetroFEFECHKE:
gui,submit,nohide
rfvideoen= no
if (FECHKE = 1)
	{
		rfvideoen= yes
	}
iniwrite,%rfvideoen%,RFcfg.ini,CONFIG,rfvideoen
TF_replaceline("!"rfsetcfg,rf_VENUM,rf_VENUM,"videoEnable = " rfvideoen "")
return

RetroFEFECHKD:
gui,submit,nohide
rffullscreen= false
if (FECHKD = 1)
	{
		rffullscreen= true
	}
iniwrite,%rffullscreen%,RFcfg.ini,CONFIG,fullscreen
TF_replaceline("!"rfsetcfg,rf_FSNUM,rf_FSNUM,"fullscreen = " rffullscreen "")
return

RetroFEFECHKF:
return

RetroFEFEDDLA:
return

RetroFEFECHKA:
return

RetroFEFECHKC:
return

RFOPNPL:
Loop,Parse,RFPLSWAP,|
	{
		guicontrol,%opntog%,%A_LoopField%
	}
return

RFROMROOT:
gui,submit,nohide
RFROOTFLDTMP=
SB_SetText("Current ROM folder is set to " RFROOTFLD "")
FileSelectFolder,RFROOTFLDTMP,,3,Select the ROM folder
if (RFROOTFLDTMP = "")
	{
		return
	}
stringright,efi,RFROOTFLDTMP,2
stringLeft,efix,RFROOTFLDTMP,2
if (efi = ":\")
	{
		RFROOTFLDTMP= %efix%
	}	
RFROOTFLD= %RFROOTFLDTMP%
SB_SetText("Current ROM folder is set to " RFROOTFLD "")
guicontrol,,RFRRTXT, ROM Directory is SET
RFROMLST=
Loop, %RFROOTFLD%\*.*
	{
		RFROMLST.= A_LoopFileFullPath . "|"
	}
guicontrol,,ROMPOP,|%RFROMLST%
return

RFPOPCORE:
gui,submit,nohide
return

RFBackupPl:
gui,submit,nohide
return

RFSavePl:
gui,submit,nohide
SB_SetText("Creating Playlist ... ")
SYSNAME=
guicontrolget,SYSNAME,,RFPLXMP
if (SYSNAME = "")
	{
		SB_SetText("You Must have a name for your playlist.")
		return
	}
plsave=
if (plsave = "")
	{
		plsave= %RFHOME%\collections
	}
plstdir= %plsave%\%SYSNAME%
ifnotexist, %plstdir%
	{
		FileCreateDir,%plstdir%
	}
ControlGet,curpllst, List,,,ahk_id %insel%
existlst=
Loop, Parse,curplLst,`n`r
	{
		if (A_LoopField <> ",")
		{
			taih1=
			taih2=
			stringsplit,taih,A_LoopField,>
			existlst .= (A_Index == 1 ? "" : "|") . taih1
		}
	}
plmatch=
plsep=
plsep1=
plsep2=
coretitle=
RFPlaylistSaving:
guicontrol, disable, SVAPLST
guicontrol, disable, SVPLST
guicontrol,disable,RFPLCORE
guicontrol,disable,ROMPOP
guicontrol,disable,CURPLST
guicontrol,disable,CLRPP
guicontrol,disable,PLINIT
guicontrol,disable,MVPLOD
guicontrol,disable,MVPLOU
guicontrol,disable,CLRPL
guicontrol,disable,BRADD
guicontrol,disable,CPYPL
guicontrol,disable,REMPL
guicontrol,disable,RFSVPL
guicontrol,disable,RFOPENPL
guicontrol,disable,RFTHUMBSRCHBUT
guicontrol,disable,RFMARQSRCHBUT
guicontrol,disable,RFVIDSRCHBUT
ARCDTYP=
guicontrolget, RFPLCORE, ,RFPLCORE
if (SYSNAME = "MAME")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "MAME - Aracade")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "arcade")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "model2")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "model3")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "cps3")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "cps2")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "cps")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "neogeo")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "neocd")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "naomi")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "atomiswave")
	{
		ARCDTYP= 1
	}
if (SYSNAME = "fba")
	{
		ARCDTYP= 1
	}
FileDelete,rj\RF\tmp.txt
FileDelete,rj\RF\include.txt
FileDelete,rj\RF\story.txt
if (RFCPYSCR = 1)
	{
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\artwork_front
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\artwork_back
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\artwork_front
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\bezel
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\fanart
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\logo
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\medium_back
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\medium_front
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\screenshot
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\screentitle
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\story
		FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\video
	}
filecreatedir,rj\RF\%SYSNAME%
FileDelete,rj\RF\%SYSNAME%\*.txt
FileDelete,rj\RF\%SYSNAME%\*.cfg
FileDelete,rj\RF\%SYSNAME%\include.txt
Loop, Parse, existlst,|
	{
		TOTPTH= %RFROOTFLD%\%A_LoopField%
		splitpath,TOTPTH,romn,romind,romext,romname,romdd
		imgetn= %romname%
		if (RFPLCORE = "Fuzzy-Match")
			{
				stringsplit,romspl,romname,([
				imgetn= %romspl1%*
			}
		RFK=
		imgetb= %imgetn%
		RFBOXPATH= %ASSETS%\%SYSNAME%\%romname%\BoxArt
		imgetb= %imgetn%
		if (RFBOXPATH = "")
			{
				RFBOX= 1
				RFBOXPATH= %RFHOME%\collections\%SYSNAME%\medium_artwork\artwork_front
				imgetb= %imgetn%-image
			}
		ROMIMAGEMATCH=
		  Loop, %RFBOXPATH%\%imgetb%.*
			{
				ROMIMAGEMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMIMAGEMATCH,,,newxt
				if (RFCPYSCR = 1)
					{
						RFIMG= 1
						FileCopy, %ROMIMAGEMATCH%, %RFHOME%\collections\%SYSNAME%\medium_artwork\artwork_front\%romname%.%newxt%
					}
				break
			}
		if (RFIMG = "")
			{
				Loop,Files,%RJSYSTEMS%\%SYSNAME%\%romname%\Folder.*
					{
						if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg"))
							{
								ROMIMAGEMATCH= %A_LoopFileFullPath%
								newxt=
								splitpath,ROMIMAGEMATCH,,,newxt
								RFIMG= 1
								FileCopy, %A_LoopFileFullPath%, %RFHOME%\collections\%SYSNAME%\medium_artwork\artwork_front\%romname%.%newxt%,1
								break
							}
					}
				if ((RFIMG = "")&&(RFPLCORE = "Fuzzy-Match"))
					{
						Loop, Files, %RJSYSTEMS%\%SYSNAME%\%imgetb%,D
							{
								Loop, %A_LoopFileFullPath%\Folder.*
									{
										if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg"))
											{				
												ROMIMAGEMATCH= %A_LoopFileFullPath%
												newxt=
												splitpath,ROMIMAGEMATCH,,,newxt
												RFIMG= 1
												FileCopy, %A_LoopFileFullPath%, %RFHOME%\collections\%SYSNAME%\medium_artwork\artwork_front\%romname%.%newxt%,1
												break
											}
									}
								if (RFIMG = 1)
									{
										break
									}
							}					
					}
			}	
		RFMARQ=
		imgetm= %imgetn%
		RFMARQUEEPATH= %ASSETS%\%SYSNAME%\%romname%\Marquees
		imgetb= %imgetn%
		if (RFMARQUEEPATH = "")
			{
				RFMARQ= 1
				RFMARQUEEPATH= %RFHOME%\collections\%SYSNAME%\medium_artwork\bezel
				imgetm= %imgetn%-marquee
			}
		ROMMARQUEEMATCH=
		Loop, %RFMARQUEEPATH%\%imgetm%.*
			{
				ROMMARQUEEMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMMARQUEEMATCH,,,newxt
				RFMARQ= 1
				FileCopy, %ROMMARQUEEMATCH%, %RFHOME%\collections\%SYSNAME%\medium_artwork\bezel\%romname%.%newxt%,1
				break
			}
		if (RFMARQ = "")
			{
				Loop,Files,%RJSYSTEMS%\%SYSNAME%\%romname%\Logo.*
					{
						if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg"))
							{
								ROMMARQUEEMATCH= %A_LoopFileFullPath%
								newxt=
								splitpath,ROMMARQUEEMATCH,,,newxt
								RFMARQ= 1
								FileCopy, %A_LoopFileFullPath%, %RFHOME%\collections\%SYSNAME%\medium_artwork\bezel\%romname%.%newxt%,1
								break
							}
					}
				if ((RFMARQ = "")&&(RFPLCORE = "Fuzzy-Match"))
					{
						Loop, Files, %RJSYSTEMS%\%SYSNAME%\%imgetb%,D
							{
								Loop, %A_LoopFileFullPath%\Logo.*
									{
										if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg"))
											{
												ROMMARQUEEMATCH= %A_LoopFileFullPath%
												newxt=
												splitpath,ROMMARQUEEMATCH,,,newxt
												RFMARQ= 1
												FileCopy, %A_LoopFileFullPath%, %RFHOME%\collections\%SYSNAME%\medium_artwork\bezel\%romname%.%newxt%,1
												break
											}
									}
								if (RFMARQ = 1)
									{
										break
									}	
							}					
					}
			}	
		RFTHU=
		imgett= %imgetn%
		RFTHUMBNAILPATH= %ASSETS%\%SYSNAME%\%romname%\Snapshots
		imgetb= %imgetn%
		if (RFTHUMBNAILPATH = "")
			{
				RFTHU= 1
				imgett= %imgetn%-thumb
				RFTHUMBNAILPATH= %RFHOME%\collections\%SYSNAME%\medium_artwork\screenshot
			}
		ROMTHUMBNAILMATCH=
		Loop, %RFTHUMBNAILPATH%\%imgett%.*
			{
				ROMTHUMBNAILMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMTHUMBNAILMATCH,,,newxt
				RFTHU= 1
				FileCopy, %ROMTHUMBNAILMATCH%, %RFHOME%\collections\%SYSNAME%\medium_artwork\screenshot\%romname%.%newxt%
				break
			}
		if (RFTHU = "")
			{
				Loop,Files,%RJSYSTEMS%\%SYSNAME%\%romname%\.snaps\*.*
					{
						if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg")or(A_LoopFileExt = "bmp")or(A_LoopFileExt = "gif"))
							{
								ROMTHUMBNAILMATCH= %A_LoopFileFullPath%
								newxt=
								splitpath,ROMTHUMBNAILMATCH,,,newxt
								RFTHU= 1
								FileCopy, %A_LoopFileFullPath%, %RFHOME%\collections\%SYSNAME%\medium_artwork\screenshot\%romname%.%newxt%,1
								break
							}
					}
				if ((RFTHU = "")&&(RFPLCORE = "Fuzzy-Match"))
					{
						Loop, Files, %RJSYSTEMS%\%SYSNAME%\%imgetb%,D
							{
								Loop, %A_LoopFileFullPath%\Logo.*
									{
										if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg")or(A_LoopFileExt = "bmp")or(A_LoopFileExt = "gif"))
											{
												ROMTHUMBNAILMATCH= %A_LoopFileFullPath%
												newxt=
												splitpath,ROMTHUMBNAILMATCH,,,newxt
												RFTHU= 1
												FileCopy, %A_LoopFileFullPath%, %RFHOME%\collections\%SYSNAME%\medium_artwork\screenshot\%romname%.%newxt%,1
												break
											}
									}								
							if (RFTHU = 1)
								{
									break
								}
							}	
					}
			}	
		RFVID=
		imgetv= %imgetn%
		RFVIDEOPATH= %ASSETS%\%SYSNAME%\%romname%\Videos
		imgetb= %imgetn%
		if (RFVIDEOPATH = "")
			{
				RFVID= 1
				RFVIDEOPATH= %RFHOME%\collections\%SYSNAME%\medium_artwork\video
				imgetv= %imgetn%-video
			}
		ROMVIDEOMATCH=
		Loop, %RFVIDEOPATH%\%imgetv%.*
			{
				ROMVIDEOEMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMVIDEOEMATCH,,,newxt
				if (RFCPYSCR = 1)
					{
						RFVID= 1
						FileCreateDir, %RFHOME%\collections\%SYSNAME%\medium_artwork\video
						FileCopy, %ROMVIDEOEMATCH%, %RFHOME%\collections\%SYSNAME%\medium_artwork\video\%romname%.%newxt%
					}
				break
			}
		if (RFVID = "")
			{
				Loop,Files,%RJSYSTEMS%\%SYSNAME%\%romname%\backdrops\*.*
					{
						if ((A_LoopFileExt = "mp4")or(A_LoopFileExt = "avi"))
							{
								ROMVIDEOEMATCH= %A_LoopFileFullPath%
								newxt=
								splitpath,ROMVIDEOEMATCH,,,newxt
								RFVID= 1
								FileCopy, %A_LoopFileFullPath%, %RFHOME%\collections\%SYSNAME%\medium_artwork\video\%romname%.%newxt%
								break
							}
					}
				if ((RFVID = "")&&(RFPLCORE = "Fuzzy-Match"))
					{
						Loop, Files, %RJSYSTEMS%\%SYSNAME%\%imgetb%,D
							{
								Loop, %A_LoopFileFullPath%\*.*
									{
										if ((A_LoopFileExt = "mp4")or(A_LoopFileExt = "avi"))
											{
												ROMVIDEOEMATCH= %A_LoopFileFullPath%
												newxt=
												splitpath,ROMVIDEOEMATCH,,,newxt
												RFVID= 1
												FileCopy, %A_LoopFileFullPath%, %RFHOME%\collections\%SYSNAME%\medium_artwork\video\%romname%.%newxt%
												break
											}
									}								
								if (RFVID = 1)
									{
										break
									}
							}			
					}
			pulmeta=
			pulrate=
			puldate=
			pulhid=
			puldev=
			pulpub=
			pulgen=
			pulpl=
			pulkid=
			pulfav=
			metaspl1=
			metaspl2=
			metaspl3=
			Loop, %ASSETS%\%SYSNAME%\%romname%\MetaData\*.xml
				{
					fndmet=
					FileRead,metadt,%A_LoopFileFullPath%
					Loop, Parse, metadt,`n`r
						{
							if (A_LoopField = "")
								{
									continue
								}
							stringsplit,metaspl,A_LoopField,<>
							if (metaspl2 = "released")
								{
									puldate= %metaspl3%
								}
							if (metaspl2 = "developer")
								{
									puldev= %metaspl3%
								}
							if (metaspl2 = "publisher")
								{
									pulpub= %metaspl3%
								}
							if (metaspl2 = "genre")
								{
									pulgen= %metaspl3%
								}
							if (metaspl2 = "players")
								{
									pulpl= %metaspl3%
								}
							if (metaspl2 = "rating")
								{
									pulrate= %metaspl3%
								}
							if (metaspl2 = "desc")
								{
									fndmet= 1
									pulmeta.= metaspl3
									if (metaspl4 = "/desc")
										{
											fndmet=
										}
								}
							if (metaspl2 = "plot")
									{
										fndmet= 1
										pulmeta.= metaspl3
										if (metaspl4 = "/plot")
											{
												fndmet=
											}
									}
							if (metaspl2 = "overview")
									{
										fndmet= 1
										pulmeta.= metaspl3
										if (metaspl4 = "/overview")
											{
												fndmet=
											}
									}
							if (metaspl2 = "notes")
									{
										fndmet= 1
										pulmeta.= metaspl3
										if (metaspl4 = "/notes")
											{
												fndmet=
											}
									}
							if (fndmet = 1)
								{
									pulmeta.= A_LoopField . "`n"
									ifinstring, pulmeta,</desc>
										{
											fndmet=
										}
								}
						}
					break
				}
		pthrom= %A_LoopField%
		if (RFVID = 1)
			{
				stringreplace,ROMVIDEOMATCH,ROMVIDEOMATCH,%RFVIDEOPATH%,`%BASE_MEDIA_PATH`%/`%ITEM_COLLECTION_NAME`%/medium_artwork/video,All
			}
		if (RFMARQ = 1)
			{
				stringreplace,ROMMARQUEEMATCH,ROMMARQUEEMATCH,%RFMARQUEEPATH%,`%BASE_MEDIA_PATH`%/`%ITEM_COLLECTION_NAME`%/medium_artwork/bezel,All
			}
		if (RFTHU = 1)
			{
				stringreplace,ROMTHUMBNAILMATCH,ROMTHUMBNAILMATCH,%RFTHUMBNAILPATH%,`%BASE_MEDIA_PATH`%/`%ITEM_COLLECTION_NAME`%/medium_artwork/screenshot,All
			}
		if (RFBOX = 1)
			{
				stringreplace,ROMIMAGEMATCH,ROMIMAGEMATCH,%RFBOXPATH%,`%BASE_MEDIA_PATH`%/`%ITEM_COLLECTION_NAME`%/medium_artwork/artwork_front,All
			}
		ifinstring,pthrom,:
			{
				stringreplace,pthrom,pthrom,%RJSYSTEMS%\%SYSNAME%\,,All
			}
		stringreplace,pthrom,pthrom,\,/,All
		romsfi= ./%romn%
		if (pulfav = "")
			{
				pulfav= false
			}
		if (pulkid = "")
			{
				pulkid= false
			}
		if (pulhid = "")
			{
				pulhid= false
			}
		FileAppend,%romname%`n,rj\RF\%SYSNAME%\include.txt
		FileAppend,rating = %pulrate%`n,rj\RF\%SYSNAME%\%romname%.txt
		FileAppend,year = %puldate%`n,rj\RF\%SYSNAME%\%romname%.txt
		FileAppend,developer = %puldev%`n,rj\RF\%SYSNAME%\%romname%.txt
		FileAppend,publisher = %pulpub%`n,rj\RF\%SYSNAME%\%romname%.txt
		FileAppend,genre = %pulgen%`n,rj\RF\%SYSNAME%\%romname%.txt
		FileAppend,players = %pulpl%`n,rj\RF\%SYSNAME%\%romname%.txt
		FileAppend,%pulmeta%`n,rj\RF\%SYSNAME%\%romname%_story.cfg
	}
	}
if (RFBACKUP = 1)
	{
		FileCopy,%RFHOME%\collections\%SYSNAME%\include.txt,%RFHOME%\collections\%SYSNAME%\include.txt.bak,1
	}
filecopy,rj\RF\%SYSNAME%\include.txt,%RFHOME%\collections\%SYSNAME%,1
filecopy,rj\RF\%SYSNAME%\*.txt,%RFHOME%\collections\%SYSNAME%\info,1
Loop,rj\RF\%SYSNAME%\*_story.cfg
	{
		stringtrimright,newrmn,A_LoopFileName,10
		filecopy,rj\RF\%SYSNAME%\%A_LoopFileName%,%RFHOME%\collections\%SYSNAME%\medium_artwork\story\%newrmn%.txt,1
	}
MsgBox,1,GameList Created,Created %plstdir%`nGamelist created.
SB_SetText(" " plstdir " gamelist created")
guicontrol, enable, SVAPLST
guicontrol, enable, SVPLST
guicontrol,enable,RFPLCORE
guicontrol,enable,ROMPOP
guicontrol,enable,CURPLST
guicontrol,enable,CLRPP
guicontrol,enable,PLINIT
guicontrol,enable,MVPLOU
guicontrol,enable,MVPLOD
guicontrol,enable,CLRPL
guicontrol,enable,BRADD
guicontrol,enable,CPYPL
guicontrol,enable,REMPL
guicontrol,enable,RFSVPL
guicontrol,enable,RFOPENPL
guicontrol,enable,RFTHUMBSRCHBUT
guicontrol,enable,RFMARQSRCHBUT
guicontrol,enable,RFVIDSRCHBUT
return

RfPlaylistNames:
gui,submit,nohide
return

RfOpenPl:
gui,submit,nohide
RFGAMLOTMP=
guicontrolget,SYSNAME,,RFPLXMP
FileSelectFile,RFGAMLOTMP,3,%rfhome%\collections\%SYSNAME%,Select a gamelist file, gamelist (*.txt)
if (RFGAMLOTMP = "")
	{
		return
	}
splitpath,RFGAMLOTMP,RFGAMLOMN,RFGAMLOD,,RFGAMLODIR
splitpath,RFGAMLOD,,,,syspfl
ifnotexist,rj\RF\%syspfl%
	{
		FileCreateDir,rj\RF\%syspfl%
	}
splitpath,RFGSAMLOD,RfGamLstF,
ifinstring,SysLLst,%syspfl%=
	{
		syssub= %syspfl%
	}
FileDelete,rj\RF\%syspfl%\*.ini
FileDelete,rj\RF\n.txt
RFGAMLO= %RFGAMLOTMP%
RFGAMX=
FileRead, RFGAMX,%RFGAMLO%
SB_SetText("POPULATING")
RFINIPOP=
ngame=
ren=
agame=
Loop, Parse, RFGAMX,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,:
		if (clut1 = "game")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				ren= %ngame%
				stringreplace,ren,ren,\,,All
				stringreplace,ren,ren,/,,All
				stringreplace,ren,ren,?,-,All
				stringreplace,ren,ren,<,-,All
				stringreplace,ren,ren,>,-,All
				stringreplace,ren,ren,=,-,All
				stringreplace,ren,ren,`%,-,All
				stringreplace,ren,ren,*,-,All
				stringreplace,ren,ren,:,-,All
				stringreplace,ren,ren,&#39;,',All
				stringreplace,ren,ren,&amp;,&,All
				continue
			}
		if (clut1 = "assets.boxfront")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "assets.marquee")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt
					}
				continue
			}
		if (clut1 = "assets.video")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "description")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "rating")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "release")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "assets.screenshot")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "developer")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "publisher")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "genre")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
		if (clut1 = "players")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ngame.= fprt . "`n"
					}
				continue
			}
	}
ngame.= "`n"
if (ren = "")
	{
		stringreplace,rffpath,rffpath,/,\,All
		splitpath,rffpath,,,,ren
	}
incv=
inc=
INCMOVRFEG:
FileAppend,%ngame%`n,rj\RF\n.txt
fileMove,rj\RF\n.txt,rj\RF\%syspfl%\%ren%%incv%.ini
if (ERRORLEVEL > 0)
	{
		inc+=1
		incv= _%inc%
		if (inc < 10)
			{
				goto, INCMOVRFEG
			}
	}
RFINIPOP.= ren . incv . ":" . syspfl . "|"
ren=
rffpath=
guicontrol,,CURPLST,|%RFINIPOP%
SB_SetText("COMPLETE")
opltog= hide
gosub, REMSYSTOG
opntog= show
gosub, RFOPNPL
return

RFCPYSCR:
gui,submit,nohide
return

RFUSESCR:
gui,submit,nohide
guicontrol,disable,RFCPYSCR
if (RFUSESCR = 1)
{
guicontrol,enable,RFCPYSCR
return
}
guicontrol,,RFCPYSCR,0
return

RFMARQSRCHBUT:
gui,submit,nohide
RFMARQUEEPATHTMP=
FileSelectFolder,RFMARQUEEPATHTMP,,3,Select the path to banners for this system
if (RFMARQUEEPATHTMP = "")
	{
		if (RFMARQUEEPATH <> "")
			{
				MsgBox,260,Reset Maquee Path,Would you like to clear the current banner path?
				ifmsgbox,OK
					{
						RFMARQUEEPATH=
						SB_SetText("Marquee path cleared")
						guicontrol,,RFMRQCHK,0
					}
			}
		return
	}
stringright,efi,RFMARQUEEPATHTMP,2
stringLeft,efix,RFMARQUEEPATHTMP,2
if (efi = ":\")
	{
		RFMARQUEEPATHTMP= %efix%
	}	
RFMARQUEEPATH= %RFMARQUEEPATHTMP%
SB_SetText("Marquee path set to " RFMARQUEEPATH " ")
guicontrol,,RFMRQCHK,1
return

RFVIDSRCHBUT:
gui,submit,nohide
RFVIDEOPATHTMP=
FileSelectFolder,RFVIDEOPATHTMP,,3,Select the path to videos for this system
if (RFVIDEOPATHTMP = "")
	{
		if (RFVIDEOPATH <> "")
			{
				MsgBox,260,Reset Video Path,Would you like to clear the current Video path?
				ifmsgbox,OK
					{
						RFVIDEOPATH=
						SB_SetText("VIDEO path cleared")
						guicontrol,,RFVIDCHK,0
					}
			}
		return
	}
stringright,efi,RFVIDEOPATHTMP,2
stringLeft,efix,RFVIDEOPATHTMP,2
if (efi = ":\")
	{
		RFVIDEOPATHTMP= %efix%
	}	
RFVIDEOPATH= %RFVIDEOPATHTMP%
SB_SetText("VIDEO path set to " RFVIDEOPATH " ")
guicontrol,,RFVIDCHK,1
return

RFTHUMBSRCHBUT:
gui,submit,nohide
RFTHUMBNAILPATHTMP=
FileSelectFolder,RFTHUMBNAILPATHTMP,,3,Select the path to thumbnails for this system
if (RFTHUMBNAILPATHTMP = "")
	{
		if (RFTHUMBNAILPATH <> "")
			{
				MsgBox,260,Reset Thumnails Path,Would you like to clear the current thumbnail path?
				ifmsgbox,OK
					{
						RFTHUMBNAILPATH=
						SB_SetText("thumbnail path cleared")
						guicontrol,,RFTHMBCHK,0
					}
			}
		return
	}
stringright,efi,RFTHUMBNAILPATHTMP,2
stringLeft,efix,RFTHUMBNAILPATHTMP,2
if (efi = ":\")
	{
		RFTHUMBNAILPATHTMP= %efix%
	}	
RFTHUMBNAILPATH= %RFTHUMBNAILPATHTMP%
SB_SetText("Thumbnails path set to " RFTHUMBNAILPATH " ")
guicontrol,,RFTHMBCHK,1
return

RFBOXSRCHBUT:
gui,submit,nohide
RFBOXPATHTMP=
FileSelectFolder,RFBOXPATHTMP,,3,Select the path to boxarts for this system
if (RFBOXPATHTMP = "")
	{
		if (RFBOXPATH <> "")
			{
				MsgBox,260,Reset Box-Art Path,Would you like to clear the current Box-Art path?
				ifmsgbox,OK
					{
						RFBOXPATH=
						SB_SetText("Box-Art path cleared")
						guicontrol,,RFBOXCHK,0
					}
			}
		return
	}
stringright,efi,RFBOXPATHTMP,2
stringLeft,efix,RFBOXPATHTMP,2
if (efi = ":\")
	{
		RFBOXPATHTMP= %efix%
	}	
RFBOXPATH= %RFBOXPATHTMP%
SB_SetText("Box-Art path set to " RFBOXPATH " ")
guicontrol,,RFBOXCHK,1
return

RFPopDownloads:
gui,submit,nohide
LNKLSTP=
guicontrolget,RFDWNLPOS,,RFDWNLPOS
guicontrol,,ROMPOP,|
if (RFRPOPPL = 1)
	{
		guicontrol,,RFPLXMP,|%RFDWNLPOS%||%RFPLPLST%%rfcommon%%systmfldrs%
		Loop, %CMIRLOC%\%RFDWNLPOS%\*.lnk,,1
			{
				LNKLSTP.= A_LoopFileFullPath . "|"
			}
		RFROOTFLD= %CMIRLOC%\%RFDWNLPOS%
		stringreplace,LNKLSTP,LNKLSTP,%RFROOTFLD%\,,All
		guicontrol,,ROMPOP,|%LNKLSTP%
		return
	}
if (RFRPOPDL = 1)
	{
		guicontrol,,RFPLXMP,|%RFDWNLPOS%||%RFPLPLST%%rfcommon%%systmfldrs%
		Loop, %RJSYSTEMS%\%RFDWNLPOS%\*.bat,,1
			{
				LNKLSTP.= A_LoopFileFullPath . "|"
			}
		RFROOTFLD= %RJSYSTEMS%\%RFDWNLPOS%
		stringreplace,LNKLSTP,LNKLSTP,%RFROOTFLD%\,,All
		guicontrol,,ROMPOP,|%LNKLSTP%
		return
	}
if (RFRPOPROM = 1)
	{
		guicontrol,,RFPLXMP,|%RFDWNLPOS%||%RFPLPLST%%rfcommon%%systmfldrs%
		IniRead,sysexlst,emuCfgPresets.ini,%RFDWNLPOS%,RJROMXT
		if (sysexlst = "ERROR")
			{
				sysexlst= .*
			}
		Loop,Parse,sysexlst,`,
			{
				Loop, %RJSYSTEMS%\%RFDWNLPOS%\*%A_LoopField%,,1
					{
						LNKLSTP.= A_LoopFileFullPath . "|"
					}
			}
		RFROOTFLD= %RJSYSTEMS%\%RFDWNLPOS%
		stringreplace,LNKLSTP,LNKLSTP,%RFROOTFLD%\,,All
		guicontrol,,ROMPOP,|%LNKLSTP%
		return
	}
return

RFRPopJ:
gui,submit,nohide
RPDND=
guicontrol,hide,RFMIRSEL
guicontrol,hide,RFRRTXT
guicontrol,hide,RFROMROOT
guicontrol,,RFPLXMP,|%RFPLPLST%%rfcommon%%systmfldrs%
guicontrol,,RFDWNLPOS,|%systmfldrs%
guicontrol,,ROMPOP,|
return

RFRPopMir:
gui,submit,nohide
gosub, RFMIRSEL
RPDND=
guicontrol,show,RFMIRSEL
guicontrol,hide,RFRRTXT
guicontrol,hide,RFROMROOT
guicontrol,,RFPLXMP,|%RFPLPLST%%rfcommon%%systmfldrs%
guicontrol,,ROMPOP,|
return

RFRPopRom:
gui,submit,nohide
RPDND=
guicontrol,,RFDWNLPOS,|
guicontrol,show,RFRRTXT
guicontrol,show,RFROMROOT
guicontrol,hide,RFMIRSEL
guicontrol,,RFDWNLPOS,|%systmfldrs%
stringleft,rfptr,RFPLPLST,1
if (rfptr = "|")
	{
		stringtrimleft,RFPLPLST,RFPLPLST,1
	}
guicontrol,,RFPLXMP,|%RFPLPLST%%rfcommon%
guicontrol,,ROMPOP,|
if (RFROOTFLD = "")
	{
		SB_SetText("ROM FOLDER IS NOT SET")
		return
	}
splitpath,RFROOTFLD,RFRFLN
SB_SetText("Current ROM folder is set to " RFROOTFLD "")
RFROMLST=
Loop, %RFROOTFLD%\*.*
	{
		if (A_LoopFileName = "")
			{
				continue
			}
		RFROMLST.= A_LoopFileFullPath . "|"
	}
guicontrol,,ROMPOP,|%RFROMLST%
return

RFMIRSEL:
gui,submit,nohide
guicontrolget,RFMIRSEL,,RFMIRSEL
iniread,CMIRLOC,Settings.ini,GLOBAL,%RFMIRSEL%
if (CMIRLOC = "ERROR")
	{
		SB_SetText("Mirrors must be created using the ''Mirrored_links'' dropdown of the Frontends tab.")
		return
	}
MIRLSTLOC=
Loop, %CMIRLOC%\*,2
	{
		if (A_LoopFileName = "")
			{
				continue
			}
		if (A_Index = 1)
			{
				GMIR= %A_LoopFileName%
			}
		MIRLSTLOC.= A_LoopFileName . "|"
	}
guicontrol,,RFDWNLPOS,|%GMIR%||%MIRLSTLOC%
return

RFKIDG:
gui,submit,nohide
rfpekidgame= false
if (RFKIDG = 1)
	{
		rfpekidgame= true
	}
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "kidgame")
			{
				RFREPL.= "<kidgame>" . rfpekidgame . "</kidgame>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
return

RFHIDDEN:
gui,submit,nohide
rfpehidden= false
if (RFHIDDEN = 1)
	{
		rfpehidden= true
	}
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "hidden")
			{
				RFREPL.= "<hidden>" . rfpehidden . "</hidden>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
return

RFFAV:
gui,submit,nohide
rfpefavorite= false
if (RFFAV = 1)
	{
		rfpefavorite= true
	}
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "favorite")
			{
				RFREPL.= "<favorite>" . rfpefavorite . "</favorite>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
return

RFTHUMBBUT:
gui,submit,nohide
RFTHTMP=
FileSelectFile,RFTHTMP,3,,Select a Thumbnail
if (RFTHTMP = "")
	{
		return
	}
rfpethumbnail= %RFTHTMP%
stringreplace,rfpethumbnailx,rfpethumbnail,\,/,All
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "thumbnail")
			{
				RFREPL.= "<thumbnail>" . rfpethumbnailx . "</thumbnail>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
imgprev= %rfpethumbnail%
guicontrol,,RFTHUMBP,%rfpethumbnail%
return

RFMARQBUT:
gui,submit,nohide
RFTHTMP=
FileSelectFile,RFTHTMP,3,,Select a marquee
if (RFTHTMP = "")
	{
		return
	}
rfpemarquee= %RFTHTMP%
stringreplace,rfpemarqueex,rfpemarquee,\,/,All
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "marquee")
			{
				RFREPL.= "<marquee>" . rfpemarqueex . "</marquee>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
imgprev= %rfpemarquee%
guicontrol,,RFMARQPTHTXT,%rfpemarquee%
return

RFVIDBUT:
gui,submit,nohide
RFTHTMP=
FileSelectFile,RFTHTMP,3,,Select a video
if (RFTHTMP = "")
	{
		return
	}
rfpevideo= %RFTHTMP%
stringreplace,rfpevideo,rfpevideo,\,/,All
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "video")
			{
				RFREPL.= "<video>" . rfpevideo . "</video>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
guicontrol,,RFVIDPTHTXT,%rfpevideo%
return

RFIMGBUT:
gui,submit,nohide
RFTHTMP=
FileSelectFile,RFTHTMP,3,Select a image
if (RFTHTMP = "")
	{
		return
	}
rfpeimage= %RFTHTMP%
stringreplace,rfpeimagex,rfpeimage,\,/,All
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "image")
			{
				RFREPL.= "<image>" . rfpeimagex . "</image>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
imgprev= %rfpeimage%
guicontrol,,RFOPNIMGPTHTXT,%rfpeimage%
return

RFDESCEDT:
gui,submit,nohide
guicontrolget,rfpedesc,,RFDESCEDT
stringreplace,rfpedesc,rfpedesc,`n,[CR],All
stringreplace,rfpedesc,rfpedesc,[CR][CR][CR],[CR],All
stringreplace,rfpedesc,rfpedesc,[CR][CR],[CR],All
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "desc")
			{
				RFREPL.= "<desc>" . rfpedesc . "</desc>" . "`n"
				continue
			}
		if (clut2 = "plot")
			{
				RFREPL.= "<desc>" . rfpedesc . "</desc>" . "`n"
				continue
			}
		if (clut2 = "overview")
			{
				RFREPL.= "<desc>" . rfpedesc . "</desc>" . "`n"
				continue
			}
		if (clut2 = "notes")
			{
				RFREPL.= "<desc>" . rfpedesc . "</desc>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
return

RFNAMEDT:
gui,submit,nohide
ControlGet,curpllst, List,,,ahk_id %insel%
RFRNMCHK:
guicontrolget,rfpename,,RFNAMEDT
stringreplace,RFINIPOP,RFINIPOP,%gamesel%:,%rfpename%:
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "name")
				{
				RFREPL.= "<name>" . rfpename . "</name>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
gui,submit,nohide
guicontrolget,rfrnmchk,,RFNAMEDT
if (rfrnmchk <> rfpename)
	{
		goto, RFRNMCHK
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
gamesel:= rfpename
FileAppend,%RFGAMP%,rj\RF\%syssub%\%rfpename%.ini
guicontrol,,CURPLST,|%RFINIPOP%
return

RFPTHEDT:
gui,submit,nohide
guicontrolget,rfpepath,,RFPTHEDT
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "path")
			{
				RFREPL.= "<path>" . rfpepath . "</path>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
return

RFPUBEDT:
gui,submit,nohide
guicontrolget,rfpepublisher,,RFPUBEDT
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "publisher")
			{
				RFREPL.= "<publisher>" . rfpepublisher . "</publisher>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
return

RFGENEDT:
gui,submit,nohide
guicontrolget,rfpegenre,,RFGENEDT
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "genre")
			{
				RFREPL.= "<genre>" . rfpegenre . "</genre>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
return

RFDEVEDT:
guicontrolget,rfpedeveloper,,RFDEVEDT
gui,submit,nohide
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "developer")
			{
				RFREPL.= "<developer>" . rfpedeveloper . "</developer>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
return

RFRLSDG:
return

RFDDPLNUM:
gui,submit,nohide
guicontrolget,RFDDPLNUM,,RFDDPLNUM
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "players")
			{
				RFREPL.= "<players>" . RFDDPLNUM . "</players>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
		}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
guicontrol,,RFDDPLNUM,%RFDDPLNUM%
return

RFRATSLD:
gui,submit,nohide
ERATTSLD=
RFREPL=
guicontrolget,RFRATSLD,,RFRATSLD
RFRATSLD:= (RFRATSLD / 10)
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "rating")
			{
				RFREPL.= "rating: " . RFRATSLD . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
return

RFEDTPOP:
vvi1=
vvi2=
stringsplit,vvi,CURPLST,:
if (vvi1 = "")
	{
		return
		gamesel=
	}
syssub= %vvi2%
if (gamesel <> vvi1)
	{
		if (vvi1 <> "")
			{
				if (gamesel <> "")
					{
						FileDelete,rj\RF\%syssub%\%gamesel%.ini
						FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
					}
			}
		gamesel=
	}
if (crpln <> 1)
	{
		guicontrol,,RFFAV,0
		guicontrol,,RFKIDG,0
		guicontrol,,RFHIDDEN,0
		guicontrol,,RFPUBEDT,
		guicontrol,,RFDEVEDT,
		guicontrol,,RFGENEDT,
		guicontrol,,RFPTHEDT,
		guicontrol,,RFNAMEDT,
		guicontrol,,RFRATSLD,
		guicontrol,,RFTHUMBP,
		guicontrol,,RFOPNIMGPTHTXT,
		guicontrol,,RFVIDPTHTXT,
		guicontrol,,RFMARQPTHTXT,
		guicontrol,,RFDDPLNUM,|1||2|3|4|5|6|7|8
		guicontrol,,RFDESCEDT,
		return
	}
gamesel:= vvi1
FileRead,RFGAMP,rj\RF\%syssub%\%gamesel%.ini
Loop, Parse, RFGAMP,`n`r
	{
		cmpl=
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,:
		if (clut1 = "name")
			{
				rfpepublisher=
				rfpedeveloper=
				rfpegenre=
				rfpepath=
				rfpename=
				rfperating=
				rfpethumbnail=
				rfpeimage=
				rfpevideo=
				rfpemarquee=
				rfpelayers=
				rfpedesc=
				rfpekidg= 0
				rfhide= 0
				rfpefav= 0
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						ren.= fprt
					}
				stringreplace,ren,ren,&#39;,',All
				stringreplace,ren,ren,&amp;,&,All
				rfpename= %ren%
				continue
			}
		if (clut1 = "assets.boxfront")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfpeimage.= fprt
					}
				stringreplace,rfpeimagex,rfpeimage,/,\,All
				continue
			}
		if (clut1 = "assets.screenshot")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfpethumbnail.= fprt
					}
				stringreplace,rfpethumbnailx,rfpethumbnail,/,\,All
				continue
			}
		if (clut1 = "assets.marquee")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfpemarquee.= fprt
					}
				stringreplace,rfpemarqueex,rfpemarquee,/,\,All
				continue
			}
		if (clut1 = "assets.video")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfpevideo.= fprt
					}
				stringreplace,rfpevideox,rfpevideo,/,\,All
				continue
			}
		if (clut1 = "description")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfpedesc.= fprt
					}
				stringreplace,rfpedeedt,rfpedesc,&#39;,',All
				stringreplace,rfpedeedt,rfpedeedt,&amp;,&,All
				continue
			}
		if (clut1 = "rating")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfperating.= fprt
					}
				rfperating= %clut3%
				rfperatsld:= (rfperating * 10)
				continue
			}
		if (clut1 = "release")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfpereleasedate.= fprt
					}
				continue
			}
		if (clut1 = "developer")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfpedeveloper.= fprt
					}
				continue
			}
		if (clut1 = "publisher")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfpepublisher.= fprt
					}
				continue
			}
		if (clut1 = "genre")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfpegenre.= fprt
					}
				continue
			}
		if (clut2 = "players")
			{
				Loop,%clut0%
					{
						if (A_index = 1)
							{
								continue
							}
						fprt= % clut%A_Index%
						rfpeplayers.= fprt
					}
				continue
			}
	}
guicontrol,,RFPUBEDT,%rfpepublisher%
guicontrol,,RFDEVEDT,%rfpedeveloper%
guicontrol,,RFGENEDT,%rfpegenre%
stringreplace,systid,syssub,_,,All
rfperpath= %rfpepath%
guicontrol,,RFNAMEDT,%ren%
guicontrol,,RFRATSLD,%rfperatsld%
guicontrol,,RFTHUMBP,%rfpethumbnailx%
guicontrol,,RFOPNIMGPTHTXT,%rfpeimagex%
guicontrol,,RFVIDPTHTXT,%rfpevideox%
guicontrol,,RFMARQPTHTXT,%rfpemarqueex%
guicontrol,,RFDDPLNUM,%rfpelayers%||1|2|3|4|5|6|7|8
guicontrol,,RFDESCEDT,%rfpedeedt%
if (rfpename = "")
		{
			stringreplace,rfptmp,rfpepath,/,\,All
			splitpath,rfptmp,,,,rfpename
		}
splitpath,rfptmp,,,,rfpename
RFGAMTMP=
RFGAMTMP.= "game: " . rfpename . "`n"
RFGAMTMP.= "files: " . rfpepath . "`n"
RFGAMTMP.= "boxfront: " . rfpeimage . "`n"
RFGAMTMP.= "assets.marquee: " . rfpemarquee . "`n"
RFGAMTMP.= "assets.video: " . rfpevideo . "`n"
RFGAMTMP.= "description: " . rfpedesc . "`n"
RFGAMTMP.= "assets.boxfront: " . rfpethumbnail . "`n"
RFGAMTMP.= "developer: " . rfpedeveloper . "`n"
RFGAMTMP.= "publisher: " . rfpepublisher . "`n"
RFGAMTMP.= "genre: " . rfpegenre . "`n"
RFGAMTMP.= "release: " . rfpereleasedate . "`n"
RFGAMTMP.= "rating: " . rfperating . "`n"
RFGAMP= %RFGAMTMP%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
return

RFSAVEOPL:
guicontrol,,CURPLST,|
gamesel=
curtxt=
RFGAMP=
gosub, curplst
gui,submit,nohide
guicontrol,,RFFAV,0
guicontrol,,RFKIDG,0
guicontrol,,RFHIDDEN,0
guicontrol,,RFPUBEDT,
guicontrol,,RFDEVEDT,
guicontrol,,RFGENEDT,
guicontrol,,RFPTHEDT,
guicontrol,,RFNAMEDT,
guicontrol,,RFRATSLD,
guicontrol,,RFTHUMBP,
guicontrol,,RFOPNIMGPTHTXT,
guicontrol,,RFVIDPTHTXT,
guicontrol,,RFMARQPTHTXT,
guicontrol,,RFDDPLNUM,|1||2|3|4|5|6|7|8
guicontrol,,RFDESCEDT,
FileMove,%RFHOME%\collections\%syssub%\gamelist.xml.txt,%RFHOME%\collections\%syssub%\gamelist.xml.bak,1
FileDelete,rj\RF\%syssub%\gamelist.xml
ControlGet,curpllst, List,,,ahk_id %insel%
stringreplace,curpllst,curpllst,`n,|,All
Loop, rj\RF\%syssub%\*.ini
	{
		splitpath,A_LoopField,,,,ftap1
		fileread,ftap,%A_LoopFileFullPath%
		FileAppend,%ftap%,rj\RF\%syssub%\gamelist.xml
	}
FileAppend,`n,rj\RF\%syssub%\gamelist.xml
FileMove,rj\RF\%syssub%\gamelist.xml,%RFHOME%\gamelists\%syssub%\gamelist.xml,1
Msgbox,1,CREATED,%syssub% gamelist created.,5
gamesel=
guicontrol,,CURPLST,|
FileDelete,rj\RF\%syssub%\*.ini
return

RFROMADDBUT:
gui,submit,nohide
gamesel=
curtxt=
guicontrol,,RFNAMEDT,
guicontrol,,RFPTHEDT,
guicontrol,,RFDESCEDT,
guicontrol,,RFPUBEDT,
guicontrol,,RFDEVEDT,
guicontrol,,RFGENEDT,
presel= %RJSYSTEMS%\%syssub%
RFROMRSEL:
RFTHTMP=
FileSelectFile,RFTHTMP,3,,Select a ROM
if (RFTHTMP = "")
	{
			if ((presel = "") && (RFTHTMP = ""))
			{
				return
			}
		presel=
		goto, RFROMRSEL
return
	}
rfpepath= %RFTHTMP%
splitpath,rfpepath,rfpefile,,,rfpepnam
gamesel= %rfpepnam%
if (syssub = "")
	{
		guicontrolget,syssub,,RFPLXMP
	}
RFINIPOP.= gamesel . ":" . syssub . "|"
FileAppend,game: %rfpepnam%`n,rj\RF\%syssub%\%gamesel%.ini
FileAppend,file: %rfpefile%`n,rj\RF\%syssub%\%gamesel%.ini
rfperpath= %rfpepath%
guicontrol,,RFPTHEDT,%rfpepath%
stringreplace,systid,syssub,_
stringreplace,rfperpath,rfpepath,%RJSYSTEMS%\%systid%,.,All
if (epserpath <> rfpepath)
	{
		stringreplace,rfperpath,rfperpath,\,/,All
		guicontrol,,RFPTHEDT,%rfperpath%
	}
guicontrol,,RFNAMEDT,%rfpepnam%
guicontrol,,CURPLST,|%RFINIPOP%
gosub, CURPLST
return

RFFLDADDBUT:
gui,submit,nohide
gamesel=
curtxt=
guicontrol,,RFNAMEDT,
guicontrol,,RFPTHEDT,
guicontrol,,RFDESCEDT,
guicontrol,,RFPUBEDT,
guicontrol,,RFDEVEDT,
guicontrol,,RFGENEDT,
presel= %RJSYSTEMS%\%syssub%
RFFLDRSEL:
RFTHTMP=
FileSelectFolder,RFTHTMP,*%presel%,3,Select a FOLDER
sysrepth= %syssub%
if (RFTHTMP = "")
	{
		if ((presel = "") && (RFTHTMP = ""))
			{
				return
			}
		presel=
		goto, RFFLDRSEL
	}
stringright,efi,RFTHTMP,2
stringLeft,efix,RFTHTMP,2
if (efi = ":\")
	{
		RFTHTMP= %efix%
	}	
rfperpath= %RFTHTMP%
splitpath,rfperpath,,,,rfpepnam
ifnotinstring,syssub,%rfperpnam%
	{
		sysrrepth= %rfperpnam%
	}
stringreplace,systid,syssub,_,,All
stringreplace,rfperpath,rfperpath,%RJSYSTEMS%\%systid%,,All
stringreplace,rfperpath,rfperpath,%RJSYSTEMS%\%sysrepth%,,All
if (rfperpath <> RFTHTMP)
	{
		stringreplace,rfperpath,rfperpath,\,/,All
		rfperpath= .%rfperpath%
	}
gamesel= %rfperpnam%
if (syssub = "")
	{
		guicontrolget,syssub,,RFPLXMP
	}
RFINIPOP.= gamesel . ":" . syssub . "|"
FileAppend,<folder>`n,rj\RF\%syssub%\%gamesel%.ini
FileAppend,<name>%rfpepnam%</name>`n,rj\RF\%syssub%\%gamesel%.ini
FileAppend,<path>%rfpepath%</path>`n,rj\RF\%syssub%\%gamesel%.ini
FileAppend,</folder>`n,rj\RF\%syssub%\%gamesel%.ini
stringreplace,systid,syssub,_,,All
rfperpath= %rfpepath%
guicontrol,,RFPTHEDT,.%rfpepath%
stringreplace,rfperpath,rfpepath,%RJSYSTEMS%\%systid%,.,All
if (rfperpath <> rfpepath)
	{
		stringreplace,rfperpath,rfperpath,\,/,All
		guicontrol,,RFPTHEDT,%rfperpath%
	}
guicontrol,,RFNAMEDT,%rfpepnam%
guicontrol,,CURPLST,|%RFINIPOP%
gosub, CURPLST
return

RFROMPTHBUT:
jtf=
gui,submit,nohide
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "folder")
			{
				jtf= 1
			}
	}
RFTHTMP=
if (jtf = 1)
	{
		goto, RFFSFLD
	}
FileSelectFile,RFTHTMP,3,,Select a ROM
if (RFTHTMP = "")
	{
		return
	}
rfpepath= %RFTHTMP%
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "path")
			{
				RFREPL.= "<path>" . rfpepath . "</path>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
stringreplace,systid,syssub,_,,All
rfperpath= %rfpepath%
ifexist,%RJSYSTEMS%\%systid%\
	{
		stringreplace,rfperpath,rfpepath,%RJSYSTEMS%\%systid%,,All
		stringreplace,rfperpath,rfperpath,\,/,All
	}
guicontrol,,RFPTHEDT,%rfperpath%
return

RFFSFLD:
FileSelectFolder,RFTHTMP,,3,Select a path
if (RFTHTMP = "")
	{
		return
	}
stringright,efi,RFTHTMP,2
stringLeft,efix,RFTHTMP,2
if (efi = ":\")
	{
		RFTHTMP= %efix%
	}	
rfpepath= %RFTHTMP%
RFREPL=
Loop, Parse, RFGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "path")
			{
				RFREPL.= "<path>" . rfpepath . "</path>" . "`n"
				continue
			}
		RFREPL.= A_LoopField . "`n"
	}
RFGAMP= %RFREPL%
FileDelete,rj\RF\%syssub%\%gamesel%.ini
FileAppend,%RFGAMP%,rj\RF\%syssub%\%gamesel%.ini
previmg= %rfpepath%
stringreplace,systid,syssub,_,,All
rfperpath= %rfpepath%
ifexist,%RJSYSTEMS%\%systid%\
	{
		stringreplace,rfperpath,rfpepath,%RJSYSTEMS%\%systid%,,All
		stringreplace,rfperpath,rfperpath,\,/,All
	}
guicontrol,,RFPTHEDT,.%rfperpath%
return

pgSystems:
gui,ListView,FELVA
LV_Delete()
Loop, Parse, fesyslst,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		revsys= % fe_%A_LoopField%	
		iniread,sysxst,SystemLocations.ini,LOCATIONS,%revsys%
		if ((sysxst <> "")&&(sysxst <> "ERROR"))
			{
				LV_Add("",A_LoopField)
			}
	}
LV_ModifyCol()
return

pgALL:
gui,ListView,FELVA
LV_Delete()
Loop,parse,fesyslst,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,syslk,A_LoopField,=
		LV_Add("",syslk1)
	}
LV_ModifyCol()
return

EmulationStationToggle:
gosub, FEUNPOP
ESINIT:
ESGUIITEMS= FEBUTA|FEBUTB|FEBUTC|FEBUTD|FEBUTE|FEBUTF|FEBUTG|FEBUTH|FEBUTI|FEBUTJ|FEBUTK|FECBXA|FECBXB|FECBXC|FECBXD|FECHKB|FECHKC|FECHKD|FECHKE|FECHKF|FECHKG|FEDDLA|FEDDLC|FEDDLD|FEDDLF|FEDDLG|FEEDTA|FEEDTB|FELBXA|FELVA|FEPRGA|FERAD2A|FERAD2B|FERAD5A|FERAD5B|FERAD5C|FESLDA
iniread,EmulationStation,apps.ini,FRONTENDS,EmulationStation
if (EmulationStation = "ERROR")
	{
		SB_SetText("Use the Install tab to install EmulationStation.")
		guicontrol,choose,TABMENU,3
		guicontrol,,SALIST,|Frontends||Systems|Emulators|Utilities
		guicontrol,enable,SALIST
		gosub, SALIST
		Guicontrol,choose,PRGINSTLBX,|5
		guicontrol, ChooseString, PRGINSTLBX,EmulationStation
		return
	}
esinit=
ifnotexist,EScfg.ini
	{
		FileAppend,[CONFIG]`n,EScfg.ini
		FileAppend,[ORDER]`n,EScfg.ini
		esinit= 1
		IniWrite,0,EScfg.ini,CONFIG,Parse_Only
		esgameparse= 0
		esparseonly= false
		IniWrite,1,EScfg.ini,CONFIG,quick_select
		esquickselect= 1
		esquicksystemselect= true
		IniWrite,1,EScfg.ini,CONFIG,Navigation_Sounds
		esnavsnds= 1
		esnavigationsounds= true
		IniWrite,1,EScfg.ini,CONFIG,Video_Sound
		esvideosnd= 1
		IniWrite,100,EScfg.ini,CONFIG,VRAM
		esvideoram= 100
		IniWrite,simple,EScfg.ini,CONFIG,theme
		estheme= simple
		esthpop= simple
		IniWrite,video,EScfg.ini,CONFIG,GameList
		esgamelist= video
		IniWrite,slide,EScfg.ini,CONFIG,transition
		estransition= slide
	}
iniread,ESHOME,escfg.ini,CONFIG,home_directory
if (ESHOME = "ERROR")
	{
		ESHOME= %CURSRPTH%\	
		iniwrite,%ESHOME%,escfg.ini,CONFIG,home_directory
	}
splitpath,EmulationStation,ESFEXE,ESPROG
cplinites:
eshfl= %ESPROG%\.emulationstation
eshomept := DllCall("GetFileAttributes","str",eshfl)
if (eshomept != -1 && eshomept & 0x400)
    {
		fileappend,!,%ESPROG%\.emulationstation\~.del
		if (ERRORLEVEL = 0)
			{
				filedelete,%ESPROG%\.emulationstation\~.del
			}
			else {
					gosub, initeshome			
			}
	}
else
	{
		gosub, initeshome			
	}
ifnotexist,%ESHOME%
	{
		FileCreateDir,%ESHOME%\collections
		FileCreateDir,%ESHOME%\gamelists
		FileCreateDir,%ESHOME%\themes
		FileCreateDir,%ESHOME%\tmp
	}
esthemes=
IniRead,esinitheme,sets\themes.set
Loop, Parse, esinitheme,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		iniread,esth,sets\Themes.set,%A_LoopField%,ESTHEME
		if (esth <> "ERROR")
			{
				esthemes.= A_LoopField . "|"
			}
	}
Loop, %eshome%\themes,2
	{
		ifinstring,esthemes,%A_LoopFileName%|
			{
				continue
			}
		esthemes.= A_LoopFileName . "|"
	}
if (esinit = 1)
	{
		ifinstring,esthemes,rj|
			{
				esthpop= rj
				iniwrite,rj,EScfg.ini,CONFIG,theme
			}
		esinit= 	
	}
fetog= show
ESCURPL=
guicontrol,,FELBXA,|
iniread,sysordr,EScfg.ini,ORDER,system_order
if (sysordr <> "ERROR")
	{
		ESCURPL= %sysordr%
	}
insttheme= simple
Loop,%ESHOME%\themes\*,2
	{
		insttheme= %A_LoopFileName%
		ifexist,%ESHOME%\themes\rj
			{
				insttheme= rj
			}
		break
	}
cursysthemelist=
avblnk=
Loop, %ESHOME%\themes\%insttheme%\*,2
		{
			if (A_Index = 1)
				{
					avblnk= %A_LoopFileName% . "|" . "|"
				}
			cursysthemelist.= A_LoopFileName . "|"
		}
guicontrol,,FELBXA,%ESCURPL%
IniRead, esmirloc,EScfg.ini,CONFIG,Mirror_Links
if (esmirloc = "ERROR")
	{
		esmirloc= %S_KeyDir%\mirrors
	}
IniRead, estransition,EScfg.ini,CONFIG,Transition
if (estransition = "ERROR")
	{
		estransition= slide
	}
IniRead, estheme,EScfg.ini,CONFIG,theme
if (estheme = "ERROR")
	{
		estheme= simple
		ifinstring,cursysthemelist,rj|
			{
				estheme= rj
			}
	}
IniRead, esvideoram,EScfg.ini,CONFIG,VRAM
if (esvideoram = "ERROR")
	{
		esvideoram= 100
	}
IniRead, esvideosnd,EScfg.ini,CONFIG,Video_Sound
if (esvideosnd = "ERROR")
	{
		esvideosnd= 1
	}
IniRead, esgamelist,EScfg.ini,CONFIG,Gamelist
if (esgamelist = "ERROR")
	{
		esgamelist= video
	}
IniRead,esgameparse,EScfg.ini,CONFIG,Parse_Only
if (esgameparse = "ERROR")
	{
		esgameparse= 0
	}
esparseonly= false
if (esgameparse = 1)
	{
		esparseonly= true
	}
IniRead,esquickselect,EScfg.ini,CONFIG,Quick_selelct
if (esquickselect = "ERROR")
	{
		esquickselect= 1
	}
esquicksystemselect= true
if (esquickselect= 0)
	{
		esquicksystemselect= false
	}
IniRead,esnavsnds,EScfg.ini,CONFIG,Navigation_Sound
if (esnavsnds = "ERROR")
	{
		esnavsnds= 1
	}
esnavigationsounds= true
if (esnavsnds= 0)
	{
		esnavigationsounds= false
	}
estrans= 0
estrans2= 1
if (estransition = "slide")
	{
		estrans:= 1
		estrans2:= 0
	}
emst_dtog=FEBUTA|FEBUTB|FEBUTC|FEBUTD|FEBUTE|FEBUTF|FEBUTH|FEBUTG|FEBUTI|FEBUTJ|FEBUTK|FECHKB|FECHKC|FECHKD|FECHKE|FECHKG|FECHKF|FEEDTA|FEEDTB|FEDDLD|FEDDLC|FEDDLG|FECBXB|FECBXC|FECBXD|FECBXA|FELVA|FERAD5A|FERAD5B|FERAD5C|FERAD2A|FERAD2B|FESLDA|FETXTA|FETXTC|FETXTD|FELBXA|FETXTE|FETXTF|FETXTH|FETXTN|FETXTI|FETXTJ|FETXTL|FETXTM|FETXTO|FETXTP|FEPRGA
emst_etog=FEBUTA|FEBUTB|FEBUTC|FEBUTD|FEBUTE|FEBUTF|FEBUTH|FEBUTG|FEBUTI|FEBUTJ|FEBUTK|FECHKB|FECHKC|FECHKD|FECHKE|FECHKG|FECHKF|FEEDTA|FEEDTB|FEDDLD|FEDDLC|FEDDLF|FEDDLG|FECBXB|FECBXC|FECBXD|FECBXA|FELVA|FERAD5A|FERAD5B|FERAD5C|FERAD2A|FERAD2B|FESLDA|FETXTA|FETXTB|FETXTK|FETXTC|FETXTD|FELBXA|FETXTE|FETXTF|FETXTG|FETXTH|FETXTN|FETXTI|FETXTJ|FETXTL|FETXTM|FETXTO|FETXTP|FEPRGA
guicontrol,move,FEBUTA, x537 y33 w60 h19
guicontrol,,FEBUTA,Download
gui,font,normal
Guicontrol,font,FEBUTA
guicontrol,move,FEBUTB,x659 y473 w93 h23
guicontrol,,FEBUTB,CREATE
guicontrol,move,FEBUTC,x394 y475 w52 h22
guicontrol,,FEBUTC,Delete
guicontrol,move,FEBUTD,x355 y105 w37 h19
guicontrol,,FEBUTD,. . .
guicontrol,move,FEBUTE,x262 y475 w52 h22
guicontrol,,FEBUTE,Add
guicontrol,move,FEBUTF,x704 y451 w46 h17
guicontrol,,FEBUTF,Load
guicontrol,move,FEBUTH,x261 y130 w62 h20
guicontrol,,FEBUTH,Emulator
guicontrol,move,FEBUTG,x450 y475 w52 h22
guicontrol,,FEBUTG,Clear
guicontrol,move,FEBUTI,x508 y352 w18 h18
guicontrol,,FEBUTI,v
guicontrol,move,FEBUTJ,x508 y334 w18 h18
guicontrol,,FEBUTJ,^
guicontrol,move,FEBUTK,x419 y4 w18 h18
gui, font, %fontXlg% bold
guicontrol, font, FEBUTK
guicontrol,,FEBUTK,>
gui, font, %fontXmed% normal
guicontrol,move,FECHKB,x643 y424 w111 h13
guicontrol,,FECHKB,Video-sound-on
guicontrol,,FECHKB,%esvideosnd%
guicontrol,move,FECHKC,x521 y55 w74 h13
guicontrol,,FECHKC,Overwrite
guicontrol,move,FECHKD,x642 y357 w120 h23
guicontrol,,FECHKD,GameLists Only
guicontrol,,FECHKD,%esgameparse%
guicontrol,move,FECHKE,x642 y378 w120 h23
guicontrol,,FECHKE,Quick Select
guicontrol,,FECHKE,%esquickselect%
guicontrol,move,FECHKG,x514 y406 w125 h13
guicontrol,,FECHKG,Overwrite Gamelists
guicontrol,,FECHKG,1
guicontrol,move,FECHKF,x642 y400 w120 h23
guicontrol,,FECHKF,Navigation Sounds
guicontrol,,FECHKF,%esnavsnds%
guicontrol,move,FEEDTA,x428 y130 w145 h21
guicontrol,,FEEDTA,%A_SPACE%>[ROMPATH]>
guicontrol,-password,FEEDTB
guicontrol,move,FEEDTB,x578 y130 w120 h21
guicontrol,,FEEDTB,
guicontrol,move,FEDDLD,x599 y32 w162
guicontrol,,FEDDLD,|%esthpop%||%esthemes%
guicontrol,move,FEDDLC,x661 y259 w82
guicontrol,,FEDDLC,|video||automatic|detailed|basic|
guicontrol,hide,FEDDLF
guicontrol,move,FEDDLF,x324 y79 w100
guicontrol,,FEDDLF,|%esmirloc%||
guicontrol,move,FEDDLG,x325 y130 w100
guicontrol,,FEDDLG,|other||%emuinstpop%
guicontrol,move,FECBXB,x263 y153 w217
guicontrol,,FECBXB,|%systmfldrs%
guicontrol,move,FECBXC,x263 y176 w217
guicontrol,,FECBXC,|%systmfldrs%
guicontrol,move,FECBXD,x264 y199 w217
guicontrol,,FECBXD,|%cursysthemelist%
guicontrol,move,FECBXA,x590 y166 w104
guicontrol,,FECBXA,|%cursysthemelist%
guicontrol,,FELVA,Mirrors
guicontrol,move,FELVA,x10 y64 w247 h433
guicontrol,+altsubmit,FELVA
guicontrol,-checked,FELVA
gui,ListView,FELVA
LV_Delete()
Loop, Parse, systmfldrs,|
	{
		ifnotinstring,SysLLst,%A_LoopField%=
			{
				continue
			}
		LV_Add("",A_LoopField)
	}
LV_ModifyCol()
guicontrol,move,FERAD5A,x701 y151 w56 h15
guicontrol,,FERAD5A, Jackets
guicontrol,,FERAD5A, 0
guicontrol,move,FERAD5B,x701 y171 w53 h15
guicontrol,,FERAD5B, Mirrors
guicontrol,,FERAD5B, 0
guicontrol,move,FERAD5C,x701 y133 w53 h15
guicontrol,,FERAD5C,ROMs
guicontrol,,FERAD5C, 1
guicontrol,move,FERAD2A,x661 y241 w44 h13
guicontrol,,FERAD2A,slide
guicontrol,,FERAD2A, %estrans%
guicontrol,move,FERAD2B,x710 y242 w50 h13
guicontrol,,FERAD2B, Fade
guicontrol,,FERAD2B,%estrans2%
guicontrol,+Range100-1000,FESLDA
guicontrol,move,FESLDA,x636 y316 w120 h32
guicontrol,,FESLDA,%esvideoram%
guicontrol,move,FETXTA,x643 y55 w110 h13
guicontrol,,FETXTA,Global Theme
guicontrol,move,FETXTB,x508 y437 w120 h15
guicontrol,,FETXTB,Remove
guicontrol,move,FETXTK,x597 y452 w106 h15
guicontrol,,FETXTK,Load es_systems.cfg
guicontrol,move,FETXTC,x14 y23 w512 h16
guicontrol,,FETXTC,System Location
guicontrol,move,FETXTD,x577 y242 w82 h13
guicontrol,,FETXTD,Transition Style
guicontrol,move,FELBXA,x263 y223 w240 h251
guicontrol,move,FETXTE,x652 y297 w93 h23
guicontrol,,FETXTE,Vram limit : %esvideoram%
guicontrol,move,FETXTF,x583 y263 w71 h13
guicontrol,,FETXTF, Gamelist Style
guicontrol,move,FETXTG,x424 y478 w80 h20
guicontrol,,FETXTG, Current
guicontrol,move,FETXTH, x329 y480 w47 h14
guicontrol,,FETXTH, System
guicontrol,move,FETXTN,x610 y190 w70 h16
guicontrol,,FETXTN,system theme
guicontrol,move,FETXTI,x580 y115 w146 h13
guicontrol,,FETXTI, Extensions (comma sperated)
guicontrol,move,FETXTJ,x424 y82 w326 h31
guicontrol,,FETXTJ,
guicontrol,move,FETXTL,x488 y155 w62 h13
guicontrol,,FETXTL,Full-Name
guicontrol,move,FETXTM, x490 y178 w49 h13
guicontrol,,FETXTM,Platform
guicontrol,move,FETXTO, x491 y201 w49 h13
guicontrol,,FETXTO,Name
guicontrol,move,FETXTP, x441 y6 w47 h15
guicontrol,,FETXTP,Launch
guicontrol,move,FEPRGA,x15 y500 w736 h7
guicontrol,,FEPRGA,0
curjmn= %ESHOME%\es_settings.cfg
bepvn= <bool name="ParseGamelistOnly" value="
;"
beqvn= <bool name="QuickSystemSelect" value="
;"
beavn= <bool name="VideoAudio" value="
;"
bebvn= <bool name="EnableSounds" value="
;"
beyvn= <string name="ThemeSet" value="
;"
seyvn= " />
;"
Loop,parse,emst_dtog,|
	{
		guicontrol,%fetog%,%A_LoopField%
	}
Loop,parse,emst_etog,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

esguitog:
Loop,parse,ESGUIITEMS,|
	{
		guicontrol,%esguitog%,%A_LoopField%
	}
return	
EmulationStationFEBUTA:
esguitog= disable
gosub,esguitog
guicontrolget,FEDDLD,,FEDDLD
guicontrol,disable,FEDDLD
guicontrol,disable,FEBUTA
if (FEDDLD = "")
	{
		SB_SetText("You need select a theme!")
		guicontrol,enable,FEDDLD
		guicontrol,enable,FEBUTA
		esguitog= enable
		gosub,esguitog
		return
	}
esteo=
dwnovr= false
if (FECHKC = 1)
	{
		dwnovr= true
	}
ifexist, %ESHOME%\themes\%FEDDLD%
	{
		esteo= 1
		if (FECHKC = 1)
			{
				esteo=
			}
	}
iniRead,URLFILE,sets\themes.set,%FEDDLD%,ESTHEME
if (URLFILE = "ERROR")
	{
		SB_SetText("This theme cannot be downloaded from the skeletonKey repository")
		guicontrol,enable,FEDDLD
		guicontrol,enable,FEBUTA
		esguitog= enable
		gosub,esguitog
		return
	}
save= rj\ES\%FEDDLD%.zip
extractpath= %ESHOME%\themes
splitpath,save,svaf,svap
exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
filegetsize,estsz,%save%,K
if (estsz < 1)
	{
		SB_SetText("Download Failed")
		guicontrol,enable,FEDDLD
		guicontrol,enable,FEBUTA
		esguitog= enable
		gosub,esguitog
		return
	}
ifnotexist,%save%
	{
		SB_SetText("Download Failed")
		guicontrol,enable,FEDDLD
		guicontrol,enable,FEBUTA
		esguitog= enable
		gosub,esguitog
		return
	}
if (esteo = "")
	{
		RunWait, %comspec% cmd /c " "%S_KeyDir%\bin\7za.exe" x -y "%save%" -O"%extractpath%" ",,hide
	}
ifexist, %ESHOME%\themes\%FEDDLD%
	{
		cursysthemelist=
		Loop, %ESHOME%\themes\%FEDDLD%\*,2
				{
					cursysthemelist.= A_LoopFileName . "|"
				}
		guicontrol,,FECBXA,|%cursysthemelist%
		guicontrol,,FECBXC,|%cursysthemelist%%systmfldrs%
		guicontrol,,FECBXD,|%cursysthemelist%%systmfldrs%
	}
SB_SetText("Current theme is " ESTHEME " ")
esguitog= enable
gosub,esguitog
return

EmulationStationFEBUTB:
esguitog= disable
gosub,esguitog
FECREATE= 1
PLCREATE= 
guicontrolget,FEDDLF,,FEDDLF
guicontrolget,FEDDLC,,FEDDLC
guicontrolget,FEDDLD,,FEDDLD
FileCopy,%ESHOME%\es_input.cfg,%ESHOME%\es_input.cfg.bak,1
FileCopy,%ESHOME%\es_settings.cfg,%ESHOME%\es_settings.cfg.bak,1
FileCopy,%ESHOME%\es_systems.cfg,%ESHOME%\es_systems.cfg.bak,1
TCURPL=
IniRead,prsy,EScfg.ini,ORDER,system_order
FileDelete,rj\ES\cursys.cfg
FileAppend,<systemList>`n,rj\ES\cursys.cfg
Loop, Parse, prsy,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		sysfin=
		sysesc= %A_LoopField%
		iniread,abr_es,EScfg.ini,%sysesc%,abbreviation
		iniread,dsp_es,EScfg.ini,%sysesc%,dsp_es
		iniread,ext_es,EScfg.ini,%sysesc%,ext_es
		iniread,emu_es,EScfg.ini,%sysesc%,emu_es
		stringreplace,extn,ext_es,`,,%A_Space%,All
		iniread,arg_es,EScfg.ini,%sysesc%,arg_es
		stringreplace,arg_es,arg_es,>,",All
		;"
		stringreplace,arg_es,arg_es,[ROMNAME],`%BASENAME`%,All
		stringreplace,arg_es,arg_es,[ROMPATH],`%ROM_RAW`%,All
		iniread,rmp_es,EScfg.ini,%sysesc%,rmp_es
		iniread,thm_es,EScfg.ini,%sysesc%,thm_es
		if instr(rmp_es,":")
			{
				sysesc= %rmp_es%	
				gosub, essysit
			}
		else {
			iniread,sysplfp,SystemLocations.ini,LOCATIONS,%dsp_es%
			Loop,parse,sysplfp,|
				{
					if (A_LoopField = "")
						{
							continue
						}
					sysplfw= %A_LoopField%
					gosub, essysit
				}
			continue
			}
	}
FileRead,escfg,sets\es_settings.cfg.set
stringreplace,escfg,escfg,[THEME],%FEDDLD%,All
stringreplace,escfg,escfg,[NAVSNDS],%esnavigationsounds%,All
stringreplace,escfg,escfg,[GAMEPARSE],%esparseonly%,All
stringreplace,escfg,escfg,[QUICKSEL],%esquicksystemselect%,All
stringreplace,escfg,escfg,[TRANS],%estransition%,All
stringreplace,escfg,escfg,[GAMELIST],%FEDDLC%,All
stringreplace,ESHOMER,ESHOME,\,/,All
stringreplace,escfg,escfg,[ESHOME],%ESHOMER%,All
stringreplace,escfg,escfg,[VRAM],%esvideoram%,All
stringreplace,escfg,escfg,[VIDSND],%videosnd%,All
if (FECHKB = 1)
	{
		FileMove,%ESHOME%\es_settings.cfg,%ESHOME%\es_settings.cfg.bak,1
	}
FileDelete,	%ESHOME%\es_settings.cfg
FileAppend,%escfg%,%ESHOME%\es_settings.cfg
if (FECHKB = 1)
	{
		FileCopy,sets\es_input.cfg.set,%ESHOME%\es_input.cfg,1
	}
FileAppend,</systemList>`n,rj\ES\cursys.cfg
filecopy, rj\ES\cursys.cfg, %ESHOME%\es_systems.cfg,1
msgbox,,Complete,ES configuration created,5
esguitog= enable
gosub,esguitog
return

initeshome:	
ifexist,%CURSRPTH%\.emulationstation
	{
		FileMoveDir,%eshfl%,%eshfl%_rnmd,R
		Runwait, %comspec% /c mklink /J "%eshfl%" "%CURSRPTH%\.emulationstation",,hide
	}
	else {
		FileCreateDir,%CURSRPTH%\.emulationstation
		if (ERRORLEVEL = 0)
			{
				goto, cplinites
			}
	}
return

essysit:
iniread,emushrtn,apps.ini,EMULATORS,%emu_es%
ifinstring,emu_es,:
	{
		stringsplit,emu_es,emushrtn
		emunmc=
		emushrtn= %emu_es%
	}
FileAppend,<system>`n,rj\ES\cursys.cfg
FileAppend,<name>%sysesc%</name>`n,rj\ES\cursys.cfg
FileAppend,<fullname>%dsp_es%</fullname>`n,rj\ES\cursys.cfg
FileAppend,<path>%sysplfw%</path>`n,rj\ES\cursys.cfg
FileAppend,<extension>%extn%</extension>`n,rj\ES\cursys.cfg
stringreplace,emushrtn,emushrtn,",,All
;"
splitpath,emushrtn,fxe,fp,xe,fn,fd
stringleft,fd,fd,1
stringtrimleft,fp,fp,3
FileAppend,<command>%fd%":\%fp%\%fxe%" %arg_es%</command>`n,rj\ES\cursys.cfg
FileAppend,<platform>%abr_es%</platform>`n,rj\ES\cursys.cfg
FileAppend,<theme>%thm_es%</theme>`n,rj\ES\cursys.cfg
FileAppend,</system>`n,rj\ES\cursys.cfg		
if (FECHKG = 1)
	{
		SYSNAME= %dsp_es%	
		gosub, plsavelp
	}
return

EmulationStationFEBUTC:
if (sysfnd = "")
	{
		return
	}
TCURPL=
inidelete,EScfg.ini,%curtxt%
Loop, Parse, ESCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = curtxt)
			{
				continue
			}
		TCURPL.= A_LoopField . "|"
	}
ESCURPL= %TCURPL%
iniwrite,%ESCURPL%,EScfg.ini,ORDER,system_order
ESCURPL= %TCURPL%
guicontrol,,FELBXA,|%ESCURPL%
return

EmulationStationFEBUTD:
selctsystmp=
FileSelectFolder,selctsystmp,,3,Select a ROM Directory for %curtxt%
if (selctsystmp = "")
	{
		return
	}
if (sysfnd = "")
	{
		return
	}
if ((FETXTJ <> selctsystmp)&&(selctsystmp = ""))
	{
		guicontrol,,FETXTJ,
		selctsystmp= %FECBXB%
	}
iniwrite,%selctsystmp%,ESCfg.ini,%curtnm%,syspath
return	
EmulationStationFEBUTE:
esguitog= disable
gosub, esguitog
SNFEITMS=
NFEITMS=
FEItems=
FEItems:= LVGetCheckedItems("", "ahk_id" . FELSTVA)
guicontrolget,SYSTHM,,FECBXA
IniRead,ESCURPL,EScfg.ini,ORDER,system_order
if (ESCURPL = "ERROR")
	{
		ESCURPL=
	}
if (sysfnd = 1)
	{
		SB_SetText("Current system is already added")
		esguitog= enable
		gosub, esguitog
		return
	}
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)  ; Resume the search at the row after that found by the previous iteration.
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
	}
Loop, Parse, ESCURPL,|
	{
		if (A_LoopField = curtxt)
			{
				SB_SetText("Current system is already in the playlist.")
				esguitog= enable
				gosub, esguitog
				return
			}
	}
ESCURPL.= curtxt . "|"
guicontrolget,FECBXB,,FECBXB
if (FECBXB = "")
	{
		FECBXB= %curtxt%
	}
guicontrolget,FECBXD,,FECBXD
if (FECBXD = "")
	{
		FECBXD= %curtxt%
	}
guicontrolget,FECBXA,,FECBXA
if (FECBXA = "")
	{
		FECBXA= %curtxt%
	}
if (SLCTDSN = "")
	{
		SLCTDSN= other
	}
guicontrolget,SLCTDEMU,,FEDDLG
if (SLCTDEMU = "other")
	{
		if (esemu = "")
			{
				SB_SetText("You must assign an Emulator")
				esguitog= enable
				gosub, esguitog
				return
			}
		SLCTDEMU= %esemu%
	}
ifinstring,SLCTDEMU,_libretro.dll
	{		
		SLCTDRW= -L "%raexedir%\cores\%SLCTDEMU%" >[ROMPATH]>
		SLCTDEMU= retroarch
	}
guicontrolget,SLCTDEXT,,FEEDTB
if (SLCTDEXT = "")
	{
		SLCTDEXT= .*
	}
guicontrolget,SLCTDRW,,FEEDTA
if (SLCTDRW = "")
	{
		SB_SetText("launch parameter set to  ''`%ROM_RAW`%''")
		SLCTDRW=>[ROMPATH]>
		guicontrol,,FEEDTA,%SLCTDRW%
	}
guicontrolget,selctsyst,,FETXTJ
if (selctsyst = "")
	{
		iniread,selctsystl,SystemLocations.ini,LOCATIONS,%fecbxb%
		if ((selctsystl = "")or(selctsystl = "ERROR"))
			{
				selctsyst= %RJSYSTEMS%
			}
			else {
				Loop,parse,selctsystl,|
					{
						selctsyst= %A_LoopField%
						break
					}
			}
	}	
SLCTDRW=%A_SPACE%%SLCTDRW%
IniWrite,%FECBXD%,ESCfg.ini,%curtxt%,abbreviation
IniWrite,%FECBXB%,ESCfg.ini,%curtxt%,dsp_es
IniWrite,%SLCTDEXT%,ESCfg.ini,%curtxt%,ext_es
IniWrite,%SLCTDEMU%,ESCfg.ini,%curtxt%,emu_es
IniWrite,"%SLCTDRW%",ESCfg.ini,%curtxt%,arg_es
IniWrite,%fecbxb%,ESCfg.ini,%curtxt%,rmp_es
IniWrite,%FECBXA%,ESCfg.ini,%curtxt%,thm_es
iniread,sysordr,EScfg.ini,ORDER,system_order
if (sysordr <> "ERROR")
	{
		ESCURPL= %sysordr%%curtxt%|
	}
guicontrol,,FELBXA,|%ESCURPL%
iniwrite,%ESCURPL%,EScfg.ini,ORDER,system_order
Gui,ListView,FELVA
LV_Modify(0, "-Check")
esguitog= enable
gosub, esguitog
return

EmulationStationFECBXA:
if (sysfnd = "")
	{
		return
	}
guicontrolget,SYSTHM,,FECBXA
guicontrolget,SYSNAM,,FECBXD
extpop= %curtxt%
iniwrite,%SYSTHM%,EScfg.ini,%extpop%,thm_es
return

EmulationStationFECBXC:
if (sysfnd = "")
	{
		return
	}
guicontrolget,FECBXC,,FECBXC
guicontrolget,FECBXD,,FECBXD
iniwrite,%FECBXC%,EScfg.ini,%FECBXD%,abbreviation
return

EmulationStationFECBXD:
guicontrolget,SYSREORDER,,FELBXA
guicontrolget,SYSNAMEREP,,FECBXD
if (sysfnd = "")
	{
		return
	}	
blockinput,on
iniread,sysreplace,EScfg.ini,%SYSREORDER%
inidelete,EScfg.ini,%SYSNAMEREP%
blockinput,off
ESRELST=
IniRead, ESQLIST,EScfg.ini,ORDER,system_order
IniDelete,EScfg.ini,GLOBAL,%SYSREORDER%
Loop,parse,sysreplace,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,dki,A_LoopField,=
		IniWrite,%dki2%,EScfg.ini,%SYSNAMEREP%,%dki1%
	}
Loop, Parse, ESQLIST,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = SYSREORDER)
			{
				ESRELST.= SYSNAMEREP . "|"
			}
		ESRELST.= A_LoopField . "|"
	}
guicontrol,,FELBXA,|%ESRELST%
return

EmulationStationFEDDLD:
guicontrolget,estheme,,FEDDLD
if (estheme = "")
	{
		SB_SetText("Select a theme")
		return
	}
iniwrite,%estheme%,EScfg.ini,CONFIG,theme
cursysthemelist=
ifexist,%ESHOME%\themes\%estheme%
	{
		Loop, %ESHOME%\themes\%estheme%\*,2
			{
				cursysthemelist.= A_LoopFileName . "|"
			}
		guicontrol,,FECBXA,|%cursysthemelist%
		guicontrol,,FECBXC,|%cursysthemelist%%systmfldrs%
		guicontrol,,FECBXD,|%cursysthemelist%%systmfldrs%
	}
	else {
		SB_SetText("Download this theme")
		return
	}
fileread,feij,%curjmn%
kivr= 
loop,parse,feij,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		kivr+=1	
		fej2= 	
		stringsplit,fej,A_LoopField,"
		;"
		if (fej2 = "ThemeSet")
			{
				TF_replaceline("!"curjmn,kivr,kivr,beyvn estheme seyvn)
				SB_SetText("Theme")
				break
			}
	}
return

EmulationStationFECBXB:
if (curtxt = "")
	{
		SB_SetText("You must select an added system to configure the ROM path")
		return
	}
if (sysfnd = "")
	{
		return
	}
guicontrolget,FECBXB,,FECBXB
extpop= %curtxt%
iniwrite,%FECBXB%,EScfg.ini,%curtxt%,dsp_es
return

EmulationStationFEDDLG:
if (sysfnd = "")
	{
		return
	}
pto=
guicontrolget,FEDDLG,,FEDDLG
if (FEDDLG = "other")
	{
		pto= 1
		esemu= other
		gosub,FEBUTH
		guicontrol,,FEDDLG,|other||%emuinstpop%
		guicontrol,enable,FEBUTE
		return
	}
ifinstring,FEDDLG,_libretro.dll
	{
		iniwrite,%A_SPace%-L "%raexedir%\cores\%FEDDLG%" >[ROMPATH]>,esCfg.ini,%curtxt%,arg_es
		iniwrite,retroarch,esCfg.ini,%curtxt%,emu_es
	}	
iniread,esemt,apps.ini,EMULATORS,%FEDDLG%
if (esemt = "ERROR")
	{
		esemu=
		guicontrol,disable,FEBUTE
		gosub, FEBUTH
		if (esemu = "")
			{
				return
			}
		iniwrite, "%esemu%",apps.ini,EMULATORS,%FEDDLG%
		guicontrol,enable,FEBUTE
	}
pto=
return

EmulationStationFEDDLF:
guicontrolget,FEDDLF,,FEDDLF
Gui,ListView,FELVA
LV_Delete()
Loop, %ESMIRROR%\*,2
		{
			LV_Add("",A_LoopFileName)
		}
LV_ModifyCol()
return

EmulationStationFEBUTH:
guicontrolget,sysfnd,,FEDDLG
FileSelectFile,esemutmp,3,,Select an emulator for %addsystm%
if (esemutmp = "")
	{
		return
	}
esemu= %esemutmp%
extpop= %curtxt%
iniwrite,%esemu%,EScfg.ini,%curtxt%,emu_es
guicontrol,,FEDDLG,|%esemu%||%emuinstpop%
return

EmulationStationFEDDLC:
guicontrolget,FEDDLC,,FEDDLC
iniwrite,%FEDDLC%,EScfg.ini,CONFIG,GameList
return

RESWARUN:
REZRUN:= A_Space "--windowed --resolution 640 480"
goto, REZRUN
RESWBRUN:
REZRUN:= A_Space "--windowed --resolution 720 480"
goto, REZRUN
RESWCRUN:
REZRUN:= A_Space "--windowed --resolution 1024 768"
goto, REZRUN
RESWDRUN:
REZRUN:= A_Space "--windowed --resolution 1280 720"
goto, REZRUN
RESWERUN:
REZRUN:= A_Space "--windowed --resolution 1280 1024"
goto, REZRUN
RESRSRUN:
FileDelete,ESCfg.ini
Goto, FEDDLJ
return

RESWFRUN:
REZRUN:= A_Space "--windowed --resolution 1920 1080"
goto, REZRUN
EmulationStationFEBUTK:
REZRUN=
REZRUN:
Run, %comspec% /c "%EmulationStation%"%REZRUN%,,hide
sb_settext(" " emulationstation "" REZRUN "")
return

EmulationStationFEBUTJ:
SB_SetText("")
iniDelete,EScfg.ini,ORDER,system_order
newnum=
olnum=
Loop, Parse, ESCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		olnum+=1
		systmv= A_LoopField
		if (A_LoopField = curtxt)
			{
				newnum:= olnum-1
			}
	}
if (newnum = 0)
	{
		sb_settext("Cannot move up")
		return
	}
TESCURPL=
olnum=
Loop, Parse, ESCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		olnum+=1
		if (A_LoopField = curtxt)
			{
				continue
			}
		if (olnum = newnum)
			{
				TESCURPL.= curtxt . "|"
			}
		TESCURPL.= A_LoopField . "|"
	}
ESCURPL= %TESCURPL%
iniwrite,%TESCURPL%,EScfg.ini,ORDER,system_order
guicontrol,,FELBXA,|%ESCURPL%
return

EmulationStationFESLDA:
guicontrolget,FESLDA,,FESLDA
iniwrite,%FESLDA%,EScfg.ini,CONFIG,VRAM
esvideoram= %FESLDA%
guicontrol,,FETXTE,VRAM Limit : %FESLDA%
return

EmulationStationFEBUTI:
SB_SetText("")
iniDelete,EScfg.ini,ORDER,system_order
mvnum=
mvtm=
Loop, Parse, ESCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		mvnum+=1
		if (A_LoopField = curtxt)
			{
				mvtm:= mvnum+1
			}
	}
totord:= mvnum
if (mvtm > totord)
	{
		SB_SetText("Cannot Move further down.")
		return
	}
TESCURPL=
mvnum=
Loop, Parse, ESCURPL,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		mvnum+=1
		if (A_LoopField = curtxt)
			{
				continue
			}
		TESCURPL.= A_LoopField . "|"
		if (mvtm = mvnum)
			{
				TESCURPL.= curtxt . "|"
			}
	}
ESCURPL= %TESCURPL%
guicontrol,,FELBXA,|%ESCURPL%
iniwrite,%TESCURPL%,EScfg.ini,ORDER,system_order
return

EmulationStationFEBUTF:
escfgtmp=
FileSelectFile,escfgtmp,3,,Select the es_systems.cfg,
if (escfgtmp = "")
	{
		return
	}
gosub,loadescfg
return

loadescfg:
ESLDPL=
LOADEDCFG=
ESTOPOP=
Loop, read, %escfgtmp%
	{
		if (A_LoopReadline = "")
			{
				continue
			}
		stringsplit,fjf,A_loopreadline,<>
		if (fjf2 = "system")
			{
				ESLDPL.= <system> . "`n"
			}
		if (fjf2 = "name")
			{
				gintp=
				vesname= %fjf3%
				stringleft,aund,fjf3,1
				if (aund = "_")
					{
						gintp= J
					}
				stringright,aund,fjf3,1
				if (aund = "_")
					{
						gintp= M
					}
				ESLDPL.= "<name>" . fjf3 . "</name>" . "`n"
			}
		if (fjf2 = "fullname")
			{
				vesfullname= %fjf3%
				ESLDPL.= "<fullname>" . fjf3 . "</fullname>" . "`n"
			}
		if (fjf2 = "extension")
			{
				vesextension= %fjf3%
				stringreplace,vesextension,vesextension,%A_Space%,`,,All
				ESLDPL.= "<extension>" . vesextension . "</extension>" . "`n"
			}
		if (fjf2 = "command")
			{
				vesemupath= %fjf3%
				stringreplace,vesetmp,vesemupath,",,All
				;"
				ifinstring,vesemupath,ROM
					{
						vesign= "
						;"
					}
				vespt1=
				vespt2=
				stringsplit,vespt,vesetmp,`%
				vesemutmp= %vespt1%
				vesopt=
				vesopt.= "`%" . vespt2 . "`%"
				ifinstring,vesemupath,BASENAME
					{
						vesign=
					}
				splitpath,vesemutmp,vesfxe,vesfp,vesxtn,,vesxd
				stringleft,vesxd,vesxd,1
				stringtrimleft,vesfp,vesfp,3
				ESLDPL.= "<command>" . vesxd . """" . ":" . "\" . vesfp . "\" . vesfxe . """" . A_Space .  vesign . vesopt . vesign . "</command>" . "`n"
			}
		if (fjf2 = "path")
			{
				vespath= %fjf3%
				ESLDPL.= "<path>" . fjf3 . "</path>" . "`n"
			}
		if (fjf2 = "platform")
			{
				vesplatform= %fjf3%
				ESLDPL.= "<platform>" . fjf3 . "</platform>" . "`n"
			}
		if (fjf2 = "theme")
			{
				vestheme= %fjf3%
				ESLDPL.= "<theme>" . fjf3 . "</theme>" . "`n"
			}
		if (fjf2 = "/system")
			{
				ESLDPL.= </system> . "`n"
				ESNM= %vesname%
				EROF= %vesname%
				if (gintp = "")
					{
						ifinstring,fesyslst,=%vesname%
							{
								EROF= %vesplatform%
							}
					}
				rdfnd=
				ESTOPOP.= EROF . "|"
				;;LOADEDCFG.= ESNM . "=" . vesplatform . "|" . vesfullname . "|" . vesextension . "|" . vesxd . """" . ":" . "\" . vesfp . "\" . vesfxe . """" . "|" . vesign . vesopt . vesign . "|" . vespath . "|" . vestheme . "`n"
				iniwrite, %vesplatform%,rj\es\loadsys.ini,%ESNM%,abbreviation
				iniwrite, %vesfullname%,rj\es\loadsys.ini,%ESNM%,dsp_es
				iniwrite, %vesextension%,rj\es\loadsys.ini,%ESNM%,ext_es
				iniwrite, %vesxd%":\%vesfp%\%vesfxe%",rj\es\loadsys.ini,%ESNM%,emu_es
				iniwrite, "%vesign%%vesopt%%vesign%",rj\es\loadsys.ini,%ESNM%,arg_es
				iniwrite, %vespath%,rj\es\loadsys.ini,%ESNM%,rmp_es
				iniwrite, %vestheme%,rj\es\loadsys.ini,%ESNM%,thm_es
			}		
	}
iniwrite,%esgameparse%,rj\es\loadsys.ini,CONFIG,Parse_Only
iniwrite,%esquickselect%,rj\es\loadsys.ini,CONFIG,quick_select
iniwrite,%esnavsnds%,rj\es\loadsys.ini,CONFIG,Navigation_Sounds
iniwrite,%esvideosnd%,rj\es\loadsys.ini,CONFIG,Video_Sound
iniwrite,%esvideoram%,rj\es\loadsys.ini,CONFIG,VRAM
iniwrite,%estheme%,rj\es\loadsys.ini,CONFIG,theme
iniwrite,%esgamelist%,rj\es\loadsys.ini,CONFIG,GameList
iniwrite,%estransition%,rj\es\loadsys.ini,CONFIG,transition
iniwrite,%ESHOME%,rj\es\loadsys.ini,CONFIG,home_directory
guicontrol,,FELBXA,|%ESTOPOP%
iniwrite,%ESTOPOP%,rj\es\loadsys.ini,ORDER,system_order
ESCURPL= %ESTOPOP%
fileCopy,EScfg.ini,EScfg.ini.bak,1
fileMove,rj\es\loadsys.ini,EScfg.ini,1
return

EmulationStationFEEDTA:
gui,submit,nohide
extpop= %curtxt%
guicontrolget,FEEDTA,,FEEDTA
if (sysfnd = "")
	{
		return
	}
iniwrite,"%FEEDTA%",EScfg.ini,%curtxt%,arg_es
return

EmulationStationFEEDTB:
guicontrolget,FEEDTB,,FEEDTB
if (sysfnd = "")
	{
		return
	}
iniwrite,%FEEDTB%,EScfg.ini,%curtxt%,ext_es	
return

EmulationStationFERAD5A:
guicontrol,,FEEDTB,.bat
guicontrol,,FEDDLG,|bsl||%runlist%
return

EmulationStationFERAD5B:
guicontrol,,FEEDTB,.lnk
guicontrol,,FEDDLG,|bsl||%runlist%
return

EmulationStationFERAD5C:
espopem=
iniread,allxtn,EmuCfgPresets.ini,%curtxt%,RJROMXT
iniread,esemuas,Assignments.ini,OVERRIDES,%curtxt%
if (esemuas = "")
	{
		iniread,esemudef,EmuCfgPresets.ini,%curtxt%,SUPEMU
		Loop,parse,esemudef,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				iniread,esapx,Apps.ini,Emulators,%A_LoopField%
				if ((esapx <> "ERROR")&&(esapx <> ""))
					{	
						if (espopem = "")
							{
								espopem.= A_LoopField . "||"
								continue
							}
						espopem.= A_LoopField . "|"
					}
			}
	}
	else {
		Loop,parse,esemuas,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (espopem = "")
					{
						espopem.= A_LoopField . "||"
						continue
					}
				espopem.= A_LoopField . "|"
			}
	}
guicontrol,,FEDDLG,|%espopem%%runlist%
guicontrol,,FEEDTB,%allxtn%
return

ESPOPULATESYS:
Gui,ListView,FELVA
Guicontrol,-checked,FELVA
Guicontrol,-Multi,FELVA
LV_Delete()
Loop, Parse, SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,syslk,A_LoopField,=
		iniread,sysxst,SystemLocations.ini,LOCATIONS,%syslk1%
		if ((sysxst <> "")&&(sysxst <> "ERROR"))
			{
				LV_Add("",syslk1)
			}
	}
LV_ModifyCol()
guicontrol,hide,FEDDLF
guicontrol,,FEDDLA,|Systems||ALL
return

EmulationStationFELVA:
GuiControl, Choose, FELBXA, 0
gui,listview,FELVA
guicontrol,enable,FEBUTE
curtxt=
sysfnd=
guicontrol,,FETXTJ,
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
	}
if (curtxt <> "")
	{
		Loop,Parse,ESFEGUIITEMS,|
			{
				guicontrol,disable,%A_LoopField%
			}
	}
Loop, Parse, ESCURPL,|
	{
		if (A_LoopField = curtxt)
			{
				curtxt=
				SB_SetText("Current system is already in the playlist.")
				guicontrol,disable,FEBUTE
				LV_Modify(RowNumber, "-Select")
				curtxt=
				Loop,Parse,ESFEGUIITEMS,|
					{
						guicontrol,enable,%A_LoopField%
					}
				return
			}
	}
if (curtxt = "other")
	{
		guicontrol,disable,FEBUTE
		SB_SetText("Define OTHER")
		curtxt=
		Loop,Parse,ESFEGUIITEMS,|
			{
				guicontrol,enable,%A_LoopField%
			}
		return
	}
Loop,parse,SysLLst,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,fbe,A_LoopField,=
		if (fbe1 = curtxt)
			{
				eshrtn= %fbe3%
				break
			}
	}
if (curtxt <> "")
	{
		inemuinp= 
		inra= 
		ingr= 
		iniread,emuinp,Assignments.ini,OVERRIDES,%curtxt%
		if ((emuinp <> "")&&(emuinp <> "ERROR"))
			{
				Loop,parse,emuinp,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						if (A_Index = 1)
							{
								ingr= %A_LoopField%
								ifinstring,ingr,_libretro
									{
										inra= 1
										inemuinp= retroarch||
										continue
									}
								inemuinp=%ingr%||
								continue
							}
						inemuinp.= ingr . "|"	
					}
			}
			else {
				iniread,emuinx,EmuCfgPresets.ini,%curtxt%,SUPEMU
				if ((emuinx <> "")&&(emuinx <> "ERROR"))
					{
						loop,parse,emuinx,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								INIREAD,TBST,Assignments.ini,ASSIGNMENTS,%A_LoopField%
								if ((tbst = "ERROR")or(tbst = ""))
									{
										continue
									}
								if !instr(inemuinp,A_LoopField)
									{
										if (inemuinp = "")
											{
												inemuinp= %A_LoopField%||
												continue
											}
										inemuinp.= A_LoopField . "|"
									}
							}
					}
				else {
					iniread,emuinc,EmuCfgPresets.ini,%curtxt%,SUPCORE
					if ((emuinc <> "")&&(emuinc <> "ERROR"))
						{
							loop,parse,emuinc,|
								{
									if (A_LoopField = "")
										{
											continue
										}
									ifnotexist,%raexedir%\cores\%A_LoopField%
										{
											continue	
										}
									if !instr(inemuinp,A_LoopField)
										{
											if (inemuinp = "")
												{
													inra= 
													ingr= %A_LoopField%
													inemuinp= %A_LoopField%||
													continue
												}
											inemuinp.= A_LoopField . "|"
										}
								}
						}	
					}
			}
		if (inemuinp = "")
			{
				inemuinp= MAME - Systems||
			}
		iniread,emupxt,EmuCfgPresets.ini,%curtxt%,RJROMXT
		if ((emupxt = "")or(emupxt = "ERROR"))
			{
				emupxt= .zip
			}
		iniread,emuppp,EmuCfgPresets.ini,%curtxt%,FEPARAM
		iniread,evr,Assignments.ini,ASSIGNMENTS,retroarch
		if (inra = 1)
			{
				emuppp= -L%A_Space%>%raexedir%\cores\%ingr%>%A_space%%emuppp%
			}
		guicontrol,,FEEDTA,%A_Space%%emuppp%
		guicontrol,,FEEDTB,%emupxt%
		guicontrol,,FEDDLG,|other|%inemuinp%%runlist%
		guicontrol,,FECBXB,%curtxt%||
		guicontrol,,FECBXD,%eshrtn%||
		guicontrol,,FECBXC,%eshrtn%||
		guicontrol,,FECBXA,%eshrtn%||
	}
	else {
		guicontrol,,FECBXB,%curtxt%||
		guicontrol,,FECBXD,%eshrtn%||
		guicontrol,,FECBXC,%eshrtn%||
		guicontrol,,FECBXA,%eshrtn%||
		guicontrol,,FEEDTA,%a_space%>[ROMPATH]>
		guicontrol,,FEEDTB,.zip
		guicontrol,,FEDDLG,|other|%inemuinp%%runlist%
	}
Loop,Parse,ESFEGUIITEMS,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

EmulationStationFELBXA:
gui,submit,nohide
guicontrolget,curtxt,,FELBXA
guicontrol,,FERAD5A,0
guicontrol,,FERAD5B,0
guicontrol,,FERAD5C,0
iniread,cesfn,ESCfg.ini,%curtxt%,dsp_es
iniread,cessn,ESCfg.ini,%curtxt%,abbreviation
iniread,cestn,ESCfg.ini,%curtxt%,thm_es
iniread,cesemu,ESCfg.ini,%curtxt%,emu_es	
iniread,cesemo,ESCfg.ini,%curtxt%,arg_es
iniread,cesxtn,ESCfg.ini,%curtxt%,ext_es
iniread,cessyp,ESCfg.ini,%curtxt%,rmp_es	
guicontrol,,fecbxb,%cesfn%||
guicontrol,,fecbxa,%cestn%||
guicontrol,,fecbxc,%cessn%||
guicontrol,,fecbxd,%cessn%||
guicontrol,,FEEDTA,%A_SPACE%%cesemo%
guicontrol,,FEEDTB,%cesxtn%
guicontrol,,FEDDLG,|other|%cesemu%||%runlist%
guicontrolget,curtxtm,,FECBXD
guicontrolget,curtxtp,,FECBXC
sysfnd= 1
return

EmulationStationFEBUTG:
MsgBox, 260, Clear List, Are you sure you want to clear all systems from the configuration list?
ifmsgbox, Yes
	{
		ESCURPL=
		ESTOPOP=
		guicontrol,,FELBXA,|
		filedelete,EScfg.ini
		Loop,Parse,ESFEGUIITEMS,|
			{
				guicontrol,disable,%A_LoopField%
			}
		gosub,ESINIT
		Loop,Parse,ESFEGUIITEMS,|
			{
				guicontrol,enable,%A_LoopField%
			}
	}
return

EmulationstationFERAD10A:
gui,submit,nohide
return

EmulationstationFERAD10B:
gui,submit,nohide
return

EmulationstationFERAD8A:
gui,submit,nohide
return

EmulationstationFERAD8B:
gui,submit,nohide
return

EmulationstationFERAD7A:
gui,submit,nohide
return

EmulationstationFERAD7B:
gui,submit,nohide
return

EmulationstationFERAD4A:
gui,submit,nohide
return

EmulationstationFERAD4B:
gui,submit,nohide
guicontrol,,ESROMONLY,1
return

EmulationStationFERAD2A:
iniwrite,slide,EScfg.ini,CONFIG,Transition
estransition= slide
return

EmulationStationFECHKB:
esvideosnd= %FECHKB%
iniwrite,%esvideosnd%,EScfg.ini,CONFIG,Video_Sound
videosnd= false
if (esvideosnd = 1)
	{
		videosnd= true
	}
fileread,feij,%curjmn%
kivr= 
loop,parse,feij,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		kivr+=1
		fej2= 
		stringsplit,fej,A_LoopField,"
		;"
		if (fej2 = "VideoAudio")
			{
				TF_replaceline("!"curjmn,kivr,kivr,beavn videosnd seyvn)
				break
			}
	}		
return

EmulationStationFECHKE:
esquickselect= %FECHKE%
iniwrite,%esquickselect%,EScfg.ini,CONFIG,quick_select
esquicksystemselect= false
if (FECHKE = 1)
	{
		esquicksystemselect= true
	}
fileread,feij,%curjmn%
kivr= 
loop,parse,feij,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		kivr+=1	
		fej2= 
		stringsplit,fej,A_LoopField,"
		;"
		if (fej2 = "QuickSystemSelect")
			{
				TF_replaceline("!"curjmn,kivr,kivr,beqvn esquicksystemselect seyvn)
				break
			}
	}		
return

EmulationStationFECHKD:
esgameparse= %FECHKD%
iniwrite,%esgameparse%,EScfg.ini,CONFIG,Parse_Only
esparseonly= false
if (FECHKD = 1)
	{
		esparseonly= true
	}
fileread,feij,%curjmn%
kivr= 
loop,parse,feij,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		kivr+=1	
		fej2= 
		stringsplit,fej,A_LoopField,"
		;"
		if (fej2 = "ParseGamelistOnly")
			{
				TF_replaceline("!"curjmn,kivr,kivr,bepvn esparseonly seyvn)
				break
			}
	}	
return

EmulationStationFECHKF:
esnavsnds= %FECHKF%
iniwrite,%esnavsnds%,EScfg.ini,CONFIG,Navigation_Sounds
esnavigationsounds= false
if (FECHKF = 1)
{
esnavigationsounds= true
}
kivr= 
fileread,feij,%curjmn%
loop,parse,feij,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		kivr+=1	
		fej2= 
		stringsplit,fej,A_LoopField,"
		;"
		if (fej2 = "EnableSounds")
			{
				TF_replaceline("!"curjmn,kivr,kivr,bebvn esnavigationsounds seyvn)
				break
			}
	}	
return

EmulationStationFECHKG:
gui,submit,nohide
return

EmulationStationFERAD2B:
iniwrite,Fade,EScfg.ini,CONFIG,Transition
estransition= Fade
return

EmulationStationFEDDLA:
guicontrolget,FEDDLA,,FEDDLA
goto, es%FEDDLA%
esALL:
Loop,parse,systmfldrs,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		LV_Add("",A_LoopField)
}
return

esSystems:
Loop,parse,fesyslst,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		revsys= % fe_%A_LoopField%	
		ifexist,%RJSYSTEMS%\%revsys%\
			{
				LV_Add("",revsys)
			}
	}
return

EmulationStationFECHKA:
return

EmulationStationFECHKC:
return

ESOPNPL:
Loop,Parse,ESPLSWAP,|
	{
		guicontrol,%opntog%,%A_LoopField%
	}
return

REMSYSTOG:
Loop,Parse,PGPLRI,|
	{
		guicontrol,%opltog%,%A_LoopField%
	}
guicontrol,%opltog%,ROMPOP
guicontrol,%opltog%,PLDBTXT
guicontrol,%opltog%,PLGBA
guicontrol,%opltog%,PLGBD
guicontrol,%opltog%,APNDTYPGRP
guicontrol,%opltog%,PLAPPND
guicontrol,%opltog%,PLOVR
guicontrol,%opltog%,CRCEnbl
guicontrol,%opltog%,ZIPSEEK
guicontrol,%opltog%,BRADD
guicontrol,%opltog%,PLCORE
guicontrol,%opltog%,DETECTCORE
guicontrol,%opltog%,SVPLST
guicontrol,%opltog%,PLNAMEDT
guicontrol,%opltog%,OPNPLST
guicontrol,%opltog%,PGCONFG
guicontrol,%opltog%,SVASPLST
guicontrol,%opltog%,SVAPLST
guicontrol,%opltog%,CPYPL
guicontrol,%opltog%,PLADPTXT
guicontrol,%opltog%,CLRPP
guicontrol,%opltog%,PLCLRPTXT
;;;;
Loop,Parse,ESPLRI,|
	{
		guicontrol,%opltog%,%A_LoopField%
	}
Loop,Parse,RFPLRI,|
	{
		guicontrol,%opltog%,%A_LoopField%
	}
return

ESROMROOT:
gui,submit,nohide
ESROOTFLDTMP=
SB_SetText("Current ROM folder is set to " ESROOTFLD "")
FileSelectFolder,ESROOTFLDTMP,,3,Select the ROM folder
if (ESROOTFLDTMP = "")
	{
		return
	}
stringright,efi,ESROOTFLDTMP,2
stringLeft,efix,ESROOTFLDTMP,2
if (efi = ":\")
	{
		ESROOTFLDTMP= %efix%
	}
ESROOTFLD= %ESROOTFLDTMP%
SB_SetText("Current ROM folder is set to " ESROOTFLD "")
guicontrol,,ESRRTXT, ROM Directory is SET
ESROMLST=
Loop, %ESROOTFLD%\*.*
	{
		ESROMLST.= A_LoopFileFullPath . "|"
	}
guicontrol,,ROMPOP,|%ESROMLST%
return

ESFLDRCR:
gui,submit,nohide
return

ESPOPCORE:
gui,submit,nohide
return

ESBackupPl:
gui,submit,nohide
return

ESSavePl:
gui,submit,nohide
FECREATE= 
PLCREATE= 1
SB_SetText("Creating Playlist ... ")
SYSNAME=
guicontrolget,SYSNAME,,ESPLXMP
if (SYSNAME = "")
	{
		SB_SetText("You Must have a name for your playlist.")
		return
	}
plsavelp:	
plsave=
if (plsave = "")
	{
		plsave= %ESHOME%\gamelists
	}
plstdir= %plsave%\%SYSNAME%
ifnotexist, %plstdir%
	{
		FileCreateDir,%plstdir%
	}
if (PLCREATE = 1)
	{
		ControlGet,curpllst, List,,,ahk_id %insel%
		existlst=
		Loop, Parse,curplLst,`n`r
			{
				if (A_LoopField <> ",")
				{
					taih1=
					taih2=
					stringsplit,taih,A_LoopField,>
					existlst .= (A_Index == 1 ? "" : "|") . taih1
				}
			}
	}
if (FECREATE = 1)
	{
		existlst=
		Loop, %rmp_es%\*.*,0,1
			{
				ifinstring,ext_es,.%A_LoopFileExt%
					{
						existlst.= (A_Index == 1 ? "" : "|") . A_LoopFileFullPath
					}
			}
	}
plmatch=
plsep=
plsep1=
plsep2=
coretitle=
ESPlaylistSaving:
guicontrol, disable, SVAPLST
guicontrol, disable, SVPLST
guicontrol,disable,ESPLCORE
guicontrol,disable,ROMPOP
guicontrol,disable,CURPLST
guicontrol,disable,CLRPP
guicontrol,disable,PLINIT
guicontrol,disable,MVPLOD
guicontrol,disable,MVPLOU
guicontrol,disable,CLRPL
guicontrol,disable,BRADD
guicontrol,disable,CPYPL
guicontrol,disable,REMPL
guicontrol,disable,ESSVPL
guicontrol,disable,ESOPENPL
guicontrol,disable,ESTHUMBSRCHBUT
guicontrol,disable,ESMARQSRCHBUT
guicontrol,disable,ESVIDSRCHBUT
ARCDTYP=
guicontrolget, ESPLCORE, ,ESPLCORE
ARCDTYPS= MAME|MAME - Arcade|arcade|model2|model3|cps|cps2|cps3|neocd|naomi|atomiswave|fba|cave
Loop,parse,ARCDTYPS,|
	{
		if (SYSNAME = A_LoopField)
			{
				ARCDTYP= 1
				break
			}
	}
FileDelete,tmp.xml
FileAppend,<gameList>`n,tmp.xml
FileCreateDir, %ESHOME%\downloaded_images\%SYSNAME%
FileCreateDir, %ESHOME%\downloaded_videos\%SYSNAME%
curfldrlst= 
curromnlst= 
Loop, Parse, existlst,|
	{
		TOTPTH= %A_LoopField%
		ifnotinstring,TOTPTH,:\
			{
				TOTPTH= %ESROOTFLD%\%A_LoopField%
			}
		stringsplit,fiv,TOTPTH,:
		ifinstring,TOTPTH,:\
			{
				TOTPTH= %fiv1%:%fiv2%
			}
			else {
					TOTPTH= %fiv1%	
			}
		splitpath,TOTPTH,romn,romind,romext,romname,romdd
		ifnotinstring,curromnlst,%romname%|
			{
				curromnlst.= romname . "|"
			}
			else {	
					addtildtoromn:
					if (romext <> "")
						{
							romname.= "~"
							ifinstring,curromnlst,%romname%
								{
									goto, addtildtoromn
								}
							curromnlst.= romname . "|"
						}
						else {
							continue
						}	
			}
		imgetn= %romname%
		avr= 
		sysnx= 
		Loop,parse,TOTPTH,\
			{
					if (A_LoopField = "")
						{
							continue
						}
					if (A_LoopField = SYSNAME)
						{
							avr:= A_Index
							continue
						}	
					if (avr = "")
						{
							continue
						}
					curfldrnm= %A_LoopField%
					sysnx+=1
			}
		fldrcr= 
		if (sysnx > 1)
			{
				ifnotinstring,curfldrlst,%romname%|
					{
						fldrcr= 1
						curfldrlst.= romname . "|"
					}
			}
		if (ESPLCORE = "Fuzzy-Match")
			{
				stringsplit,romspl,romname,([
				imgetn= %romspl1%*
			}
		ESK=
		imgetb= %imgetn%
		ESBOXPATH= %ASSETS%\%SYSNAME%\%romname%\BoxArt
		imgetb= %imgetn%
		ifnotexist,%ESBOXPATH%\
			{
				ESBOXPATH= 
			}
		if (ESBOXPATH = "")
			{
				ESBOX= 1
				ESBOXPATH= %ESHOME%\downloaded_images\%SYSNAME%
				imgetb= %imgetn%-image
			}
		ESIMG= 	
		ROMIMAGEMATCH=
		  Loop, %ESBOXPATH%\%imgetb%.*
			{
				ROMIMAGEMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMIMAGEMATCH,,,newxt
				ESIMG= 1
				FileCopy, %ROMIMAGEMATCH%, %ESHOME%\downloaded_images\%SYSNAME%\%romname%-image.%newxt%,1
				break
			}
		if (ESIMG = "")
			{
				Loop,Files,%RJSYSTEMS%\%SYSNAME%\%romname%\Folder.*
					{
						if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg"))
							{
								ROMIMAGEMATCH= %A_LoopFileFullPath%
								newxt=
								splitpath,ROMIMAGEMATCH,,,newxt
								ESIMG= 1
								FileCopy, %A_LoopFileFullPath%, %ESHOME%\downloaded_images\%SYSNAME%\%romname%-image.%newxt%,1
								break
							}
					}
				if ((ESIMG = "")&&(ESPLCORE = "Fuzzy-Match"))
					{
						Loop, Files, %RJSYSTEMS%\%SYSNAME%\%imgetb%,D
							{
								Loop, %A_LoopFileFullPath%\Folder.*
									{
										if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg"))
											{				
												ROMIMAGEMATCH= %A_LoopFileFullPath%
												newxt=
												splitpath,ROMIMAGEMATCH,,,newxt
												ESIMG= 1
												FileCopy, %A_LoopFileFullPath%, %ESHOME%\downloaded_images\%SYSNAME%\%romname%-image.%newxt%,1
												break
											}
									}
								if (ESIMG = 1)
									{
										break
									}
							}					
					}
				if (ESIMG = "")
					{
						MISREPIMG= Icons
						ifexist,%ESHOME%\downloaded_images\%SYSNAME%.png
							{
								ESIMG= 1
								ROMIMAGEMATCH= %ESHOME%\downloaded_images\%SYSNAME%.png
							}
							else {
									ifexist,rj\netart\%FEDDLD%\%SYSNAME%\%MISREPIMG%\%SYSNAME%.png
										{
											filecopy, rj\netart\%FEDDLD%\%SYSNAME%\%MISREPIMG%\%SYSNAME%.png,%ESHOME%\downloaded_images\%SYSNAME%.png
											ESIMG= 1
											ROMIMAGEMATCH= %ESHOME%\downloaded_images\%SYSNAME%.png
										}
							}
					}
			}
		ESMARQ=
		imgetm= %imgetn%
		ESMARQUEEPATH= %ASSETS%\%SYSNAME%\%romname%\Marquees
		imgetb= %imgetn%
		ifnotexist,%ESMARQUEEPATH%\
			{
				ESMARQUEEPATH= 
			}
		if (ESMARQUEEPATH = "")
			{
				ESMARQ= 1
				ESMARQUEEPATH= %ESHOME%\downloaded_images\%SYSNAME%
				imgetm= %imgetn%-marquee
			}
		ROMMARQUEEMATCH=
		Loop, %ESMARQUEEPATH%\%imgetm%.*
			{
				ROMMARQUEEMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMMARQUEEMATCH,,,newxt
				ESMARQ= 1
				FileCopy, %ROMMARQUEEMATCH%, %ESHOME%\downloaded_images\%SYSNAME%\%romname%-marquee.%newxt%,1
				break
			}
		if (ESMARQ = "")
			{
				Loop,Files,%RJSYSTEMS%\%SYSNAME%\%romname%\Logo.*
					{
						if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg"))
							{
								ROMMARQUEEMATCH= %A_LoopFileFullPath%
								newxt=
								splitpath,ROMMARQUEEMATCH,,,newxt
								ESMARQ= 1
								FileCopy, %A_LoopFileFullPath%, %ESHOME%\downloaded_images\%SYSNAME%\%romname%-marquee.%newxt%
								break
							}
					}
				if ((ESMARQ = "")&&(ESPLCORE = "Fuzzy-Match"))
					{
						Loop, Files, %RJSYSTEMS%\%SYSNAME%\%imgetb%,D
							{
								Loop, %A_LoopFileFullPath%\Logo.*
									{
										if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg"))
											{
												ROMMARQUEEMATCH= %A_LoopFileFullPath%
												newxt=
												splitpath,ROMMARQUEEMATCH,,,newxt
												ESMARQ= 1
												FileCopy, %A_LoopFileFullPath%, %ESHOME%\downloaded_images\%SYSNAME%\%romname%-marquee.%newxt%
												break
											}
									}
								if (ESMARQ = 1)
									{
										break
									}	
							}					
					}
				if (ESMARQ = "")
					{
						MISREPIMG= Logos
						ifexist,%ESHOME%\downloaded_images\%SYSNAME%-logo.png
								{
									ESMARQ= 1
									ROMMARQUEEMATCH= %ESHOME%\downloaded_images\%SYSNAME%-logo.png
								}
								else {
										ifexist,rj\netart\%FEDDLD%\%SYSNAME%\%MISREPIMG%\%SYSNAME%.png
											{
												filecopy, rj\netart\%FEDDLD%\%SYSNAME%\%MISREPIMG%\%SYSNAME%.png,%ESHOME%\downloaded_images\%SYSNAME%-logo.png
												ESMARQ= 1
												ROMMARQUEEMATCH= %ESHOME%\downloaded_images\%SYSNAME%-logo.png
											}
								}
					}
			}
		ESTHU=
		imgett= %imgetn%
		ESTHUMBNAILPATH= %ASSETS%\%SYSNAME%\%romname%\Snapshots
		imgetb= %imgetn%
		ifnotexist,%ESTHUMBNAILPATH%\
			{
				ESTHUMBNAILPATH=
			}
		if (ESTHUMBNAILPATH = "")
			{
				ESTHU= 1
				ESTHUMBNAILPATH= %ESHOME%\downloaded_images\%SYSNAME%
				imgett= %imgetn%-thumb
			}
		ROMTHUMBNAILMATCH=
		Loop, %ESTHUMBNAILPATH%\%imgett%.*
			{
				ROMTHUMBNAILMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMTHUMBNAILMATCH,,,newxt
				ESTHU= 1
				FileCopy, %ROMTHUMBNAILMATCH%, %ESHOME%\downloaded_images\%SYSNAME%\%romname%-thumb.%newxt%,1
				break
			}
		if (ESTHU = "")
			{
				Loop,Files,%RJSYSTEMS%\%SYSNAME%\%romname%\.snaps\*.*
					{
						if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg")or(A_LoopFileExt = "bmp")or(A_LoopFileExt = "gif"))
							{
								ROMTHUMBNAILMATCH= %A_LoopFileFullPath%
								newxt=
								splitpath,ROMTHUMBNAILMATCH,,,newxt
								ESTHU= 1
								FileCopy, %A_LoopFileFullPath%, %ESHOME%\downloaded_images\%SYSNAME%\%romname%-thumb.%newxt%,1
								break
							}
					}
				if ((ESTHU = "")&&(ESPLCORE = "Fuzzy-Match"))
					{
						Loop, Files, %RJSYSTEMS%\%SYSNAME%\%imgetb%,D
							{
								Loop, %A_LoopFileFullPath%\Logo.*
									{
										if ((A_LoopFileExt = "png")or(A_LoopFileExt = "jpg")or(A_LoopFileExt = "bmp")or(A_LoopFileExt = "gif"))
											{
												ROMTHUMBNAILMATCH= %A_LoopFileFullPath%
												newxt=
												splitpath,ROMTHUMBNAILMATCH,,,newxt
												ESTHU= 1
												FileCopy, %A_LoopFileFullPath%, %ESHOME%\downloaded_images\%SYSNAME%\%romname%-thumb.%newxt%,1
												break
											}
									}								
							if (ESTHU = 1)
								{
									break
								}
							}	
					}
					if (ESTHU = "")
						{
							MISREPIMG= Backdrops
							ifexist,%ESHOME%\downloaded_images\%SYSNAME%-thumb.png
								{
									ESTHU= 1
									ROMTHUMBNAILMATCH= %ESHOME%\downloaded_images\%SYSNAME%-thumb.png
								}
								else {
										ifexist,rj\netart\%FEDDLD%\%SYSNAME%\%MISREPIMG%\%SYSNAME%.png
											{
												filecopy, rj\netart\%FEDDLD%\%SYSNAME%\%MISREPIMG%\%SYSNAME%.png,%ESHOME%\downloaded_images\%SYSNAME%-thumb.png
												ESTHU= 1
												ROMTHUMBNAILMATCH= %ESHOME%\downloaded_images\%SYSNAME%-thumb.png
											}
								}
						}
			}
		ESVID=
		imgetv= %imgetn%
		ESVIDEOPATH= %ASSETS%\%SYSNAME%\%romname%\Videos
		imgetb= %imgetn%
		ifnotexist,%ESVIDEOPATH%\
			{
				ESVIDEOPATH= 
			}
		if (ESVIDEOPATH = "")
			{
				ESVID= 1
				ESVIDEOPATH= %ESHOME%\download_videos\%SYSNAME%
				imgetv= %imgetn%-video
			}
		ROMVIDEOMATCH=
		Loop, %ESVIDEOPATH%\%imgetv%.*
			{
				ROMVIDEOEMATCH= %A_LoopFileFullPath%
				newxt=
				splitpath,ROMVIDEOEMATCH,,,newxt
				ESVID= 1
				FileCreateDir, %ESHOME%\downloaded_videos\%SYSNAME%\
				FileCopy, %ROMVIDEOEMATCH%, %ESHOME%\downloaded_videos\%SYSNAME%\%romname%-video.%newxt%,1
				break
			}
		if (ESVID = "")
			{
				Loop,Files,%RJSYSTEMS%\%SYSNAME%\%romname%\backdrops\*.*
					{
						if ((A_LoopFileExt = "mp4")or(A_LoopFileExt = "avi"))
							{
								ROMVIDEOEMATCH= %A_LoopFileFullPath%
								newxt=
								splitpath,ROMVIDEOEMATCH,,,newxt
								ESVID= 1
								FileCopy, %A_LoopFileFullPath%, %ESHOME%\downloaded_videos\%SYSNAME%\%romname%-video.%newxt%
								break
							}
					}
				if ((ESVID = "")&&(ESPLCORE = "Fuzzy-Match"))
					{
						Loop, Files, %RJSYSTEMS%\%SYSNAME%\%imgetb%,D
							{
								Loop, %A_LoopFileFullPath%\*.*
									{
										if ((A_LoopFileExt = "mp4")or(A_LoopFileExt = "avi"))
											{
												ROMVIDEOEMATCH= %A_LoopFileFullPath%
												newxt=
												splitpath,ROMVIDEOEMATCH,,,newxt
												ESVID= 1
												FileCopy, %A_LoopFileFullPath%, %ESHOME%\downloaded_videos\%SYSNAME%\%romname%-video.%newxt%
												break
											}
									}								
								if (ESVID = 1)
									{
										break
									}
							}			
					}
				if (ESVID = "")
					{
						ifexist,%ESHOME%\downloaded_videos\%SYSNAME%\%SYSNAME%.mp4
							{
								ESVID= 1
								ROMVIDEOEMATCH= %ESHOME%\downloaded_videos\%SYSNAME%\%SYSNAME%.mp4
							}
						else {
								ifexist,rj\netart\%FEDDLD%\%SYSNAME%\Video\%SYSNAME%.mp4
									{
										ESVID= 1
										filecopy,rj\netart\%FEDDLD%\%SYSNAME%\Video\%SYSNAME%.mp4,%ESHOME%\downloaded_videos\%SYSNAME%\%SYSNAME%.mp4
										ROMVIDEOEMATCH= %ESHOME%\downloaded_videos\%SYSNAME%\%SYSNAME%.mp4
									}										
									else {
										ifexist,%ESHOME%\downloaded_videos\%SYSNAME%\%SYSNAME%.mp4							
										ESVID= 1
										ROMVIDEOEMATCH= %ESHOME%\downloaded_videos\%SYSNAME%\%SYSNAME%.mp4
									}
						}	
					}
			}
		pulmeta=
		pulrate=
		puldate=
		pulhid=
		puldev=
		pulpub=
		pulgen=
		pulpl=
		pulkid=
		pulfav=
		metaspl1=
		metaspl2=
		metaspl3=
		Loop, %ASSETS%\%SYSNAME%\%romname%\MetaData\*.xml
			{
				fndmet=
				FileRead,metadt,%A_LoopFileFullPath%
				Loop, Parse, metadt,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,metaspl,A_LoopField,<>
						if (metaspl2 = "hidden")
							{
								pulhid= %metaspl3%
							}
						if (metaspl2 = "kidgame")
							{
								pulfav= %metaspl3%
							}
						if (metaspl2 = "favorite")
							{
								pulfav= %metaspl3%
							}
						if (metaspl2 = "released")
							{
								puldate= %metaspl3%
							}
						if (metaspl2 = "developer")
							{
								puldev= %metaspl3%
							}
						if (metaspl2 = "publisher")
							{
								pulpub= %metaspl3%
							}
						if (metaspl2 = "genre")
							{
								pulgen= %metaspl3%
							}
						if (metaspl2 = "players")
							{
								pulpl= %metaspl3%
							}
						if (metaspl2 = "lastplayed")
							{
								pullast= %metaspl3%
							}
						if (metaspl2 = "playcount")
							{
								pulcnt= %metaspl3%
							}
						if (metaspl2 = "rating")
							{
								pulrate= %metaspl3%
							}
						if (metaspl2 = "desc")
							{
								fndmet= 1
								pulmeta.= metaspl3
								if (metaspl4 = "/desc")
									{
										fndmet=
									}
							}
						if (metaspl2 = "plot")
							{
								fndmet= 1
								pulmeta.= metaspl3
								if (metaspl4 = "/plot")
									{
										fndmet=
									}
							}
						if (metaspl2 = "overview")
							{
								fndmet= 1
								pulmeta.= metaspl3
								if (metaspl4 = "/overview")
									{
										fndmet=
									}
							}
						if (metaspl2 = "notes")
							{
								fndmet= 1
								pulmeta.= metaspl3
								if (metaspl4 = "/notes")
									{
										fndmet=
									}
							}
						if (fndmet = 1)
							{
								pulmeta.= A_LoopField . "`n"
								ifinstring, pulmeta,</desc>
									{
										fndmet=
									}
							}
					}
		break
			}
		pthrom= %TOTPTH%
		if (ESVID = 1)
			{
				stringreplace,ROMVIDEOMATCH,ROMVIDEOMATCH,%ESVIDEOPATH%,~/.emulationstation/downloaded_videos/%SYSNAME%,All
				stringreplace,ROMVIDEOMATCH,ROMVIDEOMATCH,\,/,All
			}
		if (ESMARQ = 1)
			{
				stringreplace,ROMMARQUEEMATCH,ROMMARQUEEMATCH,%ESMARQUEEPATH%,~/.emulationstation/downloaded_images/%SYSNAME%,All
				stringreplace,ROMMARQUEEMATCH,ROMMARQUEEMATCH,\,/,All
			}
		if (ESTHU = 1)
			{
				stringreplace,ROMTHUMBNAILMATCH,ROMTHUMBNAILMATCH,%ESTHUMBNAILPATH%,~/.emulationstation/downloaded_images/%SYSNAME%,All
				stringreplace,ROMTHUMBNAILMATCH,ROMTHUMBNAILMATCH,\,/,All
			}
		if (ESBOX = 1)
			{
				stringreplace,ROMIMAGEMATCH,ROMIMAGEMATCH,%ESBOXPATH%,~/.emulationstation/downloaded_images/%SYSNAME%,All
				stringreplace,ROMIMAGEMATCH,ROMIMAGEMATCH,\,/,All
			}	
		ifinstring,pthrom,:
			{
				stringreplace,pthrom,pthrom,%RJSYSTEMS%\%SYSNAME%\,,All
			}
		stringreplace,pthrom,pthrom,\,/,All
		romsfi= ./%romn%
		if (pulfav = "")
			{
				pulfav= false
			}
		if (pulkid = "")
			{
				pulkid= false
			}
		if (pulhid = "")
			{
				pulhid= false
			}
		if (fldrcr = 1)
			{
				FileAppend,<folder>`n,tmp.xml
				FileAppend,<name>%romname%</name>`n,tmp.xml
				stringreplace,pthromf,pthrom,/%romn%,,All
				FileAppend,<path>./%pthromf%</path>`n,tmp.xml
				FileAppend,<image>%ROMIMAGEMATCH%</image>`n,tmp.xml
				FileAppend,<thumbnail>%ROMTHUMBNAILMATCH%</thumbnail>`n,tmp.xml
				FileAppend,<marquee>%ROMBANMATCH%</marquee>`n,tmp.xml
				FileAppend,<video>%ROMVIDMATCH%</video>`n,tmp.xml
				FileAppend,<rating>%pulrate%</rating>`n,tmp.xml
				FileAppend,<kidgame>%pulkid%</kidgame>`n,tmp.xml
				FileAppend,<hidden>%pulhid%</hidden>`n,tmp.xml
				FileAppend,<favorite>%pulfav%</favorite>`n,tmp.xml
				FileAppend,<releasedate>%puldate%</releasedate>`n,tmp.xml
				FileAppend,<developer>%puldev%</developer>`n,tmp.xml
				FileAppend,<publisher>%pulpub%</publisher>`n,tmp.xml
				FileAppend,<desc>%pulmeta%</desc>`n,tmp.xml
				FileAppend,<genre>%pulgen%</genre>`n,tmp.xml
				FileAppend,<players>%pulpl%</players>`n,tmp.xml
				FileAppend,<playcount>%pulcnt%</playcount>`n,tmp.xml
				FileAppend,<lastplayed>%pullast%</lastplayed>`n,tmp.xml
				FileAppend,</folder>`n,tmp.xml
			}		
		FileAppend,<game>`n,tmp.xml
		FileAppend,<name>%romname%</name>`n,tmp.xml
		FileAppend,<path>./%pthrom%</path>`n,tmp.xml
		FileAppend,<image>%ROMIMAGEMATCH%</image>`n,tmp.xml
		FileAppend,<thumbnail>%ROMTHUMBNAILMATCH%</thumbnail>`n,tmp.xml
		FileAppend,<marquee>%ROMBANMATCH%</marquee>`n,tmp.xml
		FileAppend,<video>%ROMVIDMATCH%</video>`n,tmp.xml
		FileAppend,<rating>%pulrate%</rating>`n,tmp.xml
		FileAppend,<kidgame>%pulkid%</kidgame>`n,tmp.xml
		FileAppend,<hidden>%pulhid%</hidden>`n,tmp.xml
		FileAppend,<favorite>%pulfav%</favorite>`n,tmp.xml
		FileAppend,<releasedate>%puldate%</releasedate>`n,tmp.xml
		FileAppend,<developer>%puldev%</developer>`n,tmp.xml
		FileAppend,<publisher>%pulpub%</publisher>`n,tmp.xml
		FileAppend,<desc>%pulmeta%</desc>`n,tmp.xml
		FileAppend,<genre>%pulgen%</genre>`n,tmp.xml
		FileAppend,<players>%pulpl%</players>`n,tmp.xml
		FileAppend,<playcount>%pulcnt%</playcount>`n,tmp.xml
		FileAppend,<lastplayed>%pullast%</lastplayed>`n,tmp.xml
		FileAppend,</game>`n,tmp.xml
	}
	FileAPpend,</gameList>,tmp.xml
if (ESBACKUP = 1)
	{
		FileCopy,%plstdir%\gamelist.xml,%plstdir%\%SYSNAME%_gamelist.xml.bak,1
	}
plovr= 	
if ((FECHKG = 1)&&(FECREATE = 1)or(PLCREATE = 1)&&(PlaylistAppend = 1))
	{
		plovr= 1
	}
SB_SetText(" creating " plstdir " gamelist")
FileCopy,tmp.xml,%plstdir%\gamelist.xml,%plovr%
if (ERRORLEVEL = 0)
	{	
		if (PLCREATE = 1)
			{
				MsgBox,1,GameList Created,Created %plstdir%`nGamelist created.,5	
			}
		SB_SetText(" " plstdir " gamelist created")
	}
guicontrol, enable, SVAPLST
guicontrol, enable, SVPLST
guicontrol,enable,ESPLCORE
guicontrol,enable,ROMPOP
guicontrol,enable,CURPLST
guicontrol,enable,CLRPP
guicontrol,enable,PLINIT
guicontrol,enable,MVPLOU
guicontrol,enable,MVPLOD
guicontrol,enable,CLRPL
guicontrol,enable,BRADD
guicontrol,enable,CPYPL
guicontrol,enable,REMPL
guicontrol,enable,ESSVPL
guicontrol,enable,ESOPENPL
guicontrol,enable,ESTHUMBSRCHBUT
guicontrol,enable,ESMARQSRCHBUT
guicontrol,enable,ESVIDSRCHBUT
return

EsPlaylistNames:
gui,submit,nohide
return

EsOpenPl:
gui,submit,nohide
ESGAMLOTMP=
guicontrolget,SYSNAME,,ESPLXMP
FileSelectFile,ESGAMLOTMP,3,%eshome%\gamelists\%SYSNAME%,Select a gamelist file, gamelist (*.xml)
if (ESGAMLOTMP = "")
	{
		return
	}
INPLAYL= 1
splitpath,ESGAMLOTMP,ESGAMLOMN,ESGAMLOD,,ESGAMLODIR
splitpath,ESGAMLOD,,,,syspfl
ifnotexist,rj\es\%syspfl%
	{
		FileCreateDir,rj\es\%syspfl%
	}
splitpath,ESGSAMLOD,EsGamLstF,
ifinstring,SysLLst,%syspfl%=
	{
		syssub= %syspfl%
	}
FileDelete,rj\es\%syspfl%\*.ini
FileDelete,rj\es\n.xml
ESGAMLO= %ESGAMLOTMP%
ESGAMX=
FileRead, ESGAMX,%ESGAMLO%
SB_SetText("POPULATING")
ESINIPOP=
ngame=
ren=
Loop, Parse, ESGAMX,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "game")
			{
				ngame=
				ngame.= "<game>" . "`n"
				continue
			}
		if (clut2 = "folder")
			{
				ngame=
				ngame.= "<folder>" . "`n"
				continue
			}
		if (clut2 = "path")
			{
				esfpath= %clut3%
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "name")
			{
				ren:= clut3
				stringreplace,ren,ren,\,,All
				stringreplace,ren,ren,/,,All
				stringreplace,ren,ren,?,-,All
				stringreplace,ren,ren,<,-,All
				stringreplace,ren,ren,>,-,All
				stringreplace,ren,ren,=,-,All
				stringreplace,ren,ren,`%,-,All
				stringreplace,ren,ren,*,-,All
				stringreplace,ren,ren,:,-,All
				stringreplace,ren,ren,&#39;,',All
				stringreplace,ren,ren,&amp;,&,All
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "image")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "marquee")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "video")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "desc")
			{
				desx= %clut3%
				ngame.= "<" . clut2 . ">" . desx . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "plot")
			{
				desx= %clut3%
				ngame.= "<" . clut2 . ">" . desx . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "overview")
			{
				desx= %clut3%
				ngame.= "<" . clut2 . ">" . desx . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "notes")
			{
				desx= %clut3%
				ngame.= "<" . clut2 . ">" . desx . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "rating")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "releasedate")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "kidgame")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "favorite")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "hidden")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "thumbnail")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "developer")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "publisher")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "genre")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "players")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "playcount")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "lastplayed")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "rating")
			{
				ngame.= "<" . clut2 . ">" . clut3 . "</" . clut2 . ">" . "`n"
				continue
			}
		if (clut2 = "/folder")
			{
				ngame.= "</folder>" . "`n"
				if (ren = "")
					{
						stringreplace,esfpath,esfpath,/,\,All
						splitpath,esfpath,,,,ren
					}
				incv=
				inc=
				INCMOVEF:
				FileAppend,%ngame%`n,rj\es\n.xml
				fileMove,rj\es\n.xml,rj\es\%syspfl%\%ren%%incv%.ini
				if (ERRORLEVEL > 0)
					{
						inc+=1
						incv= _%inc%
						if (inc < 10)
							{
								goto, INCMOVEF
							}
					}
				ESINIPOP.= ren . incv . ":" . syspfl . "|"
				ren=
				esfpath=
				continue
			}
		if (clut2 = "/game")
			{
				ngame.= "</game>" . "`n"
				if (ren = "")
					{
						stringreplace,esfpath,esfpath,/,\,All
						splitpath,esfpath,,,,ren
					}
				incv=
				inc=
				INCMOVEG:
				FileAppend,%ngame%`n,rj\es\n.xml
				fileMove,rj\es\n.xml,rj\es\%syspfl%\%ren%%incv%.ini
				if (ERRORLEVEL > 0)
					{
						inc+=1
						incv= _%inc%
						if (inc < 10)
							{
								goto, INCMOVEG
							}
					}
				ESINIPOP.= ren . incv . ":" . syspfl . "|"
				ren=
				esfpath=
				continue
			}
	}
guicontrol,,CURPLST,|%ESINIPOP%
SB_SetText("COMPLETE")
opltog= hide
gosub, REMSYSTOG
opntog= show
gosub, ESOPNPL
return

ESCPYSCR:
gui,submit,nohide
return

ESUSESCR:
gui,submit,nohide
return

ESMARQSRCHBUT:
gui,submit,nohide
ESMARQUEEPATHTMP=
FileSelectFolder,ESMARQUEEPATHTMP,,3,Select the path to banners for this system
if (ESMARQUEEPATHTMP = "")
	{
		if (ESMARQUEEPATH <> "")
			{
				MsgBox,260,Reset Maquee Path,Would you like to clear the current banner path?
				ifmsgbox,OK
					{
						ESMARQUEEPATH=
						SB_SetText("Marquee path cleared")
						guicontrol,,ESMRQCHK,0
					}
			}
		return
	}
stringright,efi,ESMARQUEEPATHTMP,2
stringLeft,efix,ESMARQUEEPATHTMP,2
if (efi = ":\")
	{
		ESMARQUEEPATHTMP= %efix%
	}	
ESMARQUEEPATH= %ESMARQUEEPATHTMP%
SB_SetText("Marquee path set to " ESMARQUEEPATH " ")
guicontrol,,ESMRQCHK,1
return

ESVIDSRCHBUT:
gui,submit,nohide
ESVIDEOPATHTMP=
FileSelectFolder,ESVIDEOPATHTMP,,3,Select the path to videos for this system
if (ESVIDEOPATHTMP = "")
	{
		if (ESVIDEOPATH <> "")
			{
				MsgBox,260,Reset Video Path,Would you like to clear the current Video path?
				ifmsgbox,OK
					{
						ESVIDEOPATH=
						SB_SetText("VIDEO path cleared")
						guicontrol,,ESVIDCHK,0
					}
			}
		return
	}
stringright,efi,ESVIDEOPATHTMP,2
stringLeft,efix,ESVIDEOPATHTMP,2
if (efi = ":\")
	{
		ESVIDEOPATHTMP= %efix%
	}	
ESVIDEOPATH= %ESVIDEOPATHTMP%
SB_SetText("VIDEO path set to " ESVIDEOPATH " ")
guicontrol,,ESVIDCHK,1
return

ESTHUMBSRCHBUT:
gui,submit,nohide
ESTHUMBNAILPATHTMP=
FileSelectFolder,ESTHUMBNAILPATHTMP,,3,Select the path to thumbnails for this system
if (ESTHUMBNAILPATHTMP = "")
	{
		if (ESTHUMBNAILPATH <> "")
			{
				MsgBox,260,Reset Thumnails Path,Would you like to clear the current thumbnail path?
				ifmsgbox,OK
					{
						ESTHUMBNAILPATH=
						SB_SetText("thumbnail path cleared")
						guicontrol,,ESTHMBCHK,0
					}
			}
		return
	}
stringright,efi,ESTHUMBNAILPATHTMP,2
stringLeft,efix,ESTHUMBNAILPATHTMP,2
if (efi = ":\")
	{
		ESTHUMBNAILPATHTMP= %efix%
	}	
ESTHUMBNAILPATH= %ESTHUMBNAILPATHTMP%
SB_SetText("Thumbnails path set to " ESTHUMBNAILPATH " ")
guicontrol,,ESTHMBCHK,1
return

ESBOXSRCHBUT:
gui,submit,nohide
ESBOXPATHTMP=
FileSelectFolder,ESBOXPATHTMP,,3,Select the path to boxarts for this system
if (ESBOXPATHTMP = "")
	{
		if (ESBOXPATH <> "")
			{
				MsgBox,260,Reset Box-Art Path,Would you like to clear the current Box-Art path?
				ifmsgbox,OK
					{
						ESBOXPATH=
						SB_SetText("Box-Art path cleared")
						guicontrol,,ESBOXCHK,0
					}
			}
		return
	}
stringright,efi,ESBOXPATHTMP,2
stringLeft,efix,ESBOXPATHTMP,2
if (efi = ":\")
	{
		ESBOXPATHTMP= %efix%
	}	
ESBOXPATH= %ESBOXPATHTMP%
SB_SetText("Box-Art path set to " ESBOXPATH " ")
guicontrol,,ESBOXCHK,1
return

ESPopDownloads:
gui,submit,nohide
LNKLSTP=
guicontrolget,ESDWNLPOS,,ESDWNLPOS
guicontrol,,ROMPOP,|
if (ESRPOPPL = 1)
	{
		LNKLSTP= 
		guicontrol,,ESPLXMP,|%ESDWNLPOS%||%ESPLPLST%%escommon%%systmfldrs%
		Loop, %CMIRLOC%\%ESDWNLPOS%\*.lnk,,1
			{
				LNKLSTP.= A_LoopFileFullPath . "|"
			}
		ESROOTFLD= %CMIRLOC%\%ESDWNLPOS%
		stringreplace,LNKLSTP,LNKLSTP,%ESROOTFLD%\,,All
		guicontrol,,ROMPOP,|%LNKLSTP%
		return
	}
if (ESRPOPDL = 1)
	{
		LNKLSTP= 
		guicontrol,,ESPLXMP,|%ESDWNLPOS%||%ESPLPLST%%escommon%%systmfldrs%
		Loop, %RJSYSTEMS%\%ESDWNLPOS%\*.bat,,1
			{
				LNKLSTP.= A_LoopFileFullPath . "|"
			}
		ESROOTFLD= %RJSYSTEMS%\%ESDWNLPOS%
		stringreplace,LNKLSTP,LNKLSTP,%ESROOTFLD%\,,All
		guicontrol,,ROMPOP,|%LNKLSTP%
		return
	}
if (ESRPOPROM = 1)
	{
		ESFND=
		Loop, Parse, ESPLPLST,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				mpth= %A_LoopField%
				Loop, Parse, ESPLPLSTA,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						inn1=
						inn2=
						stringsplit,inn,A_LoopField,`,
						if (inn1 = ESDWNLPOS)
							{
								ESROOTFLD= %inn2%
								Loop,19
									{
										inx%A_Index%=
									}
								innr= %inn3%
								stringreplace,innr,innr,.,,All
								stringsplit,inx,innr,%A_Space%
								guicontrol,,ESRRTXT,%ESROOTFLD%
								ESFND= 1
								break
							}
					}
				if (ESFND = 1)
					{
						break
					}
			}
		guicontrol,,ESPLXMP,|%ESDWNLPOS%||%ESPLPLST%%escommon%%systmfldrs%
		ESROMLST=
		if (ESROOTFLD <> "")
			{
				vvr := Object()
				Loop, %inx0%
					{
						new= % (inx%a_index%)
						if (inx%a_index% <> "")
							{
								vvr.insert(new)
							}
					}
				Loop, %ESROOTFLD%\*.*,,1
					{
						ext= %A_LoopFileExt%
						for k, v in vvr
							{
								extm:= v
								if (ext = extm)
									{
										ESROMLST.= A_LoopFileFullPath . "|"
									}
							}
					}
				stringreplace,ESROMLST,ESROMLST,%ESROOTFLD%\,,All
				guicontrol,,ROMPOP,|%ESROMLST%
			}
	}
return

ESRPopJ:
gui,submit,nohide
RPDND=
guicontrol,hide,ESMIRSEL
guicontrol,hide,ESRRTXT
guicontrol,hide,ESROMROOT
guicontrol,,ESPLXMP,|%ESPLPLST%%escommon%%systmfldrs%
guicontrol,,ESDWNLPOS,|%systmfldrs%
guicontrol,,ROMPOP,|
return

ESRPopMir:
gui,submit,nohide
gosub, ESMIRSEL
RPDND=
guicontrol,show,ESMIRSEL
guicontrol,hide,ESRRTXT
guicontrol,hide,ESROMROOT
guicontrol,,ESPLXMP,|%ESPLPLST%%escommon%|%systmfldrs%
guicontrol,,ROMPOP,|
gosub, ESPopDownloads
return

ESRPopRom:
gui,submit,nohide
RPDND=
guicontrol,,ESDWNLPOS,|
guicontrol,show,ESRRTXT
guicontrol,show,ESROMROOT
guicontrol,hide,ESMIRSEL
ESPLPLSD:= ESPLPLST
if (ESDWNLPOS <> "")
	{
		ESPLPLSD= %ESDWNLPOS%||%ESPLPLSD%
	}
guicontrol,,ESDWNLPOS,|%ESPLPLSD%%systmfldrs%
stringleft,esptr,ESPLPLST,1
if (esptr = "|")
	{
		stringtrimleft,ESPLPLST,ESPLPLST,1
	}
guicontrol,,ESPLXMP,|%ESPLPLST%%escommon%
guicontrol,,ROMPOP,|
if (ESROOTFLD = "")
	{
		SB_SetText("ROM FOLDER IS NOT SET")
		return
	}
splitpath,ESROOTFLD,ESRFLN
SB_SetText("Current ROM folder is set to " ESROOTFLD "")
ESROMLST=
Loop, %ESROOTFLD%\*.*
	{
		if (A_LoopFileName = "")
			{
				continue
			}
		ESROMLST.= A_LoopFileFullPath . "|"
	}
guicontrol,,ROMPOP,|%ESROMLST%
gosub, ESPopDownloads
return

ESMIRSEL:
gui,submit,nohide
guicontrolget,ESMIRSEL,,ESMIRSEL
iniread,CMIRLOC,Settings.ini,GLOBAL,%ESMIRSEL%
if (CMIRLOC = "ERROR")
	{
		SB_SetText("Mirrors must be created using the ''Mirrored_links'' dropdown of the Frontends tab.")
		return
	}
MIRLSTLOC=
Loop, %CMIRLOC%\*,2
	{
		if (A_LoopFileName = "")
			{
				continue
			}
		if (A_Index = 1)
			{
				GMIR= %A_LoopFileName%
			}
		MIRLSTLOC.= A_LoopFileName . "|"
	}
guicontrol,,ESDWNLPOS,|%GMIR%||%MIRLSTLOC%
return

ESKIDG:
gui,submit,nohide
espekidgame= false
if (ESKIDG = 1)
	{
		espekidgame= true
	}
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "kidgame")
			{
				ESREPL.= "<kidgame>" . espekidgame . "</kidgame>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
return

ESHIDDEN:
gui,submit,nohide
espehidden= false
if (ESHIDDEN = 1)
	{
		espehidden= true
	}
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "hidden")
			{
				ESREPL.= "<hidden>" . espehidden . "</hidden>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
return

ESFAV:
gui,submit,nohide
espefavorite= false
if (ESFAV = 1)
	{
		espefavorite= true
	}
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "favorite")
			{
				ESREPL.= "<favorite>" . espefavorite . "</favorite>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
return

ESTHUMBBUT:
gui,submit,nohide
ESTHTMP=
FileSelectFile,ESTHTMP,3,,Select a Thumbnail
if (ESTHTMP = "")
	{
		return
	}
espethumbnail= %ESTHTMP%
stringreplace,espethumbnailx,espethumbnail,\,/,All
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "thumbnail")
			{
				ESREPL.= "<thumbnail>" . espethumbnailx . "</thumbnail>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
imgprev= %espethumbnail%
guicontrol,,ESTHUMBP,%espethumbnail%
return

ESMARQBUT:
gui,submit,nohide
ESTHTMP=
FileSelectFile,ESTHTMP,3,,Select a marquee
if (ESTHTMP = "")
	{
		return
	}
espemarquee= %ESTHTMP%
stringreplace,espemarqueex,espemarquee,\,/,All
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "marquee")
			{
				ESREPL.= "<marquee>" . espemarqueex . "</marquee>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
imgprev= %espemarquee%
guicontrol,,ESMARQPTHTXT,%espemarquee%
return

ESVIDBUT:
gui,submit,nohide
ESTHTMP=
FileSelectFile,ESTHTMP,3,,Select a video
if (ESTHTMP = "")
	{
		return
	}
espevideo= %ESTHTMP%
stringreplace,espevideo,espevideo,\,/,All
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "video")
			{
				ESREPL.= "<video>" . espevideo . "</video>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
guicontrol,,ESVIDPTHTXT,%espevideo%
return

ESIMGBUT:
gui,submit,nohide
ESTHTMP=
FileSelectFile,ESTHTMP,3,Select a image
if (ESTHTMP = "")
	{
		return
	}
espeimage= %ESTHTMP%
stringreplace,espeimagex,espeimage,\,/,All
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "image")
			{
				ESREPL.= "<image>" . espeimagex . "</image>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
imgprev= %espeimage%
guicontrol,,ESOPNIMGPTHTXT,%espeimage%
return

ESDESCEDT:
gui,submit,nohide
guicontrolget,espedesc,,ESDESCEDT
stringreplace,espedesc,espedesc,`n,[CR],All
stringreplace,espedesc,espedesc,[CR][CR][CR],[CR],All
stringreplace,espedesc,espedesc,[CR][CR],[CR],All
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "desc")
			{
				ESREPL.= "<desc>" . espedesc . "</desc>" . "`n"
				continue
			}
		if (clut2 = "plot")
			{
				ESREPL.= "<desc>" . espedesc . "</desc>" . "`n"
				continue
			}
		if (clut2 = "overview")
			{
				ESREPL.= "<desc>" . espedesc . "</desc>" . "`n"
				continue
			}
		if (clut2 = "notes")
			{
				ESREPL.= "<desc>" . espedesc . "</desc>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
return

ESNAMEDT:
gui,submit,nohide
ControlGet,curpllst, List,,,ahk_id %insel%
ESRNMCHK:
guicontrolget,espename,,ESNAMEDT
stringreplace,ESINIPOP,ESINIPOP,%gamesel%:,%espename%:
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "name")
				{
				ESREPL.= "<name>" . espename . "</name>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
gui,submit,nohide
guicontrolget,esrnmchk,,ESNAMEDT
if (esrnmchk <> espename)
	{
		goto, ESRNMCHK
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
gamesel:= espename
FileAppend,%ESGAMP%,rj\ES\%syssub%\%espename%.ini
guicontrol,,CURPLST,|%ESINIPOP%
return

ESPTHEDT:
gui,submit,nohide
guicontrolget,espepath,,ESPTHEDT
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "path")
			{
				ESREPL.= "<path>" . espepath . "</path>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
return

ESPUBEDT:
gui,submit,nohide
guicontrolget,espepublisher,,ESPUBEDT
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "publisher")
			{
				ESREPL.= "<publisher>" . espepublisher . "</publisher>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
return

ESGENEDT:
gui,submit,nohide
guicontrolget,espegenre,,ESGENEDT
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "genre")
			{
				ESREPL.= "<genre>" . espegenre . "</genre>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
return

ESDEVEDT:
guicontrolget,espedeveloper,,ESDEVEDT
gui,submit,nohide
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "developer")
			{
				ESREPL.= "<developer>" . espedeveloper . "</developer>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
return

ESRLSDG:
return

ESDDPLNUM:
gui,submit,nohide
guicontrolget,ESDDPLNUM,,ESDDPLNUM
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "players")
			{
				ESREPL.= "<players>" . ESDDPLNUM . "</players>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
		}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
guicontrol,,ESDDPLNUM,%ESDDPLNUM%
return

ESRATSLD:
gui,submit,nohide
ERATTSLD=
ESREPL=
guicontrolget,ESRATSLD,,ESRATSLD
ESRATSLD:= (ESRATSLD / 10)
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "rating")
			{
				ESREPL.= "<rating>" . ESRATSLD . "</rating>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
return

ESEDTPOP:
vvi1=
vvi2=
stringsplit,vvi,CURPLST,:
if (vvi1 = "")
	{
		return
		gamesel=
	}
syssub= %vvi2%
if (gamesel <> vvi1)
	{
		if (vvi1 <> "")
			{
				if (gamesel <> "")
					{
						FileDelete,rj\ES\%syssub%\%gamesel%.ini
						FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
					}
			}
		gamesel=
	}
if (crpln <> 1)
	{
		guicontrol,,ESFAV,0
		guicontrol,,ESKIDG,0
		guicontrol,,ESHIDDEN,0
		guicontrol,,ESPUBEDT,
		guicontrol,,ESDEVEDT,
		guicontrol,,ESGENEDT,
		guicontrol,,ESPTHEDT,
		guicontrol,,ESNAMEDT,
		guicontrol,,ESRATSLD,
		guicontrol,,ESTHUMBP,
		guicontrol,,ESOPNIMGPTHTXT,
		guicontrol,,ESVIDPTHTXT,
		guicontrol,,ESMARQPTHTXT,
		guicontrol,,ESDDPLNUM,|1||2|3|4|5|6|7|8
		guicontrol,,ESDESCEDT,
		return
	}
gamesel:= vvi1
FileRead,ESGAMP,rj\ES\%syssub%\%gamesel%.ini
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "folder")
			{
				cmpl= 1
				espepublisher=
				espedeveloper=
				espegenre=
				espepath=
				espename=
				esperating=
				espethumbnail=
				espeimage=
				espevideo=
				espemarquee=
				espelayers=
				espedesc=
				espekidgame=
				espekidg= 0
				espehidden=
				eshide= 0
				espefavorite=
				espefav= 0
				continue
			}
		if (clut2 = "game")
			{
				espepublisher=
				espedeveloper=
				espegenre=
				espepath=
				espename=
				esperating=
				espethumbnail=
				espeimage=
				espevideo=
				espemarquee=
				espelayers=
				espedesc=
				espekidg= 0
				eshide= 0
				espefav= 0
				continue
			}
		if (clut2 = "path")
			{
				espepath= %clut3%
				continue
			}
		if (clut2 = "name")
			{
				ren= %clut3%
				stringreplace,ren,ren,&#39;,',All
				stringreplace,ren,ren,&amp;,&,All
				espename= %clut3%
				continue
			}
		if (clut2 = "image")
			{
				espeimage= %clut3%
				stringreplace,espeimagex,espeimage,/,\,All
				continue
			}
		if (clut2 = "thumbnail")
			{
				espethumbnail= %clut3%
				stringreplace,espethumbnailx,espethumbnail,/,\,All
				continue
			}
		if (clut2 = "marquee")
			{
				espemarquee= %clut3%
				stringreplace,espemarqueex,espemarquee,/,\,All
				continue
			}
		if (clut2 = "kidgame")
			{
				espekidgame= %clut3%
				if (clut3 = "true")
					{
						espekidg= 1
				continue
					}
			}
		if (clut2 = "favorite")
			{
				espefavorite= %clut3%
				if (clut3 = "true")
					{
						espefav= 1
				continue
					}
			}
		if (clut2 = "hidden")
			{
				espehidden= %clut3%
				if (clut3 = "true")
					{
					  eshide= 1
				continue
					}
			}
		if (clut2 = "video")
			{
				espevideo= %clut3%
				stringreplace,espevideox,espevideo,/,\,All
				continue
			}
		if (clut2 = "desc")
			{
				espedesc= %clut3%
				stringreplace,espedeedt,espedesc,&#39;,',All
				stringreplace,espedeedt,espedeedt,&amp;,&,All
				continue
			}
	if (clut2 = "plot")
			{
				espedesc= %clut3%
				stringreplace,espedeedt,espedesc,&#39;,',All
				stringreplace,espedeedt,espedeedt,&amp;,&,All
				continue
			}
	if (clut2 = "overview")
			{
				espedesc= %clut3%
				stringreplace,espedeedt,espedesc,&#39;,',All
				stringreplace,espedeedt,espedeedt,&amp;,&,All
				continue
			}
	if (clut2 = "notes")
			{
				espedesc= %clut3%
				stringreplace,espedeedt,espedesc,&#39;,',All
				stringreplace,espedeedt,espedeedt,&amp;,&,All
				continue
			}
		if (clut2 = "rating")
			{
				esperating= %clut3%
				esperatsld:= (esperating * 10)
				continue
			}
		if (clut2 = "releasedate")
			{
				espereleasedate= %clut3%
				continue
			}
		if (clut2 = "developer")
			{
				espedeveloper= %clut3%
				continue
			}
		if (clut2 = "publisher")
			{
				espepublisher= %clut3%
				continue
			}
		if (clut2 = "genre")
			{
				espegenre= %clut3%
				continue
			}
		if (clut2 = "players")
			{
				espeplayers= %clut3%
				continue
			}
		if (clut2 = "playcount")
			{
				espeplaycount= %clut3%
				continue
			}
		if (clut2 = "lastplayed")
			{
				espelastplayed= %clut3%
				continue
			}
		if (clut2 = "rating")
			{
				esperating= %clut3%
				continue
			}
		if (clut2 = "/folder")
			{
				cpml=
				guicontrol,,ESFAV,%espefav%
				guicontrol,,ESKIDG,%espekidg%
				guicontrol,,ESHIDDEN,%eshide%
				guicontrol,,ESPUBEDT,%espepublisher%
				guicontrol,,ESDEVEDT,%espedeveloper%
				guicontrol,,ESGENEDT,%espegenre%
				stringreplace,systid,syssub,_,,All
				esperpath= %espepath%
				guicontrol,,ESPTHEDT,%espepath%
				stringreplace,esperpath,espepath,%RJSYSTEMS%\%systid%,.,All
				if (esperpath <> espepath)
					{
						stringreplace,esperpath,esperpath,\,/,All
						guicontrol,,ESPTHEDT,%esperpath%
					}
				guicontrol,,ESNAMEDT,%ren%
				guicontrol,,ESRATSLD,%esperatsld%
				guicontrol,,ESTHUMBP,%espethumbnailx%
				guicontrol,,ESOPNIMGPTHTXT,%espeimagex%
				guicontrol,,ESVIDPTHTXT,%espevideox%
				guicontrol,,ESMARQPTHTXT,%espemarqueex%
				guicontrol,,ESDDPLNUM,%espelayers%||1|2|3|4|5|6|7|8
				guicontrol,,ESDESCEDT,%espedeedt%
				continue
			}
		if (clut2 = "/game")
			{
				cpml=
				guicontrol,,ESFAV,%espefav%
				guicontrol,,ESKIDG,%espekidg%
				guicontrol,,ESHIDDEN,%eshide%
				guicontrol,,ESPUBEDT,%espepublisher%
				guicontrol,,ESDEVEDT,%espedeveloper%
				guicontrol,,ESGENEDT,%espegenre%
				esperpath= %espepath%
				guicontrol,,ESPTHEDT,%espepath%
				stringreplace,systid,syssub,_
				stringreplace,esperpath,espepath,%RJSYSTEMS%\%systid%,.,All
				if (esperpath <> espepath)
					{
						stringreplace,esperpath,esperpath,\,/,All
						guicontrol,,ESPTHEDT,%esperpath%
					}
				guicontrol,,ESNAMEDT,%espename%
				guicontrol,,ESRATSLD,%esperating%
				guicontrol,,ESTHUMBP,%espethumbnailx%
				guicontrol,,ESOPNIMGPTHTXT,%espeimagex%
				guicontrol,,ESVIDPTHTXT,%espevideox%
				guicontrol,,ESMARQPTHTXT,%espemarqueex%
				guicontrol,,ESDDPLNUM,%espelayers%||1|2|3|4|5|6|7|8
				guicontrol,,ESDESCEDT,%espedesc%
				continue
			}
	}
if (espename = "")
		{
			stringreplace,esptmp,espepath,/,\,All
			splitpath,esptmp,,,,espename
		}
ESGAMTMP=
esgampp= game
if (cmpl = 1)
	{
		esgampp= folder
	}
ESGAMTMP.= "<" . esgampp . ">" . "`n"
ESGAMTMP.= "<name>" . espename . "</name>" . "`n"
ESGAMTMP.= "<path>" . espepath . "</path>" . "`n"
ESGAMTMP.= "<image>" . espeimage . "</image>" . "`n"
ESGAMTMP.= "<marquee>" . espemarquee . "</marquee>" . "`n"
ESGAMTMP.= "<video>" . espevideo . "</video>" . "`n"
ESGAMTMP.= "<desc>" . espedesc . "</desc>" . "`n"
ESGAMTMP.= "<thumbnail>" . espethumbnail . "</thumbnail>" . "`n"
ESGAMTMP.= "<hidden>" . espehidden . "</hidden>" . "`n"
ESGAMTMP.= "<kidgame>" . espekidgame . "</kidgame>" . "`n"
ESGAMTMP.= "<developer>" . espedeveloper . "</developer>" . "`n"
ESGAMTMP.= "<publisher>" . espepublisher . "</publisher>" . "`n"
ESGAMTMP.= "<genre>" . espegenre . "</genre>" . "`n"
ESGAMTMP.= "<releasedate>" . espereleasedate . "</releasedate>" . "`n"
ESGAMTMP.= "<rating>" . esperating . "</rating>" . "`n"
ESGAMTMP.= "<lastplayed>" . espelastplayed . "</lastplayed>" . "`n"
ESGAMTMP.= "<playcount>" . espeplaycount . "</playcount>" . "`n"
ESGAMTMP.= "</" . esgampp . ">" . "`n"
ESGAMP= %ESGAMTMP%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
return

ESSAVEOPL:
guicontrol,,CURPLST,|
gamesel=
curtxt=
ESGAMP=
gosub, curplst
gui,submit,nohide
guicontrol,,ESFAV,0
guicontrol,,ESKIDG,0
guicontrol,,ESHIDDEN,0
guicontrol,,ESPUBEDT,
guicontrol,,ESDEVEDT,
guicontrol,,ESGENEDT,
guicontrol,,ESPTHEDT,
guicontrol,,ESNAMEDT,
guicontrol,,ESRATSLD,
guicontrol,,ESTHUMBP,
guicontrol,,ESOPNIMGPTHTXT,
guicontrol,,ESVIDPTHTXT,
guicontrol,,ESMARQPTHTXT,
guicontrol,,ESDDPLNUM,|1||2|3|4|5|6|7|8
guicontrol,,ESDESCEDT,
FileMove,%ESHOME%\gamelists\%syssub%\gamelist.xml,%ESHOME%\gamelists\%syssub%\gamelist.xml.bak,1
FileDelete,rj\ES\%syssub%\gamelist.xml
FileAppend,<gameList>`n,rj\ES\%syssub%\gamelist.xml
ControlGet,curpllst, List,,,ahk_id %insel%
stringreplace,curpllst,curpllst,`n,|,All
Loop, rj\ES\%syssub%\*.ini
	{
		splitpath,A_LoopField,,,,ftap1
		fileread,ftap,%A_LoopFileFullPath%
		FileAppend,%ftap%,rj\ES\%syssub%\gamelist.xml
	}
FileAppend,</gameList>`n,rj\ES\%syssub%\gamelist.xml
FileMove,rj\ES\%syssub%\gamelist.xml,%ESHOME%\gamelists\%syssub%\gamelist.xml,1
Msgbox,1,CREATED,%syssub% gamelist created.,5
gamesel=
guicontrol,,CURPLST,|
FileDelete,rj\ES\%syssub%\*.ini
return

ESROMADDBUT:
gui,submit,nohide
gamesel=
curtxt=
guicontrol,,ESNAMEDT,
guicontrol,,ESPTHEDT,
guicontrol,,ESDESCEDT,
guicontrol,,ESPUBEDT,
guicontrol,,ESDEVEDT,
guicontrol,,ESGENEDT,
presel= %RJSYSTEMS%\%syssub%
ESROMRSEL:
ESTHTMP=
FileSelectFile,ESTHTMP,3,,Select a ROM
if (ESTHTMP = "")
	{
			if ((presel = "") && (ESTHTMP = ""))
			{
				return
			}
		presel=
		goto, ESROMRSEL
return
	}
espepath= %ESTHTMP%
splitpath,espepath,,,,espepnam
gamesel= %espepnam%
if (syssub = "")
	{
		guicontrolget,syssub,,ESPLXMP
	}
ESINIPOP.= gamesel . ":" . syssub . "|"
FileAppend,<game>`n,rj\ES\%syssub%\%gamesel%.ini
FileAppend,<name>%espepnam%</name>`n,rj\ES\%syssub%\%gamesel%.ini
FileAppend,<path>%espepath%</path>`n,rj\ES\%syssub%\%gamesel%.ini
FileAppend,</game>`n,rj\ES\%syssub%\%gamesel%.ini
esperpath= %espepath%
guicontrol,,ESPTHEDT,%espepath%
stringreplace,systid,syssub,_
stringreplace,esperpath,espepath,%RJSYSTEMS%\%systid%,.,All
if (epserpath <> espepath)
	{
		stringreplace,esperpath,esperpath,\,/,All
		guicontrol,,ESPTHEDT,%esperpath%
	}
guicontrol,,ESNAMEDT,%espepnam%
guicontrol,,CURPLST,|%ESINIPOP%
gosub, CURPLST
return

ESFLDADDBUT:
gui,submit,nohide
gamesel=
curtxt=
guicontrol,,ESNAMEDT,
guicontrol,,ESPTHEDT,
guicontrol,,ESDESCEDT,
guicontrol,,ESPUBEDT,
guicontrol,,ESDEVEDT,
guicontrol,,ESGENEDT,
presel= %RJSYSTEMS%\%syssub%
ESFLDRSEL:
ESTHTMP=
FileSelectFolder,ESTHTMP,*%presel%,3,Select a FOLDER
sysrepth= %syssub%
if (ESTHTMP = "")
	{
		if ((presel = "") && (ESTHTMP = ""))
			{
				return
			}
		presel=
		goto, ESFLDRSEL
	}
stringright,efi,ESTHTMP,2
stringLeft,efix,ESTHTMP,2
if (efi = ":\")
	{
		ESTHTMP= %efix%
	}	
esperpath= %ESTHTMP%
splitpath,esperpath,,,,espepnam
ifnotinstring,syssub,%esperpnam%
	{
		sysrrepth= %esperpnam%
	}
stringreplace,systid,syssub,_,,All
stringreplace,esperpath,esperpath,%RJSYSTEMS%\%systid%,,All
stringreplace,esperpath,esperpath,%RJSYSTEMS%\%sysrepth%,,All
if (esperpath <> ESTHTMP)
	{
		stringreplace,esperpath,esperpath,\,/,All
		esperpath= .%esperpath%
	}
gamesel= %esperpnam%
if (syssub = "")
	{
		guicontrolget,syssub,,ESPLXMP
	}
ESINIPOP.= gamesel . ":" . syssub . "|"
FileAppend,<folder>`n,rj\ES\%syssub%\%gamesel%.ini
FileAppend,<name>%espepnam%</name>`n,rj\ES\%syssub%\%gamesel%.ini
FileAppend,<path>%espepath%</path>`n,rj\ES\%syssub%\%gamesel%.ini
FileAppend,</folder>`n,rj\ES\%syssub%\%gamesel%.ini
stringreplace,systid,syssub,_,,All
esperpath= %espepath%
guicontrol,,ESPTHEDT,.%espepath%
stringreplace,esperpath,espepath,%RJSYSTEMS%\%systid%,.,All
if (esperpath <> espepath)
	{
		stringreplace,esperpath,esperpath,\,/,All
		guicontrol,,ESPTHEDT,%esperpath%
	}
guicontrol,,ESNAMEDT,%espepnam%
guicontrol,,CURPLST,|%ESINIPOP%
gosub, CURPLST
return

ESROMPTHBUT:
jtf=
gui,submit,nohide
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "folder")
			{
				jtf= 1
			}
	}
ESTHTMP=
if (jtf = 1)
	{
		goto, ESFSFLD
	}
FileSelectFile,ESTHTMP,3,,Select a ROM
if (ESTHTMP = "")
	{
		return
	}
espepath= %ESTHTMP%
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "path")
			{
				ESREPL.= "<path>" . espepath . "</path>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
stringreplace,systid,syssub,_,,All
esperpath= %espepath%
ifexist,%RJSYSTEMS%\%systid%\
	{
		stringreplace,esperpath,espepath,%RJSYSTEMS%\%systid%,,All
		stringreplace,esperpath,esperpath,\,/,All
	}
guicontrol,,ESPTHEDT,%esperpath%
return

ESFSFLD:
FileSelectFolder,ESTHTMP,,3,Select a path
if (ESTHTMP = "")
	{
		return
	}
stringright,efi,ESTHTMP,2
stringLeft,efix,ESTHTMP,2
if (efi = ":\")
	{
		ESTHTMP= %efix%
	}	
espepath= %ESTHTMP%
ESREPL=
Loop, Parse, ESGAMP,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		clut1=
		clut2=
		clut3=
		stringsplit,clut,A_LoopField,<>
		if (clut2 = "path")
			{
				ESREPL.= "<path>" . espepath . "</path>" . "`n"
				continue
			}
		ESREPL.= A_LoopField . "`n"
	}
ESGAMP= %ESREPL%
FileDelete,rj\ES\%syssub%\%gamesel%.ini
FileAppend,%ESGAMP%,rj\ES\%syssub%\%gamesel%.ini
previmg= %espepath%
stringreplace,systid,syssub,_,,All
esperpath= %espepath%
ifexist,%RJSYSTEMS%\%systid%\
	{
		stringreplace,esperpath,espepath,%RJSYSTEMS%\%systid%,,All
		stringreplace,esperpath,esperpath,\,/,All
	}
guicontrol,,ESPTHEDT,.%esperpath%
return

Mirrored_LinksToggle:
gosub, FEUNPOP
mlk_etog=FEBUTB|FEBUTD|FEBUTC|FECHKA|FECHKB|FECHKD|FEBUTE|FEBUTA|FETXTI|FELVA|FETXTE|FETXTF
mlk_dtog=FEBUTB|FEBUTD|FEBUTC|FECHKA|FECHKB|FECHKC|FECHKD|FECHKE|FELBXA|FEBUTE|FEBUTA|FETXTI|FELVA|FETXTE|FETXTF
MLGUIITEMS= FEBUTA|FEBUTB|FEBUTC|FEBUTD|FEBUTE|FECHKA|FECHKB|FECHKC|FECHKD|FECHKE|FELBXA|FELVA
fetog= show
artlkupit= 
artlkupa=
artlkupb=
artlkupc=
artlkupd=
artlkupe=
artlkupf=
gosub, imglocfi
guicontrol,move,FEBUTB,x684 y476 w75 h23
guicontrol,,FEBUTB,CREATE
guicontrol,move,FEBUTD,x272 y180 w23 h23
guicontrol,,FEBUTD,...
guicontrol,move,FEBUTC,x272 y156 w23 h23
guicontrol,,FEBUTC,...
guicontrol,move,FECHKA,x289 y403 w132 h13
guicontrol,,FECHKA,Enable Boxart Icons
guicontrol,,FECHKA,0
guicontrol,move,FECHKB,x289 y453 w120 h13
guicontrol,,FECHKB,Overwrite Mirrors
guicontrol,move,FECHKC,x289 y437 w100 h13
guicontrol,,FECHKC,Overwrite Icons
guicontrol,disable,FECHKC
guicontrol,move,FECHKD,x289 y387 w210 h13
guicontrol,,FECHKD,Create Shortcut in ROM-Jacket
guicontrol,disable,FECHKE
guicontrol,move,FECHKE,x289 y420 w170 h13
guicontrol,,FECHKE,Create Icon in ROM-Jacket
guicontrol,move,FELBXA,x521 y208 w109 h186
guicontrol,,FELBXA,|%iconsrc%
guicontrol,move,FEBUTE,x631 y376 w53 h19
guicontrol,,FEBUTE,Delete
guicontrol,,FEBUTA,Reset
guicontrol,move,FEBUTA,x631 y351 w53 h19
guicontrol,move,FETXTI,x631 y305 w83 h13
guicontrol,,FETXTI,Icon Sources
guicontrol,,FELVA,Mirrors
guicontrol,move,FELVA,x10 y34 w247 h463
guicontrol,+altsubmit,FELVA
guicontrol,+checked,FELVA
guicontrol,+Multi,FELVA
guicontrol,move,FETXTE,x299 y160 w456 h13
guicontrol,,FETXTE,Mirror= %CMIRLOC%
guicontrol,move,FETXTF,x299 y184 w456 h13
guicontrol,,FETXTF,Icons= %CICOLOC%
gui,ListView,FELVA
LV_Delete()
Loop, Parse, systmfldrs,|
	{
		LV_Add("",A_LoopField)
	}
LV_ModifyCol()
IniRead, CMIRLOC,Settings.ini,GLOBAL,Mirror_Links
IniRead, CICOLOC,Settings.ini,GLOBAL,Mirror_Icons
ifnotexist,%MIRLOC%\
	{
		SB_SetText("" CMIRLOC " mirror directory not found")
		filecreateDir,%S_KeyDir%\mirrors
		iniwrite,"%S_KeyDir%\mirrors",Settings.ini,Mirror_Links
	}
ifnotexist,%CICOLOC%\
	{
		SB_SetText("" CICOLOC " icon directory not found")
		filecreateDir,%S_KeyDir%\icons
		iniwrite,"%S_KeyDir%\mirrors",Settings.ini,Mirror_Icons
	}
Loop,parse,mlk_dtog,|
	{
		guicontrol,%fetog%,%A_LoopField%
	}
Loop,parse,mlk_etog,|
	{
		guicontrol,enable,%A_LoopField%
	}
return

Mirrored_LinksfeBUTA:
iniread,rfhome,rfcfg.ini,CONFIG,home_directory
gosub, imglocfi
guicontrol,,FELBXA,|%iconsrc%
return

Mirrored_linksFELBXA:
return

Mirrored_LinksfeBUTB:
SB_SetText("Creating Mirrors")
mltogl= disable
gosub, mltogl
guicontrolget,FECHKA,,FECHKA
guicontrolget,FECHKB,,FECHKB
guicontrolget,FECHKC,,FECHKC
guicontrolget,FEDDLB,,FEDDLB
guicontrolget,FEDDLA,,FEDDLA
guicontrolget,FECHKD,,FECHKD
guicontrolget,FECHKE,,FECHKE
guicontrolget,FECHKF,,FECHKF
Gui,ListView,FELVA
guicontrol,disable,FELVA
INJAK=
ICJAK=
FEItems=
locmn=
FEItems:= LVGetCheckedItems("", "ahk_id" . FELSTVA)
IniRead, sysma,Settings.ini,GLOBAL,Mirror_Links
IniRead, sysmi,Settings.ini,GLOBAL,Mirror_Icons
if (FECHKD = 1)
	{
		INJAK= 1
	}
if (FECHKE = 1)
	{
		ICJAK= 1
	}
gosub, PROCMIRROR
guicontrol,enable,FELVA
guicontrol,enable,FEBUTE
guicontrol,enable,FEBUTB
return

mltogl:
Loop,MLGUIITEMS,|
	{
		guicontrol,%mltogl%,%A_LoopField%
	}
return	
imglocfi:
iconsrc= scrapedAssets|jackets|
iniread,rfhome,rfcfg.ini,CONFIG,home_directory
ifexist,%rfhome%\
	{
		artlkupa= %rfhome%\collections\$y$\medium_artwork\artwork_front\imgloop.*|%rfhome%\collections\$y$\medium_artwork\medium_front\imgloop.*|%rfhome%\collections\$y$\medium_artwork\logo\imgloop.*|%rfhome%\collections\$y$\medium_artwork\screenshot\imgloop.*
		artlkupit.= artlkupa . "`n"
		iconsrc.= "retroFE" . "|"
	}
iniread,pghome,pgcfg.ini,CONFIG,home_directory
ifexist,%pghome%
	{
		artlkupb= %RJSYSTEMS%\$y$\media\imgloop\boxFront.*|%RJSYSTEMS%\$y$\media\imgloop\box_front.*|%RJSYSTEMS%\$y$\media\imgloop\box.*|%RJSYSTEMS%\$y$\media\imgloop\cartridge.*|%RJSYSTEMS%\$y$\media\imgloop\disc.*|%RJSYSTEMS%\$y$\media\imgloop\cart.*|%RJSYSTEMS%\$y$\media\imgloop\logo.*|%RJSYSTEMS%\$y$\media\imgloop\wheel.*	
		artlkupit.= artlkupb . "`n"
		iconsrc.= "pegasus" . "|"
	}
iniread,eshome,escfg.ini,CONFIG,home_directory
ifexist,%eshome%\
	{
		artlkupc= %eshome%\imgloop-image.*
		artlkupit.= artlkupc . "`n"
		iconsrc.= "emulationStation" . "|"
	}
ashome= %S_KeyDir%\Assets
ifexist,%ashome%\
	{
		artlkupd= %ashome%\$y$\imgloop\Boxart\*.*|%ashome%\$y$\imgloop\carts\*.*|%ashome%\$y$\imgloop\logos\*.*|%ashome%\$y$\imgloop\snapshots\*.*
		artlkupit.= artlkupd . "`n"
	}
if (!FileExist,(%thumbnailsDirectory%)&&(%thumbnailsDirectory% <> ""))
	{
		artlkupe= %thumbnailsDirectory%\$y$\Named_Titles\imgloop.png|%thumbnailsDirectory%\$y$\Named_Snaps\imgloop.png|%thumbnailsDirectory%\$y$\Named_Boxarts\imgloop.png
		artlkupit.= artlkupe . "`n"
		iconsrc.= "retroArch" . "|"
	}
ifexist,%RJSYSTEMS%\
	{
		artlkupf= %RJSYSTEMS%\$y$\imgloop\Folder.*|%RJSYSTEMS%\$y$\imgloop\logo.*|%RJSYSTEMS%\$y$\imgloop\.snaps\*.*
		artlkupit.= artlkupf . "`n"
	}
return

PROCMIRROR:
Loop, Parse, FEItems,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		curms= %A_LoopField%
		ifNotExist,%sysma%\%curms%\
			{
				FileCreateDir,%sysma%\%curms%
			}
		ifNotExist,%sysmi%\%curms%\
			{
				FileCreateDir,%sysmi%\%curms%
			}
		ifnotexist,%CICOLOC%\%curms%.ico
				{
					icosrc= img\lnch.ico
					ifexist,img\%curms%.ico
						{
							icosrc= img\%curms%.ico
						}
					FileCopy,%icosrc%,%CICOLOC%\%curms%\%curms%.ico
				}
		IniRead,syslnks,SystemLocations.ini,LOCATIONS,%curms%
		if ((syslnks = "")or(syslnks = "ERROR"))
			{
				syslnks= %RJSYSTEMS%\%curms%\
			}
		Loop,parse,syslnks,|
			{
				curs_p= %A_LoopField%
				Loop, %curs_p%\*,2
					{
						curfldp= %A_LoopFileFullPath%
						curfldn= %A_LoopFileName%
						Loop, %A_LoopFileFullPath%\*.bat
							{
								batfile= %A_LoopFileFullPath%
								splitpath,batfile,batf,batd,batx,batn
								if (FECHKF = 1)
									{
										batsrch= %batn%
										batnc2=
										stringsplit,batnc,batn,([
										if (batnc2 <> "")
											{
												batsrch= %batnc2%
											}
									}
								BOXPNG= 	
								Loop,parse,artlkupit,`n`r
									{
										if (A_LoopField = "")
											{
												continue
											}
										imglkb= %A_LoopField%
										Loop,parse,imglkb,|
											{
												jumk= %A_LoopField%
												stringreplace,iinv,jumk,$y$,%curms%
												stringreplace,iinv,iinv,imgloop,%batn%
												Loop,Files,%iinv%
													{
														BOXPNG= %A_LoopFileFullPath%
														break
													}
												if (BOXPNG <> "")
													{
														break
													}
											}
										if (BOXPNG <> "")
											{
												break
											}
									}
								if (FECHKA = 1)
									{
										cvtico= %CICOLOC%\%curms%\%batn%.ico										
										if (ICJAK = 1)
											{
												cvtico= %batd%\%batn%.ico
											}
										ifExist,%cvtico%
											{
												ALHERE= 1
											}
										if (FECHKC = 1)
											{
												ALHERE=
											}
										ifExist, %BOXPNG%
											{
												if (ALHERE = "")
													{
														RunWait, %comspec% /c " bin\any2ico.exe "-img=%BOXPNG%" "-icon=%cvtico%" -formats=32`,48`,96`,128`,256 -pngc -stretch ",,hide
														FileSetAttrib,+H,%cvtico%,2
													}
											}
										ifNotExist,%BOXPNG%
											{
												cvtico= %CICOLOC%\%curms%\%curms%.ico
											}
									}
								lnkloc= %sysma%\%curms%\%batn%.lnk
								if (INJAK = 1)
									{
										lnkloc= %batd%\%batn%.lnk
									}
								ifExist, %lnkloc%
									{
										if (FECHKB = 1)
											{
												FileDelete, %lnkloc%
											}
									}
								FileCreateShortcut,%batfile%,%lnkloc%,%batd%,,%batn%,%cvtico%
							}
					}
			}
	}
mltogl= enable
gosub, mltogl	
return

Mirrored_LinksFEBUTG:
gui,submit,nohide
Gui,ListView,FELVA
LV_Modify(0, "-Check")
guicontrol,,FELBXA,
return

Mirrored_LinksfeBUTF:
return

Mirrored_LinksfeBUTC:
gui,submit,nohide
FileselectFolder,ebum,,3,Select the Mirror Destination
if (ebum = "")
	{
		return
	}
iniwrite,"%ebum%",Settings.ini,GLOBAL,Mirror_Links
guicontrol,,FETXTE,Mirror= %ebum%
return

Mirrored_LinksfeBUTD:
return

Mirrored_LinksfeBUTE:
guicontrolget,ittd,,FELBXA
stringreplace,iconsrc,iconsrc,%ittd%|,,All
if (ittd = "pegasus")
	{
		stringreplace,artlkupit,artlkupit,%artlkupb%`n,,All
	}
if (ittd = "retroFE")
	{
		stringreplace,artlkupit,artlkupit,%artlkupa%`n,,All
	}
if (ittd = "emulationStation")
	{
		stringreplace,artlkupit,artlkupit,%artlkupc%`n,,All
	}
if (ittd = "retroArch")
	{
		stringreplace,artlkupit,artlkupit,%artlkupe%`n,,All
	}
if (ittd = "jackets")
	{
		stringreplace,artlkupit,artlkupit,%artlkupf%`n,,All
	}
if (ittd = "scrapedAssets")
	{
		stringreplace,artlkupit,artlkupit,%artlkupd%`n,,All
	}
guicontrol,,FELBXA,|%iconsrc%
return

Mirrored_LinksfeCHKA:
guicontrol,disable,FECHKE
if (FECHKA = 1)
	{
		guicontrol,enable,FECHKE
	}
return

Mirrored_LinksfeCHKB:
return

Mirrored_LinksfeCHKC:
return

Mirrored_LinksfeCHKD:
iniread,ebum,Settings.ini,GLOBAL,Mirror_Links
guicontrol,,FETXTE,Mirror= %ebum%
if (FECHKD = 1)
	{
		guicontrol,,FETXTE,Mirror= ROMJACKETS
	}
return

Mirrored_LinksfeCHKE:
iniread,ebui,Settings.ini,GLOBAL,Mirror_Icons
guicontrol,,FETXTF,Icons= %ebui%
if (FECHKE = 1)
	{
		guicontrol,,FETXTF,Icons= ROMJACKETS
	}
return

Mirrored_LinksfeCHKF:
return

Mirrored_LinksfeDDLA:
return

Mirrored_LinksfeDDLB:
return

Mirrored_LinksfeLVA:
Gui,ListView,FELVA
FEItemdxa=
FEItemdxa:= LVGetCheckedItems("", "ahk_id" . FELSTVA)
stringreplace,FEchki,FEItemdxa,`n,|,All
stringreplace,FEchki,FEchki,`r,|,All
FELBXQ=
loop, parse, FEchki,|
	{
		FELBXQ=%A_index%
	}
guicontrol,,FELBXA,|%FEchki%
return

Mirrored_LinksfeEDTA:
return

Mirrored_LinksfeRAD5A:
return

Mirrored_LinksfeRAD5B:
return

Mirrored_LinksfeRAD5C:
return

TOGUTSEL:
gosub, %curutl%TOGFESEL
return

ADDUTSEL:
gosub, %curutl%ADDUTSEL
return

REMUTSEL:
gosub, %curutl%REMUTSEL
return

UTLTOGFESEL:
gui,submit,nohide
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
				LV_Modify(RowNumber, "-Check")
				continue
			}
		Else
			{
				LV_Modify(RowNumber, "Check")
			}
	}
return

UTLADDFESEL:
gui,submit,nohide
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
			}
		Else
			{
				LV_Modify(RowNumber, "Check")
			}
	}
return

BIOSREMFESEL:
gui,submit,nohide
SB_SetText("Deleteing BIOS cache")
FileRemoveDir, %cacheloc%\bios,1
FileRemoveDir, %cacheloc%\firmware,1
SB_SetText("BIOS cache cleared")
return

EMUUPDTSEL:
gosub, EMUDELFESEL
knum=
Loop, Parse, emuinstpop,|
	{
		knum+=1
		if (A_LoopField = selfnd)
			{
				guicontrol, choose, PRGINSTLBX,%knum%
				gosub, PRGINSTLBX
				SB_SetText(" " selfnd " emulator auto-suggested")
				break
			}
	}
gosub, EmuInst
return

EMUDELFESEL:
gui,submit,nohide
guicontrolget,selfnd,,INSTEMUDDL
guicontrolget,SaList,,SaList
SB_SetText("Deleteing Emulator")
Guicontrolget,emutd,,EINSTLOC
splitpath,emutd,emuxtd,emuptd
SALSTYP= %SaList%
if ((selfnd = "Antimicro")or(selfnd = "XPadder"))
	{
		SALSTYP= KEYMAPPERS
	}
MsgBox,8707,Confirm Delete,Are you sure you want to delete %selfnd%?
ifMsgBox,Yes
	{
		FileRemoveDir,%emuptd%,1
		inidelete,Apps.ini,%SALSTYP%,%selfnd%
		iniwrite,"",Assignments.ini,ASSIGNMENTS,%selfnd%
		gosub, RBLDRUNLST
		gosub, SALIST
		SB_SetText("Emulator Deleted")
	}
return

EMUREMFESEL:
gui,submit,nohide
guicontrolget,selfnd,,INSTEMUDDL
guicontrolget,SaList,,SaList
SB_SetText("Clearing Emulator")
if ((selfnd = "Antimicro")or(selfnd = "XPadder"))
	{
		SALSTYP= KEYMAPPERS
	}
inidelete,Apps.ini,%SALSTYP%,%selfnd%
iniwrite,"",Assignments.ini,ASSIGNMENTS,%selfnd%
gosub, RBLDRUNLST
gosub, SALIST
SB_SetText("Emulator cleared")
return

UTLREMFESEL:
gui,submit,nohide
Gui,ListView,utlLVA
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
				LV_Modify(RowNumber, "-Check")
			}
		Else
			{
			}
	}
LV_ModifyCol()	
return

FEDELSEL:
gui,submit,nohide
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
				if (FERAD2B = 1)
					{
						curtxt= %FEDDLA%\%curtxt%
					}
				SB_SetText("deleting " Assets "\" curtxt " ")
				FileRemoveDir,%ASSETS%\%curtxt%,1
			}
		Else
			{
			}
	}
return

TOGFESEL:
gosub, %FETYP%TOGFESEL
return

ADDFESEL:
gosub, %FETYP%ADDFESEL
return

REMFESEL:
gosub, %FETYP%REMFESEL
return

PegasusTOGFESEL:
EmulationStationTOGFESEL:
MediaTOGFESEL:
Mirrored_LinksTOGFESEL:
gui,submit,nohide
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
				LV_Modify(RowNumber, "-Check")
				stringreplace,FE_TDB,FE_TDB,%curtxt%|0,%curtxt%|1,All
				continue
			}
		Else
			{
				LV_Modify(RowNumber, "Check")
				stringreplace,FE_TDB,FE_TDB,%curtxt%|0,%curtxt%|1,All
			}
	}
return

PegasusADDFESEL:
EmulationStationADDFESEL:
MediaADDFESEL:
Mirrored_LinksADDFESEL:
gui,submit,nohide
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
			}
		Else
			{
				LV_Modify(RowNumber, "Check")
				stringreplace,FE_TDB,FE_TDB,%curtxt%|0,%curtxt%|1,All
			}
	}
return

PegasusREMFESEL:
EmulationStationREMFESEL:
MediaREMFESEL:
Mirrored_LinksREMFESEL:
gui,submit,nohide
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
				LV_Modify(RowNumber, "-Check")
				stringreplace,FE_TDB,FE_TDB,%curtxt%|1,%curtxt%|0,Alsl
			}
		Else
			{
			}
	}
return

MediaToggle:
gosub, FEUNPOP
fetog= show
fe_medshw=FEPRGA|FETXTE|FETXTD|FETXTC|FETXTB|FETXTA|FERAD2C|FERAD2A|FERAD5A|FERAD5B|FELVA|FEDDLA|FEDDLD|FECHKG|FECHKP|FECHKE|FECHKD|FECHKB|FECHKA|FEBUTA|FECHKC
fe_medtog=FEBUTM|FEPICA|FEBUTA|FEBUTN|FEBUTC|FEBUTD|FEBUTE|FEBUTF|FEBUTG|FEBUTO|FETXTN|FETXTM|FETXTL|FETXTJ|FETXTG|FETXTE|FETXTD|FETXTC|FETXTB|FETXTA|FERAD4B|FERAD4A|FERAD7B|FERAD2B|FERAD2A|FERAD2C|FERAD7A|FERAD5A|FERAD5B|FELVA|FEDDLA|FEDDLC|FEDDLF|FEDDLE|FEDDLD|FEDDLG|FECHKN|FECHKO|FECHKM|FECHKL|FECHKK|FECHKJ|FECHKH|FECHKG|FECHKF|FECHKP|FECHKE|FECHKD|FECHKC|FECHKB|FECHKA|FELBXA|FECBXB|FEBUTI|FEBUTM|FEBUTL|FEEDTA|FEEDTB|FEEDTC|FEEDTD|FELBXB|FECBXA
ifnotexist, mediafe.ini
	{
		filecopy,sets\mediafe.set,mediafe.ini
	}
iniread,imagefrmt,mediafe.ini,CONFIG,Global_image_format
iniread,imageheight,mediafe.ini,CONFIG,Global_image_height
iniread,imagewidth,mediafe.ini,CONFIG,Global_image_width
iniread,mediaorder,mediafe.ini,ORDER,system_order
iniread,ESHOME,escfg.ini,CONFIG,home_directory
if (ESHOME = "ERROR")
	{
		ESHOME= %CURSRPTH%\.emulationstation
		iniwrite,%ESHOME%,escfg.ini,CONFIG,home_directory
	}
ssuser=
sspassw=
iniread,ssuser,mediafe.ini,CONFIG,ss_user
if (ssuser = "ERROR")
	{
		ssuser=
	}
iniread,sspassw,mediafe.ini,CONFIG,ss_password
if (sspassw = "ERROR")
	{
		sspassw=
	}
cslst=
esmlist=
esxlist=
cursysthemelist=
Loop, Parse, scrsup,|
	{
		ifExist, %RJSYSTEMS%\%A_LoopField%
			{
				cslst.= A_LoopField . "|"
				esmlist.= A_LoopField . "=" . RJSYSTEMS . "\" . A_LoopField . "|"
			}
	}
if (ESHOME <> "")
	{
		avblnk=
		esynlst=
		ifexist, %ESHOME%\es_systems.cfg
			{
				Loop,Read,%ESHOME%\es_systems.cfg
					{
						if (A_LoopReadLine = "")
							{
									continue
							}
						stringsplit,avix,A_LoopReadLine,<>
						if (avix2 = "name")
							{
								runame= %avix3%
							}
						if (avix2 = "path")
							{
								rupath= %avix3%
							}
						if (avix2 = "platform")
							{
								suplkup= %avix3%
								ifnotinstring,scrsup,%avix3%
									{
										continue
									}
								esxlist.= runame . "=" . rupath . "|"
							}
					}
			}
	}
Loop, Parse, esmlist,|
	{
		mls1=
		mls2=
		stringsplit,mls,A_LoopField,=
		akv=
		loop, parse, esxlist,|
			{
				dup=
				xls1=
				xls2=
				stringsplit,xls,A_LoopField,=
				if (mls1 = xls1)
					{
						if (mls2 = xls2)
							{
								dup= 1
								break
							}
						AKV:
						akv+=1
						newnm= %xls1%%akv%
						ifinstring, exmlist,%xls1%%akv%
							{
								goto, AKV
							}
						csxlst.= newnm . "|"
						cursysthl.= newnm . "=" . xls2 . "|"
						continue
					}
			}
		if (dup = "")
			{
				csxlst.= mls1 . "|"
				cursysthl.= mls1 . "=" . mls2 . "|"
				continue
			}
	}
ppartb= 	
Loop,parse,ssenms,|
	{
		pggmbt%A_Index%= %A_LoopField%
		ppartb.= A_LoopField . "|"
	}
guicontrol,move,FEPICA,x495 y5 w240 h205
guicontrol,,FEPICA,
guicontrol,move,FEBUTA,x458 y420 w83 h33
guicontrol,,FEBUTA,Download
gui,font,Bold
Guicontrol,font,FEBUTA
gui,font,normal
guicontrol,move,FEBUTN,x350 y470 w15 h15
guicontrol,,FEBUTN,-
guicontrol,move,FEBUTB,x259 y285 w17 h18
guicontrol,,FEBUTB,^
guicontrol,move,FEBUTC,x259 y305 w17 h18
guicontrol,,FEBUTC,v
guicontrol,move,FEBUTD,x279 y367 w45 h19
guicontrol,,FEBUTD, reset
guicontrol,move,FEBUTE,x330 y367 w48 h19
guicontrol,,FEBUTE, remove
guicontrol,move,FEBUTF,x339 y110 w45 h19
guicontrol,,FEBUTF,. . .
guicontrol,move,FEBUTG,x533 y474 w11 h16
guicontrol,,FEBUTG,<
guicontrol,move,FEBUTO,,x534 y240 w30 h19
guicontrol,,FEBUTO,>All
guicontrol,enable,FEBUTH
guicontrol,move,FEBUTH,x544 y474 w11 h16
guicontrol,,FEBUTH,>
guicontrol,move,FEBUTI,x458 y420 w83 h33
guicontrol,,FEBUTI,cancel
guicontrol,move,FEBUTM,x738 y473 w20 h20
guicontrol,,FEBUTM,...
guicontrol,move,FEBUTL,x619 y214 w36 h17
guicontrol,,FEBUTL,open
guicontrol, ,FELNKB,
guicontrol,move,FELNKB,x435 y5 w137 h13
guicontrol, ,FELNKA,<a href="http://screenscraper.fr">screenscraper.fr</a>
guicontrol,move,FELNKA,x289 y208 w128 h13
guicontrol,move,FEEDTA,x348 y158 w110 h21
guicontrol,,FEEDTA,%ssuser%
guicontrol,move,FEEDTB,x348 y180 w110 h21
guicontrol,+password,FEEDTB
guicontrol,,FEEDTB,%sspassw%
guicontrol,move,FEEDTC, x397 y368 w72 h21
guicontrol,+number,FEEDTC
guicontrol,,FEEDTC, %imagewidth%
guicontrol,move, FEEDTD,x397 y393 w72 h21
guicontrol,+number,FEEDTD
guicontrol,,FEEDTD, %imageheight%
guicontrol,-Multi,FELBXB
guicontrol,move,FELBXB,x564 y235 w199 h212
guicontrol,,FECBXA,|ImageName||
guicontrol,move,FECBXA,x444 y89 w100 h21
guicontrol,+Right,FECBXB
guicontrol,,FECBXB,|
guicontrol,move,FECBXB,x565 y474 w171
guicontrol,,FELBXB,|
guicontrol,move,FELBXA,x279 y259 w101 h108
guicontrol,,FELBXA,|%mediaorder%
guicontrol,move,FECHKA,x466 y259 w80 h13
guicontrol,,FECHKA,Backdrop
guicontrol,move,FECHKB,x466 y277 w80 h13
guicontrol,,FECHKB,Box-Art
guicontrol,move,FECHKC,x466 y293 w80 h13
guicontrol,,FECHKC,Logo
guicontrol,move,FECHKD,x466 y310 w81 h13
guicontrol,,FECHKD,Video
guicontrol,move,FECHKE,x466 y327 w80 h13
guicontrol,,FECHKE,Metadata
guicontrol,move,FECHKP, x466 y243 w80 h13
guicontrol,,FECHKP,Photos
guicontrol,move,FECHKF,x385 y323 w80 h13
guicontrol,,FECHKF,Overwrite
guicontrol,move,FECHKG,x466 y346 w80 h13
guicontrol,,FECHKG,Snapshot
guicontrol,move,FECHKH, x389 y259 w70 h17
guicontrol,,FECHKH,3D Boxart
guicontrol,move,FECHKI,x389 y327 w59 h17
guicontrol,,FECHKI,Cart
guicontrol,move,FECHKJ,x389 y346 w59 h17
guicontrol,,FECHKJ,3 Mix
guicontrol,move,FECHKK,x389 y293 w59 h17
guicontrol,,FECHKK,4 Mix
guicontrol,move,FECHKL,x389 y310 w59 h17
guicontrol,,FECHKL,Label
guicontrol,move,FECHKM,x389 y277 w59 h17
guicontrol,,FECHKM,Marquee
guicontrol,move,FECHKN,x285 y423 w82 h13
guicontrol,,FECHKN,Redundancy
guicontrol,move,FECHKO,x265 y463 w69 h13
guicontrol,,FECHKO,Scrape to
guicontrol,move,FEDDLG,x340 y460 w130
guicontrol,,FEDDLG,|Jackets||%fSYSINSTLBX%
guicontrolget,FEDDLG,,FEDDLG
guicontrol,move,FEDDLD,x599 y22 w162
guicontrol,,FEDDLD,|rj||
guicontrolget,FEDDLD,,FEDDLD
guicontrol,move,FEDDLE,x662 y212 w100
guicontrol,,FEDDLE,|
guicontrol,move,FEDDLF,x340 y89 w100
guicontrol,,FEDDLF,|Image Type||%ppartb%
guicontrol,move,FEDDLC,x281 y237 w100
guicontrol,,FEDDLC,|Global||%metaimages%
guicontrol,move,FEDDLA,x9 y41 w249
guicontrol,,FEDDLA,|Systems||
guicontrol,,FELVA,Mirrors
guicontrol,move,FELVA,x10 y64 w247 h433
guicontrol,+altsubmit,FELVA
guicontrol,+checked,FELVA
guicontrol,+Multi,FELVA
gui,ListView,FELVA
LV_Delete()
guicontrol,move,FERAD5B,x289 y79 w81 h13
guicontrol,,FERAD5B,All Systems
guicontrol,,FERAD5B, 0
guicontrol,move,FERAD5A,x289 y95 w130 h13
guicontrol,,FERAD5A, Individual System
guicontrol,,FERAD5A, 1
guicontrol,move,FERAD2A,x272 y65 w80 h13
guicontrol,,FERAD2A,Systems
guicontrol,,FERAD2A, 1
guicontrol,move,FERAD2B,x272 y89 w60 h13
guicontrol,,FERAD2B,Jackets
guicontrol,,FERAD2B, 0
guicontrol,move,FERAD2C,x272 y110 w60 h13
guicontrol,,FERAD2C,ROMs
guicontrol,,FERAD2C, 0
guicontrol,move,FERAD7A,x615 y457 w50 h13
guicontrol,,FERAD7A,Strict
guicontrol,,FERAD7A, 1
guicontrol,move,FERAD7B,x557 y457 w50 h15
guicontrol,,FERAD7B,Fuzzy
guicontrol,,FERAD7B, 0
guicontrol,move,FERAD4A,x454 y240 w44 h13
guicontrol,,FERAD4A,PNG
guicontrol,,FERAD4A, 1
guicontrol,move,FERAD4B,x405 y239 w38 h15
guicontrol,,FERAD4B,JPG
guicontrol,,FERAD4B, 0
guicontrol,move,FETXTA,x599 y5 w140 h13
guicontrol,,FETXTA,Global Artwork Theme
bdset= Not Found
ifexist,rj\netArt\%FEDDLD%\Backdrops.7z
	{
		bdset= Downloaded
	}
guicontrol,move,FETXTB,x435 y23 w137 h13
guicontrol,,FETXTB,Backdrop Set %bdset%
icoset= Not Found
ifexist,rj\netArt\%FEDDLD%\Icons.7z
	{
		icoset= Downloaded
	}
guicontrol,move,FETXTC,x435 y37 w137 h13
guicontrol,,FETXTC,Icon Set %icoset%
logset= Not Found
ifexist,rj\netArt\%FEDDLD%\Logos.7z
	{
		logset= Downloaded
	}
guicontrol,move,FETXTD,x435 y51 w138 h13
guicontrol,,FETXTD,Logo Set %logset%
metset= Not Found
ifexist,rj\netArt\%FEDDLD%\MetaData.7z
	{
		metset= Downloaded
	}
guicontrol,move,FETXTE,x435 y66 w147 h13
guicontrol,,FETXTE,Metadata Set %metset%
guicontrol,move,FETXTG,x291 y392 w78 h13
guicontrol,,FETXTG,Scraper Priority
guicontrol,move,FETXTI,x288 y157 w53 h23
guicontrol,,FETXTI,Username
guicontrol,move,FETXTJ,x290 y180 w50 h23
guicontrol,,FETXTJ,Password
guicontrol,move,FETXTK,x390 y110 w350 h13
guicontrol,,FETXTK,ROMPATHS
guicontrol,move,FETXTL,x472 y373 w88 h13
guicontrol,,FETXTL,Image Max-Width
guicontrol,move,FETXTM,x472 y396 w88 h13
guicontrol,,FETXTM,Image Max-height
guicontrol,move,FETXTN,x470 y75 w88 h13
guicontrol,,FETXTN,Image-Name
guicontrol,move,FEGRPA,x282 y133 w200 h98
guicontrol,,FEGRPA,ScreenScraper
guicontrol,move,FEPRGA,x15 y500 w736 h7
guicontrol,,FEPRGA,0
Gui,ListView,FELVA
Loop, Parse, systmfldrs,|
	{
		LV_Add("",A_LoopField)
	}
LV_ModifyCol()
Loop,parse,fe_medtog,|
	{
		guicontrol,enable,%A_LoopField%
	}
Loop,parse,fe_medshw,|
	{
		guicontrol,show,%A_LoopField%
	}
return

MediaFEBUTN:
gosub, CLRNETP
return

MediaFEBUTO:
loop,parse,efbab,|
	{
		guicontrol,,%A_LoopField%,1
	}
return

MediaFEBUTA:
CNCLKUP=
getboxart=
getbackdrop=
getsnapshot=
getvideo=
getmetadata=
getlogo=
arpause= disable
artinterupt= show
gosub, ARTPAUSE
guicontrol,show,FEBUTI
guicontrol,hide,FEBUTA
guicontrol,show,FEBUTI
guicontrol,enable,FEBUTI
artinterupt= hide
arpause= enable
guicontrolget,FERAD5A,,FERAD5A
guicontrolget,FERAD2A,,FERAD2A
guicontrolget,REALSYS,,FEDDLA
guicontrolget,FEDDLD,,FEDDLD
guicontrolget,FECHKA,,FECHKA
if (FECHKA = 1)
	{
		getbackdrop= 1
	}
guicontrolget,FECHKB,,FECHKB
if (FECHKB = 1)
	{
		getboxart= 1
	}
guicontrolget,FECHKC,,FECHKC
if (FECHKC = 1)
	{
		getlogo= 1
	}
guicontrolget,FECHKD,,FECHKD
if (FECHKD = 1)
	{
		getvideo= 1
	}
guicontrolget,FECHKE,,FECHKE
if (FECHKE = 1)
	{
		getmetadata= 1
	}
guicontrolget,FECHKG,,FECHKG
if (FECHKG = 1)
	{
		getsnapshot= 1
	}
guicontrolget,FECHKH,,FECHKH
if (FECHKH = 1)
	{
		get3dboxart= 1
	}
guicontrolget,FECHKI,,FECHKI
if (FECHKI = 1)
	{
		getcart= 1
	}
guicontrolget,FECHKJ,,FECHKJ
if (FECHKJ = 1)
	{
		get3mix= 1
	}
guicontrolget,FECHKK,,FECHKK
if (FECHKK = 1)
	{
		get4mix= 1
	}
guicontrolget,FECHKL,,FECHKL
if (FECHKL = 1)
	{
		getlabel= 1
	}
guicontrolget,FECHKM,,FECHKM
if (FECHKM = 1)
	{
		getbanner= 1
		getmarquee= 1
	}
guicontrolget,FECHKF,,FECHKF
iniRead, mediaorder,mediafe.ini,ORDER,system_order
IniRead, photop,sets\themes.set,%FEDDLD%,Photos
IniRead, photod,sets\themes.set,%FEDDLD%,Photos_Directory
IniRead, bckdrp,sets\themes.set,%FEDDLD%,Backdrop
IniRead, bckdrpd,sets\themes.set,%FEDDLD%,Backdrop_Directory
IniRead, icnl,sets\themes.set,%FEDDLD%,Icon
IniRead, icnld,sets\themes.set,%FEDDLD%,Icon_Directory
IniRead, logol,sets\themes.set,%FEDDLD%,Logo
IniRead, logold,sets\themes.set,%FEDDLD%,Logo_Directory
IniRead, videol,sets\themes.set,%FEDDLD%,Video
IniRead, videold,sets\themes.set,%FEDDLD%,Video_Directory
IniRead, metl,sets\themes.set,%FEDDLD%,Meta
IniRead, metld,sets\themes.set,%FEDDLD%,Meta_Directory
DWNOVR= False
if (FECHKF = 1)
	{
		DWNOVR= True
	}
dwnlenb:= 0
dwnlenb:= (FECHKA + FECHKB + FECHKC + FECHKD + FECHKE + FECHKG + FECHKH + FECHKI + FECHKJ + FECHKK + FECHKL + FECHKM)
if (dwnlenb = 0)
	{
		SB_SetText("You must select components to download.")
		gosub, ARTPAUSE
		guicontrol,show,FEBUTA
		guicontrol,enable,FEBUTA
		guicontrol,hide,FEBUTI
		guicontrol,hide,FEBUTN
		guicontrol,enable,FELVA
		guicontrol,enable,FEDDLA
		guicontrol,enable,FERAD2A
		guicontrol,enable,FERAD2B
		guicontrol,enable,FERAD5A
		guicontrol,enable,FERAD5B
		return
	}
SB_SetText("...Scrape commencing....")
FEItems=
FEItems:= LVGetCheckedItems("", "ahk_id" . FELSTVA)
if (CNCLKUP = 1)
	{
		SB_SetText("Process Interrupted")
		gosub, cleanprgb
		return
	}
DWNFLD=
if (FERAD2A = 1)
	{
		if (FERAD5A = 1)
			{
				Loop, Parse, FEItems,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						if (A_Index > 1)
							{
								batchdl= 1
							}
						if (FECHKA = 1)
							{
								URLFILE= %bckdrpd%/%A_LoopField%.png
								save= rj\netArt\%FEDDLD%\%A_LoopField%\Backdrops\%A_LoopField%.png
								ifnotexist, rj\netArt\%FEDDLD%\%A_LoopField%\Backdrops
								FileCreateDir, rj\netArt\%FEDDLD%\%A_LoopField%\Backdrops
								splitpath,save,svaf,svap
								exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
								;;DownloadFile(URLFILE,save, DWNOVR, True)
								FileGetSize,imgsz,%save%,K
								SB_SetText(" " A_LoopField " backdrop downloaded")
								if (imgsz < 1)
									{
										DWNFLD= 1
										FileDelete,%save%
										SB_SetText(" " A_LoopField " backdrop was not downloaded")
									}
								ifNotExist, %save%
									{
										DWNFLD= 1
										SB_SetText(" " A_LoopField " backdrop was not downloaded")
									}
							}
							if (CNCLKUP = 1)
								{
									SB_SetText("Process Interrupted")
									gosub, cleanprgb
									break
								}
						if (FECHKP = 1)
							{
								URLFILE= %photod%/%A_LoopField%.png
								save= rj\netArt\%FEDDLD%\%A_LoopField%\Photos\%A_LoopField%.png
								ifnotexist, rj\netArt\%FEDDLD%\%A_LoopField%\Photos
								FileCreateDir, rj\netArt\%FEDDLD%\%A_LoopField%\Photos
								splitpath,save,svaf,svap
								exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
								;;DownloadFile(URLFILE,save, DWNOVR, True)
								FileGetSize,imgsz,%save%,K
								SB_SetText(" " A_LoopField " Photo downloaded")
								if (imgsz < 1)
									{
										DWNFLD= 1
										FileDelete,%save%
										SB_SetText(" " A_LoopField " Photo was not downloaded")
									}
								ifNotExist, %save%
									{
										DWNFLD= 1
										SB_SetText(" " A_LoopField " Photo was not downloaded")
									}
							}
							if (CNCLKUP = 1)
								{
									SB_SetText("Process Interrupted")
									gosub, cleanprgb
									break
								}
						if (FECHKB = 1)
							{
								URLFILE= %icnld%/%A_LoopField%.png
								save= rj\netArt\%FEDDLD%\%A_LoopField%\Icons\%A_LoopField%.png
								ifnotexist, rj\netArt\%FEDDLD%\%A_LoopField%\Icons
								FileCreateDir, rj\netArt\%FEDDLD%\%A_LoopField%\Icons
								splitpath,save,svaf,svap
								exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
								;;DownloadFile(URLFILE,save, DWNOVR, True)
								FileGetSize,imgsz,%save%,K
								SB_SetText(" " A_LoopField " icon downloaded")
								if (imgsz < 1)
									{
										DWNFLD= 1
										FileDelete,%save%
										SB_SetText(" " A_LoopField " icon was not downloaded")
									}
								ifNotExist, %save%
									{
										DWNFLD= 1
										SB_SetText(" " A_LoopField " icon was not downloaded")
									}
							}
							if (CNCLKUP = 1)
								{
									SB_SetText("Process Interrupted")
									gosub, cleanprgb
									break
								}
						if (FECHKC = 1)
							{
								URLFILE= %logold%/%A_LoopField%.png
								save= rj\netArt\%FEDDLD%\%A_LoopField%\Logos\%A_LoopField%.png
								ifnotexist, rj\netArt\%FEDDLD%\%A_LoopField%\Logos
								FileCreateDir, rj\netArt\%FEDDLD%\%A_LoopField%\Logos
								splitpath,save,svaf,svap
								exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
								;;DownloadFile(URLFILE,save, DWNOVR, True)
								FileGetSize,imgsz,%save%,K
								SB_SetText(" " A_LoopField " logo downloaded")
								if (imgsz < 1)
									{
										DWNFLD= 1
										FileDelete,%save%
										SB_SetText(" " A_LoopField " logo was not downloaded")
									}
								ifNotExist, %save%
									{
										DWNFLD= 1
										SB_SetText(" " A_LoopField " logo was not downloaded")
									}
							}
							if (CNCLKUP = 1)
								{
									SB_SetText("Process Interrupted")
									gosub, cleanprgb
									break
								}
						if (FECHKD = 1)
							{
								URLFILE= %videold%/%A_LoopField%/%A_LoopField%.mp4
								save= rj\netArt\%FEDDLD%\%A_LoopField%\Videos\%A_LoopField%.mp4
								ifnotexist, rj\netArt\%FEDDLD%\%A_LoopField%\Videos
								FileCreateDir, rj\netArt\%FEDDLD%\%A_LoopField%\Videos
								splitpath,save,svaf,svap
								exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
								;;DownloadFile(URLFILE,save, DWNOVR, True)
								FileGetSize,imgsz,%save%,K
								SB_SetText(" " A_LoopField " video downloaded")
								if (imgsz < 1)
									{
										DWNFLD= 1
										FileDelete,%save%
										SB_SetText(" " A_LoopField " video was not downloaded")
									}
								ifNotExist, %save%
									{
										DWNFLD= 1
										SB_SetText(" " A_LoopField " video was not downloaded")
									}
							}
							if (CNCLKUP = 1)
								{
									SB_SetText("Process Interrupted")
									gosub, cleanprgb
									break
								}
						if (FECHKE = 1)
							{
								URLFILE= %metld%/%A_LoopField%.xml
								save= rj\netArt\%FEDDLD%\%A_LoopField%\MetaData\%A_LoopField%.xml
								ifnotexist, rj\netArt\%FEDDLD%\%A_LoopField%\MetaData
								FileCreateDir, rj\netArt\%FEDDLD%\%A_LoopField%\MetaData
								splitpath,save,svaf,svap
								exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
								;;DownloadFile(URLFILE,save, DWNOVR, True)
								FileGetSize,imgsz,%save%,K
								SB_SetText(" " A_LoopField " downloaded")
								if (imgsz < 1)
									{
										DWNFLD= 1
										FileDelete,%save%
										SB_SetText(" " A_LoopField " metadata was not downloaded")
									}
								ifNotExist, %save%
									{
										DWNFLD= 1
										SB_SetText(" " A_LoopField " metadata was not downloaded")
									}
							}
							if (CNCLKUP = 1)
								{
									SB_SetText("Process Interrupted")
									gosub, cleanprgb
									break
								}
					}
			SB_SetText("Scraping Complete")
			gosub, cleanprgb
			}
;;;;;;;;;;;;;;;;;;;;;  ARTWORK SETS  ;;;;;;;;;;;;;
		if (FERAD5B = 1)
			{
				DWNFLD=
				if (FECHKA = 1)
					{
						URLFILE= %bckdrp%
						splitpath,URLFILE,bdfile
						save= rj\netArt\%FEDDLD%\%bdfile%
						ifnotexist, rj\netArt\%FEDDLD%
						FileCreateDir, rj\netArt\%FEDDLD%
						splitpath,save,svaf,svap
						exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
						;;DownloadFile(URLFILE,save, DWNOVR, True)
						FileGetSize,imgsz,%save%,K
						SB_SetText(" " A_LoopField " backdrops downloaded")
						if (imgsz < 1)
							{
								DWNFLD= 1
								FileDelete,%save%
								SB_SetText(" " A_LoopField " backdrops was not downloaded")
							}
						ifNotExist, %save%
							{
								DWNFLD= 1
								SB_SetText(" " A_LoopField " backdrops was not downloaded")
							}
					}
				if (FECHKP = 1)
					{
						URLFILE= %photop%
						splitpath,URLFILE,pdfile
						save= rj\netArt\%FEDDLD%\%pdfile%
						ifnotexist, rj\netArt\%FEDDLD%
						FileCreateDir, rj\netArt\%FEDDLD%
						splitpath,save,svaf,svap
						exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
						;;DownloadFile(URLFILE,save, DWNOVR, True)
						FileGetSize,imgsz,%save%,K
						SB_SetText(" " A_LoopField " photos downloaded")
						if (imgsz < 1)
							{
								DWNFLD= 1
								FileDelete,%save%
								SB_SetText(" " A_LoopField " photos was not downloaded")
							}
						ifNotExist, %save%
							{
								DWNFLD= 1
								SB_SetText(" " A_LoopField " photos was not downloaded")
							}
					}
				if (FECHKB = 1)
					{
						URLFILE= %icnl%
						splitpath,URLFILE,icfile
						save= rj\netArt\%FEDDLD%\%icfile%
						ifnotexist, rj\netArt\%FEDDLD%
						FileCreateDir, rj\netArt\%FEDDLD%
						splitpath,save,svaf,svap
						exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
						;;DownloadFile(URLFILE,save, DWNOVR, True)
						FileGetSize,imgsz,%save%,K
						SB_SetText(" " A_LoopField " icons downloaded")
						if (imgsz < 1)
							{
								DWNFLD= 1
								FileDelete,%save%
								SB_SetText(" " A_LoopField " icons was not downloaded")
							}
						ifNotExist, %save%
							{
								DWNFLD= 1
								SB_SetText(" " A_LoopField " icons was not downloaded")
							}
					}
				if (FECHKC = 1)
					{
						URLFILE= %logol%
						splitpath,URLFILE,lgfile
						save= rj\netArt\%FEDDLD%\%lgfile%
						ifnotexist, rj\netArt\%FEDDLD%
						FileCreateDir, rj\netArt\%FEDDLD%
						splitpath,save,svaf,svap
						exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
						;;DownloadFile(URLFILE,save, DWNOVR, True)
						FileGetSize,imgsz,%save%,K
						SB_SetText(" " A_LoopField " logos downloaded")
						if (imgsz < 1)
							{
								DWNFLD= 1
								SB_SetText(" " A_LoopField " logos was not downloaded")
							}
						ifNotExist, %save%
							{
								DWNFLD= 1
								SB_SetText(" " A_LoopField " logos was not downloaded")
							}
					}
				if (FECHKD = 1)
					{
						URLFILE= %videol%
						splitpath,URLFILE,vefile
						save= rj\netArt\%FEDDLD%\%vefile%
						ifnotexist, rj\netArt\%FEDDLD%\Videos
						FileCreateDir, rj\netArt\%FEDDLD%\Videos
						splitpath,save,svaf,svap
						exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
						;;DownloadFile(URLFILE,save, DWNOVR, True)
						FileGetSize,imgsz,%save%,K
						SB_SetText(" " A_LoopField " videos downloaded")
						if (imgsz < 1)
							{
								DWNFLD= 1
								FileDelete,%save%
								SB_SetText(" " A_LoopField " videos was not downloaded")
							}
						ifNotExist, %save%
							{
								DWNFLD= 1
								SB_SetText(" " A_LoopField " videos was not downloaded")
							}
					}
				if (FECHKE = 1)
					{
						URLFILE= %metl%
						splitpath,URLFILE,mtfile
						save= rj\netArt\%FEDDLD%\%mtfile%
						ifnotexist, rj\netArt\%FEDDLD%
						FileCreateDir, rj\netArt\%FEDDLD%
						splitpath,save,svaf,svap
						exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
						;;DownloadFile(URLFILE,save, DWNOVR, True)
						FileGetSize,imgsz,%save%,K
						SB_SetText(" " A_LoopField " metadata downloaded")
						if (imgsz < 1)
							{
								DWNFLD= 1
								FileDelete,%save%
								SB_SetText(" " A_LoopField " metadata was not downloaded")
							}
						ifNotExist, %save%
							{
								DWNFLD= 1
								SB_SetText(" " A_LoopField " metadata was not downloaded")
							}
					}
				GuiControl,,FEPRGA,0
				if (DWNFLD = 1)
					{
						SB_SetText("Some items could not be retrieved.")
					}
				return
			}
	}
if (FERAD2B = 1)
	{
		SCRPCPY= 
		iniread,scrapeto,MediaFE.ini,GLOBAL,scrape_destinations
		Loop,parse,scrapeto,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				SCRPCPY= 1
				%A_LoopField%_scrape= 1	
			}
		if (INARCL = 1)
			{
				FEItems:= LVGetCheckedItems("", "ahk_id" . FELSTVA)
			}
		if (FEDDLA = "")
			{
				guicontrolget,SYSROMD,,ESDWNLPOS
				SYSLKLOC= %RJSYSTEMS%\%SYSROMD%
				REALSYS= %SYSROMD%
				SCRPDIR= %SYSLKLOC%
				SYSLKUP= %SYSROMD%
			}
		goto, JACKETSCRAPE
	}
if (FERAD2C = 1)
	{
		SCRPCPY= 
		iniread,scrapeto,MediaFE.ini,GLOBAL,scrape_destinations
		Loop,parse,scrapeto,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				SCRPCPY= 1
				%A_LoopField%_scrape= 1	
			}
		if (EmulationStation_scrape = 1)
			{
				filecreatedir,%eshome%\downloaded_images\%REALSYS%
			}		
		if (retroArch_scrape = 1)
			{
				filecreatedir,%thumbnailsDirectory%\%REALSYS%
			}		
		Loop, Parse, FEItems,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				rmfnpth= %A_LoopField%
				splitpath,A_LoopField,romfnam,,,jaktit
				realname= %jaktit%
				SYSROMD= %romfnam%
				SYSLKLOC= %RJSYSTEMS%\%SYSROMD%
				REALSYS= %SYSROMD%
				SCRPDIR= %SYSLKLOC%
				SYSLKUP= %SYSROMD%
				gosub, BROMSCRAPE
				if (CNCLKUP = 1)
					{
						SB_SetText("Process Interrupted")
						gosub, cleanprgb
						break
					}
			}
		SB_SetText("Scraping Complete")
		gosub, cleanprgb
	}
batchdl= 	
arpause= enable
gosub,ARTPAUSE
guicontrol,hide,FEBUTI
guicontrol,show,FEBUTA
guicontrol,enable,FEBUTA
return

JACKETSCRAPE:
SYSLKUP= %FEDDLA%
if (EmulationStation_scrape = 1)
	{
		filecreatedir,%eshome%\downloaded_images\%SYSLKUP%
	}		
if (retroArch_scrape = 1)
	{
		filecreatedir,%thumbnailsDirectory%\%SYSLKUP%
	}	
BROMSCRAPE:
mameget=
JACKINARC:
if (SYSLKUP = "Capcom Play System - CPS")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (SYSLKUP = "MAME - Arcade")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (SYSLKUP = "MAME")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (SYSLKUP = "Capcom Play System - CPS II")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (SYSLKUP = "SNK - Neo Geo MVS")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (SYSLKUP = "Sega - Hikaru")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (SYSLKUP = "Galeco - Galeco")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (SYSLKUP = "Sega - NAOMI")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (SYSLKUP = "Sega - Model 2")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (SYSLKUP = "Sega - Model 3")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (SYSLKUP = "Cave Systems - Cave")
	{
		SYSLKUP= MAME - Arcade
		mameget= 1
	}
if (mameget = 1)
	{
		if (mamedbx = "")
			{
				FileRead, mamedbx, sets\MAME - Arcade.set
			}
	}
if (mediaorder = "")
	{
		return
	}
sscrape= 1
ssopt=
if (ssuser = "")
	{
		sscrape=
	}
if (sspassw = "")
	{
		sscrape=
	}
if (sscrape <> "")
	{
		ssopt:= A_Space . "-ss_user=" . ssuser . A_Space . "-ss_password=" . sspassw
	}
3DBoxartscrapeorder=
Marqueescrapeorder=
4Mixscrapeorder=
3Mixscrapeorder=
Labelscrapeorder=
Cartscrapeorder=
Backdropscrapeorder=
BoxArtscrapeorder=
Logoscrapeorder=
Videoscrapeorder=
Metadatascrapeorder=
Snapshotscrapeorder=
sscrpri=
iniread,imagefrmt,mediafe.ini,CONFIG,Global_image_format
iniread,imageheight,mediafe.ini,CONFIG,Global_image_height
iniread,imagewdith,mediafe.ini,CONFIG,Global_image_width
iniread,iscrp,mediaFE.ini,ORDER
iniread,zrox,MediaFE.ini,%FEDDLA%,3DBoxart
if ((zrox = "")or(zrox = "ERROR"))
	{
		zrox= 3dboxart
	}
iniread,mrox,MediaFE.ini,%FEDDLA%,Marquee
if ((mrox = "")or(mrox = "ERROR"))
	{
		mrox= Marquee
	}
iniread,4rox,MediaFE.ini,%FEDDLA%,4Mix
if ((4rox = "")or(4rox = "ERROR"))
	{
		4rox= 4mix
	}
iniread,3rox,MediaFE.ini,%FEDDLA%,3Mix
if ((3rox = "")or(3rox = "ERROR"))
	{
		3rox= 3mix
	}
iniread,lrox,MediaFE.ini,%FEDDLA%,Label
if ((lrox = "")or(lrox = "ERROR"))
	{
		lrox= label
	}
iniread,crox,MediaFE.ini,%FEDDLA%,Cart
if ((crox = "")or(crox = "ERROR"))
	{
		crox= Media
	}
iniread,brox,MediaFE.ini,%FEDDLA%,Backdrop
if ((brox = "")or(brox = "ERROR"))
	{
		brox= Fanart
	}
iniread,arox,MediaFE.ini,%FEDDLA%,BoxArt
if ((arox = "")or(arox = "ERROR"))
	{
		arox= Folder
	}
iniread,orox,MediaFE.ini,%FEDDLA%,Logo
if ((orox = "")or(orox = "ERROR"))
	{
		orox= Logo
	}
iniread,vrox,MediaFE.ini,%FEDDLA%,Video
if ((vrox = "")or(vrox = "ERROR"))
	{
		vrox= video
	}
iniread,drox,MediaFE.ini,%FEDDLA%,Metadata
if ((drox = "")or(drox = "ERROR"))
	{
		drox= game
	}
iniread,srox,MediaFE.ini,%FEDDLA%,Snapshot
if ((srox = "")or(srox = "ERROR"))
	{
		srox= snapshot
	}
Loop, Parse, mediaorder,|
	{
		if (A_LoopField = "ScreenScraper")
			{
				sscrpri.= "ss" . ","
			}
		if (A_LoopField = "theGamesDB")
			{
				sscrpri.= "gdb" . ","
			}
		if (A_LoopField = "OpenVGDB")
			{
				if (mameget = "")
					{
						sscrpri.= "ovgdb" . ","
					}
			}
	}
if (mameget = 1)
	{
		sscrpri.= "adb" . "," . "mamedb" . ","
	}
stringtrimright,sscrpri,sscrpri,1
scrapeorder= %sscrpri%
oppri= Global
Loop, Parse, metaimages,|
	{
		arpi= %A_LoopField%
		Loop, Parse, iscrp,`n`r
			{
				stringsplit,vix,A_LoopField,=
				if (vix1 = arpi)
					{
						stringreplace,vixs,vix1,%A_Space%,,All
						stringreplace,vixs,vixs,-,,All
						Loop,parse,vixs2,|
							{
								%vixs%order= 
								%vixs%sscrpri= 
							}
						Loop, Parse, vix2,|
							{
								if (A_LoopField = "IAGL")
									{
										%vixs%order.= "IAGL" . "|"
									}
								if (A_LoopField = "ScreenScraper")
									{
										%vixs%order.= "ScreenScraper" . "|"
										%vixs%sscrpri.= "ss" . ","
									}
								if (A_LoopField = "theGamesDB")
									{
										%vixs%order.= "theGamesDB" . "|"
										%vixs%sscrpri.= "gdb" . ","
									}
								if (A_LoopField = "OpenVGDB")
									{
										if (mameget = "")
											{
												%vixs%order.= "OpenVGDB" . "|"
												%vixs%sscrpri.= "ovgdb" . ","
											}
									}
							}
						if (mameget = 1)
							{
								if (A_LoopField = "arcadeitalia")
									{
										%vixs%order.= "ardadeitalia" . "|"
										%vixs%sscrpri.= "adb" . ","
									}
								if (A_LoopField = "mamedb")
									{
										%vixs%order.= "mamedb" . "|"
										%vixs%sscrpri.= "mamedb" . ","
									}
							}
					}
			}
		iniread,imgwdth,Mediafe.ini,CONFIG,%vixs%_image_width
		%vixs%imgsize= %imgwdth%
		if (imgwdth = "ERROR")
			{
				%vixs%imgsize= %imagewidth%
			}
		iniread,imght,Mediafe.ini,CONFIG,%vixs%_image_height
		%vixs%imgtall= %imght%
		if (imght = "ERROR")
			{
				%vixs%imgtall= %imageheight%
			}
		iniread,imgfrm,Mediafe.ini,CONFIG,%vixs%_image_format
		%vixs%imagefrmt= %imgfrm%
		if (imgfrm = "ERROR")
			{
				%vixs%imagefrmt= %imagefrmt%
			}
		nmorder= % %vixs%order
		if (nmorder = "")
			{
				nmorder= %mediaorder%
			}
		if (nmorder <> "")
			{
				mediaorder= %nmorder%
			}
		kiv= % %vixs%sscrpri
		if (kiv = "")
			{
				kiv= %sscrpri%
			}
		stringtrimright,kiv,kiv,1
		%vixs%scrapeorder= %kiv%
	}
if (FERAD2B = 1)
	{
		supsysr=
		supsysi=
		supsys=
		ifnotexist,%RJSYSTEMS%\%SYSLKUP%\%curtxt%\.snaps\
			{
				filecreatedir,%RJSYSTEMS%\%SYSLKUP%\%curtxt%\.snaps
			}
		Loop, Parse, scrsup,/
			{
				if (SYSLKUP = A_LoopField)
					{
						supsysr= 1
						supsys= 1
						break
					}
			}
		Loop,Parse,scrble,|
			{
				if (SYSLKUP = A_LoopField)
					{
						supsysi= 1
						supsys= 1
						break
					}
			}
		if (supsys = "")
			{
				SB_SetText(" " SYSLKUP " is not supported")
				return
			}
		SYSLKLOC= %RJSYSTEMS%\%REALSYS%
		Loop, Parse, FEItems,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				jaktit= %A_LoopField%
				ifinstring,A_LoopField,:
					{
						stringreplace,jaktit,A_LoopField,%RJSYSTEMS%\%SYSLKUP%\,,All
					}
				ifinstring,jaktit,:
					{
						njk=
						ptspl=
						Loop,Parse,jaktit,\
							{
								if ((njk = 1)&&(ptspl <> ""))
									{
										ptspl.= "\"
									}
								if (A_LoopField = SYSLKUP)
									{
										njk= 1
									}
								if (njk = 1)
									{
										ptspl.= A_LoopField
									}
							}
						splitpath,ptspl,,,,jaktit
					}
				realname= %jaktit%
				ifnotexist,%RJSYSTEMS%\%REALSYS%\%realname%\.snaps\
					{
						filecreatedir,%RJSYSTEMS%\%REALSYS%\%realname%\.snaps
					}
				if (getboxart = 1)
					{
						FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Boxart
					}
				if (get3dboxart = 1)
					{
						FileCreateDir, %ASSETS%\%REALSYS%\%realname%\3DBoxart
					}
				if (getbackdrop = 1)
					{
						FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Backdrops
					}
				if (getsnapshot = 1)
					{
						FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Snapshots
					}
				if (getlogo = 1)
					{
						FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Logos
					}
				if (getvideo = 1)
					{
						FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Videos
					}
				if (getmetadata = 1)
					{
						FileCreateDir, %ASSETS%\%REALSYS%\%realname%\MetaData
					}
				if (getlabel = 1)
					{
						FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Labels
					}
				if (getcart = 1)
					{
						FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Carts
					}
				if (getmarquee = 1)
					{
						FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Marquees
					}
				stringReplace,nsjak,jaktit,%A_Space%,,All
				stringReplace,nsjak,nsjak,',,All
				stringReplace,nsjak,nsjak,.,,All
				stringReplace,nsjak,nsjak,`,,,All
				stringReplace,nsjak,nsjak,-,,All
				ccnt1=
				ccnt2=
				stringsplit,ccnt,nsjak,([
				ifnotexist, rj\scrapeArt\
					{
						filecreatedir,rj\scrapeArt
					}
				ifnotexist, rj\scrapeArt\%SYSLKUP%\
					{
						ifnotexist,rj\scrapeArt\%SYSLKUP%.7z
							{
								IniRead,dlprfx,%ARCORG%,GLOBAL,HOSTINGURL
								;;filereadline,dlprfx,arcorg.set,2
								URLFILE= %dlprfx%/DATFILES/%SYSLKUP%.7z
								ifinstring,dlprfx,github
									{
										urloc1= DATFILES
										urloc2= %SYSLKUP%.7z
										URLFILE= %dlprfx%/%urloc1%/raw/master/%urloc2%
									}
								save= rj\scrapeArt\%SYSLKUP%.7z
								SB_SetText("Downloading " SYSLKUP " Metadata")
								splitpath,save,svaf,svap
								exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
								;;DownloadFile(URLFILE,save, True, True)
								SB_SetText("Download Complete")
								gosub, cleanprgb
							}
						if (CNCLKUP = 1)
								{
									SB_SetText("Process Interrupted")
									gosub, cleanprgb
									break
								}
						ifnotexist,rj\scrapeArt\%SYSLKUP%.7z
							{
								IniRead,dlprfx,%ARCORG%,GLOBAL,SOURCEHOST
								;;filereadline,dlprfx,arcorg.set,5
								URLFILE= %dlprfx%/rj/scrapeart/%SYSLKUP%.7z
								save= rj\scrapeArt\%SYSLKUP%.7z
								SB_SetText("Downloading " SYSLKUP " Metadata")
								splitpath,save,svaf,svap
								exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
								;;DownloadFile(URLFILE,save, True, True)
								SB_SetText("Download Complete")
								gosub, cleanprgb
							}
						ifnotexist,rj\scrapeArt\%SYSLKUP%.7z
							{
									SB_SetText(" Metadata was not downloaded ")
									gosub, cleanprgb
							}
						if (CNCLKUP = 1)
								{
									SB_SetText("Process Interrupted")
									gosub, cleanprgb
									break
								}
						ifexist,rj\scrapeArt\%SYSLKUP%.7z
							{
								SB_SetText("Extracting " SYSLKUP " metadata")
								RunWait, "%S_KeyDir%\bin\7za.exe" x -y "rj\scrapeArt\%SYSLKUP%.7z" -O"rj\scrapeArt",,hide
								SB_SetText(" " SYSLKUP " metadata extracted")
							}
					}
				if (CNCLKUP = 1)
						{
							SB_SetText("Process Interrupted")
							gosub, cleanprgb
							break
						}
				gosub, SCRSCRAPE
				if (CNCLKUP = 1)
						{
							SB_SetText("Process Interrupted")
							gosub, cleanprgb
							break
						}
				Loop, rj\scrapeArt\%SYSLKUP%\*.xml
					{
						splitpath,A_LoopFileFullPath,xmlf,,,xmln
						stringreplace,akj,xmln,%A_Space%,,All
						stringreplace,akj,akj,',,All
						stringreplace,akj,akj,.,,All
						stringreplace,akj,akj,`,,,All
						stringreplace,akj,akj,-,,All
						ccnv1=
						ccnv2=
						stringsplit,ccnv,akj,([
						if (xmln = jaktit)
							{
								gosub, DBSCRAPE
								continue
							}
						if (ccnt1 = ccnv1)
							{
								gosub, DBSCRAPE
								continue
							}
						if (CNCLKUP = 1)
								{
									SB_SetText("Process Interrupted")
									gosub, cleanprgb
									break
								}
					}
				if (CNCLKUP = 1)
						{
							SB_SetText("Process Interrupted")
							gosub, cleanprgb
							break
						}
			}
			SB_SetText("Scraping Complete")
	}
if (FERAD2C = 1)
	{
		iniread,bbnbz,emuCfgPresets.ini,%rmfnpth%,RJROMXT
		if (bbnbz = "ERROR")
			{
				krmswp= 1
				bbnbz= %extpvr%
			}
		stringreplace bbnbz,bbnbz,.,,All
		stringsplit,extpvx,bbnbz,`,
		sxtn := Object()
		Loop, %extpvx0%
			{
				new= % (extpvx%a_index%)
				if (extpvx%a_index% <> "")
					{
						sxtn.insert(new)
					}
			}
		;;if (rmfnpth = "")
			;;{
				rmfnpth= *.*
			;;}
		Loop, %SYSLKLOC%\%rmfnpth%,0,1
			{
				if A_LoopFileAttrib contains H
						{
							continue
						}
				ext= %A_LoopFileExt%
				if (ext = "")
					{
						continue
					}
				noapl=
				for k, v in sxtn
					{
						extm:= v
						if (ext = extm)
							{
								noapl= 1
							}
					}
				if (noapl = krmswp)
					{
						continue
					}
				splitpath,A_LoopFileFullPath,repnm,sysfrd,,justrom
				jaktit= %justrom%
				realname= %justrom%
				stringReplace,nsjak,jaktit,%A_Space%,,All
				stringReplace,nsjak,nsjak,',,All
				stringReplace,nsjak,nsjak,.,,All
				stringReplace,nsjak,nsjak,`,,,All
				stringReplace,nsjak,nsjak,-,,All
				ccnt1=
				ccnt2=
				stringsplit,ccnt,nsjak,([
				gosub, SCRSCRAPE
				ifnotexist, rj\scrapeArt\%SYSLKUP%
					{
						filecreatedir,rj\scrapeArt\%SYSLKUP%
						ifnotexist,rj\scrapeArt\%SYSLKUP%.7z
							{
								IniRead,dlprfx,%ARCORG%,GLOBAL,HOSTINGURL
								;;filereadline,dlprfx,arcorg.set,2
								URLFILE= %dlprfx%/DATFILES/%SYSLKUP%.7z
								ifinstring,dlprfx,github
									{
										urloc1= DATFILES
										urloc2= %SYSLKUP%.7z
										URLFILE= %dlprfx%/%urloc1%/raw/master/%urloc2%
									}
								save= rj\scrapeArt\%SYSLKUP%.7z
								SB_SetText("Downloading " SYSLKUP " Metadata")
								splitpath,save,svaf,svap
								exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
								;;DownloadFile(URLFILE,save, True, True)
								SB_SetText("Download Complete")
						ifnotexist,rj\scrapeArt\%SYSLKUP%.7z
							{
								SB_SetText("Download Failed")
								return
							}
					}
						SB_SetText("Extracting " SYSLKUP " metadata")
						RunWait, %comspec% cmd /c "  "%S_KeyDir%\bin\7za.exe" e -y "rj\scrapeArt\%SYSLKUP%.7z" -O"rj\scrapeArt\%SYSLKUP%" ",,hide
						SB_SetText(" " SYSLKUP " metadata extracted")
					}
				Loop, rj\scrapeArt\%SYSLKUP%\*.xml
					{
						splitpath,A_LoopFileFullPath,xmlf,,,xmln
						stringreplace,akj,xmln,%A_Space%,,All
						stringreplace,akj,akj,',,All
						stringreplace,akj,akj,.,,All
						stringreplace,akj,akj,`,,,All
						stringreplace,akj,akj,-,,All
						ccnv1=
						ccnv2=
						stringsplit,ccnv,akj,([
						if (xmln = jaktit)
							{
								gosub, DBSCRAPE
								if (CNCLKUP = 1)
									{
										SB_SetText("Process Interrupted")
										gosub, cleanprgb
										break
									}
								continue
							}
						if (ccnt1 = ccnv1)
							{
								gosub, DBSCRAPE
								if (CNCLKUP = 1)
									{
										SB_SetText("Process Interrupted")
										gosub, cleanprgb
										break
									}
								continue
							}
					}
			if (CNCLKUP = 1)
					{
						SB_SetText("Process Interrupted")
						gosub, cleanprgb
						break
					}
			}
			SB_SetText("Scraping Complete")
			gosub, cleanprgb
	}
guicontrol,hide,FEBUTI
gosub, ARTPAUSE
guicontrol,show,FEBUTA
return

SCRAPEJAK:
SCRSCRAPE:
alvnum=
strk=
sysfnd=
brkal=
mamemode=
realname= %jaktit%
imgtyp= console
if (mameget = 1)
	{
		mamemode:= A_Space . "-mame" . "mame=true"
		imgtyp= mame
		if (FERAD2B = 1)
			{
				Loop, Parse, mamedbx,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						realn1=
						realn2=
						realj1=
						realj2=
						stringsplit,realn,A_LoopField,|
						if (realn1 = jaktit)
							{
								realname= %realn2%
								break
							}
					}
			}
	}
if (supsysr = "")
	{
	;	return
	}
IMGDEST= %ASSETS%\%SYSROMD%
if (FERAD2B = 1)
	{
		IMGDEST= %ASSETS%\%REALSYS%\%realname%
	}
if (get3mix = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\3Mix
	}
if (get4mix = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\4Mix
	}
if (getboxart = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Boxart
	}
if (get3dboxart = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\3DBoxart
	}
if (getbackdrop = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Backdrops
	}
if (getsnapshot = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Snapshots
	}
if (getlogo = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Logos
	}
if (getvideo = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Videos
	}
if (getmetadata = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\MetaData
	}
if (getlabel = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Labels
	}
if (getcart = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Carts
	}
if (getmarquee = 1)
	{
		FileCreateDir, %ASSETS%\%REALSYS%\%realname%\Marquees
	}
if (Pegasus_scrape = 1)
	{
		filecreatedir,%pghome%\metafiles\%REALSYS%\media\%jaktit%
	}
if (retroFE_scrape = 1)
	{
		filecreatedir,%rfhome%\collections\%REALSYS%\medium_artwork
	}
if (Jackets_scrape = 1)
	{
		Filecreatedir,%RJSYSTEMS%\%REALSYS%\%jaktit%\.snaps
	}
if (FERAD2C = 1)
	{
		scrsufx=
		if (FECHKN = 1)
			{
				Loop, Parse, metaimages,|
					{
						arpi= %A_LoopField%
						getatst= % get%arpi%
						if (getatst = "")
							{
								continue
							}
						iniread,scrord,mediafe.ini,ORDER,%arpi%
						Loop, Parse, scrord, |
							{
								if (A_LoopField = "IAGL")
									{
										continue
									}
								if (A_LoopField = "ScreenScraper")
									{
										tmpscro= ss
									}
								if (A_LoopField = "theGamesDB")
									{
										tmpscro= gdb
									}
								if (A_LoopField = "OpenVGDB")
									{
										tmpscro= ovgdb
									}
								if (mameget = 1)
									{
										if (A_LoopField = "arcadeitalia")
											{
												tmpscro= adb
											}
										if (A_LoopField = "mamedb")
											{
												tmpscro= mamedb
											}
									}
								%arpi%scrapeorder= %tmpscro%
								scrsufx= -%A_LoopField%
								gosub, RRD%arpi%
								if (CNCLKUP = 1)
									{
										SB_SetText("Process Interrupted")
										gosub, cleanprgb
										break
									}
							}
						if (CNCLKUP = 1)
							{
								SB_SetText("Process Interrupted")
								gosub, cleanprgb
								break
							}
					}	
				return
			}
RRDboxart:
		if (getboxart = 1)
			{
					SB_SetText("Downloading " SYSROMD " Boxart ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Boxartimgtall% -max_width=%Boxartimgsize% -%imgtyp%_src=%BoxArtscrapeorder% -append=true -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=b -img_format=%Boxartimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\Boxart" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -skip_check=true -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Boxart\%jaktit%.%Boxartimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%arox%.%scrsufx%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Boxart\%jaktit%.%Boxartimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_image.%Boxartimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Boxart\%jaktit%.%Boxartimagefrmt%,%thumbnailsDirectory%\%REALSYS%\%jaktit%.%Boxartimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Boxart\%jaktit%.%Boxartimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_image.%Boxartimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Boxart\%jaktit%.%scrsufx%,%pghome%\metafiles\%REALSYS%\media\%jaktit%\BoxFront.%Boxartimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRDsnapshot:
		if (getsnapshot = 1)
			{
					SB_SetText("Downloading " SYSROMD " Snapshots ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Snapshotsimgtall% -max_width=%Snapshotsimgsize% -%imgtyp%_src=%Snapshotscrapeorder%  -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=s -img_format=%Snapshotimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\Snapshots" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Snapshots\%jaktit%.%Snapshotimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\.snaps\%srox%.%Snapshotimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Snapshots\%jaktit%.%Snapshotimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_screen.%Snapshotimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Snapshots\%jaktit%.%Snapshotimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_screen.%Snapshotimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Snapshots\%jaktit%.%Snapshotimagefrmt%,%pghome%\metafiles\%REALSYS%\media\%jaktit%\screenshot.%Snapshotimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRDbackdrop:
		if (getbackdrop = 1)
			{
					artx= f
					if (mameget = 1)
						{
							artx=fly
						}
					SB_SetText("Downloading " SYSROMD " Backdrops ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%imgtall% -max_width=%Backdropimgsize% -%imgtyp%_src=%Backdropscrapeorder%  -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=%artx% -img_format=%Backdropimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\Backdrops" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Backdrops\%jaktit%.%Backdropimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%brox%.%Backdropimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Backdrops\%jaktit%.%Backdropimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_fanart.%Backdropimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Backdrops\%jaktit%.%Backdropimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_fanart.%Backdropimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Backdrops\%jaktit%.%Backdropimagefrmt%,%pghome%\metafiles\%REALSYS%\media\%jaktit%\background.%Backdropimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRDlogo:
		if (getlogo = 1)
			{
					artx= l
					if (mameget = 1)
						{
							artx=t
						}
					SB_SetText("Downloading " SYSROMD " Logos ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Logoimgtall% -max_width=%Logoimgsize% -%imgtyp%_src=%Logoscrapeorder%  -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=%artx% -img_format=%Logoimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\Logos" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Logos\%jaktit%.%Logoimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%orox%.%Logoimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Logos\%jaktit%.%Logoimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_logo.%Logoimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Logos\%jaktit%.%Logoimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_logo.%Logoimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Logos\%jaktit%.%Logoimagefrmt%,%pghome%\metafiles\%REALSYS%\media\%jaktit%\logo.%Logoimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRD3dboxart:
		if (get3dboxart = 1)
			{
					SB_SetText("Downloading " SYSROMD " 3D-Boxart ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%3dboximgtall% -max_width=%3dboximgsize% -%imgtyp%_src=%3DBoxscrapeorder%  -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=3b -img_format=%3dboxartimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\3D-Boxart" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\3DBoxart\%jaktit%.%3dboxartimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%zrox%.%3dboxartimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\3DBoxart\%jaktit%.%3dboxartimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_3dbox.%3dboxartimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\3DBoxart\%jaktit%.%3dboxartimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_3dbox.%3dboxartimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\3DBoxart\%jaktit%.%3dboxartimagefrmt%,%pghome%\metafiles\%REALSYS%\media\%jaktit%\box.%3dboxartimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRDcart:
		if (getcart = 1)
			{
					artx= cart
					if (mameget = 1)
						{
							artx=c
						}
					SB_SetText("Downloading " SYSROMD " Carts ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Cartimgtall% -max_width=%Cartimgsize% -%imgtyp%_src=%Cartscrapeorder%  -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=%artx% -img_format=%Cartimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\Carts" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_SPace%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Carts\%jaktit%.%Cartimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%crox%.%Cartimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Carts\%jaktit%.%Cartimagefrmt%.%Cartimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_cart.%Cartimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Carts\%jaktit%.%Cartimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_cart.%Cartimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Carts\%jaktit%.%Cartimagefrmt%,%pghome%\metafiles\%REALSYS%\media\%jaktit%\cart.%Cartimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRDlabel:
		if (getlabel = 1)
				{
					if (mameget = "")
						{
							SB_SetText("Downloading " SYSROMD " Labels ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Labelimgtall% -max_width=%Labelimgsize% -%imgtyp%_src=%Labelscrapeorder%  -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=clabel -img_format=%Labelimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\Labels" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml" 
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
							if (SCRPCPY = 1)
								{
									if (Jackets_scrape = 1)
										{
											FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Labels\%jaktit%.%Labelimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%lrox%.%Labelimagefrmt%
										}
									if (EmulationStation_scrape = 1)
										{
											FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Labels\%jaktit%.%Labelimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_label.%Labelimagefrmt%
										}
									if (retroArch_scrape = 1)
										{
											;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
										}
									if (retroFE_scrape = 1)
										{
											FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Labels\%jaktit%.%Labelimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_label.%Labelimagefrmt%
										}
									if (Pegasus_scrape = 1)
										{
											FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Labels\%jaktit%.%Labelimagefrmt%,%pghome%\metafiles\%REALSYS%\media\%jaktit%\boxspine.%Labelimagefrmt%
										}
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRDbanner:
		if (getbanner = 1)
				{
					if (mameget = "")
						{
							SB_SetText("Downloading " SYSROMD " Marquees ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt% -%imgtyp%_src=%Marqueescrapeorder% -max_height=%Marqueeimgtall% -max_width=%Marqueeimgsize% -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=a -img_format=%Marqueeimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\Marquees" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Marquees\%jaktit%.%Marqueeimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%mrox%.%Marqueeimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Marquees\%jaktit%.%Marqueeimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_banner.%Marqueeimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Marquees\%jaktit%.%Marqueeimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_banner.%Marqueeimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Marquees\%jaktit%.%Marqueeimagefrmt%,%pghome%\metafiles\%REALSYS%\media\%jaktit%\banner.%Marqueeimagefrmt%
								}
						}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRD3mix:
		if (get3mix = 1)
				{
					if (mameget = "")
						{
							SB_SetText("Downloading " SYSROMD " 3Mix ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%3Miximgtall% -max_width=%3Miximgsize% -%imgtyp%_src=%3Mixscrapeorder%  -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=mix3 -img_format=%3miximagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\3Mix" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%a_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
							if (SCRPCPY = 1)
								{
									if (Jackets_scrape = 1)
										{
											FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\3Mix\%jaktit%.%3miximagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%3rox%.%3miximagefrmt%
										}
									if (EmulationStation_scrape = 1)
										{
											FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%3miximagefrmt%.%marqueeimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%-3mix.%3miximagefrmt%
										}
									if (retroArch_scrape = 1)
										{
											;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
										}
									if (retroFE_scrape = 1)
										{
											FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%3miximagefrmt%.%marqueeimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_3mix.%3miximagefrmt%
										}
									if (Pegasus_scrape = 1)
										{
											FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%3miximagefrmt%.%marqueeimagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_3mix.%3miximagefrmt%
										}
								}
					}
					if (FECHKN = 1)
						{
							return
						}
				}
RRD4mix:
		if (get4mix = 1)
				{
					if (mameget = "")
						{
							SB_SetText("Downloading " SYSROMD " 4Mix ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt% -%imgtyp%_src=%4Mixscrapeorder% -max_height=%4Miximgtall% -max_width=%4Miximgsize% -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=mix4 -img_format=%4miximagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\4Mix" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
							if (SCRPCPY = 1)
								{
									if (Jackets_scrape = 1)
										{
											FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\4mix\%jaktit%.%4miximagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%4rox%.%4miximagefrmt%
										}
									if (EmulationStation_scrape = 1)
										{
											FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\4mix\%jaktit%.%4miximagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%-4mix.%4miximagefrmt%
										}
									if (retroArch_scrape = 1)
										{
											;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
										}
									if (retroFE_scrape = 1)
										{
											FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\4mix\%jaktit%.%4miximagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_4mix.%4miximagefrmt%
										}
									if (Pegasus_scrape = 1)
										{
											FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\4mix\%jaktit%.%4miximagefrmt%,%pghome%\metafiles\%REALSYS%\media\%jaktit%\flyer.%4miximagefrmt%
										}
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRDmarquee:
		if (getmarquee = 1)
				{
					if (mameget = "")
						{
							SB_SetText("Downloading " SYSROMD " Marquees ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt% -%imgtyp%_src=%Marqueescrapeorder% -max_height=%Marqueeimgtall% -max_width=%Marqueeimgsize% -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=false -marquee_suffix="" -marquee_format=%Marqueeimagefrmt%
					enfec= -use_filename=true -marquee_dir="%ASSETS%\%SYSROMD%\%jaktit%\Marquees" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
						}
					if (mameget = 1)
						{
							SB_SetText("Downloading " SYSROMD " Marquees ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Marqueeimgtall% -max_width=%Marqueeimgsize% -%imgtyp%_src=%Marqueescrapeorder% -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=true -console_img=m -img_format=%Marqueeimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%SYSROMD%\%jaktit%\Marquees" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
						}
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Marquees\%jaktit%.%Marqueeimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%mrox%.%Marqueeimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Marquees\%jaktit%.%Marqueeimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%-marquee.%Marqueeimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Marquees\%jaktit%.%Marqueeimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_marquee.%Marqueeimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Marquees\%jaktit%.%Marqueeimagefrmt%,%pghome%\metafiles\%REALSYS%\media\%jaktit%\marquee.%Marqueeimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRDvideo:
RRDvid:
		if (getvideo = 1)
				{
					SB_SetText("Downloading " SYSROMD " Video ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt% -%imgtyp%_src=%Videoscrapeorder%  -append=false -rom_dir="%sysfrd%" -retries=5 -download_images=false -video_suffix=""
					enfec= -use_filename=true -video_dir="%ASSETS%\%SYSROMD%\%jaktit%\Video" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Videos\%jaktit%.mp4,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%vrox%.mp4
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Videos\%jaktit%.mp4,%eshome%\downloaded_videos\%REALSYS%\%jaktit%-video.mp4
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Videos\%jaktit%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.mp4
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\Videos\%jaktit%.mp4,%rfhome%\collections\%REALSYS%\medium_artwork\video\%jaktit%.mp4
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%RJSSYTEMS%\%REALSYS%\media\%jaktit%\video.mp4
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
RRDmetadata:
		if (getmetadata = 1)
				{
					SB_SetText("Downloading " SYSROMD " MetaData ")
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt% -%imgtyp%_src=%Metadatascrapeorder%  -append=true -retries=5 -download_images=false
					enfec= -use_filename=true -output_file="%ASSETS%\%SYSROMD%\%jaktit%\MetaData\%SYSROMD%%scrsufx%.xml" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%SYSROMD%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%sysfrd%,hide
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\MetaData\%jaktit%.xml,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%drox%.xml
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\MetaData\%jaktit%.xml,%eshome%\gamelists\%REALSYS%\%jaktit%.xml
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\MetaData\%jaktit%.xml,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%.xml
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%SYSROMD%\%jaktit%\MetaData\%jaktit%.xml,%pghome%\metafiles\%REALSYS%\media\%jaktit%\%jaktit%.xml
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
		SB_SetText("")
		return
	}
if (FERAD2B = 1)
	{
		scrsufx=
		if (FECHKN = 1)
			{
				Loop, Parse, metaimages,|
					{
						arpi= %A_LoopField%
						getatst= % get%arpi%
						if (getatst = "")
							{
								continue
							}
						iniread,scrord,mediafe.ini,ORDER,%arpi%
						Loop, Parse, scrord, |
							{
								if (A_LoopField = "IAGL")
									{
										continue
									}
								if (A_LoopField = "ScreenScraper")
									{
										tmpscro= ss
									}
								if (A_LoopField = "theGamesDB")
									{
										tmpscro= gdb
									}
								if (A_LoopField = "OpenVGDB")
									{
										tmpscro= ovgdb
									}
								if (mameget = 1)
									{
										if (A_LoopField = "arcadeitalia")
											{
												tmpscro= adb
											}
										if (A_LoopField = "mamedb")
											{
												tmpscro= mamedb
											}
									}
								%arpi%scrapeorder= %tmpscro%
								scrsufx= -%A_LoopField%
								gosub, JRD%arpi%
							}
					}
				guicontrol,enable,FELVA
				guicontrol,enable,FEBUTA
				guicontrol,hide,FEBUTI
				guicontrol,hide,FEBUTN
				if (fromcfg = 1)
					{
						GuiControl,Choose,TABMENU,7
						guicontrol,,feDDLA,|Systems|
						gui,ListView,FELVA
						LV_Delete()
						fromcfg=
					}
				return
			}
JRDboxart:
		if (getboxart = 1)
				{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Boxartimgtall% -max_width=%Boxartimgsize% -%imgtyp%_src=%BoxArtscrapeorder%  -append=false -retries=5 -download_images=true -console_img=b -img_format=%Boxartimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\Boxart" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
					SBNOT= Failed
					ifexist, %ASSETS%\%REALSYS%\%realname%\Boxart\%realname%%scrsufx%.%Boxartimagefrmt%
						{
							SBNOT= Completed
							FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\Boxart\%realname%%scrsufx%.%Boxartimagefrmt%,K
							if (imgsz < 1)
								{
									SBNOT= Failed
								}
						}
					SB_SetText("Downloaded " realname " Boxart " SBNOT " ")					
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Boxart\%realname%%scrsufx%.%Boxartimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%arox%.%Boxartimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Snapshots\%realname%%scrsufx%.%Boxartimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_image.%Boxartimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Snapshots\%realname%%scrsufx%.%Boxartimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_image.%Snapshotimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Snapshots\%realname%%scrsufx%.%Boxartimagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_image.%Snapshotimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
JRDsnapshot:
		if (getsnapshot = 1)
				{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Snapshotimgtall% -max_width=%Snapshotimgsize% -%imgtyp%_src=%Snapshotscrapeorder%  -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=true -console_img=s -img_format=%Snapshotimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\Snapshots" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enefc%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
					SBNOT= Failed
					ifexist, %ASSETS%\%REALSYS%\%realname%\Snapshots\%realname%%scrsufx%.%Snapshotimagefrmt%
						{
							SBNOT= Completed
							FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\Snapshots\%realname%%scrsufx%.%Snapshotimagefrmt%,K
							if (imgsz < 1)
								{
									SBNOT= Failed
								}
						}
					SB_SetText("Downloaded " realname " Snapshots " SBNOT " ")
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Snapshots\%realname%%scrsufx%.%Snapshotimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%arox%.%Snapshotimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Snapshots\%realname%%scrsufx%.%Snapshotimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_screen.%Snapshotimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Snapshots\%realname%%scrsufx%.%Snapshotimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_screen.%Snapshotimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Snapshots\%realname%%scrsufx%.%Snapshotimagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_screen.%Snapshotimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
JRDbackdrop:
		if (getbackdrop = 1)
				{
					artx= f
					if (mameget = 1)
						{
							artx=fly
						}
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Backdropimgtall% -max_width=%Backdropimgsize% -%imgtyp%_src=%Backdropscrapeorder%  -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=true -console_img=%artx% -img_format=%imagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\Backdrops" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
					SBNOT= Failed
					ifexist, %ASSETS%\%REALSYS%\%realname%\Backdrops\%realname%%scrsufx%.%backdropimagefrmt%
						{
							SBNOT= Completed
							FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\Backdrops\%realname%%scrsufx%.%backdropimagefrmt%,K
							if (imgsz < 1)
								{
									SBNOT= Failed
								}
						}
					SB_SetText("Downloaded " realname " Backdrops " SBNOT " ")
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Backdrops\%realname%%scrsufx%.%backdropimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%brox%.%backdropimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Backdrops\%realname%%scrsufx%.%backdropimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_fanart.%backdropimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Backdrops\%realname%%scrsufx%.%backdropimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_fanart.%backdropimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Backdrops\%realname%%scrsufx%.%backdropimagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_fanart.%backdropimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
JRDlogo:
		if (getlogo = 1)
				{
					artx= l
					if (mameget = 1)
						{
							artx=t
						}
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Logoimgtall% -max_width=%Logoimgsize% -%imgtyp%_src=%Logoscrapeorder%  -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=true -console_img=%artx% -img_format=%imagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\Logos" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
					SBNOT= Failed
					ifexist, %ASSETS%\%REALSYS%\%realname%\Logos\%realname%%scrsufx%.%logoimagefrmt%
						{
							SBNOT= Completed
							FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\Logos\%realname%%scrsufx%.%logoimagefrmt%,K
							if (imgsz < 1)
								{
									SBNOT= Failed
								}
						}
					SB_SetText("Downloaded " realname " Logos " SBNOT " ")
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Logos\%realname%%scrsufx%.%logoimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%orox%.%logoimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Logos\%realname%%scrsufx%.%logoimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_logo.%logoimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Logos\%realname%%scrsufx%.%logoimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_logo.%logoimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Logos\%realname%%scrsufx%.%logoimagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_logo.%logoimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
JRD3dboxart:
		if (get3dboxart = 1)
				{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%3dboximgtall% -max_width=%3dboximgsize% -%imgtyp%_src=%3DBoxartscrapeorder%  -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=true -console_img=3b -img_format=%3dboximagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\3D-Boxart" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
					SBNOT= Failed
					ifexist, %ASSETS%\%REALSYS%\%realname%\3D-Boxart\%realname%%scrsufx%.%3dboximagefrmt%
						{
							SBNOT= Completed
							FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\3D-Boxart\%realname%%scrsufx%.%3dboximagefrmt%,K
							if (imgsz < 1)
								{
									SBNOT= Failed
								}
						}
					SB_SetText("Downloaded " realname " 3D-Boxart " SBNOT " ")
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\3D-Boxart\%realname%%scrsufx%.%3dboximagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%zrox%.%3dboximagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\3D-Boxart\%realname%%scrsufx%.%3dboximagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_3dbox.%3dboximagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\3D-Boxart\%realname%%scrsufx%.%3dboximagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_3dbox.%3dboximagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\3D-Boxart\%realname%%scrsufx%.%3dboximagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_3dbox.%3dboximagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
JRDcart:
		if (getcart = 1)
				{
					artx= cart
					if (mameget = 1)
						{
							artx=c
						}
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%cartimgtall% -max_width=%cartimgsize% -%imgtyp%_src=%Cartscrapeorder%  -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=true -console_img=%artx% -img_format=%Cartimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\Carts" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
					SBNOT= Failed
					ifexist, %ASSETS%\%REALSYS%\%realname%\Carts\%realname%%scrsufx%.%Cartimagefrmt%
						{
							SBNOT= Completed
							FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\Carts\%realname%%scrsufx%.%Cartimagefrmt%,K
							if (imgsz < 1)
								{
									SBNOT= Failed
								}
						}
					SB_SetText("Downloaded " realname " Carts " SBNOT " ")
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Carts\%realname%%scrsufx%.%Cartimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%crox%.%Cartimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Carts\%realname%%scrsufx%.%Cartimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_cart.%Cartimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Carts\%realname%%scrsufx%.%Cartimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_cart.%Cartimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Carts\%realname%%scrsufx%.%Cartimagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_cart.%Cartimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
JRDlabel:
		if (getlabel = 1)
				{
					if (mameget = "")
						{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%labelimgtall% -max_width=%labelimgsize% -%imgtyp%_src=%Labelscrapeorder%  -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=true -console_img=clabel -img_format=%Labelimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\Labels" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
							SBNOT= Failed
							ifexist, %ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%Labelimagefrmt%
								{
									SBNOT= Completed
									FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%Labelimagefrmt%,K
									if (imgsz < 1)
										{
											SBNOT= Failed
										}
								}
							SB_SetText("Downloaded " realname " Labels " SBNOT " ")
						}
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%Labelimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%lrox%.%Labelimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%Labelimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_label.%Labelimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%Labelimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_label.%Labelimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%Labelimagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_label.%Labelimagefrmt%
								}
						}	
					if (FECHKN = 1)
						{
							return
						}
				}
JRDbanner:
		if (getbanner = 1)
				{
					if (mameget = "")
						{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt% -%imgtyp%_src=%Marqueescrapeorder% -max_height=%marqueeimgtall% -max_width=%marqueemgsize%-append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=true -console_img=a -img_format=%Marqueeimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\Marquees" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
							SBNOT= Failed
							ifexist, %ASSETS%\%REALSYS%\%realname%\Marquees\%realname%%scrsufx%.%Marqueeimagefrmt%
								{
									SBNOT= Completed
									FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\Marquees\%realname%%scrsufx%.%Marqueeimagefrmt%,K
									if (imgsz < 1)
										{
											SBNOT= Failed
										}
								}
							SB_SetText("Downloaded " realname " Marquees " SBNOT " ")
						}
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%marqueeimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%mrox%.%marqueeimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%marqueeimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%_banner.%marqueeimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%marqueeimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_banner.%marqueeimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%marqueeimagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_banner.%marqueeimagefrmt%
								}
						}		
					if (FECHKN = 1)
						{
							return
						}
				}
JRD3mix:
		if (get3mix = 1)
				{
					if (mameget = "")
						{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%3miximgtall% -max_width=%3miximgsize% -%imgtyp%_src=%3Mixscrapeorder%  -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=true -console_img=mix3 -img_format=%3miximagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\3Mix" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
							SBNOT= Failed
							ifexist, %ASSETS%\%REALSYS%\%realname%\3Mix\%realname%%scrsufx%.%3miximagefrmt%
								{
									SBNOT= Completed
									FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\3Mix\%realname%%scrsufx%.%3miximagefrmt%,K
									if (imgsz < 1)
										{
											SBNOT= Failed
										}
								}
							SB_SetText("Downloaded " realname " 3Mix " SBNOT " ")
						}
					if (FECHKN = 1)
						{
							return
						}
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\3Mix\%realname%%scrsufx%.%3miximagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%3rox%.%3miximagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%marqueeimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%-3mix.%3miximagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%marqueeimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_3mix.%3miximagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Labels\%realname%%scrsufx%.%marqueeimagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_3mix.%3miximagefrmt%
								}
						}			
				}
JRD4mix:
		if (get4mix = 1)
				{
					if (mameget = "")
						{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt% -%imgtyp%_src=%4Mixscrapeorder% -max_height=%4miximgtall% -max_width=%4miximgsize% -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=true -console_img=mix4 -img_format=%4miximagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\4Mix" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
							SBNOT= Failed
							ifexist, %ASSETS%\%REALSYS%\%realname%\4Mix\%realname%%scrsufx%.%4miximagefrmt%
								{
									SBNOT= Completed
									FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\4Mix\%realname%%scrsufx%.%4miximagefrmt%,K
									if (imgsz < 1)
										{
											SBNOT= Failed
										}
								}
							SB_SetText("Downloaded " realname " 4Mix " SBNOT " ")
						}
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\4Mix\%realname%%scrsufx%.%4miximagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%4rox%.%4miximagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\4Mix\%realname%%scrsufx%.%4miximagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%-4mix.%4miximagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\4Mix\%realname%%scrsufx%.%4miximagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_4mix.%4miximagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\4Mix\%realname%%scrsufx%.%4miximagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_4mix.%4miximagefrmt%
								}
						}				
					if (FECHKN = 1)
						{
							return
						}
				}
JRDmarquee:
		if (getmarquee = 1)
				{
					if (mameget = "")
						{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt% -%imgtyp%_src=%Marqueescrapeorder% -max_height=%Marqueeimgtall% -max_width=%Marqueeimgsize% -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=false -marquee_suffix="%scrsufx%" -marquee_format=%Marqueeimagefrmt%
					enfec= -use_filename=true -marquee_dir="%ASSETS%\%REALSYS%\%realname%\Marquees" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
							SBNOT= Failed
							ifexist, %ASSETS%\%REALSYS%\%realname%\Marquees\%realname%%scrsufx%.%Marqueeimagefrmt%
								{
									SBNOT= Completed
									FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\Marquees\%realname%%scrsufx%.%Marqueeimagefrmt%,K
									if (imgsz < 1)
										{
											SBNOT= Failed
										}
								}
							SB_SetText("Downloaded " realname " Marquees " SBNOT " ")
						}
					if (mameget = 1)
						{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt%%mamemode% -max_height=%Marqueeimgtall% -max_width=%Marqueeimgsize% -%imgtyp%_src=%Marqueescrapeorder%  -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=true -console_img=m -img_format=%Marqueeimagefrmt%
					enfec= -use_filename=true -image_dir="%ASSETS%\%REALSYS%\%realname%\Marquees" -image_suffix="" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
							SBNOT= Failed
							ifexist, %ASSETS%\%REALSYS%\%realname%\Marquees\%realname%%scrsufx%.%Marqueeimagefrmt%
								{
									SBNOT= Completed
									FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\Marquees\%realname%%scrsufx%.%Marqueeimagefrmt%,K
									if (imgsz < 1)
										{
											SBNOT= Failed
										}
								}
							SB_SetText("Downloaded " realname " Marquees " SBNOT " ")
						}
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Marquees\%realname%%scrsufx%.%Marqueeimagefrmt%,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%mrox%.%Marqueeimagefrmt%
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Marquees\%realname%%scrsufx%.%Marqueeimagefrmt%,%eshome%\downloaded_images\%REALSYS%\%jaktit%-marquee.%Marqueeimagefrmt%
								}
							if (retroArch_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.%Marqueeimagefrmt%
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Marquees\%realname%%scrsufx%.%Marqueeimagefrmt%,%rfhome%\collections\%REALSYS%\medium_artwork\%jaktit%_marquee.%Marqueeimagefrmt%
								}
							if (Pegasus_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Marquees\%realname%%scrsufx%.%Marqueeimagefrmt%,%RJSSYTEMS%\%REALSYS%\media\%jaktit%_marquee.%Marqueeimagefrmt%
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
JRDvideo:
		if (getvideo = 1)
				{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt% -%imgtyp%_src=%Videoscrapeorder% -append=false -rom_dir="%RJSYSTEMS%%REALSYS%%realname%" -retries=5 -download_images=false -video_suffix="%scrsufx%"
					enfec= -use_filename=true -video_dir="%ASSETS%\%REALSYS%\%realname%\Video" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
					SBNOT= Failed
					ifexist, %ASSETS%\%REALSYS%\%realname%\Videos\%realname%%scrsufx%.mp4
						{
							SBNOT= Completed
							FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\Videos\%realname%%scrsufx%.mp4,K
							if (imgsz < 1)
								{
									SBNOT= Failed
								}
						}
					SB_SetText("Downloaded " realname " Video " SBNOT " ")
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\Videos\%realname%%scrsufx%.mp4,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%vrox%.mp4
								}
							if (EmulationStation_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%eshome%\downloaded_videos\%REALSYS%\%jaktit%-video.mp4
								}
							if (retroArch_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.mp4
								}
							if (retroFE_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%rfhome%\collections\%REALSYS%\medium_artwork\video\%jaktit%.mp4
								}
							if (Pegasus_scrape = 1)
								{
									;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%RJSSYTEMS%\%REALSYS%\media\%jaktit%\video.mp4
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
JRDmetadata:
		if (getmetadata = 1)
				{
					filedelete,%cacheloc%\scrape.cmd
					enfeb="%S_KeyDir%\bin\Scraper.exe"%ssopt% -%imgtyp%_src=%Metadatascrapeorder% -append=true -retries=5 -download_images=false
					enfec= -use_filename=true -output_file="%ASSETS%\%REALSYS%\%realname%\MetaData\%realname%%scrsufx%.xml" -nested_img_dir=false -no_thumb -extra_ext="" -use_nointro_name=true -workers=1 -strip_unicode=false -update_cache=true -lang=en -region=us,wor,eu,jp,fr,xx -output_file="%ASSETS%\%REALSYS%\gamelist.xml"
					fileappend,%enfeb%%A_Space%%enfec%,%cacheloc%\scrape.cmd
					RunWait, "%cacheloc%\scrape.cmd" >>"%cacheloc%\scrape.log",%RJSYSTEMS%\%REALSYS%\%realname%,hide
					SBNOT= Failed
					ifexist, %ASSETS%\%REALSYS%\%realname%\MetaData\%realname%%scrsufx%.xml
						{
							SBNOT= Completed
						}
					SB_SetText("Downloaded " realname " MetaData " SBNOT " ")
					if (SCRPCPY = 1)
						{
							if (Jackets_scrape = 1)
								{
									FileCopy,%ASSETS%\%REALSYS%\%realname%\MetaData\%realname%%scrsufx%.xml,%RJSYSTEMS%\%FEDDLA%\%jaktit%\%drox%.xml
								}
						}
					if (FECHKN = 1)
						{
							return
						}
				}
		SB_SetText("")
		return
	}
return

DBSCRAPE:
IfNotInString,mediaorder,IAGL
	{
		return
	}
Loop, Read, rj\scrapeArt\%SYSLKUP%\%xmlf%
	{
		if (A_LoopReadLine = "")
			{
				continue
			}
		xlmb1=
		xlmb2=
		xlmb3=
		stringsplit,xlmb,A_LoopreadLine,<>
		ifinstring,xlmb2,thegamesdb_id
			{
				continue
			}
		ifinstring,xlmb2,_url
			{
				continue
			}
		ifinstring,xlmb2,3dbox
			{
				jaksbd= 3dboxart
				if (get3dboxart = "")
					{
						continue
					}
			}
		ifinstring,xlmb2,boxart
			{
				jaksbd= boxart
				if (getboxart = "")
					{
						continue
					}
			}
		ifinstring,xlmb2,media
			{
				jaksbd= cart
				if (getcart = "")
					{
						continue
					}
			}
		ifinstring,xlmb2,clearlogo
			{
				jaksbd= logos
				if (getlogo = "")
					{
						continue
					}
			}
		ifinstring,xlmb2,banner
			{
				jaksbd= marquees
				if (getbanner = "")
					{
						continue
					}
			}
		ifinstring,xlmb2,boxback
			{
				jaksbd= boxart
				if (getboxart = "")
					{
						continue
					}
			}
		ifinstring,xlmb2,fanart
			{
				jaksbd= backdrops
				if (getbackdrop = "")
					{
						continue
					}
			}
		ifinstring,xlmb2,snapshot
			{
				jaksbd= snapshots
				if (getsnapshot = "")
					{
						continue
					}
			}
		ifinstring,xlmb2,videourl
			{
				jaksbd= videos
				if (getvideo = "")
					{
						continue
					}
		if (CNCLKUP = 1)
			{
				break
			}
				ifnotinstring,xlmb3,:
					{
						ifnotexist,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%xlmb3%.mp4
							{
								SB_SetText("Downloading " realname " Video")
								RunWait, %comspec% /c " "%S_KeyDir%\bin\youtube-dl.exe" -R 3 -i -c --id "%xlmb3%" --no-check-certificate --prefer-insecure --no-part --sleep-interval 3 --max-sleep-interval 10",%ASSETS%\%REALSYS%\%realname%\%jaksbd%,hide,%vidwnl%
								FileGetSize,imgsz,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%xlmb3%.mp4,K
								if (imgsz < 1)
									{
										DWNFLD= 1
										FileDelete,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%xlmb3%.mp4
										SB_SetText(" " realname " " jaksbd " was not downloaded")
										continue
									}
								ifNotExist, %ASSETS%\%REALSYS%\%realname%\%jaksbd%\%xlmb3%.mp4
									{
										DWNFLD= 1
										SB_SetText(" " realname " " jaksbd " was not downloaded")
										continue
									}
								ifNotExist, %ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4
									{
										FileMove, %ASSETS%\%REALSYS%\%realname%\%jaksbd%\%xlmb3%.mp4, %ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,1
									}																	
								if (SCRPCPY = 1)
									{
										if (Jackets_scrape = 1)
											{
												FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%RJSYSTEMS%\%REALSYS%\%jaktit%\%realname%.mp4
											}
										if (EmulationStation_scrape = 1)
											{
												FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%eshome%\downloaded_videos\%REALSYS%\%jaktit%-video.mp4
											}
										if (retroArch_scrape = 1)
											{
												FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%thumbnailsDirectory%\%REALSYS%\video\%jaktit%-video.mp4
											}
										if (retroFE_scrape = 1)
											{
												FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%rfhome%\collections\%REALSYS%\medium_artwork\video\%jaktit%.mp4
											}
										if (Pegasus_scrape = 1)
											{
												;;FileCopy,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%realname%.mp4,%RJSSYTEMS%\%REALSYS%\media\%jaktit%\video.mp4
											}
									}	
							}
						continue
					}
			}
		if (CNCLKUP = 1)
			{
				break
			}
		URLFILE= %xlmb3%
		splitpath,URLFILE,urlf
		save= %ASSETS%\%REALSYS%\%realname%\%jaksbd%\%urlf%
		splitpath,save,,sfd,svx
		SB_SetText("Downloading " realname " " jaksbd "")
		ifnotexist,%ASSETS%\%REALSYS%\%realname%\%jaksbd%\%urlf%
			{
				splitpath,save,svaf,svap
				fileappend, %URLFILE%`n%A_Space%%A_Space%always-resume=false`n%A_Space%%A_Space%http-no-cache=true`n%A_Space%%A_Space%allow-overwrite=true`n%A_Space%%A_Space%stop-with-process=%CURPID%`n,uri.txt
				fileappend, %A_Space%%A_Space%truncate-console-readout=false`n%A_Space%%A_Space%check-certificate=false`n%A_Space%%A_Space%dir=%svap%`n%A_Space%%A_Space%out=%svaf%,uri.txt
				exen_get(ARIA,,,,,cacheloc)
				;;DownloadFile(URLFILE, save, DWNOVR, True)
				ifNotExist, %save%
					{
						DWNFLD= 1
						SB_SetText(" " realname " " jaksbd " was not downloaded")
						continue
					}
				FileGetSize,imgsz,%save%,K
				if (imgsz < 1)
					{
						DWNFLD= 1
						FileDelete,%save%
						SB_SetText(" " realname " " jaksbd " was not downloaded")
						continue
					}
				jaksbn=
				Loop, %sfd%\%realname%.*
					{
						jaksbn+=1
					}
				FileMove,%save%,%sfd%\%realname%%jaksbn%.%svx%
				SB_SetText(" " realname " " jaksbd " downloaded")
			}
			if (CNCLKUP = 1)
				{
					break
				}
	}
if (getmetadata = 1)
	{
		filecopy, rj\scrapeArt\%SYSLKUP%\%xmlf%, %ASSETS%\%REALSYS%\%realname%\metadata,1
	}
return

ARTPAUSE:
Loop,parse,MEDIAFEITEMS,|
	{
		guicontrol,%arpause%,%A_LoopField%
	}
return

MediaFEBUTB:
SB_SetText("")
guicontrolget,FEDDLC,,FEDDLC
stringreplace,FEDDLC,FEDDLC,%A_Space%,,All
stringreplace,FEDDLC,FEDDLC,%A_Space%,-,All
if (FEDDLC = "Global")
	{
		FEDDLC= system_order
	}
iniDelete,mediafe.ini,ORDER,%FEDDLC%
newnum=
olnum=
Loop, Parse, mediaorder,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		olnum+=1
		systmv= A_LoopField
		if (A_LoopField = curtxt)
			{
				newnum:= olnum-1
			}
	}
if (newnum = 0)
	{
		sb_settext("Cannot move up")
		return
	}
TMORD=
olnum=
Loop, Parse, mediaorder,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		olnum+=1
		if (A_LoopField = curtxt)
			{
				continue
			}
		if (olnum = newnum)
			{
				TMORD.= curtxt . "|"
			}
		TMORD.= A_LoopField . "|"
	}
mediaorder= %TMORD%
iniwrite,%TMORD%,mediafe.ini,ORDER,%FEDDLC%
guicontrol,,FELBXA,|%mediaorder%
return

MediaFEBUTC:
gui,submit,nohide
SB_SetText("")
guicontrolget,FEDDLC,,FEDDLC
stringreplace,FEDDLC,FEDDLC,%A_Space%,,All
stringreplace,FEDDLC,FEDDLC,%A_Space%,-,All
if (FEDDLC = "Global")
	{
		FEDDLC= system_order
	}
iniDelete,mediafe.ini,ORDER,%FEDDLC%
mvnum=
mvtm=
Loop, Parse, mediaorder,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		mvnum+=1
		if (A_LoopField = curtxt)
			{
				mvtm:= mvnum+1
			}
	}
totord:= mvnum
if (mvtm > totord)
	{
		SB_SetText("Cannot Move further down.")
		return
	}
TMORD=
mvnum=
Loop, Parse, mediaorder,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		mvnum+=1
		if (A_LoopField = curtxt)
			{
				continue
			}
		TMORD.= A_LoopField . "|"
		if (mvtm = mvnum)
			{
				TMORD.= curtxt . "|"
			}
	}
mediaorder= %TMORD%
guicontrol,,FELBXA,|%mediaorder%
iniwrite,%TMORD%,mediafe.ini,ORDER,%FEDDLC%
return

MediaFEBUTD:
guicontrolget,FEDDLC,,FEDDLC
stringreplace,FEDDLC,FEDDLC,%A_Space%,,ALL
stringreplace,FEDDLC,FEDDLC,-,,All
if (FEDDLC = "Global")
	{
		MsgBox,3,Reset All,Would you like to reset ALL image-type priorities?
		ifmsgbox,Yes
			{
				iniwrite,%mediaordert%,mediafe.ini,ORDER,system_order
				Loop, Parse, metaimages,|
					{
						metimg= %A_LoopField%
						iniwrite,%mediaordert%,mediafe.ini,ORDER,%metimg%
						iniwrite,600,mediafe.ini,CONFIG,%metimg%_image_height
						iniwrite,800,mediafe.ini,CONFIG,%metimg%_image_width
						iniwrite,png,mediafe.ini,CONFIG,%metimg%_image_format
					}
			}
		ifmsgbox,Cancel
			{
				return
			}
	}
mediaorder= %mediaordert%
iniwrite,png,mediafe.ini,CONFIG,%FEDDLC%_image_format
iniwrite,800,mediafe.ini,CONFIG,%FEDDLC%_image_width
iniwrite,600,mediafe.ini,CONFIG,%FEDDLC%_image_height
guicontrol,,FEEDTD, 600
guicontrol,,FEEDTC, 800
guicontrol,,FELBXA,|theGamesDB|OpenVGDB|ScreenScraper|arcadeitalia|mamedb|IAGL
iniwrite,%mediaorder%,mediafe.ini,ORDER,%FEDDLC%
return

MediaFEBUTE:
guicontrolget,FEDDLC,,FEDDLC
curmedord= %mediaorder%
GRANDORDER= %FEDDLC%
TMEDO=
if (FEDDLC = "Global")
	{
		Loop, Parse, metaimages,|
			{
				GRANDORDER= %A_LoopField%
				Gosub, MEDFEGLRMV
			}
		mediaorder= %TMEDO%
		iniwrite,%TMEDO%,mediafe.ini,ORDER,system_order
		guicontrol,,FELBXA,|%mediaorder%
		return
	}
MEDFEGLRMV:
TMEDO=
Loop, Parse, curmedord,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = curtxt)
			{
				continue
			}
		TMEDO.= A_LoopField . "|"
	}
if (INARCL = 1)
	{
		return
	}
guicontrol,,FELBXA,|%TMEDO%
iniwrite,%TMEDO%,mediafe.ini,ORDER,%GRANDORDER%
guicontrol,,FELBXA,|%TMEDO%
return

MediaFEBUTF:
guicontrolget,FEDDLA,,FEDDLA
if (FEDDLA = "")
	{
		SB_SetText("Select A System to assign a ROM-path")
		return
	}
ESROMMEDPTHTMP=
FileSelectFolder,ESROMMEDPTHTMP,,3,Select the matching ROM Media path
if (ESROMMEDPTHTMP = "")
	{
		return
	}
stringright,efi,ESROMMEDPTHTMP,2
stringLeft,efix,ESROMMEDPTHTMP,2
if (efi = ":\")
	{
		ESROMMEDPTHTMP= %efix%
	}	
ESROMMEDPTH= %ESROMMEDPTHTMP%
Loop, Parse, cslst,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		ssiv1=
		ssiv2=
		stringsplit,ssiv,A_LoopField,=
		if (ssiv1 = FEDDLA)
			{
				csxlst.= ssiv1 . "=" . ESROMMEDPTH
				continue
			}
		csxlst.= ssiv1 . "=" . ssiv2
	}
Gui,ListView,FELVA
LV_Delete()
Loop, %ESROMMEDPTH%\*.*
	{
		LV_Add("",A_LoopFileName)
	}
guicontrol,,FETXTF,%ESROMMEDPTH%
return

MediaFELNKA:
return

MediaFELNKB:
return

MediaFELBXB:
gui,submit,nohide
guicontrolget,imgdat,,FELBXB
if (FERAD2B = 1)
	{
		guicontrol,,FEPICA,%ASSETS%\%FEDDLA%\%curtxt%\%FEDDLE%\%imgdat%
	}
	else {
		guicontrolget,FECBXB,,FECBXB
		guicontrolget,FEDDLE,,FEDDLE
		guicontrol,,FEPICA,%FECBXB%\%FEDDLE%\%imgdat%
	}
guicontrol,move,FEPICA,x505 y5 w240 h205
return

MediaFELBXA:
gui,submit,nohide
guicontrolget,curtxt,,FELBXA
return

MediaFECHKA:
return

MediaFECHKB:
return

MediaFECHKC:
return

MediaFECHKD:
return

MediaFECHKE:
return

MediaFECHKF:
return

MediaFECHKG:
return

MediaFECHKH:
return

MediaFECHKI:
return

MediaFECHKJ:
return

MediaFECHKK:
return

MediaFECHKL:
return

MediaFECHKM:
return

MediaFECHKP:
return

MediaFECHKN:
if (FECHKN = 1)
	{
		SB_SetText(":: :: :: WARNING :: :: ::Redundancy is an expensive option:: :: :: WARNING :: :: ::multiplier enabled:: :: :: WARNING :: :: ::")
	}
if (FECHKN = 0)
{
	SB_SetText("")
	}
return

MediaFECHKO:
gui,submit,nohide
ACTRJ= %FECHKO%
guicontrolget,FEDDLG,,FEDDLG
iniread,scrapeto,MediaFE.ini,GLOBAL,scrape_destinations
if (FEDDLG <> "Jackets")
	{
		iniread,feexchk,Apps.ini,FRONTENDS,%FEDDLG%
		if ((feexchk = "ERROR")or(feexchk = ""))
			{
				SB_SetText("This frontend is not installed/detected")
				return
			}
	}
ScrapeDisp:	
scrapeton= 
if (FECHKO = 1)
	{
		guicontrol,show,FEDDLF
		guicontrol,show,FECBXA
		guicontrol,show,FETXTN
		Loop,Parse,scrapeto,|
			{
				if (A_LoopField = FEDDLG)
					{
						continue
					}
				scrapeton.= A_LoopField . "|"
			}
		scrapeton.= FEDDLG . "|"
		iniwrite,%scrapeton%,MediaFE.ini,GLOBAL,scrape_destinations
		SB_SetText("Scraped Artwork will be copied to " FEDDLG ".")
		return
	}
iniwrite,%scrapeton%,MediaFE.ini,GLOBAL,scrape_destinations	
guicontrol,hide,FEDDLF
guicontrol,hide,FECBXA
guicontrol,hide,FETXTN
return

MediaFEEDTA:
gui,submit,nohide
guicontrolget,FEEDTA,,FEEDTA
iniwrite,%FEEDTA%,mediafe.ini,CONFIG,ss_user
return

MediaFEEDTB:
gui,submit,nohide
guicontrolget,FEEDTB,,FEEDTB
iniwrite,%FEEDTB%,mediafe.ini,CONFIG,ss_password
return

MediaFEEDTC:
gui,submit,nohide
guicontrolget,FEDDLC,,FEDDLC
guicontrolget,FEEDTC,,FEEDTC
stringreplace,FEDDLC,FEDDLC,%A_Space%,,All
stringreplace,FEDDLC,FEDDLC,-,,All
GRANDORDER= %FEDDLC%
if (FEDDLC = "Global")
{
		Loop, Parse, metaimages,|
			{
				GRANDORDER= %A_LoopField%
				Gosub, SCRIMGWIDTH
			}
		iniwrite,%FEEDTC%,mediafe.ini,CONFIG,Global_image_width
		return
	}
SCRIMGWIDTH:
iniwrite,%FEEDTC%,mediafe.ini,CONFIG,%GRANDORDER%_image_width
return

MediaFEEDTD:
gui,submit,nohide
guicontrolget,FEDDLC,,FEDDLC
guicontrolget,FEEDTD,,FEEDTD
stringreplace,FEDDLC,FEDDLC,%A_Space%,,All
stringreplace,FEDDLC,FEDDLC,-,,All
GRANDORDER= %FEDDLC%
if (FEDDLC = "Global")
{
		Loop, Parse, metaimages,|
			{
				GRANDORDER= %A_LoopField%
				Gosub, SCRIMGHEIGHT
			}
		iniwrite,%FEEDTD%,mediafe.ini,CONFIG,Global_image_height
		return
	}
SCRIMGHEIGHT:
iniwrite,%FEEDTD%,mediafe.ini,CONFIG,%GRANDORDER%_image_height
return

MediaFEDDLA:
mfedlachn= %FEDDLA%
guicontrolget,FEDDLA,,FEDDLA
if (fromcfg = 1)
	{
		return
	}
Gui,ListView,FELVA
if (FERAD2B = 1)
	{	
		if ((FEDDLA = "Systems")or (FEDDLA = ""))
			{
				SB_SetText("Select a System")
				return
			}
		Gui,ListView,FELVA
		LV_Delete()
		Loop, %RJSYSTEMS%\%FEDDLA%\*,2
			{
				if A_LoopFileAttrib contains H
					{
						continue
					}
				LV_Add("",A_LoopFileName)
			}
		LV_ModifyCol()
		return
	}
if (FERAD2A = 1)
	{
		LV_Delete()
		Loop,%RJSYSTEMS%\*,2
			{
				if A_LoopFileAttrib contains H
					{
						continue
					}
				LV_Add("",A_LoopFileName)
			}
		LV_ModifyCol()
	}
if (FERAD2C = 1)
	{
		guicontrolget,FECBXB,,FECBXB
		menr= 
		Loop, %FECBXB%\*,2
			{
				if (A_Index = 1)
					{
						fen= %A_LoopFileName%
					}
				menr.= A_LoopFileName . "|"
			}
		guicontrol,,FEDDLE,|%menr%
		guicontrolget,FEDDLE,,FEDDLE
		if (FEDDLE = "")
			{
				SB_SetText("Select a folder")
				return
			}	
		Loop, %FECBXB%\%FEDDLE%\*.*,0,1
			{
				if A_LoopFileAttrib contains H
					{
						continue
					}
				ext= %A_LoopFileExt%
					if (ext = "")
						{
							continue
						}
					noapl=
					for k, v in ar
						{
							extm:= v
							if (ext = extm)
								{
									noapl= 1
								}
						}
					if (noapl = "")
						{
							stringreplace,lving,A_LoopFileFullPath,%RJSYSTEMS%\%curtxt%\,,All
							nrnr.= A_LoopFileName . "|"
						}
			}
			guicontrol,,FELBXB,|%nrnr%
	}
return	
MediaFEDDLE:
Gui,ListView,FELVA
guicontrolget,FEDDLE,,FEDDLE
curtxt=
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		if (FERAD2B = 1)
			{
				gosub, MEDIMGPOP
			}
		if (FERAD2C = 1)
			{
				guicontrolget,FECBXB,,FECBXB
				dianew=
				anbe= 
				AvINNG= 
				Loop, %FECBXB%\%FEDDLE%\*.*
					{
						ifinstring,imgonl,|%A_LoopFileExt%|
							{
								AvINNG.= A_LoopFileName . "|"
								fibv= %A_LoopFileFullPath%							
							}
					}
				dianew.= A_LoopFileFullPath . "|"
			}
			guicontrol,,FELBXB,|%AvINNG%
	}
return

MEDIMGPOP:
ARINNG=
guicontrolget,FEDDLA,,FEDDLA
SUBFFILES=
splitpath,curtxt,,,,curtxn
if ((curtxn <> "") && (curtxn <> curtxt))
	{
		curtxt= %curtxn%
	}
if (FERAD2B = 1)
	{
		Loop, %ASSETS%\%FEDDLA%\%curtxt%\%FEDDLE%\*.*
			{
				SUBFFILES.= A_LoopFileName . "|"
			}	
		GuiControl,,FELBXB,|%SUBFFILES%
	}
return

MediaFEDDLC:
guicontrolget,FEDDLC,,FEDDLC
stringreplace,FEDDLC,FEDDLC,%A_Space%,,All
stringreplace,FEDDLC,FEDDLC,-,,All
ifnotexist,mediafe.ini
	{
		filecopy,sets\mediafe.set,mediafe.ini
	}
iniread,imageheight,mediafe.ini,CONFIG,%FEDDLC%_image_height
if (imageheight = "ERROR")
	{
		iniread,imageheight,mediafe.ini,CONFIG,Global_image_height
		iniwrite,%imageheight%,mediafe.ini,CONFIG,%FEDDLC%_image_height
	}
guicontrol,,FEEDTD,%imageheight%
iniread,imagewidth,mediafe.ini,CONFIG,%FEDDLC%_image_width
if (imagewidth = "ERROR")
	{
		iniread,imagewidth,mediafe.ini,CONFIG,Global_image_width
		iniwrite,%imagewidth%,mediafe.ini,CONFIG,%FEDDLC%_image_width
	}
guicontrol,,FEEDTC,%imagewidth%
iniread,imagefrmt,mediafe.ini,CONFIG,%FEDDLC%_image_format
Guicontrol,,FERAD4A,1
if (imagefrmt = "ERROR")
	{
		iniread,imagefrmt,mediafe.ini,CONFIG,Global_image_format
		iniwrite,%imagefrmt%,mediafe.ini,CONFIG,%FEDDLC%_image_format
	}
if (imagefrmt = "JPG")
	{
		Guicontrol,,FERAD4B,1
	}
iniread,mediaorder,mediafe.ini,ORDER,%FEDDLC%
if (mediaorder = "ERROR")
	{
		iniread,mediaorder,mediafe.ini,ORDER,system_order
		iniwrite,%mediaorder%,mediafe.ini,ORDER,%FEDDLC%
	}
guicontrol,,FELBXA,|%mediaorder%
return

MediaFEDDLG:
gui,submit,nohide
guicontrol,,FECHKO,0
guicontrolget,FEDDLG,,FEDDLG
iniread,scrapeto,MediaFE.ini,GLOBAL,scrape_destinations
scrpt= hide
ifinstring,scrapeto,%FEDDLG%
	{
		guicontrol,,FECHKO,1
		scrpt= show
	}
guicontrol,%scrpt%,FEDDLF
guicontrol,%scrpt%,FECBXA
guicontrol,%scrpt%,FETXTN
return

MediaFEDDLD:
guicontrolget,FEDDLD,,FEDDLD
return

MediaFEDDLF:
gui,submit,nohide
guicontrolget,FEDDLF,,FEDDLF
guicontrolget,FEDDLG,,FEDDLG
guicontrolget,FEDDLA,,FEDDLA
iniread,fed,Mediafe.ini,%FEDDLG%,%FEDDLF%
if ((fei = "ERROR") or (fei = ""))
	{
		iniread,fei,Mediafe.ini,GLOBAL,%FEDDLF%
		guicontrol,,FECBXA,|%fed%
		return
	}
stringreplace,fed,fed,||,|,All	
guicontrol,,FECBXA,|%fei%||%fed%
return

MediaFECBXA:
gui,submit,nohide
guicontrolget,FECBXA,,FECBXA
guicontrolget,FEDDLG,,FEDDLG
guicontrolget,FEDDLF,,FEDDLF
if ((FECBXA = "") or (FEDDLF = "Image Type"))
	{
		return
	}	
iniwrite,%FECBXA%,MediaFE.ini,%FEDDLG%,%FEDDLF%
return

MediaFECBXB:
gui,submit,nohide
guicontrolget,FECBXB,,FECBXB
efx= 
Loop,%FECBXB%\*,2
	{
		if (A_Index = 1)
			{
				efxi= %A_LoopFileName%
			}
		efx.= A_LoopFileName . "|"
	}
guicontrol,,FEDDLE,|%efxi%||%efx%
gosub,FEDDLE
return

MediaFERAD2A:
fromcfg=
Loop,Parse,MEDIAFEITEMS,|
	{
		guicontrol,hide,%A_LoopField%
	}
guicontrol,show,FECHKA
guicontrol,show,FECHKB
guicontrol,show,FECHKC
guicontrol,show,FECHKD
guicontrol,show,FECHKE
guicontrol,show,FECHKF
guicontrol,show,FECHKP
guicontrol,show,FEDDLD
guicontrol,show,FEBUTA
guicontrol,show,FELVA
guicontrol,show,FETXTB
guicontrol,show,FETXTC
guicontrol,show,FETXTD
guicontrol,show,FETXTE
guicontrol,show,FECHKP
guicontrol,show,FERAD2A
guicontrol,show,FERAD5A
guicontrol,show,FERAD5B
guicontrol,show,FERAD2C
guicontrol,show,FETXTA
guicontrol,show,FEDDLD
guicontrol,enable,FELVA
guicontrol,enable,FEDDLD
guicontrol,enable,FERAD5B
guicontrol,enable,FECHKD
guicontrol,move,FECHKF,x591 y323
guicontrol,,FECHKA,0
guicontrol,,FECHKB,0
guicontrol,,FECHKC,0
guicontrol,,FECHKD,0
guicontrol,,FECHKE,0
guicontrol,,FECHKG,0
guicontrol,,FECHKH,0
guicontrol,,FECHKJ,0
guicontrol,,FECHKI,0
guicontrol,,FECHKJ,0
guicontrol,,FECHKK,0
guicontrol,,FECHKL,0
guicontrol,,FECHKM,0
guicontrol,,FECHKG,0
guicontrol,,FERAD5A,1
guicontrol,,FEDDLA,|Systems||
Gui,ListView,FELVA
LV_Delete()
Loop, %RJSYSTEMS%\*,2
	{
		if A_LoopFileAttrib contains H
			{
				continue
			}
		ifinstring,scrsup,%A_LoopFileName%
			{
				LV_Add("",A_LoopFileName)
			}
	}
LV_ModifyCol()
return

MediaFERAD2B:
gui,submit,nohide
guicontrol,enable,FECHKD
guicontrol,,FERAD5A,1
guicontrol,enable,FELVA
guicontrol,disable,FERAD5B
guicontrol,disable,FEDDLD
scrble=
Loop, %RJSYSTEMS%\*,2
	{
		if A_LoopFileAttrib contains H
			{
				continue
			}
		ifinstring,scrsup,%A_LoopFileName%
			{
				if (A_Index = 1)
					{
						scrpp= %A_LoopFileName%
					}
				scrble.= A_LoopFileName . "|"
			}
		}
guicontrol,,FEDDLA,|Systems||%scrble%
Gui,ListView,FELVA
LV_Delete()
return

MediaFERAD2C:
fromcfg=
guicontrol,,FEDDLA,|
gui,ListView,FELVA
LV_Delete()
loop,Parse,systmfldrs,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		LV_Add("",A_LoopField)
	}
Loop,Parse,MEDIAFEITEMS,|
	{
		guicontrol,show,%A_LoopField%
	}
LV_ModifyCol()		
guicontrol,hide,FERAD5A
guicontrol,hide,FERAD5B
guicontrol,hide,FEBUTI
guicontrol,hide,FETXTB
guicontrol,hide,FETXTC
guicontrol,hide,FETXTD
guicontrol,hide,FETXTE
guicontrol,hide,FECHKP
guicontrol,show,FECHKO
guicontrol,show,FEDDLG
guicontrol,show,FEBUTM
guicontrol,show,FECBXB
guicontrol,show,FERAD2B
guicontrol,move,FECHKF,x285 y440
guicontrol,,FECHKA,0
guicontrol,,FECHKB,0
guicontrol,,FECHKC,0
guicontrol,,FECHKD,0
guicontrol,,FECHKE,0
guicontrol,,FECHKG,0
guicontrol,,FECHKH,0
guicontrol,,FECHKJ,0
guicontrol,,FECHKI,0
guicontrol,,FECHKJ,0
guicontrol,,FECHKK,0
guicontrol,,FECHKL,0
guicontrol,,FECHKM,0
guicontrol,enable,FECHKD
guicontrol,,FERAD5A,1
guicontrol,enable,FELVA
guicontrol,disable,FERAD5B
guicontrol,hide,FETXTA
guicontrol,hide,FEDDLD
guicontrol,disable,FEDDLD
return

MediaFEBUTL:
gui,submit,nohide
guicontrolget,feDDLE,,feDDLE
guicontrolget,msyn,,FELVA
if (FERAD2B = 1)
	{
		guicontrolget,msyn,,FEDDLA
	}
SB_SetText("opening " assets " " msyn " folder ")
Run, %comspec% /c explorer "%S_KeyDir%\%ASSETS%\%msyn%"
return

MediaFEBUTM:
gui,submit,nohide
FileSelectFolder,ASTDV,,3,Select a folder of media
if (ASTDV = "")
	{
		return
	}
guicontrol,,FECBXB,|%ASTDV%||
guicontrol,,FEDDLE,|
ijv= 
Loop, %ASTDV%\*.*
	{
		ifinstring,imgonl,|%A_LoopFileExt%|
			{
				ijv.= A_LoopFileFullPath . "|"
			}
	}
guicontrol,,FELBXB,|%ijv%
return

MediaFERAD4A:
guicontrolget,FEDDLC,,FEDDLC
guicontrolget,FEEDTC,,FEEDTC
stringreplace,FEDDLC,FEDDLC,%A_Space%,,All
stringreplace,FEDDLC,FEDDLC,-,,All
GRANDORDER= %FEDDLC%
if (FEDDLC = "Global")
{
		Loop, Parse, metaimages,|
			{
				GRANDORDER= %A_LoopField%
				Gosub, SCRWRPNG
			}
		iniwrite,png,mediafe.ini,CONFIG,Global_image_format
		return
	}
SCRWRPNG:
iniwrite,png,mediafe.ini,CONFIG,%GRANDORDER%_image_format
return

MediaFERAD4B:
guicontrolget,FEDDLC,,FEDDLC
guicontrolget,FEEDTC,,FEEDTC
stringreplace,FEDDLC,FEDDLC,%A_Space%,,All
stringreplace,FEDDLC,FEDDLC,-,,All
GRANDORDER= %FEDDLC%
if (FEDDLC = "Global")
{
		Loop, Parse, metaimages,|
			{
				GRANDORDER= %A_LoopField%
				Gosub, SCRWRJPG
			}
		iniwrite,jpg,mediafe.ini,CONFIG,Global_image_format
		return
	}
SCRWRJPG:
iniwrite,jpg,mediafe.ini,CONFIG,%FEDDLC%_image_format
return

MediaFERAD5A:
guicontrol,enable,FELVA
return

MediaFERAD7B:
scrlrset=
guicontrol,enable,FELVA
stringleft,srchsh,curtxt,3
stringsplit,avxin,curtxt0,([
stringreplace,ntrnsf,avxin1,%A_Space%,,All
stringreplace,ntrnsf,ntrnsf,-,,All
stringreplace,ntrnsf,ntrnsf,`,,,All
stringreplace,ntrnsf,ntrnsf,.,,All
stringreplace,ntrnsf,ntrnsf,',,All
subfar=
arin=
beginpop=
garner=
garnern=
lsfnd=
splitpath,curtxt,curtxf,,,curtxn
Loop, %ASSETS%\%FEDDLA%\%srchsh%*,2
{
	if (arin <> "")
		{
			beginpop= %subfar%
			guicontrol,show,FEBUTH
			guicontrol,show,FEBUTG
		}
	stringsplit,spliip,A_LoopFileName,([
	if (avxin1 = spliip1)
		{
			garnern+=1
			garner.= A_LoopFileName . "`n"
			continue
			}
	if (garnern > 1)
		{
			splitpath,A_LoopFileFullPath,filen,matd,mmex,menan
			stringreplace,fiemn,menan,%A_Space%,,All
			stringreplace,fiemn,menan,-,,All
			stringreplace,fiemn,menan,`,,,All
			stringreplace,fiemn,menan,.,,All
			stringreplace,fiemn,menan,',,All
			if (ntrnsf = fiemn)
			{
			garner.= A_LoopFileName . "`n"
			continue
				}
			garnern=
			subfar.= A_LoopFileName . "`n"
			lsfnd= A_LoopFileName . "`n"
			arin+=1
		}
	if (scrln = arin)
		{
			goto, medpoppic
		}
}
if (arin = 1)
	{
		goto, MEDFLDDDWN
	}
subemds=
Loop, %ASSETS%\%FEDDLA%\%curtxt%\%FEDDLE%\*.*
	{
		subemds.= A_LoopFileName . "|"
	}
guicontrol,,FELBXB,|%submeds%
return

MediaFEPICA:
gosub, MEDIATOOLTIP
return

MediaFEBUTH:
if (FEUPDCn < 1)
{
	return
	}
FEUPDCn-=1
gosub, FLDRCARRIER
return

MediaFEBUTG:
if (FEUPDCn > 9)
{
	return
	}
FEUPDCn+=1
gosub, FLDRCARRIER
return

MediaFEBUTI:
CNCLKUP= 1
arpause= ENABLE
artinterupt= hide
gosub, ARTPAUSE
guicontrol,hide,FEBUTN
guicontrol,hide,FEBUTI
guicontrol,show,FEBUTA
Process,close,%vidwnl%
return

FLDRCARRIER:
curtxt=
goto, medpoppic
if ("" = "")
	{
		SB_SetText("foldername")
	}
return

medpoppic:
tmpic=
fuzn=
afuzn=
tmpfldr= Global|
if (FERAD2B = 1)
	{
		systmem= %FEDDLA%
		febe= %ASSETS%\%FEDDLA%\%srchsh%
	}
if (FERAD2C = 1)
	{
		systmem= %curtxt%
		guicontrolget,febe,,FECBXB
	}
Loop,%febe%*,2
	{
		fuzn+= 1
		fldrnm= %A_LoopFileName%
		if (FEUPDCn = fuzn)
		{
			SB_SetText(" current folder: " FEUPDCn " " A_LoopFileName " ")
			curtxt= %A_LoopFileName%
			SUBFLDRPOP=
			Loop, %A_LoopFileFullPath%\*,2
				{
					if (A_LoopFileName = "BoxArt")
						{
							tmpfldr= %A_LoopFileName%|
								cfils=
							Loop, %febe%\%FEDDLE%\*.*
								{
									cfils.= A_LoopFileName . "|"
								}
							guicontrol,,FELBXB,|%cfils%
						}
					SUBFLDRPOP.= A_LoopFileName . "|"
					}
			guicontrol,,FEDDLE,|%tmpfldr%|%SUBFLDRPOP%
			guicontrol,,FECBXB,|%fldrnm%||
			guicontrol,show,FEBUTH
			guicontrol,show,FEBUTG
			continue
		}
		afuzn+= 1
	}
if (afuzn > fuzn)
		{
			FEUPDCn=
			Loop, %febe%\%FEDDLE%\*,2
				{
					if (A_LoopFileName = "BoxArt")
						{
							cfils=
							Loop, %ASSETS%\%systmem%\%fldrnm%\%tmpfldr%\*.*
								{
									cfils.= A_LoopFileName . "|"
								}
							guicontrol,,FELBXB,|%cfils%
							tmpfldr= %A_LoopFileName%|
						}
					SUBFLDRPOP.= A_LoopFileName . "|"
				}
			SB_SetText(" current folder: " A_LoopFileName " ")
			guicontrol,,FEDDLE,|%tmpfldr%|%SUBFLDRPOP%
			guicontrol,show,FEBUTH
			guicontrol,show,FEBUTG
		}
guicontrol,show,FEBUTG
guicontrol,show,FEBUTH
return

MediaFERAD7A:
MEDFLDDDWN:
medlpn=
Loop, %ASSETS%\%FEDDLA%\%curtxn%,2
	{
		medlpn.= A_LoopField . "|"
	}
guicontrol,,FELBXB,|%medlpn%
guicontrol,enable,FELVA
return

MediaFERAD5B:
guicontrol,disable,FELVA
return

MediaFELVA:
gui,submit,nohide
curtxt=
if	(ErrorLevel == "C")
		{
			LV_Modify(A_EventInfo, "+Select")
			LV_GetNext(A_EventInfo, Focused)
			LV_GetText(curtxt, A_EventInfo)
			stringreplace,FE_TDB,FE_TDB,%curtxt%|0,%curtxt%|1,All
		}
    Else if	(ErrorLevel == "c")
       {
			LV_Modify(A_EventInfo, "+Select")
			LV_GetNext(A_EventInfo, Focused)
			LV_GetText(curtxt, A_EventInfo)
			stringreplace,FE_TDB,FE_TDB,%curtxt%|1,%curtxt%|0,All
	   }
curtxt=
RowNumber = 0
dialg= 
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		if (curtxt = "")
			{
				continue
			}
		if (FERAD2B = 1)
			{
				gosub, MEDIMGPOP
			}
		if (FERAD2C = 1)
			{
				dialg= 
				Loop,%ASSETS%\%curtxt%\*,2
					{
						dialg.= A_LoopFileFullPath . "|"
					}
			}	
	}
ASINNG=
splitpath,curtxt,,,,curtxn
if ((curtxn <> "") && (curtxn <> curtxt))
	{
		curtxt= %curtxn%
	}
if (FERAD2B = 1)
	{
		Loop, %ASSETS%\%FEDDLA%\%curtxt%\*,2
			{
				ASINNG.= A_LoopFileName . "|"
			}
		guicontrol,,FEDDLE,|Boxart||%ASINNG%
	}
if (FERAD2C = 1)
	{
		dianew= 
		anbe= 
		ARINNG= 
		Loop, parse, dialg,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				fibv= %A_LoopField%
				/*
				Loop,%A_LoopField%\*,2
					{
						Loop, %A_LoopField%\%A_LoopFileName%\*,2
							{
								if (anbe > 1)
									{
										break
									}
								if (A_Index = 1)
									{
										fibx= %A_LoopFileName%
									}
								ARINNG.= A_LoopFileName . "|"
							}
						if (ARINNG <> "")
							{
								anbe=2
							}
					}
				*/	
				dianew.= A_LoopField . "|"
			}
		;;guicontrol,,FEDDLE,|%fibx%||%ARINNG%
		guicontrol,,FECBXB,|%fibv%||%dianew%
		gosub, FEDDLE
	}
return

MEDIATOOLTIP:
gui,submit, nohide
guicontrolget, HOVPREV
if (HOVPREV = 0)
{
	return
}
coordmode,mouse,screen
mousegetpos,x,y
imagex:=x+20
imagey:=y+20
absolmedimg= %ASSETS%\%FEDDLA%\%curtxt%\%FEDDLE%\%imgdat%
splashimage,%absolmedimg%,b x%imagex% y%imagey%,,,MediaMID
sleep,100
loop, 30
{
imagex:=x+20
imagey:=y+20
winmove,MediaMID,,%imagex%,%imagey%
}
SplashImage, Off
pkvi= 
Loop,%ASSETS%\%FEDDLA%\%curtxt%\*,2
	{
		pkvi.= A_LoopFileFullPath . "|"
	}
guicontrol,,FECBXB,|%ASSETS%\%FEDDLA%\%curtxt%\%FEDDLE%||%pkvi%
return

utlBUTA:
gui,submit,nohide
gosub, %curutl%utlBUTA
return

utlBUTB:
gui,submit,nohide
gosub, %curutl%utlBUTB
return

utlBUTC:
gui,submit,nohide
gosub, %curutl%utlBUTC
return

utlBUTG:
gui,submit,nohide
gosub, %curutl%utlBUTG
return

utlBUTD:
gui,submit,nohide
gosub, %curutl%utlBUTD
return

utlBUTE:
gui,submit,nohide
gosub, %curutl%utlBUTE
return

utlBUTF:
gui,submit,nohide
gosub, %curutl%utlBUTF
return

utlBUTH:
gui,submit,nohide
gosub, %curutl%utlBUTH
return

utlBUTI:
gui,submit,nohide
gosub, %curutl%utlBUTI
return

utlBUTJ:
gui,submit,nohide
gosub, %curutl%utlBUTJ
return

utlCHKD:
gui,submit,nohide
gosub, %curutl%utlCHKD
return

utlCHKE:
gui,submit,nohide
gosub, %curutl%utlCHKE
return

utlCHKF:
gui,submit,nohide
gosub, %curutl%utlCHKF
return

utlCHKG:
gui,submit,nohide
gosub, %curutl%utlCHKG
return

utlCHKH:
gui,submit,nohide
gosub, %curutl%utlCHKH
return

utlCHKI:
gui,submit,nohide
gosub, %curutl%utlCHKI
return

utlCHKJ:
gui,submit,nohide
gosub, %curutl%utlCHKJ
return

utlCHKK:
gui,submit,nohide
gosub, %curutl%utlCHKK
return

utlCHKL:
gui,submit,nohide
gosub, %curutl%utlCHKL
return

utlCHKM:
gui,submit,nohide
gosub, %curutl%utlCHKM
return

utlCHKN:
gui,submit,nohide
gosub, %curutl%utlCHKN
return

utlCHKO:
gui,submit,nohide
gosub, %curutl%utlCHKO
return

utlCHKP:
gui,submit,nohide
gosub, %curutl%utlCHKP
return

utlCHKQ:
gui,submit,nohide
gosub, %curutl%utlCHKQ
return

utlCHKA:
gui,submit,nohide
gosub, %curutl%utlCHKA
return

utlCHKB:
gui,submit,nohide
gosub, %curutl%utlCHKB
return

utlCHKC:
gui,submit,nohide
gosub, %curutl%utlCHKC
return

utlCBXE:
gui,submit,nohide
gosub, %curutl%utlCBXE
return

utlCBXF:
gui,submit,nohide
gosub, %curutl%utlCBXF
return

utlCBXG:
gui,submit,nohide
gosub, %curutl%utlCBXG
return

utlCBXH:
gui,submit,nohide
gosub, %curutl%utlCBXH
return

utlCBXI:
gui,submit,nohide
gosub, %curutl%utlCBXI
return

utlCBXJ:
gui,submit,nohide
gosub, %curutl%utlCBXJ
return

utlCBXA:
gui,submit,nohide
gosub, %curutl%utlCBXA
return

utlCBXB:
gui,submit,nohide
gosub, %curutl%utlCBXB
return

utlCBXC:
gui,submit,nohide
gosub, %curutl%utlCBXC
return

utlCBXD:
gui,submit,nohide
gosub, %curutl%utlCBXD
return

utlDDLE:
gui,submit,nohide
gosub, %curutl%utlDDLE
return

utlDDLF:
gui,submit,nohide
gosub, %curutl%utlDDLF
return

utlDDLG:
gui,submit,nohide
gosub, %curutl%utlDDLG
return

utlDDLH:
gui,submit,nohide
gosub, %curutl%utlDDLH
return

utlDDLI:
gui,submit,nohide
gosub, %curutl%utlDDLI
return

utlDDLJ:
gui,submit,nohide
gosub, %curutl%utlDDLJ
return

utlDDLC:
gui,submit,nohide
gosub, %curutl%utlDDLC
return

utlDDLD:
gui,submit,nohide
gosub, %curutl%utlDDLD
return

utlDDLA:
gui,submit,nohide
guicontrolget,curutl,,UTLDDLA
if (curutl = "Executable")
	{
		utltog= hide
		gosub, UTLUNPOP
		gosub, %UTLDDLA%_util
		return
	}
return

utlDDLB:
gui,submit,nohide
gosub, %curutl%utlDDLB
return

utlEDTA:
gui,submit,nohide
gosub, %curutl%utlEDTA
return

utlEDTB:
gui,submit,nohide
gosub, %curutl%utlEDTB
return

utlEDTC:
gui,submit,nohide
gosub, %curutl%utlEDTC
return

utlEDTD:
gui,submit,nohide
gosub, %curutl%utlEDTD
return

utlEDTE:
gui,submit,nohide
gosub, %curutl%utlEDTE
return

utlEDTF:
gui,submit,nohide
gosub, %curutl%utlEDTF
return

utlEDTG:
gui,submit,nohide
gosub, %curutl%utlEDTG
return

utlUPDA:
gui,submit,nohide
gosub, %curutl%utlUPDA
return

utlEDTH:
gui,submit,nohide
gosub, %curutl%utlEDTH
return

utlEDTI:
gui,submit,nohide
gosub, %curutl%utlEDTI
return

utlUPDB:
gui,submit,nohide
gosub, %curutl%utlUPDB
return

utlUPDC:
gui,submit,nohide
gosub, %curutl%utlUPDC
return

utlLBXA:
gui,submit,nohide
gosub, %curutl%utlLBXA
return

utlLBXB:
gui,submit,nohide
gosub, %curutl%utlLBXB
return

utlLVA:
gui,submit,nohide
gosub, %curutl%utlLVA
return

utlLVB:
gui,submit,nohide
gosub, %curutl%utlLVB
return

utlLVC:
gui,submit,nohide
gosub, %curutl%utlLVC
return

utlRad5B:
gui,submit,nohide
gosub, %curutl%utlRad5B
return

utlRad5C:
gui,submit,nohide
gosub, %curutl%utlRad5C
return

utlRad4A:
gui,submit,nohide
gosub, %curutl%utlRad4A
return

utlRad4B:
gui,submit,nohide
gosub, %curutl%utlRad4B
return

utlRad5A:
gui,submit,nohide
gosub, %curutl%utlRad5A
return

utlRad6A:
gui,submit,nohide
gosub, %curutl%utlRad6A
return

utlRad6B:
gui,submit,nohide
gosub, %curutl%utlRad6B
return

utlRad6C:
gui,submit,nohide
gosub, %curutl%utlRad6C
return

utlRad6D:
gui,submit,nohide
gosub, %curutl%utlRad6D
return

utlRad7A:
gui,submit,nohide
gosub, %curutl%utlRad7A
return

utlRad7B:
gui,submit,nohide
gosub, %curutl%utlRad7B
return

utlRad8A:
gui,submit,nohide
gosub, %curutl%utlRad8A
return

utlRad8B:
gui,submit,nohide
gosub, %curutl%utlRad8B
return

utlRad9A:
gui,submit,nohide
gosub, %curutl%utlRad9A
return

utlRad9B:
gui,submit,nohide
gosub, %curutl%utlRad9B
return

utlRad9C:
gui,submit,nohide
gosub, %curutl%utlRad9C
return

utlRad10A:
gui,submit,nohide
gosub, %curutl%utlRad10A
return

utlRad10B:
gui,submit,nohide
gosub, %curutl%utlRad10B
return

utlRad11A:
gui,submit,nohide
gosub, %curutl%utlRad11A
return

utlRad11B:
gui,submit,nohide
gosub, %curutl%utlRad11B
return

utlRad2A:
gui,submit,nohide
gosub, %curutl%utlRad2A
return

utlRad2B:
gui,submit,nohide
gosub, %curutl%utlRad2B
return

utlRad2C:
gui,submit,nohide
gosub, %curutl%utlRad2C
return

utlRad1A:
gui,submit,nohide
gosub, %curutl%utlRad1A
return

utlRad3A:
gui,submit,nohide
gosub, %curutl%utlRad3A
return

utlRad3B:
gui,submit,nohide
gosub, %curutl%utlRad3B
return

utlRad3C:
gui,submit,nohide
gosub, %curutl%utlRad3C
return

utlRad3D:
gui,submit,nohide
gosub, %curutl%utlRad3D
return

utlRad1B:
gui,submit,nohide
gosub, %curutl%utlRad1B
return

utlSLDA:
gui,submit,nohide
gosub, %curutl%utlSLDA
return

utlSLDB:
gui,submit,nohide
gosub, %curutl%utlSLDB
return

utlSLDC:
gui,submit,nohide
gosub, %curutl%utlSLDC
return

utlSLDD:
gui,submit,nohide
gosub, %curutl%utlSLDD
return

utlSLDE:
gui,submit,nohide
gosub, %curutl%utlSLDE
return

UTLUNPOP:
Loop,Parse,UTLGUIITEMS,|
	{
		guicontrol,%utltog%,%A_LoopField%
	}
return

Executable_util:
lvachk= +Check
ROQU= "
;"
ROPTH= ..\
ROXT= .ext
RODIS= %ROQU%%ROPTH%$ROM$%ROXT%%ROQU%
curxe= executable\exeparam.ini
gui,submit,nohide
guicontrol,show,utlRad1B
guicontrol,,utlRad1B,Keymapper Disabled
guicontrol,move,UTLRAD1B,x411 y347 w140 h23
guicontrol,,utlRad1B,1
guicontrol,show,utlRad1A
guicontrol,,utlRad1A,Keymapper Enabled
guicontrol,move,UTLRAD1A,x412 y323 w140 h23
guicontrol,show,utlCBXA
guicontrol,move,utlCBXA,x643 y236 w100
guicontrol,,utlCBXA,|
guicontrol,show,utlCBXB
guicontrol,move,utlCBXB,x409 y236 w134
guicontrol,,utlCBXB,|
guicontrol,show,utlCHKC
guicontrol,,utlCHKC,1
guicontrol,move,utlCHKC,x411 y267 w54 h17
guicontrol,,utlCHKC,quotes
guicontrol,show,utlCHKD
guicontrol,,utlCHKD,1
guicontrol,move,utlCHKD,x411 y284 w64 h19
guicontrol,,utlCHKD,extension
guicontrol,show,utlCHKE
guicontrol,,utlCHKE,1
guicontrol,move,utlCHKE,x411 y303 w44 h16
guicontrol,,utlCHKE,path
guicontrol,show,utlCHKF
guicontrol,,utlCHKF,0
guicontrol,move,utlCHKF,x531 y283 w204 h16
guicontrol,,utlCHKF,User-Defined Extraction Path
guicontrol,show,utlCHKG
guicontrol,enable,utlCHKG
guicontrol,,utlCHKG,Enable_Icon
guicontrol,,utlCHKG,0
guicontrol,move,utlCHKG,x368 y382 w107 h16
guicontrol,show,utlEDTA
guicontrol,move,utlEDTA,x495 y80 w221 h21
guicontrol,,utlEDTA,EXECUTBALE TITLE
guicontrol,show,utlCBXD
guicontrol,disable,utlCBXD
guicontrol,move,utlCBXD,x531 y303 w204 h21
guicontrol,,utlCBXD,|temp||exe directory|desktop
guicontrol,show,utlTXTM
guicontrol,move,utlTXTM,x686 y219 w57 h16
guicontrol,,utlTXTM,arguments
guicontrol,show,utlTXTN
guicontrol,move,utlTXTN,x413 y221 w40 h13
guicontrol,,utlTXTN,options
guicontrol,show,utlTXTI
guicontrol,+Center,utlTXTI
guicontrol,move,utlTXTI,x545 y240 w93 h17
guicontrol,,utlTXTI,%RODIS%
guicontrol,show,utlBUTH
guicontrol,move,utlBUTH,x371 y51 w50 h22
guicontrol,,utlBUTH,Add
guicontrol,enable,utlBUTH
guicontrol,show,utlPRGA
guicontrol,move,utlPRGA, x753 y44 w8 h459 -Smooth Vertical
guicontrol,show,utlPRGA
guicontrol,move,utlBUTJ, x687 y470 w68 h23
guicontrol,show,utlBUTJ
guicontrol,enable,utlBUTJ
guicontrol,,utlBUTJ,Create
guicontrol,move,utlBUTC, x367 y445 w75 h23
guicontrol,enable,utlBUTC
guicontrol,show,utlBUTC
guicontrol,,utlBUTC,Out-File
guicontrol,move,utlBUTD, x438 y51 w51 h22
guicontrol,show,utlBUTD
guicontrol,enable,utlBUTD
guicontrol,,utlBUTD,Open
guicontrol,move,utlTXTK, x495 y53 w221 h14
guicontrol,show,utlTXTK
guicontrol,enable,utlTXTK
guicontrol,,utlTXTK,Open compilation-directory in explorer
guicontrol,move,utlBUTE,x587 y470 w68 h23
guicontrol,show,utlBUTE
guicontrol,,utlBUTE,RESET
guicontrol,move,utlBUTG,x556 y201 w51 h18
;;guicontrol,show,utlBUTG
guicontrol,,utlBUTG,config
guicontrol,move,utlDDLC, x408 y198 w120
guicontrol,,utlDDLC,|Other|%emuinstpop%
guicontrol,show,utlDDLC
guicontrol,move,utlBUTF, x367 y400 w75 h23
guicontrol,show,utlBUTF
guicontrol,enable,utlBUTF
guicontrol,,utlBUTF,Icon
guicontrol,move,utlGRPD, x364 y427 w391 h86
guicontrol,show,utlGRPD
guicontrol,,utlGRPD,Save
guicontrol,move,utlLVA, x20 y26 w341 h479
guicontrol,show,utlLVA
guicontrol,,utlLVA,|Added_Files||
guicontrol,+checked,utlLVA
guicontrol,+Multi,utlLVA
guicontrol,+AltSubmit,utlLVA
guicontrol,move,utlTXTB, x531 y20 w79 h13
guicontrol,show,utlTXTB
guicontrol,,utlTXTB,Utility
guicontrol,move,utlTXTF, x515 y103 w221 h14
guicontrol,show,utlTXTF
guicontrol,,utlTXTF,Executable Title
guicontrol,move,utlTXTC, x447 y449 w309 h13
guicontrol,show,utlTXTC
guicontrol,,utlTXTC,%S_KeyDir%\game.exe
guicontrol,move,utlTXTD, x409 y178 w45 h13
guicontrol,show,utlTXTD
guicontrol,,utlTXTD,Emulator
guicontrol,move,utlTXTE,x446 y406 w217 h13
guicontrol,show,utlTXTE
guicontrol,,utlTXTE,ICON
guicontrol,,utlPICA,%S_KeyDir%\img\install.ico
guicontrol,move,utlPICA, x688 y382 w66 h65
guicontrol,show, utlPICA
ifexist,%S_KeyDir%\executable\exe.ico
	{
		guicontrol,,utlPICA,%S_KeyDir%\executable\exe.ico
	}
	else {
	 filecopy,%S_KeyDir%\img\install.ico,%S_KeyDir%\executable\exe.ico
	}
Gui,Listview,utllva
presx=
Loop, Files,executable\*.*,RFD
	{
		presx= 1
		LV_Add(lvachk,A_LoopFileFullPath)
	}
LV_ModifyCol()
if (presx = 1)
	{
		ifexist,%curxe%
			{
				IniRead,xeico,%curxe%,EXECUTABLE,icon
				if (xeico <> "ERROR")
					{
						guicontrol,,utlTXTE,executable\exe.ico
						guicontrol,enable,utlBUTF
						guicontrol,,utlCHKG,1
					}
				IniRead,utlchkc,%curxe%,EXECUTABLE,quotes
				if (utlchkc <> "ERROR")
					{
						guicontrol,,utlCHKC,%utlchkc%
					}
				IniRead,utlchkd,%curxe%,EXECUTABLE,extension
				if (utlchkd <> "ERROR")
					{
						guicontrol,,utlCHKD,%utlchkd%
					}
				IniRead,emucfgf,%curxe%,EXECUTABLE,configs
				if (emucfgf <> "ERROR")
					{
						;;guicontrol,,utlCHKE,%utlchke%
					}
				IniRead,utlchke,%curxe%,EXECUTABLE,path
				if (utlchke <> "ERROR")
					{
						guicontrol,,utlCHKE,%utlchke%
					}
				IniRead,xeopt,%curxe%,EXECUTABLE,options
				if (xeopt <> "ERROR")
					{
						guicontrol,,utlCBXB,|%xeopt%
					}
				IniRead,xearg,%curxe%,EXECUTABLE,arguments
				if (xearg <> "ERROR")
					{
						guicontrol,,utlCBXA,|%xearg%
					}
				IniRead,xeemu,%curxe%,EXECUTABLE,emulator
				if (xeemu <> "ERROR")
					{
						Loop, Parse, emupartset,`n`r
							{
								stringsplit,aie,A_LoopField,<
								if (aie3 = xeemu)
									{
										xeemu= %aie1%
									}
							}
						guicontrol,,utlDDLC,|%xeemu%||Other|%emuinstpop%
					}
				IniRead,xekm,%curxe%,EXECUTABLE,keymapper
				if (xeemu = 1)
					{
						guicontrol,,utlRAD1A,1
					}
				IniRead,outsv,%curxe%,EXECUTABLE,out_file
				if ((outsv <> "ERROR")&&(outsv <> ""))
					{
						splitpath,outsv,outexe,outexedir
						guicontrol,,utlTXTC,%outsv%
					}
				IniRead,usrdfd,%curxe%,EXECUTABLE,extraction_directory
				if ((usrdfd <> "ERROR")&&(usrdfd <> ""))
					{
						if (usrdfd = "temp")
							{
								guicontrol,,utlCBXD,|temp||exe directory|desktop|
								return
							}
						guicontrol,,utlCHKF,1
						guicontrol,enable,utlCBXD
						guicontrol,,utlCBXD,|%usrdfd%|||temp|exe directory|desktop|
					}
			}
	}
return

executableutlBUTA:
gui,submit,nohide
if (utltog = "show")
	{
		utltog= hide
	}
	else if (utltog = "hide")
	{
		utltog= show
	}
gosub, UTLUNPOP
return

executableutlBUTB:
gui,submit,nohide
return

executableutlBUTC:
gui,submit,nohide
outsv= %S_KeyDir%
FileSelectFile,outsv,S58,,Set the executable name/location,*.exe
if (outsv = "")
	{
		outsv= %S_KeyDir%\game.exe
		SB_SetText("")
		iniwrite, "%outsv%",%curxe%,EXECUTABLE,out_file
		return
	}
splitpath,outsv,outexe,outexedir,outxtn
if (outxtn <> "exe")
	{
		if (outxtn = "")
			{
				outsv.= ".exe"
				outexe.= ".exe"
				outxtn= exe
				goto, exeoutsv
			}
		outsv=
		outexe=
		outexedir=
		outxtn=
		SB_SetText("File must end in ''.exe''")
		goto, utlBUTC
	}
exeoutsv:	
guicontrol,,utlTXTC,%outsv%
iniwrite, "%outsv%",%curxe%,EXECUTABLE,out_file
return

executableutlBUTG:
gui,submit,nohide
return

executableutlBUTD:
gui,submit,nohide
Run, %comspec% /c explorer "%S_KeyDir%\executable"
return

executableutlBUTE:
gui,submit,nohide
MsgBox,8196,Reset,Reset all executable Settings?`nThis will delete all files in the executable directory.
ifmsgbox,yes
	{
		Gui,ListView,utllva
		LV_Delete()
		Loop,files,%S_KeyDir%\executable,R
			{
				FileDelete,%A_LoopFileFullPath%
			}
		FileRemoveDir,%S_KeyDir%\executable,1
		FileCreateDir,%S_KeyDir%\executable
		SB_SetText("RESET")
		guicontrol,,utlTXTC,%S_KeyDir%\game.exe
		guicontrol,,utlTXTE,Icon
		guicontrol,,utlDDLC,|%emuinstpop%
		guicontrol,,utlcbxa,|
		guicontrol,,utlcbxb,|
		guicontrol,,utlRAD1B,1
		xeico=
		outsv= %S_KeyDir%\game.exe
		outexe=
		outexedir=
		gosub, Executable_util
		return
	}
return

executableutlBUTF:
gui,submit,nohide
icotmp=%S_KeyDir%\img\install.ico
FileSelectFile,icotmp,3,,Select Image,*.*
if (icotmp = "")
	{
		return
	}
splitpath, icotmp,,,icoxt
if (icoxt = "ico")
	{
		xeico= %icotmp%
		filecopy,%icotmp%,executable\exe.ico,1
		iniwrite, exe.ico,%curxe%,EXECUTABLE,icon
		guicontrol,,utlTXTE,enabled
		guicontrol,,utlPICA,executable\exe.ico
		return
	}
ifinstring,imgtmp,|%icoxt%|
	{
		RunWait, "bin\any2ico.exe" "-img=%icotmp%" "-icon=executable\exe.ico" -formats=32`,64`,96`,128`,256 -center
		iniwrite, exe.ico,%curxe%,EXECUTABLE,icon
		guicontrol,,utlTXTE,enabled
		guicontrol,,utlPICA,executable\exe.ico
		return
	}
SB_SetText(" You must select a ''.ico'' or image file.")
return

executableutlBUTH:
gui,submit,nohide
utladitms=
FileSelectFile,utladitms,M,,Select Files to add
if (utladitms = "")
	{
		return
	}
stringreplace,utladitms,utladitms,`r,|,All
stringreplace,utladitms,utladitms,`n,|,All
utlAdditms:
Gui,ListView,utlLVA
utlItemdxa=
utlItemdxa:= LVGetCheckedItems("", "ahk_id" . UTILVA)
stringreplace,utlchki,utlItemdxa,`n,|,All
stringreplace,utlchki,utlchki,`r,|,All
Loop,Parse,utladitms,|
	{
		nwaditm= %A_LoopField%
		splitpath,nwaditm,utlromf
		fnd=
		Loop, Parse, utlchki,|
			{
				splitpath,A_LoopField,rtadf,
				if (nwaditm = A_LoopField)
					{
						fnd= 1
						continue
					}
				if (utlromf = rtadf)
					{
						fnd= 1
						continue
					}
			}
		if (fnd = "")
			{
				LV_Add(lvachk, nwaditm)
			}
	}
LV_ModifyCol()
return

executableutlBUTI:
gui,submit,nohide
return

executableutlBUTJ:
gui,submit,nohide
if (outexedir = "")
	{
		SB_SetText(" Set the destination for the executable ")
		return
	}
utlguitog= disable	
gosub, utlguitog
fileDelete,executable\romlist.txt
gosub, utlEDTA
Gui,ListView,utlLVA
utlItemdxa=
utlItemdxa:= LVGetCheckedItems("", "ahk_id" . UTILVA)
stringreplace,utlchki,utlItemdxa,`n,|,All
stringreplace,utlchki,utlchki,`r,|,All
ifnotexist,executable\roms\
	{
		FileCreateDir,executable\roms
	}
SB_SetText("Copying Files")
Loop, Parse, utlchki,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		ifnotinstring,A_LoopField,executable\
			{
				FileCopy, %A_LoopField%,executable\roms\%A_LoopFileName%
				if (ERRORLEVEL > 0)
					{
						splitpath,A_LoopField,fnm,fdir,fxtn,fnnx
						if ((fnnx <> "")&&(fxtn <> "")&&(fnm <> "_"))
							{
								filecopy, %A_LoopField%,executable\roms\%fnnx%_.%fxtn%,1
							}
					}
			}
		SB_SetText("Copying " A_LoopFileName " ")
	}
SB_SetText("Copied Files")
Loop, executable\roms\*.*
	{
		fileAppend,roms\%A_LoopFileName%`n,executable\romlist.txt
	}
SB_SetText(" creating executable ")
FileCopy,bin\emuexe.*,executable
FileDelete,%cacheloc%\MakeEXE_files.txt
apndflz=
Loop,Files, executable\*.*,DFR
	{
		apndflz.= A_LoopFileFullPath . "`n"
	}
stringreplace,apndflz,apndflz,executable\,,All
FileAppend, %apndflz%,%cacheloc%\MakeEXE_files.txt
guicontrolget,utlCHKC,,utlCHKC
IniWrite, %utlCHKC%,%curxe%,EXECUTABLE,quotes
guicontrolget,utlCHKD,,utlCHKD
IniWrite, %utlCHKD%,%curxe%,EXECUTABLE,extension
guicontrolget,expath,,utlCHKE
IniWrite, %utlCHKE%,%curxe%,EXECUTABLE,path
ifexist,%cacheloc%\MakeEXE.7z
	{
		filedelete,%cacheloc%\MakeEXE.7z
	}
RunWait,  "%S_KeyDir%\bin\7za.exe" a -m0=lzma "%cacheloc%\MakeEXE.7z" @"%cacheloc%\MakeEXE_files.txt",executable,hide
FileDelete,executable\config.txt
FileAppend, `;!@Install@!UTF-8!`n,executable\config.txt
FileAppend, Title="ROM-EXECUTABLE"`n,executable\config.txt
FileAppend, RunProgram="hidcon:emuexe.exe"`n,executable\config.txt
iniread,extraction_directory,%curxe%,EXECUTABLE,extraction_directory
if ((extraction_directory <> "temp")&&(extraction_directory <> "")&&(extraction_directory <> "ERROR"))
	{
		if (extraction_directory = "desktop")
			{
				extraction_directory= `%USERPROFILE`%\\Desktop\\%utledtc%
			}
		if (extraction_directory = "exe directory")
			{
				extraction_directory= `%`%S
			}
		FileAppend, GUIFlags="1200"`n,executable\config.txt
		FileAppend, InstallPath="%extraction_directory%"`n,executable\config.txt
	}
FileAppend,`;!@InstallEnd@!`n,executable\config.txt
ifexist,%outsv%
	{
		FileDelete,%outsv%
	}
filecopy,bin\7zsd%ARCH%.sfx,%cacheloc%\7zsd%ARCH%.sfx,1
ifexist,executable\exe.ico
	{
		sleep, 2000
		RunWait, %comspec% /c bin\rcedit%ARCH%.exe "%cacheloc%\7zsd%ARCH%.sfx" --set-icon executable\exe.ico,,hide
		wicon= with icon
	}
RunWait, %comspec% /c copy /b "%cacheloc%\7zsd%ARCH%.sfx" + "executable\config.txt" + "%cacheloc%\MakeEXE.7z" "%outexedir%\%outexe%",,hide
wicon=
SB_SetText("Executable " outsv " " wicon " created")
utlguitog= enable	
gosub, utlguitog
return

executableutlCHKD:
gui,submit,nohide
ROXT= .ext
if (UTLCHKD = 0)
	{
		ROXT=
	}
IniWrite, %utlCHKD%,%curxe%,EXECUTABLE,extension
RODIS= %ROQU%%ROPTH%$ROM$%ROXT%%ROQU%
guicontrol,,utlTXTI,%RODIS%
return

executableutlCHKE:
gui,submit,nohide
ROPTH= ..\
IniWrite, %utlCHKE%,%curxe%,EXECUTABLE,path
if (UTLCHKE = 0)
	{
		ROPTH=
	}
RODIS= %ROQU%%ROPTH%$ROM$%ROXT%%ROQU%
guicontrol,,utlTXTI,%RODIS%
return

executableutlCHKF:
gui,submit,nohide
if (utlCHKF = 1)
	{
		iniread,exe_title,%curxe%,EXECUTABLE,exe_title
		guicontrol,enable,utlCBXD
		guicontrol,,utlCBXD,|%exe_title%||temp|exe directory|desktop
		iniwrite,"%exe_title%",%curxe%,EXECUTABLE,extraction_directory
		guicontrolget,utlCBXD,,utlCBXD
		return
	}
guicontrol,disable,utlCBXD
guicontrol,,utlCBXD,|temp||exe directory|desktop
iniwrite,"",%curxe%,EXECUTABLE,extraction_directory
return

executableutlCHKG:
gui,submit,nohide
if (utlCHKG = 1)
	{
		guicontrol,enable,utlBUTF
		return
	}
guicontrol,disable,utlBUTF
guicontrol,,utlTXTE,
return

executableutlCHKH:
gui,submit,nohide
return

executableutlCHKI:
gui,submit,nohide
return

executableutlCHKJ:
gui,submit,nohide
return

executableutlCHKK:
gui,submit,nohide
return

executableutlCHKL:
gui,submit,nohide
return

executableutlCHKM:
gui,submit,nohide
return

executableutlCHKN:
gui,submit,nohide
return

executableutlCHKO:
gui,submit,nohide
return

executableutlCHKP:
gui,submit,nohide
return

executableutlCHKQ:
gui,submit,nohide
return

executableutlCHKA:
gui,submit,nohide
return

executableutlCHKB:
gui,submit,nohide
return

executableutlCHKC:
gui,submit,nohide
ROQU= "
;"
if (UTLCHKC = 0)
	{
		ROQU=
	}
IniWrite, %utlCHKC%,%curxe%,EXECUTABLE,quotes
RODIS= %ROQU%%ROPTH%$ROM$%ROXT%%ROQU%
guicontrol,,utlTXTI,%RODIS%
return

executableutlCBXE:
gui,submit,nohide
return

executableutlCBXF:
gui,submit,nohide
return

executableutlCBXG:
gui,submit,nohide
return

executableutlCBXH:
gui,submit,nohide
return

executableutlCBXI:
gui,submit,nohide
return

executableutlCBXJ:
gui,submit,nohide
return

executableutlCBXA:
gui,submit,nohide
guicontrolget,utlcbxa,,utlcbxa
IniWrite, "%utlcbxa%", %curxe%,EXECUTABLE,arguments
return

executableutlCBXB:
gui,submit,nohide
guicontrolget,utlcbxb,,utlcbxb
IniWrite, "%utlcbxb%", %curxe%,EXECUTABLE,options
return

executableutlCBXC:
gui,submit,nohide
return

executableutlCBXD:
gui,submit,nohide
guicontrolget,utlCBXD,,utlCBXD
stringreplace,utlCBXD,utlCBXD,\\\\,\\,All
stringreplace,utlCBXD,utlCBXD,\\\,\\,All
stringreplace,utlCBXD,utlCBXD,\,\\,All
return

executableutlDDLE:
gui,submit,nohide
return

executableutlDDLF:
gui,submit,nohide
return

executableutlDDLG:
gui,submit,nohide
return

executableutlDDLH:
gui,submit,nohide
return

executableutlDDLI:
gui,submit,nohide
return

executableutlDDLJ:
gui,submit,nohide
return

executableutlDDLC:
gui,submit,nohide
utlguitog= disable	
gosub, utlguitog
guicontrolget,utlDDLCtmp,,utlDDLC
guicontrol,enable,utlBUTG
Gui,Listview,utlva
lvachk= +Check
utlitmz=
CFGFINC= *.ini|*.cfg|*.xml|*.txt|*.conf|*.config|*.settings
if (utlDDLCtmp = "Other")
	{
		guicontrol,disable,utlBUTG
		Gui,ListView,utlLVA
		iniread,emuxetmp,%curxe%,EXECUTABLE,emulator
		if (emuxetmp <> "")
			{
				utlItemdxa:= LVGetCheckedItems("", "ahk_id" . UTILVA)
				stringreplace,utlchki,utlItemdxa,`n,|,All
				stringreplace,utlchki,utlchki,`r,|,All
			}
		exefiletmp=
		FileSelectFile,exefiletmp,3,,Select the emulator
		if (exefiletmp = "")
			{
				guicontrol,,utlDDLC,|%utlDDLC%||%emuinstpop%
				utlguitog= enable	
				gosub, utlguitog
				return
			}
		splitpath,exefiletmp,emuexeft
		ifinstring,utlchki,emuexeft
			{
				guicontrol,,utlDDLC,|%utlDDLC%||Other|%emuinstpop%
				SB_SetText("Emulator is already added.")
				utlguitog= enable	
				gosub, utlguitog
				return
			}
		ifnotexist,executable\emu
			{
				FileCreateDir,executable\emu
			}
		FileCopy, %exefiletmp%, executable\emu
		nwemuad= executable\emu\%emuexeft%
		LV_Add(lvachk, nwemuad)
		utlitmz.= nwemuad . "|"
		LV_ModifyCol()
		utlDDLC= %utlDDLCtmp%
		IniWrite, "%emuexeft%",%curxe%,EXECUTABLE,Emulator
		utlguitog= enable	
		gosub, utlguitog
		return
	}
utlDDLC= %utlDDLCtmp%
Loop, Parse, emupartset,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,xesel,A_LoopField,<
		stringsplit,urloc,xesel2,/
		if (utlDDLC = xesel1)
			{
				URLFILE= %repoloc%/%urloc1%/%urloc2%
				ifinstring,repoloc,github
					{
						URLFILE= %repoloc%/%urloc1%/raw/master/%urloc2%
					}
				sb_settext(" " URLFILE " ")
				save=%cacheloc%\%urloc2%
				if (xtractmu = "")
						{
							xtractmu= %S_KeyDir%\executable
						}
				splitpath,save,svaf,svap
				rtrcnt= 
				origurl= %URLFILE%
				EXEUTILDWN:
				;;DownloadFile(URLFILE, save, True, True)
				ifnotexist, %save%
					{
						exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
						ifnotexist, %save%
							{
								msgbox,8452,, %xesel1%`n''%URLFILE%''`n was not downloaded`nretry?, 20
								ifmsgbox,yes
									{											
										rtrcnt+= 1
										Loop,parse,ALTHOST,>
											{
												if (A_Index = rtrcnt)
													{
														stringreplace,URLFILE,origurl,repoloc,%A_LoopField%,All
														break
													}
												rtrcnt= 
												URLFILE= %origurl%	
											}
										goto, EXEUTILDWN	
									}
								break
							}
					}
				SB_SetText(" " save " " "extracting")
				runwait, %comspec% cmd /c  " "%S_KeyDir%\bin\7za.exe" x -y "%save%" -O"%xtractmu%\emu" ", ,hide
				SB_SetText(" " save " " "was extracted")
				ifnotexist, %xtractmu%\emu\
					{
						SB_SetText(" " save " " "was NOT extracted")
						utlguitog= enable	
						gosub, utlguitog
						return
					}
				iniread,CFGFINCx,EmuCfgPresets.ini,%UTLDDLC%,CFGPTH
				if (CFGFINCx <> "ERROR")
					{
						CFGFINC= %CFGFINCx%
					}
				iniwrite,%CFGFINC%,%curxe%,EXECUTABLE,CFGFINC
				iniread,emubiosr,EmuCfgPresets.ini,%UTLDDLC%,BIOS
				if ((emubiosr <> "")&&(emubiosr <> "ERROR")&&(emubiosr <> "0"))
					{
						iniread,emuloct,Apps.ini,EMULATORS,%UTLDDLC%
						splitpath,emuloct,emulocf,emulocp
						if (emuloct <> "ERROR")
							{
								Loop,parse,BiosFSet,`n`r
									{
										if (A_LoopField = "")
											{
												continue
											}
										ifinstring,A_LoopField,%UTLDDLC%
											{
												stringsplit,bprt,A_LoopField,=
												Loop,%bprt0%
													{
														bprx= % bprt%A_index%
														ifinstring,bprx,%UTLDDLC%
															{
																stringreplace,emudest,bprx,%UTLDDLC%,executable\emu
																break
															}	
													}
												stringsplit,bfpr,A_LoopField,:?,>
												filecopy,%emulocp%\%bfpr2%,%emudest%,1
											}
									}
							}
					}
				IniWrite, "%xesel3%",%curxe%,EXECUTABLE,Emulator
				break
			}
	}
utlinjo=
utlinja=
iniread,UTLEMUO,EmuCfgPresets.ini,%utlDDLC%,RJEMUOPTS
Loop,parse,UTLEMUO,|
	{
		stringreplace,UTLEMUi,A_LoopField,<,%A_Space%,All
		utlinjo.= utlemui . "|"
	}
guicontrol,,utlCBXB,|%utlinjo%
iniread,UTLEMUA,EmuCfgPresets.ini,%utlDDLC%,RJEMUARGS
Loop,parse,UTLEMUA,|
	{
		stringreplace,UTLEMUi,A_LoopField,<,%A_Space%,All
		utlinja.= utlemui . "|"
	}
guicontrol,,utlCBXA,|%utlinja%
Loop, Files, executable\*.*,RFD
	{
		ifinstring,utlitmz,%A_LoopFileFullPath%
			{
				continue
			}
		LV_Add(lvachk, A_LoopFileFullPath)
		utlitmz.= A_LoopFileFullPath . "|"
	}
LV_ModifyCol()
utlguitog= enable	
gosub, utlguitog
return

executableutlDDLD:
gui,submit,nohide
return

executableutlDDLB:
gui,submit,nohide
return

executableutlEDTA:
gui,submit,nohide
guicontrolget,utlEDTA,,utlEDTA
iniwrite,%utlEDTA%,%curxe%,EXECUTABLE,exe_title
return

executableutlEDTB:
gui,submit,nohide
return

executableutlEDTC:
gui,submit,nohide
return

executableutlEDTD:
gui,submit,nohide
return

executableutlEDTE:
gui,submit,nohide
return

executableutlEDTF:
gui,submit,nohide
return

executableutlEDTG:
gui,submit,nohide
return

executableutlUPDA:
gui,submit,nohide
return

executableutlEDTH:
gui,submit,nohide
return

executableutlEDTI:
gui,submit,nohide
return

executableutlUPDB:
gui,submit,nohide
return

executableutlUPDC:
gui,submit,nohide
return

executableutlLBXA:
gui,submit,nohide
return

executableutlLBXB:
gui,submit,nohide
return

executableutlLVA:
gui,submit,nohide
Gui,ListView,utlLVA
utlItemdxa=
utlItemdxa:= LVGetCheckedItems("", "ahk_id" . UTILVA)
stringreplace,utlchki,utlItemdxa,`n,|,All
stringreplace,utlchki,utlchki,`r,|,All
utlLBXQ=
inib=
loop, parse, utlchki,|
	{
		utlLBXQ=%A_index%
	}
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		inib.= curtxt . "|"
	}
return

executableutlLVB:
gui,submit,nohide
return

executableutlLVC:
gui,submit,nohide
return

executableutlRad5B:
gui,submit,nohide
return

executableutlRad5C:
gui,submit,nohide
return

executableutlRad4A:
gui,submit,nohide
return

executableutlRad4B:
gui,submit,nohide
return

executableutlRad5A:
gui,submit,nohide
return

executableutlRad6A:
gui,submit,nohide
return

executableutlRad6B:
gui,submit,nohide
return

executableutlRad6C:
gui,submit,nohide
return

executableutlRad6D:
gui,submit,nohide
return

executableutlRad7A:
gui,submit,nohide
return

executableutlRad7B:
gui,submit,nohide
return

executableutlRad8A:
gui,submit,nohide
return

executableutlRad8B:
gui,submit,nohide
return

executableutlRad9A:
gui,submit,nohide
return

executableutlRad9B:
gui,submit,nohide
return

executableutlRad9C:
gui,submit,nohide
return

executableutlRad10A:
gui,submit,nohide
return

executableutlRad10B:
gui,submit,nohide
return

executableutlRad11A:
gui,submit,nohide
return

executableutlRad11B:
gui,submit,nohide
return

executableutlRad2A:
gui,submit,nohide
return

executableutlRad2B:
gui,submit,nohide
return

executableutlRad2C:
gui,submit,nohide
return

executableutlRad1A:
gui,submit,nohide
utlguitog= disable	
gosub, utlguitog
Gui,Listview,utllva
LV_Delete()
iniwrite,0,%curxe%,EXECUTABLE,keymapper
iniread,xesel,EmuCfgPresets.ini,Antimicro,URLPTH
iniread,xnsel,EmuCfgPresets.ini,Antimicro,EXENAM
stringsplit,urloc,xesel,/
save= %cacheloc%\%urloc2%
splitpath,save,svaf,svap
origurl= %URLFILE%
ifnotexist,%save%
	{
		URLFILE= %repoloc%/%urloc1%/raw/master/%urloc2%
		sb_settext(" " URLFILE " ")
		rtrcnt= 
		AMICRODWN:
		exe_get(ARIA,URLFILE,svap,svaf,CURPID,cacheloc)
		;;DownloadFile(URLFILE, save, True, True)
		ifnotexist, %save%
			{
				msgbox,8452,, %xesel1%`n''%URLFILE%''`n was not downloaded`nretry?, 20
				ifmsgbox,yes
					{								
						rtrcnt+= 1
						Loop,parse,ALTHOST,>
							{
								if (A_Index = rtrcnt)
									{
										stringreplace,URLFILE,origurl,repoloc,%A_LoopField%,All
										break
									}
								rtrcnt= 
								URLFILE= %origurl%
							}
						goto, AMICRODWN	
					}
			}
	}
gosub,amicroxtr
goto, reinitxe
reinitxe:	
Gui,Listview,utllva
utlitmz=
Loop, Files, executable\*.*,RFD
	{
		ifinstring,utlitmz,%A_LoopFileFullPath%
			{
				continue
			}
		LV_Add(lvachk, A_LoopFileFullPath)
		utlitmz.= A_LoopFileFullPath . "|"
	}
LV_ModifyCol()
utlguitog= enable	
gosub, utlguitog
return

amicroxtr:
SB_SetText(" " save " " "extracting")
xtractmu= %S_KeyDir%\executable
runwait, %comspec% cmd /c " "%S_KeyDir%\bin\7za.exe" x -y "%save%" -O"%xtractmu%\antimicro" ", ,hide
SB_SetText(" " save " " "was extracted")
ifnotexist, %xtractmu%\antimicro\
	{
		SB_SetText(" " save " " "was NOT extracted")
		return
	}
iniwrite,1,%curxe%,EXECUTABLE,keymapper
ifnotexist,executable\Player1.amgp
	{
		FileCopy,rj\joycfgs\Antimicro\joystick\Windows - Games\Player1.amgp,executable\Player1.amgp
	}
ifnotexist,executable\Player2.amgp
	{
		FileCopy,rj\joycfgs\Antimicro\joystick\Windows - Games\Player2.amgp,executable\Player2.amgp
	}
		ifnotexist,executable\Select.amgp
	{
		FileCopy,rj\joycfgs\Antimicro\MediaCenter.amgp,executable\Select.amgp
	}
return

executableutlRad3A:
gui,submit,nohide
return

executableutlRad3B:
gui,submit,nohide
return

executableutlRad3C:
gui,submit,nohide
return

executableutlRad3D:
gui,submit,nohide
return

executableutlRad1B:
gui,submit,nohide
iniwrite,0,%curxe%,EXECUTABLE,keymapper
return

executableutlSLDA:
gui,submit,nohide
return

executableutlSLDB:
gui,submit,nohide
return

executableutlSLDC:
gui,submit,nohide
return

executableutlSLDD:
gui,submit,nohide
return

executableutlSLDE:
gui,submit,nohide
return

utlguitog:
Loop,parse,UTLGUIITEMS,|
	{
		guicontrol,%utlguitog%,%A_LoopField%
	}
return

feBUTA:
gui,submit,nohide
gosub,%FETYP%feBUTA
return

feBUTB:
gui,submit,nohide
gosub,%FETYP%feBUTB
return

feBUTC:
gui,submit,nohide
gosub,%FETYP%feBUTC
return

feBUTG:
gui,submit,nohide
gosub,%FETYP%feBUTG
return

feBUTD:
gui,submit,nohide
gosub,%FETYP%feBUTD
return

feBUTE:
gui,submit,nohide
gosub,%FETYP%feBUTE
return

feBUTF:
gui,submit,nohide
gosub,%FETYP%feBUTF
return

feBUTH:
gui,submit,nohide
gosub,%FETYP%feBUTH
return

feBUTI:
gui,submit,nohide
gosub,%FETYP%feBUTI
return

feBUTJ:
gui,submit,nohide
gosub,%FETYP%feBUTJ
return

feBUTK:
gui,submit,nohide
gosub,%FETYP%feBUTK
return

feBUTL:
gui,submit,nohide
gosub,%FETYP%feBUTL
return

feBUTM:
gui,submit,nohide
gosub,%FETYP%feBUTM
return

feBUTO:
gui,submit,nohide
gosub,%FETYP%feBUTO
return

fePICA:
gui,submit,nohide
gosub,%FETYP%fePICA
return

fePICB:
gui,submit,nohide
gosub,%FETYP%fePICB
return

fePICC:
gui,submit,nohide
gosub,%FETYP%fePICC
return

fePICD:
gui,submit,nohide
gosub,%FETYP%fePICD
return

fePICE:
gui,submit,nohide
gosub,%FETYP%fePICE
return

fePICF:
gui,submit,nohide
gosub,%FETYP%fePICF
return

fePICG:
gui,submit,nohide
gosub,%FETYP%fePICG
return

feLNKA:
gui,submit,nohide
gosub,%FETYP%feLNKA
return

feLNKB:
gui,submit,nohide
gosub,%FETYP%feLNKB
return

feCHKD:
gui,submit,nohide
gosub,%FETYP%feCHKD
return

feCHKE:
gui,submit,nohide
gosub,%FETYP%feCHKE
return

feCHKF:
gui,submit,nohide
gosub,%FETYP%feCHKF
return

feCHKG:
gui,submit,nohide
gosub,%FETYP%feCHKG
return

feCHKH:
gui,submit,nohide
gosub,%FETYP%feCHKH
return

feCHKI:
gui,submit,nohide
gosub,%FETYP%feCHKI
return

feCHKJ:
gui,submit,nohide
gosub,%FETYP%feCHKJ
return

feCHKK:
gui,submit,nohide
gosub,%FETYP%feCHKK
return

feCHKL:
gui,submit,nohide
gosub,%FETYP%feCHKL
return

feCHKM:
gui,submit,nohide
gosub,%FETYP%feCHKM
return

feCHKN:
gui,submit,nohide
gosub,%FETYP%feCHKN
return

feCHKO:
gui,submit,nohide
gosub,%FETYP%feCHKO
return

feCHKP:
gui,submit,nohide
gosub,%FETYP%feCHKP
return

feCHKQ:
gui,submit,nohide
gosub,%FETYP%feCHKQ
return

feCHKA:
gui,submit,nohide
gosub,%FETYP%feCHKA
return

feCHKB:
gui,submit,nohide
gosub,%FETYP%feCHKB
return

feCHKC:
gui,submit,nohide
gosub,%FETYP%feCHKC
return

feCBXE:
gui,submit,nohide
gosub,%FETYP%feCBXE
return

feCBXF:
gui,submit,nohide
gosub,%FETYP%feCBXF
return

feCBXG:
gui,submit,nohide
gosub,%FETYP%feCBXG
return

feCBXH:
gui,submit,nohide
gosub,%FETYP%feCBXH
return

feCBXI:
gui,submit,nohide
gosub,%FETYP%feCBXI
return

feCBXJ:
gui,submit,nohide
gosub,%FETYP%feCBXJ
return

feCBXA:
gui,submit,nohide
gosub,%FETYP%feCBXA
return

feCBXB:
gui,submit,nohide
gosub,%FETYP%feCBXB
return

feCBXC:
gui,submit,nohide
gosub,%FETYP%feCBXC
return

feCBXD:
gui,submit,nohide
gosub,%FETYP%feCBXD
return

feDDLE:
gui,submit,nohide
gosub,%FETYP%feDDLE
return

feDDLF:
gui,submit,nohide
gosub,%FETYP%feDDLF
return

feDDLG:
gui,submit,nohide
gosub,%FETYP%feDDLG
return

feDDLH:
gui,submit,nohide
gosub,%FETYP%feDDLH
return

feDDLI:
gui,submit,nohide
gosub,%FETYP%feDDLI
return

feDDLJ:
if (feddlj <> "")
	{
		vndlj= %feDDLJ%		
	}
	else {
		vndlj= Media
	}
gui,submit,nohide
fetog= Hide
fromcfg=
guicontrolget,FETYP,,feDDLJ
gosub, FEUNPOP
gosub, %FETYP%TOGGLE
return

feDDLC:
gui,submit,nohide
gosub,%FETYP%feDDLC
return

feDDLD:
gui,submit,nohide
gosub,%FETYP%feDDLD
return

feDDLA:
gui,submit,nohide
gosub,%FETYP%feDDLA
return

feDDLB:
gui,submit,nohide
gosub,%FETYP%feDDLB
return

feEDTA:
gui,submit,nohide
gosub,%FETYP%feEDTA
return

feEDTB:
gui,submit,nohide
gosub,%FETYP%feEDTB
return

feEDTC:
gui,submit,nohide
gosub,%FETYP%feEDTC
return

feEDTD:
gui,submit,nohide
gosub,%FETYP%feEDTD
return

feEDTE:
gui,submit,nohide
gosub,%FETYP%feEDTE
return

feEDTF:
gui,submit,nohide
gosub,%FETYP%feEDTF
return

feEDTG:
gui,submit,nohide
gosub,%FETYP%feEDTG
return

feUPDA:
gui,submit,nohide
gosub,%FETYP%feUPDA
return

feEDTH:
gui,submit,nohide
gosub,%FETYP%feEDTH
return

feEDTI:
gui,submit,nohide
gosub,%FETYP%feEDTI
return

feUPDB:
gui,submit,nohide
gosub,%FETYP%feUPDB
return

feUPDC:
gui,submit,nohide
gosub,%FETYP%feUPDC
return

feLBXA:
gui,submit,nohide
gosub,%FETYP%feLBXA
return

feLBXB:
gui,submit,nohide
gosub,%FETYP%feLBXB
return

feLVA:
gui,submit,nohide
gosub,%FETYP%feLVA
return

feLVB:
gui,submit,nohide
gosub,%FETYP%feLVB
return

feLVC:
gui,submit,nohide
gosub,%FETYP%feLVC
return

feRad5B:
gui,submit,nohide
gosub,%FETYP%feRad5B
return

feRad5C:
gui,submit,nohide
gosub,%FETYP%feRad5C
return

feRad4A:
gui,submit,nohide
gosub,%FETYP%feRad4A
return

feRad4B:
gui,submit,nohide
gosub,%FETYP%feRad4B
return

feRad5A:
gui,submit,nohide
gosub,%FETYP%feRad5A
return

feRad6A:
gui,submit,nohide
gosub,%FETYP%feRad6A
return

feRad6B:
gui,submit,nohide
gosub,%FETYP%feRad6B
return

feRad6C:
gui,submit,nohide
gosub,%FETYP%feRad6C
return

feRad6D:
gui,submit,nohide
gosub,%FETYP%feRad6D
return

feRad7A:
gui,submit,nohide
gosub,%FETYP%feRad7A
return

feRad7B:
gui,submit,nohide
gosub,%FETYP%feRad7B
return

feRad8A:
gui,submit,nohide
gosub,%FETYP%feRad8A
return

feRad8B:
gui,submit,nohide
gosub,%FETYP%feRad8B
return

feRad9A:
gui,submit,nohide
gosub,%FETYP%feRad9A
return

feRad9B:
gui,submit,nohide
gosub,%FETYP%feRad9B
return

feRad9C:
gui,submit,nohide
gosub,%FETYP%feRad9C
return

feRad10A:
gui,submit,nohide
gosub,%FETYP%feRad10A
return

feRad10B:
gui,submit,nohide
gosub,%FETYP%feRad10B
return

feRad11A:
gui,submit,nohide
gosub,%FETYP%feRad11A
return

feRad11B:
gui,submit,nohide
gosub,%FETYP%feRad11B
return

feRad2A:
gui,submit,nohide
gosub,%FETYP%feRad2A
return

feRad2B:
gui,submit,nohide
gosub,%FETYP%feRad2B
return

feRad2C:
gui,submit,nohide
gosub,%FETYP%feRad2C
return

feRad1A:
gui,submit,nohide
gosub,%FETYP%feRad1A
return

feRad3A:
gui,submit,nohide
gosub,%FETYP%feRad3A
return

feRad3B:
gui,submit,nohide
gosub,%FETYP%feRad3B
return

feRad3C:
gui,submit,nohide
gosub,%FETYP%feRad3C
return

feRad3D:
gui,submit,nohide
gosub,%FETYP%feRad3D
return

feRad1B:
gui,submit,nohide
gosub,%FETYP%feRad1B
return

feSLDA:
gui,submit,nohide
gosub,%FETYP%feSLDA
return

feSLDB:
gui,submit,nohide
gosub,%FETYP%feSLDB
return

feSLDC:
gui,submit,nohide
gosub,%FETYP%feSLDC
return

feSLDD:
gui,submit,nohide
gosub,%FETYP%feSLDD
return

feSLDE:
gui,submit,nohide
gosub,%FETYP%feSLDE
return

FEUNPOP:
Loop,Parse,FEGUIITEMS,|
	{
		guicontrol,%fetog%,%A_LoopField%
	}
guicontrol,-number, feEDTC
return

FEOPTPOP:
fetog= hide
gosub, FEUNPOP
return

HyperspinToggle:
MediaBrowserToggle:
SteamToggle:
CairoFEToggle:
Kodi_ALToggle:
Kodi_RCBToggle:
Kodi_IAGLToggle:
return

retroArchBUTJ:
gui,submit,nohide
return

RJLSTV:
gui,submit,nohide
if (A_GuiEvent = RightClick)
	{
		return
	}
if A_GuiEvent = DoubleClick
	{
		LV_Modify(A_EventInfo, "Vis")
		LV_GetText(curselx, A_EventInfo)  ; Get the text from the row's first field.
		sb_settext("current selection is " curselx "")
	}
if (ErrorLevel == "C")
		{
			curselx=
			LV_Modify(A_EventInfo, "+Select")
			LV_GetNext(A_EventInfo, Focused)
			LV_GetText(curtxt, A_EventInfo)
			stringreplace,RJSYSDD_TDB,RJSYSDD_TDB,%curtxt%|0,%curtxt%|1,All
		}
    Else if	(ErrorLevel == "c")
       {
			curselx=
			LV_Modify(A_EventInfo, "+Select")
			LV_GetNext(A_EventInfo, Focused)
			LV_GetText(curtxt, A_EventInfo)
			stringreplace,RJSYSDD_TDB,RJSYSDD_TDB,%curtxt%|1,%curtxt%|0,All
	   }
if (curselx <> "")
	{
		curslen=
		Loop, Parse, curselx,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				curslen+=1
				if (curslen > 1)
					{
						return
					}
			}
	}
If (A_GuiEvent == "F") {
   If (RJRN1["Changed"]) {
	  Msg := ""
	  For I, O In RJRN1.Changed
		 Msg .= "Row " . O.Row . " - Column " . O.Col . " : " . O.Txt
	  RJRN1.Remove("Changed")
	  SB_SetText("changed " curselx " to " O.Txt "")
	  fifi := O.txt
	ifnotinstring,curselx,:
		{
		  sanm:= fifi
		  gosub, sanitizeN
		  fifi:= sanm
		  FileMove,%RJSYSTEMS%\%oldtxt%,%RJSYSTEMS%\%fifi%,1
		  gosub, RJRFRSHLST
		}
	ifinstring,curselx,:
		{
		  stringreplace,rnmdir,fifi,:,,All
		  sanm:= fifi
		  gosub, sanitizeN
		  fifi:= sanm
		  stringreplace,oldtxt,curselx,:,,All
		  FileMoveDir,%RJSYSTEMS%\%RJSYSDD%\%oldtxt%,%RJSYSTEMS%\%RJSYSDD%\%rnmdir%,1
		  gosub, RJRFRSHLST
		}
	  }
}
return

RJButA:
gui,submit,nohide
return

RJDELCOMP:
gui,submit,nohide
Gui,ListView,RJLSTV
QItems=
QItems:= LVGetCheckedItems("", "ahk_id" . RJLV)
guicontrolget,CDELNCH,,RJCHKL
guicontrolget,CDELCFG,,RJCHKM
guicontrolget,CDELJOY,,RJCHKP
guicontrolget,CDELLOG,,RJCHKH
guicontrolget,CDELEMU,,RJCHKI
if (CDELNCH + CDELCFG + CDELJOY + CDELLOG + CDELEMU= 0)
	{
		SB_SetText("You must select components to delete")	
		return
	}
Msgbox,3,Delete Confirmation,Are you sure you wish to delete these components from the selected Folders?
	ifMsgBox,Yes
		{
			FileDelete,rj\%RJSYSDD%_todel.tdb
			Loop, Parse, QItems,`n`r
				{
					qarray1=
					qarray2=
					fldrz1=
					fldrz2=
					stringsplit,qarray,A_LoopField,|
					stringsplit,fldrz,qarray1,:
					if (fldrz2 = "")
						{
							continue
						}
					FileAppend, %fldrz2%`n,rj\%RJSYSDD%_todel.tdb
				}
	fileread,todel,rj\%RJSYSDD%_todel.tdb			
	Loop, parse,todel,`n`r
		{
			if (A_LoopField = "")
				{
					continue
				}
			if (CDELNCH = 1)
				{
					FileDelete, %RJSYSTEMS%\%RJSYSDD%\%A_LoopField%\*.bat
				}
			if (CDELCFG = 1)
				{
					FileDelete, %RJSYSTEMS%\%RJSYSDD%\%A_LoopField%\*.ini
					FileDelete, %RJSYSTEMS%\%RJSYSDD%\%A_LoopField%\*.cfg
					FileDelete, %RJSYSTEMS%\%RJSYSDD%\%A_LoopField%\*.config
					FileDelete, %RJSYSTEMS%\%RJSYSDD%\%A_LoopField%\*.cfg
					FileDelete, %RJSYSTEMS%\%RJSYSDD%\%A_LoopField%\*.xml
					FileDelete, %RJSYSTEMS%\%RJSYSDD%\%A_LoopField%\*.conf
				}
			if (CDELJOY = 1)
				{
					FileDelete, %RJSYSTEMS%\%RJSYSDD%\%A_LoopField%\*.xpadderprofile
					FileDelete, %RJSYSTEMS%\%RJSYSDD%\%A_LoopField%\*.amgp
				}
			if (CDELLOG = 1)
				{
					FileDelete, %RJSYSTEMS%\%RJSYSDD%\%A_LoopField%\*.log
				}
			todelsys= %A_LoopField%
			if (CDELEMU = 1)
				{
					fin= 
					guicontrolget,curslmu,,RJEMUPRECFG
					iniread,fin,emuCfgPresets.ini,%RJSYSDD%,SUPEMU
					if ((fin <> "")&&(fin <> "ERROR"))
					   {
							fin.= "|ERROR|"
							ifnotinstring,fin,%curslmu%|
								{
									fin.= curslmu . "|"
								}
           					Loop,parse,fin,|
							   {
        							if (A_LoopField = "")
										{
											continue
										}
									SB_SetText("Removing " A_LoopField " Directory")
									FileRemoveDir, %RJSYSTEMS%\%RJSYSDD%\%todelsys%\%A_LoopField%,1
								}
					   }
				}
		}
	Del:= 0
	Loop, %RJSYSTEMS%\%RJSYSDD%\*, 2, 1
		{
			FL .= ((FL<>"") ? "`n" : "" ) A_LoopFileFullPath
		}
	Sort, FL, R D`n ; Arrange folder-paths inside-out
	Loop, Parse, FL, `n
		{
		  FileRemoveDir, %A_LoopField% ; Do not remove the folder unless is  empty
		  If ! ErrorLevel
			   Del := Del+1,  RFL .= ((RFL<>"") ? "`n" : "" ) A_LoopField
		}		
			Msgbox,0,Complete,Files have been deleted,5
        	SB_SetText(" Complete.  Refresh the system to observe changed directories. ")
		}
guicontrol,,RJCHKL,0
guicontrol,,RJCHKH,0
guicontrol,,RJCHKM,0
guicontrol,,RJCHKP,0
guicontrol,,RJCHKI,0
guicontrol,disable,RJDELCOMP
return

RJRad11A:
gui,submit,nohide
guicontrol,hide,RJEDTO
guicontrol,show,RJCBXH
guicontrol,hide,RJBUTG
guicontrol,hide,RJDDLP
guicontrol,show,RJBUTO
guicontrolget,PRPS,,RJDDLF
CMDRO= RJPREOPT
CMDRT= RJPRERUN
CMDRS= RJPREW
optk=
optn=
ADDAK=
RJCBXH=
if (PRPS = "Post-Command")
	{
		CMDRO= RJPOSTOPT
		CMDRT= RJPOSTRUN
		CMDRS= RJPOSTW
	}
edtmode=
guicontrol,disable,RJBUTO
IniRead, ADDFN,rj\cur.ini,%RJSYSDD%,%CMDRT%
IniRead, RJSTV,rj\cur.ini,%RJSYSDD%,%CMDRS%
IniRead, RJOPV,rj\cur.ini,%RJSYSDD%,%CMDRO%
guicontrol,,RJCBXH,|%ADDFN% |
guicontrol,,RJDDLP,|%ADDFN% |
guicontrol,,RJCHKW,0
guicontrol,,RJEDTO,
return

RJRad11B:
gui,submit,nohide
guicontrol,hide,RJBUTO
guicontrol,hide,RJCBXH
guicontrol,show,RJDDLP
guicontrol,show,RJBUTG
guicontrol,show,RJEDTO
CMDRO= RJPREOPT
CMDRT= RJPRERUN
CMDRS= RJPREW
optk=
optn=
ADDAK=
RJDDLP=
if (PRPS = "Post-Command")
	{
		CMDRO= RJPOSTOPT
		CMDRT= RJPOSTRUN
		CMDRS= RJPOSTW
	}
IniRead, ADDFN,rj\cur.ini,%RJSYSDD%,%CMDRT%
IniRead, RJSTV,rj\cur.ini,%RJSYSDD%,%CMDRS%
IniRead, RJOPV,rj\cur.ini,%RJSYSDD%,%CMDRO%
guicontrol,,RJCBXH,|%ADDFN% |
guicontrol,,RJDDLP,|%ADDFN% |
guicontrol,,RJCHKW,0
guicontrol,,RJEDTO,
return

RJEDTO:
gui,submit,nohide
guicontrolget,RJEDTO,,RJEDTO
guicontrolget,RJDDLP,,RJDDLP
nvar1=
nvar2=
stringsplit,nvar,RJDDLP,>
optnew= %nvar2%
IniRead, RJOPV,rj\cur.ini,%RJSYSDD%,%CMDRO%
RJEDTW=
if (optn = "")
	{
		return
	}
if (RJEDTO = "")
	{
		RJEDTO= :
	}
opvn=
Loop, Parse, RJOPV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		opvn+=1
		if (opvn = optnew)
			{
				opvn+=1
				RJEDTW.= RJEDTO . "|"
				continue
			}
		RJEDTW.= A_LoopField . "|"
	}
if (RJOPV = "")
	{
		RJEDTW= %RJEDTO%
	}
iniwrite, %RJEDTW%,rj\cur.ini,%RJSYSDD%,%CMDRO%
RJOPV= %RJEDTW%
return

RJCHKW:
gui,submit,nohide
IniRead, RJSTV,rj\cur.ini,%RJSYSDD%,%CMDRS%
guicontrolget,RJCHKW,,RJCHKW
guicontrolget,RJDDLP,,RJDDLP
nvar1=
nvar2=
stringsplit,nvar,RJDDLP,>
optn= %nvar2%
avar=
apndtyp=
Loop, Parse, RJSTV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		avar+=1
		if (avar = optn)
			{
				avar+=1
				apndtyp.= RJCHKW . "|"
				continue
			}
		apndtyp.= A_LoopField . "|"
	}
if (apndtyp = "")
	{
		apndtyp= %RJCHKW%
	}
IniWrite, %apndtyp%,rj\cur.ini,%RJSYSDD%,%CMDRS%
RJSTV= %apndtyp%
return

RJBUTV:
gui,submit,nohide
if (RJRAD11A = 1)
	{
		guicontrol,enable,RJBUTO
		guicontrolget,RJCBXH,,RJCBXH
		nvar1=
		nvar2=
		stringsplit,nvar,RJCBXH,>
		if (nvar2 <> "")
			{
				edtmode= 2
				optn:= nvar2
				guicontrol,enable,RJBUTO
			}
		return
	}
guicontrolget,RJDDLP,,RJDDLP
if (RJDDLP = "")
	{
		SB_SetText("No command currently selected")
		return
	}
ADDTMP=
FileSelectFIle,ADDTMP,1,,Select An executable or script
if (ADDTMP = "")
	{
		return
	}
nvar1=
nvar2=
stringsplit,nvar,RJDDLP,>
stringreplace, ADDFN,ADDFN,%RJDDLP%,%ADDTMP%>%nvar2%,All
RJDDLP= %ADDTMP%>%nvar2%
guicontrol,,RJDDLP,|%RJDDLP%||%ADDFN%
return

RJBUTG:
gui,submit,nohide
ADDFT=
ADDAK=
prepnd=
FileSelectFile,ADDFT,1,,Select An executable or script
if (ADDFT = "")
	{
		return
	}
IniRead, RJOPV,rj\cur.ini,%RJSYSDD%,%CMDRO%
IniRead, ADDFN,rj\cur.ini,%RJSYSDD%,%CMDRT%
IniRead, RJSTV,rj\cur.ini,%RJSYSDD%,%CMDRS%
guicontrolget,RJDDLP,,RJDDLP
nvar1=
nvar2=
stringsplit,nvar,RJDDLP,>
optn= %nvar2%
if (nvar2 = "")
	{
		optn=
		NEWFN=
		if (ADDFN <> "")
			{
				cnttot= 100
				cntdwn= 99
				curadd= 1
				Loop, 99
					{
						cnttot-=1
						cntdwn-=1
						stringreplace,ADDFN,ADDFN,>%cntdwn%,>%cnttot%,All
					}
				NEWFN.= ADDFT . ">" . "1" . "|" . ADDFN
				ADDAK= %NEWFN%
				prepnd= 1
			}
	}
if (prepnd = 1)
	{
		goto, popprepost
	}
adnm=
curadd=
Loop, Parse, ADDFN,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		nvar1=
		nvar2=
		stringsplit,nvar,A_LoopField,>
		adnm+=1
		if (adnm = optn)
			{
				curadd:= adnm+1
				ADDAK.= nvar1 . ">" . adnm . "|" . ADDFT . ">" . curadd . "|"
				adnm+=1
				continue
			}
		ADDAK.= nvar1 . ">" . adnm . "|"
	}
if (adnm = "")
	{
		IniWrite,%ADDFT%>1,rj\cur.ini,%RJSYSDD%,%CMDRT%
		IniWrite,:,rj\cur.ini,%RJSYSDD%,%CMDRO%
		IniWrite,%RJCHKW%,rj\cur.ini,%RJSYSDD%,%CMDRS%
		guicontrol,,RJEDTO,
		guicontrol,,RJCBXH,|%ADDFT%>1|| |
		guicontrol,,RJDDLP,|%ADDFT%>1|| |
		optn= 1
		return
	}
if (optn = "")
	{
		ADDAK= %ADDFT%>1
	}
popprepost:
guicontrol,,RJEDTO,
guicontrol,,RJCHKW,0
Sort,ADDAK,N D>
guicontrol,,RJCBXH,|%ADDFT%>%curadd%||%ADDAK% |
guicontrol,,RJDDLP,|%ADDFT%>%curadd%||%ADDAK% |
IniWrite, %ADDAK%,rj\cur.ini,%RJSYSDD%,%CMDRT%
opvn=
curovn=
RJEDTNX=
if (optn = "")
	{
		RJEDTNX.= ":" . "|" . RJOPV
	}
if (optn <> "")
	{
		Loop, Parse, RJOPV,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				opvn+=1
				if (opvn = optn)
					{
						opvn+=1
						curovn:= opvn
						RJEDTNX.= A_LoopField . "|" . ":" . "|"
						continue
					}
				RJEDTNX.= A_LoopField . "|"
			}
	}
RJOPV= %RJEDTNX%
IniWrite, %RJEDTNX%,rj\cur.ini,%RJSYSDD%,%CMDRO%
RJSTX=
opvn=
if (optn = "")
	{
		RJSTX.= RJCHKW
	}
if (optn <> "")
	{
		Loop, Parse, RJSTV,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				opvn+=1
				if (opvn = optn)
					{
						opvn+=1
						RJSTX.= A_LoopField . "|" . "0" . "|"
						continue
					}
				RJSTX.= A_LoopField . "|"
			}
	}
IniWrite, %RJSTX%,rj\cur.ini,%RJSYSDD%,%CMDRS%
return

RJCBXH:
gui,submit,nohide
ADDFT=
optn=
IniRead, RJOPV,rj\cur.ini,%RJSYSDD%,%CMDRO%
IniRead, ADDFN,rj\cur.ini,%RJSYSDD%,%CMDRT%
IniRead, RJSTV,rj\cur.ini,%RJSYSDD%,%CMDRS%
guicontrol,disable,RJBUTO
guicontrolget,RJCBXH,,RJCBXH
edtmode= 1
nvar1=
nvar2=
stringsplit,nvar,RJCBXH,>
optn:= nvar2
ORIGX:= nvar1
if (nvar2 <> "")
	{
		optnx= %nvar2%
		guicontrol,,RJDDLP,|%nvar1%>%nvar2%||%ADDFN%| |
		guicontrol,,RJCBXH,|%ORIGX%>%nvar2%||%ADDFN%| |
	}
Loop, Parse, ADDFN,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		nvar1=
		nvar2=
		stringsplit,nvar,A_LoopField,>
		if (optn = nvar2)
			{
				ADDFT= %nvar1%
			}
	}
opto=
RJOPV=
Loop, Parse, RJOPV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		opto+=1
		if (opto = optn)
			{
				RJEDTO= %A_LoopField%
				SNDEDTO= %RJEDTO%
				if (SNDEDTO = ":")
					{
						SNDEDTO=
					}
				guicontrol,,RJEDTO,%SNDEDTO%
			}
	}
optv=
Loop, Parse, RJSTV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		optv+=1
		if (optv = optn)
			{
				guicontrol,,RJCHKW,%A_LoopField%
				break
			}
	}
if (nvar2 <> "")
	{
		guicontrol,disable,RJBUTO
	}
if (edtmode = "")
	{
		guicontrol,,RJCBX,|%ORIGX%>%optn%||%ADDFN%| |
		return
	}
if (edtmode = 2)
	{
		RJCBXX=
		guicontrolget,RJCBXX,,RJCBXH
		stringreplace,ADDFN,ADDFN,%RJCBXH%,%RJCBXX%,All
		guicontrol,disable,RJBUTO
		return
	}
guicontrol,enable,RJBUTO
ADDFT= %RJCBXH%
return

RJBUTO:
if (edtmode = 2)
	{
		IniWrite, %ADDFN%,rj\cur.ini,%RJSYSDD%,%CMDRT%
		return
	}
gui,submit,nohide
ADDAK=
prepnd=
optn= %optnx%
if (ADDFT = "")
	{
		guicontrol,disable,RJBUTO
		SB_SetText("Cannot add an empty command.  Use the delete button to delete a command.")
		return
	}
if (optnx = "")
	{
		optn=
		NEWFN=
		if (ADDFN <> "")
			{
				cnttot= 100
				cntdwn= 99
				curadd= 1
				Loop, 99
					{
						cnttot-=1
						cntdwn-=1
						stringreplace,ADDFN,ADDFN,>%cntdwn%,>%cnttot%,All
					}
				NEWFN.= ADDFT . ">" . "1" . "|" . ADDFN
				ADDAK= %NEWFN%
				prepnd= 1
			}
	}
if (prepnd = 1)
	{
		goto, CSTMPPADD
	}
adnm=
curadd=
Loop, Parse, ADDFN,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		nvar1=
		nvar2=
		stringsplit,nvar,A_LoopField,>
		adnm+=1
		if (adnm = optn)
			{
				curadd:= adnm+1
				ADDAK.= nvar1 . ">" . adnm . "|" . ADDFT . ">" . curadd . "|"
				adnm+=1
				continue
			}
		ADDAK.= nvar1 . ">" . adnm . "|"
	}
if (adnm = "")
	{
		IniWrite,%ADDFT%>1,rj\cur.ini,%RJSYSDD%,%CMDRT%
		IniWrite,:,rj\cur.ini,%RJSYSDD%,%CMDRO%
		IniWrite,%RJCHKW%,rj\cur.ini,%RJSYSDD%,%CMDRS%
		guicontrol,,RJEDTO,
		guicontrol,,RJCBXH,|%ADDFT%>1|| |
		guicontrol,,RJDDLP,|%ADDFT%>1|| |
		optn= 1
		return
	}
if (optn = "")
	{
		ADDAK= %ADDFT%>1
	}
CSTMPPADD:
guicontrol,,RJEDTO,
guicontrol,,RJCHKW,0
Sort,ADDAK,N D>
guicontrol,,RJCBXH,|%ADDFT%>%curadd%||%ADDAK% |
guicontrol,,RJDDLP,|%ADDFT%>%curadd%||%ADDAK% |
IniWrite, %ADDAK%,rj\cur.ini,%RJSYSDD%,%CMDRT%
opvn=
curovn=
RJEDTNX=
if (optn = "")
	{
		RJEDTNX.= ":" . "|" . RJOPV
	}
if (optn <> "")
	{
		Loop, Parse, RJOPV,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				opvn+=1
				if (opvn = optn)
					{
						opvn+=1
						curovn:= opvn
						RJEDTNX.= A_LoopField . "|" . ":" . "|"
						continue
					}
				RJEDTNX.= A_LoopField . "|"
			}
	}
RJOPV= %RJEDTNX%
IniWrite, %RJEDTNX%,rj\cur.ini,%RJSYSDD%,%CMDRO%
RJSTX=
opvn=
if (optn = "")
	{
		RJSTX.= RJCHKW
	}
if (optn <> "")
	{
		Loop, Parse, RJSTV,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				opvn+=1
				if (opvn = optn)
					{
						opvn+=1
						RJSTX.= A_LoopField . "|" . "0" . "|"
						continue
					}
				RJSTX.= A_LoopField . "|"
			}
	}
IniWrite, %RJSTX%,rj\cur.ini,%RJSYSDD%,%CMDRS%
return

RJDDLP:
gui,submit,nohide
IniRead,RJSTV,rj\cur.ini,%RJSYSDD%,%CMDRS%
IniRead,RJOPV,rj\cur.ini,%RJSYSDD%,%CMDRO%
guicontrol,,RJEDTO,
guicontrolget,RJDDLP,,RJDDLP
ADDFT=
ADDAK=
optn=
optk=
nvar1=
nvar2=
stringsplit,nvar,RJDDLP,>
optn= %nvar2%
Loop, Parse, ADDFN,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		optk+=1
	}
opto=
RJOPV=
Loop, Parse, RJOPV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		opto+=1
		if (opto = optn)
			{
				RJEDTO= %A_LoopField%
				SNDEDTO= %RJEDTO%
				if (SNDEDTO = ":")
					{
						SNDEDTO=
					}
				guicontrol,,RJEDTO,%SNDEDTO%
			}
	}
optv=
Loop, Parse, RJSTV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		optv+=1
		if (optv = optn)
			{
				guicontrol,,RJCHKW,%A_LoopField%
				break
			}
	}
return

RJSYSSAVAS:
gui,submit,nohide
CURINI=
FileSelectFile,CURINI,S3,rj\%RJSYSDD%.ini,Select the %RJSYSDD% preset,*.ini
if (CURINI = "")
	{
		return
	}
FileCopy, rj\cur.ini,%CURINI%,1
guicontrol,,RJSYSRADC,1
return

RJSYSLOAD:
gui,submit,nohide
CURINI=
FileSelectFile,CURINI,19,rj\%RJSYSDD%.ini,Select the %RJSYSDD% preset,*.ini
if (CURINI = "")
	{
		return
	}
FileCopy, %CURINI%, rj\cur.ini,1
guicontrol,,RJSYSRADC,1
return

RJSYSSAV:
gui,submit,nohide
FileCopy, rj\cur.ini,rj\%RJSYSDD%.ini,1
guicontrol,,RJSYSRADC,1
return

RJRFRSHLST:
gui,submit,nohide
FileDelete,rj\%RJSYSDD%*.tdb
gui,listview,RJLSTV
LV_Delete()
guicontrol,,RJLSTYP,|Jackets+ROMs||Jackets ONLY|ROMs ONLY|All Files
guicontrol,,RJEDTDN
guicontrol,,RJEDTBN
guicontrol,,RJEDTD
guicontrol,,RJEDTB
guicontrol,hide,RJTXTH
guicontrol,hide,RJEDTDN
guicontrol,hide,RJEDTBN
guicontrol,hide,RJEDTD
guicontrol,hide,RJEDTB
guicontrol,,RJFNDINLST,Find
guicontrol,,RJINCEXCL,|All||A-Z|#
gosub,RJSYSDD
return

RJMAP1ROFTYP:
if (rjaval2 = 0)
	{
		guicontrol,,RJMAP1ROFTYPA,1
	}
if (rjaval2 = 1)
	{
		guicontrol,,RJMAP1ROFTYPB,1
	}
if (rjaval2 = 2)
	{
		guicontrol,,RJMAP1ROFTYPC,1
	}
return

RJMAP2ROFTYP:
if (rjaval2 = 0)
	{
		guicontrol,,RJMAP2ROFTYPA,1
	}
if (rjaval2 = 1)
	{
		guicontrol,,RJMAP2ROFTYPB,1
	}
if (rjaval2 = 2)
	{
		guicontrol,,RJMAP2ROFTYPC,1
	}
return

EMUNAMEPOP:
GuiControl, Choose, TABMENU, 2
guicontrol,,LCORE,|%RJEMUTG%||
EMUSN= %RJEMUTG%
svgbrnv=
return

RJBUTH:
ADDFW=
ADDFK=
ADDFO=
prepnd=
guicontrolget,GETFRM,,RJCBXH
if (RJRAD11B = 1)
	{
		guicontrolget,GETFRM,,RJDDLP
	}
IniRead, RJOPV,rj\cur.ini,%RJSYSDD%,%CMDRO%
IniRead, ADDFN,rj\cur.ini,%RJSYSDD%,%CMDRT%
IniRead, RJSTV,rj\cur.ini,%RJSYSDD%,%CMDRS%
if (GETFRM = "")
	{
		SB_SetText("No command selected")
		return
	}
nvar1=
nvar2=
stringsplit,nvar,GETFRM,>
optn= %nvar2%
if (nvar2 = "")
	{
		return
	}
newnm=
Loop, Parse, ADDFN,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		nvar1=
		nvar2=
		stringsplit,nvar,A_LoopField,>
		if (nvar2 = optn)
			{
				continue
			}
		newnm+=1
		ADDFK.= nvar1 . ">" . newnm . "|"
	}
newnm=
Loop, Parse, RJOPV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		newnm+=1
		if (newnm = optn)
			{
				continue
			}
		ADDFO.= A_LoopField . "|"
	}
newnm=
Loop, Parse, RJSTV,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		newnm+=1
		if (newnm = optn)
			{
				continue
			}
		ADDFW.= A_LoopField . "|"
	}
ADDFN= %ADDFK%
RJOPV= %ADDFO%
RJSTV= %ADDFW%
guicontrol,,RJEDTO,
guicontrol,,RJCHKW,0
guicontrol,,RJCBXH,|%ADDFN%| |
guicontrol,,RJDDLP,|%ADDFN%| |
IniWrite, %ADDFK%,rj\cur.ini,%RJSYSDD%,%CMDRT%
IniWrite, %ADDFO%,rj\cur.ini,%RJSYSDD%,%CMDRO%
IniWrite, %ADDFW%,rj\cur.ini,%RJSYSDD%,%CMDRS%
return

RJDIMGET:
gui,submit,nohide
RJDIMGOT=
FileSelectFile,RJDIMGOT,3,,Select an override for the ROM to mount at launch.,*.*
if (RJDIMGOT = "")
	{
		return
	}
ROMINLP= %RJDIMGOT%
iniwrite,%ROMINLP%,rj\cur.ini,%RJSYSDD%,ROMINLP
return

RJPROCQ:
gui,submit,nohide
FileDelete,rj\*.jak
SK_MODE= 2
Loop, rj\*_q.tdb
	{
		fldrapnd=
		curq:= A_LoopFileFullPath
		curntq:= A_LoopFileName
		SplitPath,curntq,,,,proq
		StringTrimRight,proq,proq,2
		IniRead,jakfil,rj\%proq%.ini,%proq%,RJACKET
		IniRead,condlm,rj\%proq%.ini,%proq%,RJCONSOLID
		if (condlm = "Individuate")
			{
				condlm:=
			}
		Loop, Read, %curq%
			{
				flpr1=
 				flpr2=
				StringSplit,flpr,A_LoopReadLine,:
				if (flpr2 <> "")
					{
						fldrapnd.= A_LoopReadLine . "|" . A_LoopReadLine . "`n"
						continue
					}
				if (jakfil = 1)
					{
						splitpath,A_LoopReadLine,ifilk,,,consolid
						indiv1=
						indiv2=
						stringsplit,indiv,consolid,%condlm%
						if (condlm = "")
							{
								indiv1= %consolid%
							}
						if (indiv1 = "")
							{
								indiv1= %consolid%
							}
						romcnt=
						Loop, Read, %curq%
							{
								ftmp1=
								ftmp2=
								stringsplit,ftmp,A_LoopReadLine,:
								if (ftmp2 = "")
									{
										continue
									}
								SplitPath,A_LoopReadLine,jrf,jrd,jrx,jrn
								mindiv1=
								mindiv2=
								stringsplit,mindiv,jrn,%condlm%
								if (condlm = "")
									{
										mindiv1= %jrn%
									}
								if (indiv1 = mindiv1)
									{
										romcnt+=1
									}
							}
						Loop, Read, rj\%proq%#c%romcnt%.jak
							{
								nh=
								if (indiv1 = A_LoopReadLine)
									{
										nh= 1
										continue
									}
							}
						if (nh = "")
							{
								FileAppend,%indiv1%|%ifilk%`n,rj\%proq%#c%romcnt%.jak
							}
					}
			}
		FileAppend,%fldrapnd%`n,rj\%proq%#c.jak
		FileMove,%curq%,%curq%.bak,1
		RJQNUM-= 1
	}
Loop, rj\*.jak
	{
		rjintr=
		curjk:= A_LoopFileFullPath
		FileRead, CURTDB, %curjk%
		curjt:= A_LoopFileName
		StringSplit,divrm,curjt,#
		curjf:= divrm1
		RVLKUP= %curtjf%
		gosub, SHRTNMLkUp
		%SHRTNM%CFGR=
		IniRead,CFG2PROP,rj\%curjf%.ini,%curjf%,CFG2PROP
		IniRead,RJZIPPEEK,rj\%curjf%.ini,%curjf%,RJZIPPEEK
		IniRead,emuname,rj\%curjf%.ini,%curjf%,RJEMUPRESET
		EMUSN= %emuname%
		IniRead,RJKEYOW,rj\%curjf%.ini,%curjf%,RJKEYOW
		IniRead,RJKEYMON,rj\%curjf%.ini,%curjf%,RJKEYON
		IniRead,RJMAP1ROFTYP,rj\%curjf%.ini,%curjf%,RJMAP1ROFTYP
		IniRead,RJMULTIDISC,rj\%curjf%.ini,%curjf%,RJMULTIDISC
		IniRead,RJMAP2ROFTYP,rj\%curjf%.ini,%curjf%,RJMAP2ROFTYP
		IniRead,RJMAPRET,rj\%curjf%.ini,%curjf%,RJMASTERPROF
		IniRead,RJMAP2PL,rj\%curjf%.ini,%curjf%,RJPLYR2
		IniRead,RJMAP1PL,rj\%curjf%.ini,%curjf%,RJPLYR1
		IniRead,RJROMINJ,rj\%curjf%.ini,%curjf%,RJROMINJ
		IniRead,PEREMUCFG,rj\%curjf%.ini,%curjf%,PEREMUCFG
		IniRead,RJQUOTES,rj\%curjf%.ini,%curjf%,RJQUOTES
		IniRead,RJPATH,rj\%curjf%.ini,%curjf%,RJPATH
		IniRead,RJEXT,rj\%curjf%.ini,%curjf%,RJEXT
		IniRead,RJABSOLROM,rj\%curjf%.ini,%curjf%,RJABSOLROM
		IniRead,RJEMULOC,rj\%curjf%.ini,%curjf%,RJEMULOC
		IniRead,RJKEYMAPPER,rj\%curjf%.ini,%curjf%,RJKEYMAPPER
		IniRead,RJPATH,rj\%curjf%.ini,%curjf%,RJPATH
		IniRead,RJRUNDIR,rj\%curjf%.ini,%curjf%,RJRUNDIR
		IniRead,DAEMTO,rj\%curjf%.ini,%curjf%,RJDISCMNT
		IniRead,RJPRERUN,rj\%curjf%.ini,%curjf%,RJPRERUN
		IniRead,RJPOSTRUN,rj\%curjf%.ini,%curjf%,RJPOSTRUN
		IniRead,RJPOSTOPT,rj\%curjf%.ini,%curjf%,RJPOSTOPT
		IniRead,RJPREOPT,rj\%curjf%.ini,%curjf%,RJPREOPT
		IniRead,NICEFLDR,rj\%curjf%.ini,%curjf%,NICEFLDR
		IniRead,RJEMUARGS,rj\%curjf%.ini,%curjf%,RJEMUARGS
		IniRead,RJPROPXE,rj\%curjf%.ini,%curjf%,RJPROPXE
		stringreplace,RJEMUARGS,RJEMUARGS,<,%A_Space%,All
		IniRead,RJEMUOPTS,rj\%curjf%.ini,%curjf%,RJEMUOPTS
		iniread,statetrn,emuCfgPresets.ini,%emuname%,STATEPTH
		splitpath,stattrn,,CURSTATE
		iniread,memtrn,emuCfgPresets.ini,,%emuname%,MEMPTH
		splitpath,memtrn,,CURMEM
		Loop,parse,rjemuopts,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				RJEMUOPTS= %A_LoopField%
				break
			}
		stringreplace,RJEMUOPTS,RJEMUOPTS,<,%A_Space%,All
		IniRead,RJPRECFG,rj\%curjf%.ini,%curjf%,RJPRECFG
		IniRead,RJPOSTCFG,rj\%curjf%.ini,%curjf%,RJPOSTCFG
		IniRead,RJEMUCFG,rj\%curjf%.ini,%curjf%,RJEMUCFG
		IniRead,RJEMUCFGOV,rj\%curjf%.ini,%curjf%,RJEMUCFGOV
		IniRead,RJLNCHCFGOW,rj\%curjf%.ini,%curjf%,RJLNCHCFGOW
		IniRead,RJLNCHCFG,rj\%curjf%.ini,%curjf%,RJLNCHCFG
		IniRead,RJROMSPL,rj\%curjf%.ini,%curjf%,RJROMXT
		IniRead,RJCONSOLID,rj\%curjf%.ini,%curjf%,RJCONSOLID
		IniRead,RJEXTRARC,rj\%curjf%.ini,%curjf%,RJEXTRARC
		IniRead,RJARCLOC,rj\%curjf%.ini,%curjf%,RJARCLOC
		FileCreateDir,rj\sysCfgs\%curjf%
		FileCreateDir,%cacheloc%\%curjf%
		RJROMXTINJ=
		Loop, Parse, RJROMSPL,`,
			{
				RJROMXTINJ.= """" . "*" . A_LoopField . """" . A_Space
			}
		RJROMXTINJ= %RJROMXTINJ%
		IniRead,emuloc,apps.ini,Emulators,%emuname%
		if (RJEMULOC <> 0)
			{
				emuloc= %RJEMULOC%
				nickpath= %emuloc%
			}
		SplitPath,emuloc,emuxe,emulocd,emulocx,emulocn
		if (emulocn = "retroarch")
			{
				rjcorea= mame_libretro.dll
				iniread,rjcoreas,emuCfgPresets.ini,%curjf%,SUPCORE
				Loop,Parse,rjcoreas,|
					{
						ifexist,%raexedir%\cores\%A_LoopField%
							{
								rjcorea= %A_LoopField%
								break
							}
					}
				stringreplace,RJEMUOPTS,RJEMUOPTS,[libretrodirectory],%raexedir%\cores,All
				stringreplace,RJEMUOPTS,RJEMUOPTS,[core],%rjcorea%,All			
			}
		FileRead, toapa,sets\rjcmd_header.set
		FileRead, toapb,sets\rjcmd_prejoy.set
		FileRead, toapc,sets\rjcmd_runloop.set
		FileRead, toapd,sets\rjcmd_runproc.set
		FileRead, toape,sets\rjcmd_postjoy.set
		if (RJPROPXE = 0)
			{
				StringReplace, toapa,toapa,[EMUL],%emulocd%,All
				StringReplace, toapa,toapa,[EMUZ],%emuxe%,All
			}
		StringReplace, toapa,toapa,[AMC],%AMCK%,All
		StringReplace, toapa,toapa,[XPD],%XPDK%,All
		If (RJKEYMON = 0)
			{
				stringReplace, toapa,toapa,[JOYENB],REM%A_Space%,All
			}
		if (RJKEYMAPPER = "Antimicro")
				{
					StringReplace, toapa,toapa,[XPALT],1,All
				}
		if (RJRUNDIR = 1)
			{
				StringReplace, toapc,toapc,[FRLOC],,All
				StringReplace, toapa,toapa,[FRLOC],,All
			}
		StringSplit,RJMAPRET,RJPMAPTR,RJMAPTD,,RJMAPTN
		StringSplit,RJMAP1PL,RJMAP1PLF,RJMAP1PLD
		StringReplace,toapa,toapa,[PLAYER1],%RJMAP1PLF%,All
		SplitPath,RJMAP1PL,rjmp1fn,rjmp1dn,rjmp1xn,rjmp1no
		RJMP1LC=
		if (rjmp1dn = "")
			{
				RJMP1LC= 1
			}
		StringSplit,RJMAP2PL,RJMAP2PLF,RJMAP2PLD
		StringReplace,toapa,toapa,[PLAYER2],%RJMAP2PLF%,All
		SplitPath,RJMAP2PL,rjmp2fn,rjmp2dn,rjmp2xn,rjmp2no
		RJMP2LC=
		if (rjmp2dn = "")
			{
				RJMP2LC= 1
			}
		StringReplace,toapa,toapa,[MediaCenter],%RJMAPTN%,All
		if (RJMAP1PLD = "")
			{
				RJMAP1PLD= `%GAMDIR`%
			}
		StringReplace,toapb,toapb,[APL1LOC],%RJMAP1PLD%,All
		StringReplace,toapb,toapb,[XPL1LOC],%RJMAP1PLD%,All
		if (RJMAP2PLD = "")
			{
				RJMAP2PLD= `%GAMDIR`%
			}
		StringReplace,toapb,toapb,[APL2LOC],%RJMAP2PLD%,All
		StringReplace,toapb,toapb,[XPL2LOC],%RJMAP2PLD%,All
		rprn=
		avvr=
		preruni=
		Loop, Parse, RJPRERUN,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				ikiv1=
				ikiv2=
				stringsplit,ikiv,A_LoopField,>
				stringreplace,avvr,ikiv1,[ROMPATH],`%GAMDIR`%,All
				stringreplace,avvr,avvr,[ROM],`%ROM`%,All
				stringreplace,avvr,avvr,[ROMF],`%ROMF`%,All
				stringreplace,avvr,avvr,[EMUL],`%EMUL`%,All
				stringreplace,avvr,avvr,[EMUZ],`%EMUZ`%,All
				rprn+=1
				rprw=
				STRTYP:= `%LAUNCH`%
				Loop, Parse, RJPREW,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						rprw+=1
						if (rprw = rprn)
							{
								if (A_LoopField = 0)
									{
										STRTYP:= `%LSTART`%
									}
							}
					}
				preruni.= STRTYP . A_Space . """" . avvr . """"
				rjpro=
				Loop, Parse, RJPREOPT,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						rjpro+=1
						if (rjpro = rprn)
							{
								if (A_LoopField = ":")
									{
										preruni.= "`n"
										continue
									}
								stringreplace,avvr,A_LoopField,[ROMPATH],`%GAMDIR`%,All
								stringreplace,avvr,avvr,[ROM],`%ROM`%,All
								stringreplace,avvr,avvr,[ROMF],`%ROMF`%,All
								stringreplace,avvr,avvr,[EMUL],`%EMUL`%,All
								stringreplace,avvr,avvr,[EMUZ],`%EMUZ`%,All
								preruni.= A_Space . avvr . "`n"
							}
					}
			}
		if (RJABSOLROM = 1)
			{ 
				StringReplace, toapc,toapc,[CMDLINEGET],[ABSOLROM],All
				StringReplace,toapc,toapc,[GAMLST],[ABSOLROM],All
			}
		StringReplace, toapc,toapc,[CMDLINEGET],%RJROMXTINJ%
		StringReplace,toapc,toapc,[GAMLST],`*,All
		stringreplace,sifn,RJROMXTINJ,",,All
		;"
		stringreplace,sifn,sifn,%A_Space%,,All
		stringreplace,sifn,sifn,.,,All
		stringreplace,sifn,sifn,*,|,All
		StringReplace, toapc,toapc,[CMDLINEGET],%sifn%
		StringReplace,toapc,toapc,[RUNOPTS],%RJEMUOPTS%,All
		StringReplace,toapc,toapc,[RUNARGS],%RJEMUARGS%,All
		if (BLNKLNCH = 1)
			{
				StringReplace,toapd,toapd,[RUNOPTS][ROMIN][RUNARGS],,All
			}
		if (RJEMUOPTS = "")
			{
				RJEMUOPTS:= A_Space
			}
		if (DAEMTO = 1)
			{
				stringreplace,toapd,toapd,[RUNOPTS][ROMIN][RUNARGS],[NXIX],All
				stringreplace,toapd,toapd,[ROMINLP],[ROMIN],All
				if (optav = "")
					{
						stringreplace,toapd,toapd,[NXIX],[RUNOPTS][ROMIN][RUNARGS],All
					}
				stringreplace,toapd,toapd,[NXIX],,All
				optav=
				Loop, Parse, RJEMUOPTS,|
					{
						if (A_LoopField = "<")
							{
								continue
							}
						if (A_LoopField = " ")
							{
								continue
							}
						if (A_LoopField = "")
							{
								continue
							}
						optav= 1
						break
					}
			}
		if (RJMULTIDISC = 1)
			{
				;;stringreplace,toapd,toapd,[ROMIN],[NWLNCH],All
			}
		StringReplace,toapd,toapd,[RUNOPTS],%RJEMUOPTS%,All
		StringReplace,toapd,toapd,[RUNARGS],%RJEMUARGS%,All
		StringReplace,toapd,toapd,[EMUPATH],`%EMUL`%,All
		StringReplace,toapd,toapd,[ROMPATH],`%GAMDIR`%,All
		rjinjpth=
		rjinjq=
		if (RJPATH = 0)
			{
				if (RJQUOTES = 0)
					{
						StringReplace,toapd,toapd,[ROMIN],%RJROMINJ%,All
						StringReplace,toapd,toapd,[GAMNAM],%RJROMINJ%,All
					}
				if (RJQUOTES = 1)
					{
						rjinjq="
						;"
						StringReplace,toapd,toapd,[ROMIN],"%RJROMINJ%",All
						StringReplace,toapd,toapd,[GAMNAM],"%RJROMINJ%",All
					}
			}
		if (RJPATH = 1)
			{
				rjinjpth= 1
				if (RJQUOTES = 0)
					{
						StringReplace,toapd,toapd,[ROMIN],`%GAMDIR`%\%RJROMINJ%,All
						StringReplace,toapd,toapd,[GAMNAM],`%GAMDIR`%\%RJROMINJ%,All
					}
				if (RJQUOTES = 1)
					{
						rjinjq="
						;"
						StringReplace,toapd,toapd,[ROMIN],"`%GAMDIR`%\%RJROMINJ%",All
						StringReplace,toapd,toapd,[GAMNAM],"`%GAMDIR`%\%RJROMINJ%",All
					}
			}
		StringReplace,toapd,toapd,<,%A_Space%,All
		rprn=
		avvx=
		postruni=
		Loop, Parse, RJPOSTRUN,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				ikiv1=
				ikiv2=
				stringsplit,ikiv,A_LoopField,>
				stringreplace,avvx,ikiv1,[ROMPATH],`%GAMDIR`%,All
				stringreplace,avvx,avvx,[ROM],`%ROM`%,All
				stringreplace,avvx,avvx,[ROMF],`%ROMF`%,All
				stringreplace,avvx,avvx,[EMUL],`%EMUL`%,All
				stringreplace,avvx,avvx,[EMUZ],`%EMUZ`%,All
				rprn+=1
				rprw=
				STRTYP:= `%LAUNCH`%
				Loop, Parse, RJPOSTW,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						rprw+=1
						if (rprw = rprn)
							{
								if (A_LoopField = 0)
									{
										STRTYP:= `%LSTART`%
									}
							}
					}
				postruni.= STRTYP . A_Space . """" . avvx . """"
				rjpro=
				Loop, Parse, RJPOSTOPT,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						rjpro+=1
						if (rjpro = rprn)
							{
								if (A_LoopField = ":")
									{
										postruni.= "`n"
										continue
									}
								stringreplace,avvx,A_LoopField,[ROMPATH],`%GAMDIR`%,All
								stringreplace,avvx,avvx,[EMUPATH],`%EMUL`%,All
								stringreplace,avvx,avvx,[ROM],`%ROM`%,All
								stringreplace,avvx,avvx,[ROMF],`%ROMF`%,All
								stringreplace,avvx,avvx,[EMUL],`%EMUL`%,All
								stringreplace,avvx,avvx,[EMUZ],`%EMUZ`%,All
								postruni.= A_Space . avvx . "`n"
							}
					}
			}
		FileDelete,rj\sysCfgs\%curjf%\lnch.cmd
		FileAppend, %toapa%, rj\sysCfgs\%curjf%\lnch.cmd
		Loop, Parse, RJPRECFG,|
			{
				FileAppend,`%XFG`%%A_LoopField%`n,rj\sysCfgs\%curjf%\lnch.cmd
			}
		FileAppend,%toapb%,rj\sysCfgs\%curjf%\lnch.cmd
		FileAppend,%preruni%,rj\sysCfgs\%curjf%\lnch.cmd
		FileAppend,%toapc%,rj\sysCfgs\%curjf%\lnch.cmd
		IF (RJDMNTDD = "Native")
			{
				Fileappend,`%LAUNCH`% powershell.exe "Mount-DiskImage ""`%GAMDIR`%"""`n,rj\sysCfgs\%curjf%\lnch.cmd
			}
		FileAppend,%toapd%,rj\sysCfgs\%curjf%\lnch.cmd
		IF (RJDMNTDD = "Native")
			{
				Fileappend,`%LAUNCH`% powershell.exe "Dismount-DiskImage ""`%GAMDIR`%"""`n,rj\sysCfgs\%curjf%\lnch.cmd
			}
		FileAppend,%postruni%,rj\sysCfgs\%curjf%\lnch.cmd
		Loop, Parse, RJPOSTCFG,|
			{
				FileAppend,`%XFG`%%A_LoopField%`n,rj\sysCfgs\%curjf%\lnch.cmd
			}
		StringReplace,toape,toape,[AMLOC],%RJMAPTD%,All
		StringReplace,toape,toape,[XPDLOC],%RJMAPTD%,All
		FileAppend,%toape%,rj\sysCfgs\%curjf%\lnch.cmd
		;;fileread,lnchcmd,rj\sysCfgs\%curjf%\lnch.cmd
		if (NICEFLDR <> 1)
			{
				inclfl=
				IniRead,subdls,rj\%curjf%.ini,%curjf%,RJSUBDS
				Loop, Parse, CURTDB,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						cursysfld= %A_LoopField%
						ninto1=
						ninto2=
						ibjn1=
						ibjn2=
						stringreplace,cursysfld,cursysfld,:,,All
						stringsplit,ibjn,cursysfld,|
						mvrom= %ibjn2%
						nwjak= %ibjn1%
						if ((mvrom = "")&&(nwjak = ""))
							{
								continue
							}
						inclfl.= nwjak . ">" . mvrom . "`n"
						nwjakxtr=
						SplitPath,ibjn2,nwjakf,nwjakd,nwjakx,nwjakn
						if (RJCONSOLID <> "Individuate")
							{
								stringsplit,anwjakn,nwjakn,%RJCONSOLID%
								nwjakn= %anwjakn1%
							}
						if (nwjakx = "zip")
							{
								nwjakxtr= 1
							}
						if (nwjakx = "rar")
							{
								nwjakxtr= 1
							}
						if (nwjakx = "7z")
							{
								nwjakxtr= 1
							}
						IF (nwjakxtr = 1)
							{
								if (RJEXTRARC = 1)
									{
										RunWait, %comspec% /c " "%S_KeyDir%\bin\7za.exe" e -y "%RJSYSTEMS%\%curjf%\%ibjn2%" -O"%RJSYSTEMS%\%curjf%\%nwjakn%" ",,hide
										if (RJARCLOC = 0)
											{
												FileMove,%RJSYSTEMS%\%curjf%\%ibjn2%,%cacheloc%\%curjf%\%ibjn2%,1
											}
										if (RJARCLOC = 2)
											{
												FileDelete,%RJSYSTEMS%\%curjf%\%ibjn2%
											}
									}
								ifnotexist,%RJSYSTEMS%\%curjf%\%nwjak%
									{
										filecreatedir,%RJSYSTEMS%\%curjf%\%nwjak%
									}
								FileMove,%RJSYSTEMS%\%curjf%\%ibjn2%,%RJSYSTEMS%\%curjf%\%nwjak%
								If (errorlevel > 0)
									{
										FileMove,%RJSYSTEMS%\%curjf%\%ibjn2%,%cacheloc%\%curjf%\%ibjn2%,1
									}
								if (RJEXTRARC = 2)
									{
										RunWait, %comspec% /c " "%S_KeyDir%\bin\7za.exe" e -y "%RJSYSTEMS%\%curjf%\%nwjak%\%ibjn2%" -O"%RJSYSTEMS%\%curjf%\%nwjak%" ",,hide
											if (RJARCLOC = 0)
												{
													FileMove,%RJSYSTEMS%\%curjf%\%nwjak%\%ibjn2%,%cacheloc%\%curjf%\%ibjn2%,1
												}
											if (RJARCLOC = 2)
												{
													FileDelete,%RJSYSTEMS%\%curjf%\%nwjak%\%ibjn2%
												}
									}
							}
						IF (nwjakxtr = "")
							{
								ifnotexist,%RJSYSTEMS%\%curjf%\%nwjak%
									{
										filecreatedir,%RJSYSTEMS%\%curjf%\%nwjak%
									}
								FileMove,%RJSYSTEMS%\%curjf%\%ibjn2%,%RJSYSTEMS%\%curjf%\%nwjak%
								If (errorlevel > 0)
									{
										FileMove,%RJSYSTEMS%\%curjf%\%ibjn2%,%cacheloc%\%curjf%\%ibjn2%,1
									}
							}
					}
			}
		if (NICEFLDR = 1)
			{
				SETGAM= sets\MAME - Arcade.set
				ifExist, %GAMSRCS%\%curjf%.gam
					{
						SETGAM= %GAMSRCS%\%curjf%.gam
					}
				FileRead, fldmvr, %SETGAM%
				FileCreateDir, %RJSYSTEMS%\%curjf%\SOURCE
				FileSetAttrib,+H,%RJSYSTEMS%\%curjf%\SOURCE,2
				IniRead,subdls,rj\%curjf%.ini,%curjf%,RJSUBDS
				inclfl=
				Loop, Parse, CURTDB,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						ninto1=
						ninto2=
						ibjn1=
						ibjn2=
						stringsplit,ibjn,A_LoopField,|
						stringsplit,ninto,ibjn1,:
						mvrom= %ninto2%
						nwjak= %mvrom%
						if (ninto2 <> "")
							{
								mvrom= %ninto2%
								nwjak= %mvrom%
								inclfl.= nwjak . ">" ninto1 . "`n"
								continue
							}
							if (ninto2 = "")
								{
									mvrom= %ibjn1%
									nwjak= %mvrom%
								}
						if (RJCONSOLID <> "Individuate")
							{
								mvromx1=
								stringsplit,mvromx,nwjak,%RJCONSOLID%
								if (mvromx1 <> "")
									{
										nwjak= %mvromx1%
									}
							}
						gosub, nicemove
						FileCreateDir, %RJSYSTEMS%\%curjf%\%nwjak%
						inclfl.= nwjak . ">" ninto1 . "`n"
						;;FileAppend, %nwjak%`n,rj\%curjf%_inclfl.tdb
						nwjrs= %mvrom%
						if (RJCONSOLID = "Individuate")
							{
								mvromtx= %mvrom%.*
							}
						if (RJCONSOLID <> "Individuate")
							{
								mvromcc1=
								stringsplit,mvromcc,mvrom,%RJCONSOLID%
								mvromtx= %mvromcc1%*
							}
						nicesrc= 1
						nicedir= SOURCE
						if (curjf = "Sammy - Atomiswave")
							{
								nicesrc=
								nicedir= %nwjak%
							}
						if (curjf = "Sega - NAOMI")
							{
								nicesrc=
								nicedir= %nwjak%
							}
						if (curjf = "Sega - Hikaru")
							{
								nicesrc=
								nicedir= %nwjak%
							}
						if (curjf = "Galeco")
							{
								nicesrc=
								nicedir= %nwjak%
							}
						FileMove,%RJSYSTEMS%\%curjf%\%ibjn2%,%RJSYSTEMS%\%curjf%\%nicedir%\%ibjn2%
						if (errorlevel > 0)
							{
								FileMove,%RJSYSTEMS%\%curjf%\%mvrom%,%cacheloc%\%curjf%,1
							}
						if (nicesrc = 1)
							{
								RunWait, %comspec% cmd /c "mklink /H "%RJSYSTEMS%\%curjf%\%nwjak%\%ibjn2%" "%RJSYSTEMS%\%curjf%\SOURCE\%ibjn2%" ",,hide
							}
					}
				Loop, Parse, inclfl,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						stringsplit,inclfspl,A_LoopField,>
						if (inclfspl1 = "")
							{
								continue
							}
						nwinclfl= %inclfspl1%
						if (RJLNCHCFG <> 0)
							{
								FileCopy, rj\sysCfgs\%curjf%\lnch.cmd,%RJSYSTEMS%\%curjf%\%nwinclfl%\%nwinclfl%.bat,%RJLNCHCFGOW%
							}
						Loop, Parse, subdls,|
							{
								if (A_LoopField = "")
									{
										continue
									}
								subda1=
								subda2=
								StringSplit,subda,A_LoopField,:
								FileCreateDir, %RJSYSTEMS%\%curjf%\%nwinclfl%\%subda1%
								if (subda2 = 1)
									{
										FileSetAttrib,+H,%RJSYSTEMS%\%curjf%\%nwinclfl%\%subda1%,2
									}
							}
						If (RJKEYMON = 1)
							{
								if (RJMP1LC = 1)
									{
										curjoyf= %curjf%
										if (RJMAP1ROFTYP = 0)
											{
												joysubt= Joystick
											}
										if (RJMAP1ROFTYP = 1)
											{
												joysubt= Keyboard
											}
										if (RJMAP1ROFTYP = 2)
											{
												joysubt= Blank
												curjoyf= All
											}
										FileCopy, rj\joyCfgs\%RJKEYMAPPER%\%joysubt%\%curjoyf%\Player1.*,%RJSYSTEMS%\%curjf%\%nwinclfl%,%RJKEYOW%
									}
								if (RJMP1LC = "")
									{
										FileCopy, %RJMAP1P%,%RJSYSTEMS%\%curjf%\%nwinclfl%,%RJKEYOW%
									}
								if (RJMP2LC = 1)
									{
										curjoyf= %curjf%
										if (RJMAP2ROFTYP = 0)
											{
												joysubt= Joystick
											}
										if (RJMAP2ROFTYP = 1)
											{
												joysubt= Keyboard
											}
										if (RJMAP2ROFTYP = 2)
											{
												joysubt= Blank
												curjoyf= All
											}
										FileCopy, rj\joyCfgs\%RJKEYMAPPER%\%joysubt%\%curjoyf%\Player2.*,%RJSYSTEMS%\%curjf%\%nwinclfl%,%RJKEYOW%
									}
								if (RJMP2LC = "")
									{
										FileCopy, %RJMAP2P%,%RJSYSTEMS%\%curjf%\%nwinclfl%,%RJKEYOW%
									}
							}
					}
			}
		gosub, EMUCFGCOPY
		Loop, Parse, inclfl,`n`r
			{
				stringsplit,inclfspl,A_LoopField,>
				if (inclfspl1 = "")
					{
						continue
					}
				curomfd= %inclfspl1%
				Loop, Parse, subdls,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						subda1=
						subda2=
						StringSplit,subda,A_LoopField,:
						FileCreateDir, %RJSYSTEMS%\%curjf%\%curomfd%\%subda1%
						if (subda2 = 1)
							{
								FileSetAttrib,+H,%RJSYSTEMS%\%curjf%\%curomfd%\%subda1%,2
							}
					}
				if (RJLNCHCFG <> 0)
					{
						FileRead, newlnch, rj\sysCfgs\%curjf%\lnch.cmd
						FileMove, rj\sysCfgs\%curjf%\lnch.cmd,rj\sysCfgs\%curjf%\lnch.orig,1
						if (RJABSOLROM = 1)
							{
								if (RJROMXT = "*.*")
									{
										continue
									}
								extpvr= %RJROMSPL%
								stringreplace,extpvr,extpvr,.,,All
								stringsplit,extpvx,extpvr,`,
								ajr := Object()
								Loop, %extpvx0%
									{
										new= % (extpvx%a_index%)
										if (extpvx%a_index% <> "")
											{
												ajr.insert(new)
											}
									}
								injrmltix=
								injrmltg=
								Einjpri=
								enpri=
								injromnR=
								Loop, %RJSYSTEMS%\%curjf%\%curomfd%\*.*
									{
										injromn= "*.*"
										ext= %A_LoopFileExt%
										for k, v in ajr
											{
												extm:= v
												if (ext = extm)
													{
														ifinstring,A_LoopFileName,[!]
															{
																if (enpri = "")
																	{
																		Einjpri= %A_LoopFileFullPath%
																		enpri= 1
																	}
															}
														if (A_Index = 1)
															{
																injromnR= %A_LoopFileFullPath%
															}
														injrmltix.= A_LoopFileFullPath . "|"
													}
											}
										stringreplace,injromnX,injromnR,%A_LoopFileDir%,`%CD`%,All
									}
								if (RJMULTIDISC = 0)
									{
										if (Einjpri <> "")
											{
												injromnR= %Einjpri%
											}
										stringreplace,newlnch,newlnch,[ABSOLROM],"%injromnX%"
										stringreplace,newlnch,newlnch,[ABSOLROM],"%injromnR%",All
										splitpath,injromnR,xinjromf,xinjromd,xinjromx,xinjromn,xinjromd
										StringReplace, newlnch,newlnch,[ROM],%xinjrom%,All
										StringReplace, newlnch,newlnch,[ROMF],%xinjromf%,All
										StringReplace, newlnch,newlnch,[ROMX],%xinjromx%,All
										StringReplace, newlnch,newlnch,[ROMFN],%xinjromn%,All
										injrmltix=
									}
								if (injrmltix <> "")
									{
										if (Einjpri <> "")
											{
												injromnR= %Einjpri%
											}
										stringreplace,newlnch,newlnch,[ABSOLROM],"%injromn%",All
										stringreplace,injromk,injrmltix,|,"%A_Space%",All
										stringsplit,injrvn,injrmltix,|
										injromk= %injrvn1%
										splitpath,injromk,xinjromf,xinjromd,xinjromx,xinjromn,xinjromd
										StringReplace, newlnch,newlnch,[ROM],%xinjrom%,All
										StringReplace, newlnch,newlnch,[ROMF],%xinjromf%,All
										StringReplace, newlnch,newlnch,[ROMX],%xinjromx%,All
										StringReplace, newlnch,newlnch,[ROMFN],%xinjromn%,All
									}
								stpar=
								cncl=
								ALINC=
								NUMINC=
								dromdtk=
								cvil=
								injromful=
								NUMINC= 1
								if (RJMULTIDISC = 1)
									{
										Loop, Parse, injrmltix,|
											{
													cvil= %A_LoopField%
													splitpath,cvil,cvifn,cvild,cvix
													Loop, Parse,KBSET,|
														{
															if (A_LoopField = "")
																{
																	continue
																}
															if (A_LoopField = "G")
																{
																	cncl=1
																	break
																}
															ALINC= %A_LoopField%
															ifinstring,cvifn,Disk%NUMINC%of
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Disk %NUMINC% of
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Disk %NUMINC%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Disk%ALINC%%A_Space%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Disk%ALINC%%A_Space%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Disk %ALINC%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Side %ALINC%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Side %NUMINC%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Side%NUMINC%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Tape %ALINC%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Tape %NUMINC%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,Tape%NUMINC%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,File %ALINC%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,File%NUMINC%
																{
																	gosub, rjinsu
																	continue
																}
															ifinstring,cvifn,File %NUMINC%
																{
																	gosub, rjinsu
																	continue
																}
														}
													ifinstring,RJEMUPRESET,MAME
														{
															Loop, %NUMINC%
																{
																	ifinstring,RJEMUOPTS,[RJRTYP]
																		{
																			avic:= (A_Index + 1)
																			stringsplit,rjesp,RJEMUOPTS,%A_Space%
																			txov:= RegExReplace(curMameOpt, "\D")
																			if (txov <> "")
																				{
																					curMameOpt:= RegExReplace(curMameOpt, "[ \t]*\d[ \t]*")
																					curMameOpt.= avic
																				}
																			acvilz= %cvil%
																			if (rjinpth = "")
																				{
																					acvilz:= cvifn
																				}
																			injromful.= A_Space . "-" . curMameOpt . A_Space . rjinjq . acvilz . rjinjq
																			if (A_index = 1)
																				{
																					injromful:= rjinjq . acvilz . rjinjq
																				}
																		}
																}
														}
											}
										stringreplace,newlnch,newlnch,[NWLNCH],%injromful%,All
									}
								stringreplace,newlnch,newlnch,[GAMLST],%dromdtk%,All
							}
						If (RJPROPXE = 1)
							{
								if (rjintr = "")
									{
										rjintr= 1
									}
								selfnd= %emuname%
								xtractmu= %RJSYSTEMS%\%curjf%\%curomfd%\%emuname%
								if (rjintr = 2)
									{
										KARC= 1
										gosub, XTRACTEMU
										KARC= 0
									}
								if (rjintr = 1)
									{
										DWNOV= False
										gosub, EMURJINT
										DWNOV= True
										KARC= 1
										gosub, XTRACTEMU
										KARC= 0
									}
								StringReplace,newlnch,newlnch,[EMUL]\[EMUZ],%emuname%\%emuxe%
								StringReplace,newlnch,newlnch,[EMUL],`%CD`%\%emuname%
								StringReplace,newlnch,newlnch,[EMUL],%emuname%,All
								StringReplace,newlnch,newlnch,[EMUZ],%emuxe%,All
							}
						FileAppend, %newlnch%,rj\sysCfgs\%curjf%\lnch.cmd
						FileCopy, rj\sysCfgs\%curjf%\lnch.cmd,%RJSYSTEMS%\%curjf%\%curomfd%\%curomfd%.bat,%RJLNCHCFGOW%
						FileMove, rj\sysCfgs\%curjf%\lnch.orig,rj\sysCfgs\%curjf%\lnch.cmd,1
					}
				if (RJEMUCFG <> 0)
					{
						jsinvr= % %SHRTNM%CFGR
						cinjr= %inclfspl2%
						CFGCOMPLETE=
						if (PEREMUCFG = 1)
							{
								gosub, PEREMUINJ
							}
						vbp= rj\sysCfgs\%curjf%
						if (CFGCOMPLETE <> 1)
							{
								Loop, Parse, jsinvr,|
									{
										if (A_LoopField = "")
											{
												continue
											}
										vb= %A_LoopField%
										vbf= %A_LoopField%
										ifinstring,vb,\
											{
												splitpath,vb,vbf,vbp
											}
										FileRead,romrpl%A_Index%,%vbp%\%vbf%
										ini_%A_Index%= %vbf%
									}
								Loop
									{
										curininx= % (ini_%A_Index%)
										curomcpl= % (romrpl%A_Index%)
										if (curomcpl = "")
											{
												break
											}
										if (RJPROPXE = 1)
											{
												stringreplace,curomcpl,curomcpl,[EMUPATH],,All
												stringreplace,curomcpl,curomcpl,[ROMPATH],..,All
												stringreplace,curomcpl,curomcpl,[SSTATE],%CURSTATE%,All
												stringreplace,curomcpl,curomcpl,[MEM],%CURMEM%,All	
											}
										stringreplace,curomcpl,curomcpl,[EMUPATH],%emulocd%,All
										stringreplace,curomcpl,curomcpl,[ROMPATH],%RJSYSTEMS%\%curjf%\%curomfd%,All
										if (inclfspl1 <> inclfspl2)
											{
												stringreplace,curomcpl,curomcpl,[ROMF],%cinjr%,All
											}
										stringreplace,curomcpl,curomcpl,[SSTATE],.sstate,All
										stringreplace,curomcpl,curomcpl,[MEM],.mem,All	
										FileAppend,%curomcpl%,%RJSYSTEMS%\%curjf%\%curomfd%\%curininx%
									}
							}
					}
				If (RJKEYMON = 1)
					{
						if (RJMP1LC = 1)
							{
								curjoyf= %curjf%
								if (RJMAP1ROFTYP = 0)
									{
										joysubt= Joystick
									}
								if (RJMAP1ROFTYP = 1)
									{
										joysubt= Keyboard
									}
								if (RJMAP1ROFTYP = 2)
									{
										joysubt= Blank
										curjoyf= All
									}
								FileCopy, rj\joyCfgs\%RJKEYMAPPER%\%joysubt%\%curjoyf%\Player1.*,%RJSYSTEMS%\%curjf%\%curomfd%,%RJKEYOW%
							}
						if (RJMP1LC = "")
							{
								FileCopy, %RJMAP1P%,%RJSYSTEMS%\%curjf%\%curomfd%,%RJKEYOW%
							}
						if (RJMP2LC = 1)
							{
								curjoyf= %curjf%
								if (RJMAP2ROFTYP = 0)
									{
										joysubt= Joystick
									}
								if (RJMAP2ROFTYP = 1)
									{
										joysubt= Keyboard
									}
								if (RJMAP2ROFTYP = 2)
									{
										joysubt= Blank
										curjoyf= All
									}
								FileCopy, rj\joyCfgs\%RJKEYMAPPER%\%joysubt%\%curjoyf%\Player2.*,%RJSYSTEMS%\%curjf%\%curomfd%,%RJKEYOW%
							}
						if (RJMP2LC = "")
							{
								FileCopy, %RJMAP2P%,%RJSYSTEMS%\%curjf%\%curomfd%,%RJKEYOW%
							}
					}
			}
	}
SK_MODE=
SB_SetText("Jacketizing Complete")
guicontrol,,RJTXTAB, %RJQNUM% Systems
guicontrol,,RJPROCQ, CONFIRM %RJQNUM%
return

rjinsu:
stpar= 1
Disk%NUMINC%= %cvil%
ifnotinstring,dromdtk,%cvil%|
	{
		NUMINC+= 1
		dromdtk.= cvil . "|"
	}
return

nicemove:
Loop, Parse, fldmvr,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		mvrpt1=
		mvrpt2=
		mvaba1=
		mvaba2=
		mvrpx1=
		mvrpx2=
		stringsplit,mvrpt,A_LoopField,|
		stringsplit,mvaba,mvrpt1,.
		if (mvrom = mvaba1)
			{
				nwjak= %mvrpt2%
				if (RJCONSOLID <> "Individuate")
					{
						stringsplit,mvrpx,mvrpt2,%RJCONSOLID%
						if (mvrpx1 <> "")
							{
								nwjak= %mvrpx1%
							}
					}
				break
			}
	}
return

NICEFLDR:
return

Individuate:
return

RJSETRANGE:
gui,submit,nohide
return

RJADDQ:
gui,submit,nohide
quryad= 1
guicontrolget,RJSYSDD,,RJSYSDD
guicontrolget,RJQLSTDD,,RJQLSTDD
SYSTMQ=
RJQNUM:= 0
Loop, rj\*_q.tdb
	{
		RJQNUM+=1
		SplitPath,A_LoopFileName,,,,dbqv
		StringTrimRight,dbqueue,dbqv,2
		SYSTMQ.= dbqueue . "|"
	}
Loop, Parse, SYSTMQ,|
	{
		if (RJSYSDD = A_LoopField)
			{
				FileCopy, rj\cur.ini, rj\%RJSYSDD%.ini,1
				return
			}
	}
guicontrol,,RJINCEXCL,|All||A-Z|#
FileCopy, rj\cur.ini, rj\%RJSYSDD%.ini,1
RJQNUM+=1
gosub, MUTEJACKOPT
gui, Listview, RJLSTV
guicontrol,disable,RJLSTV
SYSTMQ.= RJSYSDD . "|"
QItems=
QItems:= LVGetCheckedItems("", "ahk_id" . RJLV)
FileDelete, rj\%RJSYSDD%_incl.tdb
Loop, Parse, QItems,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		qarray1=
		qarray2=
		stringsplit,qarray,A_LoopField,\
		FileAppend, %qarray1%`n,rj\%RJSYSDD%_incl.tdb
	}
FileMove,rj\%RJSYSDD%_incl.tdb, rj\%RJSYSDD%_q.tdb,1
guicontrol,,RJTXTAB,%RJQNUM%-Systems
guicontrol,,RJQLSTDD,|QUEUE||%SYSTMQ%
guicontrol,,RJSYSDD,|Systems|%RJSYSDD%||%systmfldrs%
SB_SetText("Adding " RJSYSDD " to the system queue")
guicontrol,disable,RJADDQ
Guicontrol,,RJPROCQ,CONFIRM %RJQNUM%
guicontrol,enable,RJLSTV
gosub,OPENJACKOPT
gosub, RJSYSDD
return

DELRJQ:
guicontrolget,RJSYSDD,,RJSYSDD
Msgbox,262404,Clear the Queue,Delete All Systems in the queue?,10
		IfMsgBox, Yes
			{
				FileDelete,rj\*.tdb
				FileDelete,rj\*.jak
				FileDelete,rj\*.ini
				FileDelete,rj\*.bak
				SYSTMQ=
				guicontrol,,RJQLSTDD,|QUEUE||
				RJQNUM:= 0
				guicontrol,,RJTXTAB,%RJQNUM%-Systems
				guicontrol,,RJSYSDD,|Systems|%RJSYSDD%||%systmfldrs%
				guicontrol,,RJINCEXCL,|All||A-Z|#
				SB_SetText("cleared the system queue")
				Guicontrol,,RJPROCQ,CONFIRM
				return
			}
return

RJREMQSYS:
gui,submit,nohide
SYSTMQF=
guicontrolget,RJQLSTDD,,RJQLSTDD
if (RJQLSTDD = "QUEUE")
	{
		gosub, DELRJQ
		return
	}
gui, Listview, RJLSTV
SYSTMQ=
RJQNUM:= 0
Loop, rj\*_q.tdb
	{
		RJQNUM+=1
		SplitPath,A_LoopFileName,,,,dbqv
		StringTrimRight,dbqueue,dbqv,2
		SYSTMQ.= dbqueue . "|"
	}
Loop, Parse, SYSTMQ, |
	{
		if (A_LoopField = RJQLSTDD)
			{
					continue
			}
		SYSTMQF.= A_LoopField . "|"
	}
SYSTMQ:= SYSTMQF
GUICONTROL,,RJTXTAB,%RJQNUM%-Systems
Guicontrol,,RJPROCQ,CONFIRM %RJQNUM%
ifexist, rj\%RJQLSTDD%_q.tdb
	{
		FileDelete, rj\%RJQLSTDD%_q.tdb
		RJQNUM-=1
	}
SB_SetText("Removing " RJQLSTDD " from the system queue")
if (RJSYSDD = RJQLSTDD)
	{
		Guicontrol,,RJSYSDD,|Systems||%systmfldrs%
		guicontrol,,RJINCEXCL,|All||A-Z|#
		gosub, RJSYSDD
	}
Guicontrol,,RJQLSTDD,|QUEUE||%SYSTMQ%
guicontrol,,RJTXTAB, %RJQNUM% Systems
guicontrol,,RJPROCQ, CONFIRM %RJQNUM%
gosub, RJSYSDD
return

RJMAP1PLOPN:
gui,submit,nohide
return

RJMAP2PLOPN:
gui,submit,nohide
return

RJMAPRETOPN:
gui,submit,nohide
FileSelectFile,RJMASTERPROF,3,Mediacenter.*,Select FE Profile
if (RJMASTERPROF = "")
	{
		return
	}
IniWrite, %RJMASTERPROF%,rj\cur.ini,%RJSYSDD%,RJMASTERPROF
return

RJBUTM:
gui,submit,nohide
RJEMULOCT=
rjemuxe=
rjemulocd=
FileSelectFile, RJEMULOCT, 3, ,Select emulator,*.exe
if (RJEMULOCT = "")
	{
		return
	}
RJEMULOC= %RJEMULOCT%
SplitPath,RJEMULOC,rjemuxe,rjemulocd
return

RJSALITMS:
gui,submit,nohide
Gui, ListView, RJLSTV
LV_Modify(0,"+Select")
return

INSys_Open:
gui,submit,nohide
guicontrolget,xplsysin,,SYSINSTLBX
RunWait, %comspec% /c explorer "%xplsysin%"
return

Sys_Open:
gui,submit,nohide
guicontrolget,ROMDEDS,,ROMDEDT
RunWait, %comspec% /c explorer "%ROMDEDS%"
return

RMVFSYS:
gui,submit,nohide
guicontrolget,ROMDEDS,,ROMDEDT
iniread,sijn,SystemLocations.ini,LOCATIONS,%semu%
Loop,Parse,ROMDEDS,|
	{
		if (A_LoopField = "")
			{
				continue
			}
		cursyrmv= %A_LoopField%
		Loop,parse,sijn,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (A_LoopField = cursyrmv)
					{
						stringreplace,sijn,sijn,%A_LoopField%|,,All
					}
			}
	}
if (sijn = "")
	{
		ifexist,%RJSYSTEMS%\%semu%\
			{
				iniwrite,"%RJSYSTEMS%\%semu%|",SystemLocations.ini,LOCATIONS,%semu%
				guicontrol,,ROMDEDT,|%RJSYSTEMS%\%semu%
				return
			}
	}
if (sijn = "ERROR")
	{
		sijn= 
	}
iniwrite,"%sijn%",SystemLocations.ini,LOCATIONS,%semu%
guicontrol,,ROMDEDT,|%sijn%
return

CLRSYSLOC:
gui,submit,nohide
iniwrite,"",SystemLocations.ini,LOCATIONS,%semu%
SB_SetText(" " semu " System Locations Cleared")
ifexist,%RJSYSTEMS%\%semu%\
	{
		iniwrite,"%RJSYSTEMS%\%semu%|",SystemLocations.ini,LOCATIONS,%semu%
		guicontrol,,ROMDEDT,|%RJSYSTEMS%\%semu%
		return
	}
guicontrol,,ROMDEDT,|
return

TOGRJSEL:
gui,submit,nohide
gui,ListView,RJLSTV
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
				LV_Modify(RowNumber, "-Check")
				stringreplace,RJSYSDD_TDB,RJSYSDD_TDB,%curtxt%|0,%curtxt%|1,All
			}
		Else
			{
				LV_Modify(RowNumber, "Check")
				stringreplace,RJSYSDD_TDB,RJSYSDD_TDB,%curtxt%|0,%curtxt%|1,All
			}
	}
return

ADDRJSEL:
gui,submit,nohide
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
			}
		Else
			{
				LV_Modify(RowNumber, "Check")
				stringreplace,RJSYSDD_TDB,RJSYSDD_TDB,%curtxt%|0,%curtxt%|1,All
			}
	}
return

REMRJSEL:
gui,submit,nohide
RowNumber = 0
Loop
	{
		RowNumber := LV_GetNext(RowNumber)
		if not RowNumber
			{
				break
			}
		LV_GetNext(RowNumber, Focused)
		LV_GetText(curtxt, RowNumber)
		RowChecked := LV_GetNext(RowNumber - 1 , "Checked" )
		If ( RowNumber = RowChecked )
		   {
				LV_Modify(RowNumber, "-Check")
				stringreplace,RJSYSDD_TDB,RJSYSDD_TDB,%curtxt%|1,%curtxt%|0,All
			}
		Else
			{
			}
	}
return

RJADDPRECFG:
gui,submit,nohide
guicontrolget,RJPRECFGCBX,,RJPRECFGCBX
if (RJPRECFGCBX = "")
	{
		return
	}
subdna=
RJPRECFG=
IniRead, RJPRECFG,rj\cur.ini,%RJSYSDD%,RJPRECFG
RJPRECFGW=
RJPRECFGR=
Loop, parse, RJPRECFG,|
	{
		if (A_LoopField = RJPRECFGCBX)
			{
				subdna= 1
				SB_SetText("Command is already added")
				continue
			}
			RJPRECFGR.= A_LoopField . "|"
			RJPRECFGW.= A_LoopField . "|"
	}
if (subdna = 1)
	{
		IniWrite,%RJPRECFGW%,rj\cur.ini,%RJSYSDD%,RJPRECFG
		return
	}
RJPRECFGW=
RJPRECFGR:= RJPRECFGCBX . "|"
Loop, parse, RJPRECFG,|
	{
		RJPRECFGR.= A_LoopField . "|"
		RJPRECFGW.= A_LoopField . "|"
	}
guicontrol,,RJPRECFGCBX,|%RJPRECFGR%
stringreplace,RJPRECFGW,RJPRECFGW,||,|,All
IniWrite, %RJPRECFGCBX%|%RJPRECFGW%,rj\cur.ini,%RJSYSDD%,RJPRECFG
SB_SetText("Command Added")
return

RJREMPRECFG:
gui,submit,nohide
guicontrolget,RJPRECFGCBX,,RJPRECFGCBX
if (RJPRECFGCBX = "")
	{
		return
	}
RJPRECFGRM=
RJPRECFGRW=
IniRead,RJPRECFG,rj\cur.ini,%RJSYSDD%,RJPRECFG
Loop, Parse,RJPRECFG,|
	{
		if (A_LoopField <> RJPRECFGCBX)
			{
				RJPRECFGRM.= A_LoopField . "|"
				RJPRECFGRW.= A_LoopField . "|"
			}
	}
guicontrol,,RJPRECFGCBX,|%RJPRECFGRM%
stringreplace,RJPRECFGRW,RJPRECFGRW,||,|,All
IniWrite,%RJPRECFGRW%,rj\cur.ini,%RJSYSDD%,RJPRECFG
return

RJADDPOSTCFG:
gui,submit,nohide
guicontrolget,RJPOSTCFGCBX,,RJPOSTCFGCBX
if (RJPOSTCFGCBX = "")
	{
		return
	}
POSTCFGa=
RJPOSTCFG=
IniRead, RJPOSTCFG,rj\cur.ini,%RJSYSDD%,RJPOSTCFG
RJPOSTCFGW=
RJPOSTCFGR=
Loop, parse, RJPOSTCFG,|
	{
		if (A_LoopField = RJPOSTCFGCBX)
			{
				POSTCFGa= 1
			}
	}
if (POSTCFGa = 1)
	{
		return
	}
Loop, parse, RJPOSTCFG,|
	{
		if (A_LoopField = RJPOSTCFGCBX)
			{
				POSTCFGa= 1
				SB_SetText("Command is already added")
				continue
			}
		RJPOSTCFGR.= A_LoopField . "|"
		RJPOSTCFGW.= A_LoopField . "|"
		}
if (POSTCFGa = 1)
	{
		IniWrite,%RJPOSTCFGW%,rj\cur.ini,%RJSYSDD%,RJPOSTCFG
		return
	}
RJPOSTCFGW=
RJPOSTCFGR:= RJPOSTCFGCBX . "|"
Loop, parse, RJPOSTCFGS,|
	{
		RJPOSTCFGR.= A_LoopField . "|"
		RJPOSTCFGW.= A_LoopField . "|"
	}
guicontrol,,RJPOSTCFGCBX,|%RJPOSTCFGLSTSR%
stringreplace,RJPOSTCFGW,RJPOSTCFGW,||,|,All
IniWrite, %RJPOSTCFGCBX%|%RJPOSTCFGW%,rj\cur.ini,%RJSYSDD%,RJPOSTCFG
SB_SetText("Command Added")
return

RJREMPOSTCFG:
gui,submit,nohide
guicontrolget,RJPOSTCFGCBX,,RJPOSTCFGCBX
if (RJPOSTCFGCBX = "")
	{
		return
	}
RJPOSTCFGRM=
RJPOSTCFGRW=
RJPOSTCFGa=
IniRead,RJPOSTCFG,rj\cur.ini,%RJSYSDD%,RJPOSTCFG
Loop, Parse, RJPOSTCFG,|
	{
		if (A_LoopField <> RJPOSTCFGCBX)
			{
				RJPOSTCFGRM.= A_LoopField . "|"
				RJPOSTCFGRW.= A_LoopField . "|"
			}
	}
guicontrol,,RJPOSTCFGCBX,|%RJPOSTCFGRM%
stringreplace,RJPOSTCFGRW,RJPOSTCFGRW,||,|,All
IniWrite,%RJPOSTCFGRW%,rj\cur.ini,%RJSYSDD%,RJPOSTCFG
return

RJFNDINLST:
gui,submit,nohide
guicontrolget,RJFNDINLST,,RJFNDINLST
if (RJFNDINLST = "Clear")
	{
		guicontrol,,RJFNDINLST,Find
		guicontrol,,RJEDTC,
	}
guicontrolget,RJEDTC,,RJEDTC
if (RJEDTC = "")
	{
		guicontrol,,RJLSTYP,|Jackets+ROMs||Jackets ONLY|ROMs ONLY|All Files
		gosub, RJLSTYP
		return
	}
gui,listview,RJLSTV
LV_Delete()
guicontrol,,RJLSTYP,|Jackets+ROMs||Jackets ONLY|ROMs ONLY|All Files
guicontrol,,RJEDTDN
guicontrol,,RJEDTBN
guicontrol,,RJEDTD
guicontrol,,RJEDTB
guicontrol,hide,RJTXTH
guicontrol,hide,RJEDTDN
guicontrol,hide,RJEDTBN
guicontrol,hide,RJEDTD
guicontrol,hide,RJEDTB
guicontrol,,RJFNDINLST,Clear
guicontrol,,RJINCEXCL,|All||A-Z|#
fltlstv= 
Loop, Parse, RJSYSDD_TDB,`n`r
	{
		stringsplit,rjflz,A_LoopField,|
		ifinstring,rjflz1,%RJEDTC%
			{
				lvachk= +Check 
				if (rjflz2 = 0)
					{
						lvachk= ""
					}
				ifnotinstring,fltlstv,%rjflz1%
					{
						fltlstv.=rjflz1 . "|"
						LV_Add(lvachk,rjflz1)
					}
			}
	}
return

RJFLTRLST:
gui,submit,nohide
if (RJINCEXCL = "A-Z")
	{
		gosub, ALPHAVALUES
		guicontrolget, RJBEGINF,,RJEDTDN
		guicontrolget, RJENDF,,RJEDTBN
		rjbfv= % (%RJBEGINF%)
		rjefv= % (%RJENDF%)
		if (rjbfv > rjefv)
			{
				SB_SetText("Beginning-Range exceeds end-range")
				return
			}
		gui,listview,RJLSTV
		LV_Delete()
		guicontrol,,RJLSTYP,|Jackets+ROMs||Jackets ONLY|ROMs ONLY|All Files
		inclnum=
		rjadnum=
		stlst=
		Loop, Parse, RJSYSDD_TDB,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				lvachk= ""
				inclnum+=1
				rjflz1=
				rjflz2=
				stringsplit,rjflz,A_LoopField,|,:
				stringLeft,rjflet,rjflz1,1
				stringsplit,rjflz,A_LoopField,|
				rjfletv:= % (%rjflet%)
				if (rjbfv <= rjfletv)
					{
						stlst:= 1
					}
				if (rjefv < rjfletv)
					{
						break
					}
				if (stlst = 1)
					{
						rjadnum+=1
						if (rjflz2 = 1)
							{
								lvachk= +Check
							}
						LV_Add(lvachk,rjflz1)
					}
			}
		LV_ModifyCol()
		LV_Modify(0, "-Select")
		SB_SetText("Added " rjadnum " ROMs and Jackets")
		guicontrol,,RLSTOT,%rjadnum% items
		return
	}
if (RJINCEXCL = "#")
	{
		guicontrolget, RJBEGINF,,RJEDTD
		guicontrolget, RJENDF,,RJEDTB
		if (RJBEGINF > RJENDF)
			{
				SB_SetText("Beginning-Range exceeds end-range")
				return
			}
		gui,listview,RJLSTV
		LV_Delete()
		guicontrol,,RJLSTYP,|Jackets+ROMs||Jackets ONLY|ROMs ONLY|All Files
		inclnum=
		rjadnum=
		Loop, Parse, RJSYSDD_TDB,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (RJBEGINF <= inclnum)
					{
						inclnum+=1
						if (RJENDF < inclnum)
							{
								break
							}
						rjadnum+=1
						lvachk= ""
						rjflz1=
						rjflz2=
						stringsplit,rjflz,A_LoopField,|
						if (rjflz2 = 1)
							{
								lvachk= +Check
							}
						LV_Add(lvachk,rjflz1)
					}
			}
		LV_ModifyCol()
		LV_Modify(0, "-Select")
		SB_SetText("Added " rjadnum " ROMs and Jackets")
		guicontrol,,RLSTOT,%rjadnum% items
	}
return

ALPHAVALUES:
A:= 11
B:= 12
C:= 13
D:= 14
E:= 15
F:= 16
G:= 17
H:= 18
I:= 19
J:= 20
K:= 21
L:= 22
M:= 23
N:= 24
O:= 25
P:= 26
Q:= 27
R:= 28
S:= 29
T:= 30
U:= 31
V:= 32
W:= 33
X:= 34
Y:= 35
Z:= 36
return

RJREMSUBD:
gui,submit,nohide
guicontrolget,RJSUBDCBX,,RJSUBDCBX
SUBDRM=
SUBDRW=
subdna=
IniRead,cursubd,rj\cur.ini,%RJSYSDD%,RJSUBDS
Loop, parse, SUBDLST,|
		{
		if (A_LoopField = "")
			{
				continue
			}
		subda1=
		subda2=
		stringsplit,subda,A_LoopField,:
		if (subda1 = RJSUBDCBX)
			{
				return
			}
	}
Loop, Parse, cursubd,|
	{
		subda1=
		subda2=
		stringsplit,subda,A_LoopField,:
		if (subda1 <> RJSUBDCBX)
			{
				SUBDRM.= subda1 . "|"
				SUBDRW.= A_LoopField . "|"
			}
	}
guicontrol,,RJSUBDCBX,|%SUBDRM%
stringreplace,SUBDRW,SUBDRW,||,|,All
IniWrite,%SUBDRW%,rj\cur.ini,%RJSYSDD%,RJSUBDS
return

RJADDSUBD:
gui,submit,nohide
guicontrolget, RJSUBDH,,RJSUBDH
guicontrolget,RJSUBDCBX,,RJSUBDCBX
subdna=
Loop, parse, SUBDLST,|
	{
		if (A_LoopField = RJSUBDCBX)
			{
				subdna= 1
			}
	}
if (subdna = 1)
	{
		return
	}
RJSUBDS=
IniRead, RJSUBDS,rj\cur.ini,%RJSYSDD%,RJSUBDS
RJSUBDLSTSW=
RJSUBDLSTSR=
Loop, parse, RJSUBDS,|
	{
		rjsubh1=
		rjsubh2=
		stringsplit,rjsubh,A_LoopField,:
		if (rjsubh1 = RJSUBDCBX)
			{
				subdna= 1
				continue
			}
			RJSUBDLSTSR.= rjsubdh1 . "|"
			RJSUBDLSTSW.= A_LoopField . "|"
		}
if (subdna = 1)
	{
		IniWrite,%RJSUBDLSTSW%,rj\cur.ini,%RJSYSDD%,RJSUBDS
		return
	}
RJSUBDLSTSW=
RJSUBDLSTSR:= RJSUBDCBX . "|"
Loop, parse, RJSUBDS,|
	{
		subda1=
		subda2=
		stringsplit,subda,A_LoopField,:
		RJSUBDLSTSR.= subda1 . "|"
		RJSUBDLSTSW.= A_LoopField . "|"
	}
guicontrol,,RJSUBDCBX,|%RJSUBDLSTSR%
stringreplace,RJSUBDLSTSW,RJSUBDLSTSW,||,|,All
IniWrite, %RJSUBDCBX%:%RJSUBDH%|%RJSUBDLSTSW%,rj\cur.ini,%RJSYSDD%,RJSUBDS
return

RJENLNCHR:
gui,submit,nohide
guicontrolget,RJENLNCHR,,RJENLNCHR
if (RJENLNCHR = 1)
		{
			guicontrol,enable,RJLNCHOVR
			guicontrol,enable,RJRAD4A
			guicontrol,enable,RJRAD4B
			guicontrol,enable,RJEMUPRECFG
			guicontrol,enable,RJEMUPRM
			guicontrol,enable,RJCHKQ
			guicontrol,enable,RJEXEB
			guicontrol,enable,RJBUTM
			guicontrol,enable,RJCHKK
		}
guicontrolget,RJRAD4A,,RJRAD4A
CREATELNCH= 3
if (RJRAD4A = 1)
	{
		CREATELNCH= 2
	}
if (RJENLNCHR = 0)
		{
			guicontrol,disable,RJLNCHOVR
			guicontrol,disable,RJRAD4A
			guicontrol,disable,RJRAD4B
			guicontrol,disable,RJEMUPRECFG
			guicontrol,disable,RJEMUPRM
			guicontrol,disable,RJEXEB
			guicontrol,disable,RJCHKQ
			guicontrol,disable,RJBUTM
			guicontrol,disable,RJCHKK
			CREATELNCH= 0
		}
IniWrite, %CREATELNCH%,rj\cur.ini,%RJSYSDD%,RJLNCHCFG
return

RJLNCHOVR:
gui,submit,nohide
guicontrolget,RJLNCHOVR,,RJLNCHOVR
if (RJLNCHOVR = 0)
	{
		gui, font,normal
		guicontrol, font, RJLNCHOVR
		guicontrol,,RJLNCHOVR,Overwrite
	}
if (RJLNCHOVR = 1)
	{
		gui, font, %fontXlg% bold
		guicontrol, font, RJLNCHOVR
		guicontrol,,RJLNCHOVR,Overwrite
		gui, font, %fontXmed% normal
	}
IniWrite,%RJLNCHOVR%,rj\cur.ini,%RJSYSDD%,RJLNCHCFGOW
return

RJEXEB:
gui,submit,nohide
guicontrolget,RJEXEB,,RJEXEB
if (RJEXEB = 1)
	{
		SB_SetText("**** WARNING **** ''Per-EXE'' can be a very disk-expensive and slow option ******* WARNING ******")
	}
IniWrite,%RJEXEB%,rj\cur.ini,%RJSYSDD%,RJPROPXE
return

RJCHKF:
gui,submit,nohide
guicontrolget,RJCHKF,,RJCHKF
if (RJCHKF = 1)
		{
		guicontrol, enable, RJCHKO
		guicontrol, enable, RJRAD6A
		guicontrol, enable, RJRAD6B
		guicontrol, enable, RJCPYMVCFGA
		guicontrol, enable, RJCPYMVCFGB
		guicontrol, enable, RJPRECFGCBX
		guicontrol, enable, RJADDPRECFG
		guicontrol, enable, RJREMPRECFG
		guicontrol, enable, RJPOSTCFGCBX
		guicontrol, enable, RJADDPOSTCFG
		guicontrol, enable, RJREMPOSTCFG
		}
if (RJCHKF = 0)
		{
		guicontrol, disable, RJCHKO
		guicontrol, disable, RJRAD6A
		guicontrol, disable, RJRAD6B
		guicontrol, disable, RJCPYMVCFGA
		guicontrol, disable, RJCPYMVCFGB
		guicontrol, disable, RJPRECFGCBX
		guicontrol, disable, RJADDPRECFG
		guicontrol, disable, RJREMPRECFG
		guicontrol, disable, RJPOSTCFGCBX
		guicontrol, disable, RJADDPOSTCFG
		guicontrol, disable, RJREMPOSTCFG
		}
IniWrite, %RJCHKF%,rj\cur.ini,%RJSYSDD%,RJEMUCFG
return

RJCHKG:
gui,submit,nohide
GuiControlGet, RJCHKG
If (RJCHKG)
   RJRN1.OnMessage()
Else
   RJRN1.OnMessage(False)
return

RJENCNSLD:
gui,submit,nohide
guicontrol,, RJCNSLDD,|Individuate||()[]|()|[]
guicontrolget,RJENCNSLD,,RJENCNSLD
guicontrol,enable,RJCNSLDD
if (RJENCNSLD = 1)
	{
		guicontrol,, RJCNSLDD,|()[]||()|[]|Individuate
	}
guicontrolget,RJCNSLDD,,RJCNSLDD
IniWrite,%RJCNSLDD%,rj\cur.ini,%RJSYSDD%,RJCONSOLID
return

RJENDMNT:
gui,submit,nohide
guicontrolget,RJENDMNT,,RJENDMNT
if (RJENDMNT = 1)
		{
			guicontrol,enable,RJDMNTDD
			guicontrol,enable,RJENDMOV
			guicontrol,enable,RJRAD8A
			guicontrol,enable,RJRAD8B
			guicontrol,enable,RJDIMGET
		}
if (RJENDMNT = 0)
		{
			guicontrol,disable,RJDMNTDD
			guicontrol,disable,RJENDMOV
			guicontrol,disable,RJRAD8A
			guicontrol,disable,RJRAD8B
			guicontrol,disable,RJDIMGET
		}
iniwrite,%RJENDMNT%,rj\cur.ini,%RJSYSDD%,RJDISCMNT
return

RJCHKA:
gui,submit,nohide
guicontrolget,RJCHKA,,RJCHKA
if (RJCHKA = 1)
		{
			guicontrol,enable,RJENCNSLD
			guicontrol,enable,RJENXTRARC
		}
if (RJCHKA = 0)
		{
			guicontrol,disable,RJENCNSLD
			guicontrol,disable,RJENXTRARC
			guicontrol,disable,RJXTRARCA
			guicontrol,disable,RJXTRARCB
			guicontrol,disable,RJXTRARCDD
		}
IniWrite, %RJCHKA%,rj\cur.ini,%RJSYSDD%,RJACKET
return

RJENXTRARC:
gui,submit,nohide
guicontrolget,RJENXTRARC,,RJENXTRARC
if (RJENXTRARC = 1)
		{
			guicontrol,enable,RJXTRARCA
			guicontrol,enable,RJXTRARCB
			guicontrol,enable,RJXTRARCDD
		}
if (RJENXTRARC = 0)
		{
			guicontrol,disable,RJXTRARCA
			guicontrol,disable,RJXTRARCB
			guicontrol,disable,RJXTRARCDD
			guicontrol,,RJXTRARCDD,|Keep||Store|Delete
			RJEXTRARC= 0
			return
		}
guicontrolget,RJXTRARCA,,RJXTRARCA
if (RJXTRARCA = 1)
	{
		RJEXTRARC= 1
	}
if (RJXTRARCA = 0)
	{
		RJEXTRARC= 2
	}
IniWrite, %RJENXTRARC%,rj\cur.ini,%RJSYSDD%,RJEXTRARC
return

RJENMAP:
gui,submit,nohide
guicontrolget,RJENMAP,,RJENMAP
if (RJENMAP = 1)
		{
			guicontrol, enable, RJOVKM
			guicontrol, enable, RJMAPDD
			guicontrol, enable, RJMAPRET
			guicontrol, enable, RJMAPRETOPN
			guicontrol, enable, RJMAP1ROFTYPA
			guicontrol, enable, RJMAP1ROFTYPB
			guicontrol, enable, RJMAP1ROFTYPC
			guicontrol, enable, RJMAP1PL
			guicontrol, enable, RJMAP1PLOPN
			guicontrol, enable, RJMAP2ROFTYPA
			guicontrol, enable, RJMAP2ROFTYPB
			guicontrol, enable, RJMAP2ROFTYPC
			guicontrol, enable, RJMAP2PL
			guicontrol, enable, RJMAP2PLOPN
		}
if (RJENMAP = 0)
		{
			guicontrol, disable, RJOVKM
			guicontrol, disable, RJMAPDD
			guicontrol, disable, RJMAPRET
			guicontrol, disable, RJMAPRETOPN
			guicontrol, disable, RJMAP1ROFTYPA
			guicontrol, disable, RJMAP1ROFTYPB
			guicontrol, disable, RJMAP1ROFTYPC
			guicontrol, disable, RJMAP1PL
			guicontrol, disable, RJMAP1PLOPN
			guicontrol, disable, RJMAP2ROFTYPA
			guicontrol, disable, RJMAP2ROFTYPB
			guicontrol, disable, RJMAP2ROFTYPC
			guicontrol, disable, RJMAP2PL
			guicontrol, disable, RJMAP2PLOPN
		}
IniWrite, %RJENMAP%,rj\cur.ini,%RJSYSDD%,RJKEYON
return

RJSUBDCBX:
gui,submit,nohide
guicontrolget,RJSUBDCBX,,RJSUBDCBX
guicontrol,,RJSUBDH,0
subdvar=
IniRead,subdvar,rj\cur.ini,%RJSYSDD%,RJSUBDS
Loop, parse,subdvar,|
	{
		subdh1=
		subdh2=
		stringsplit,subdh,A_LoopField,:
			if (subdh1 = RJSUBDCBX)
				{
					if (subdh2 = 1)
						{
							guicontrol,,RJSUBDH,1
						}
				}
	}
return

RJSUBDH:
gui,submit,nohide
guicontrolget,RJSUBDCBX,,RJSUBDCBX
guicontrolget,RJSUBDH,,RJSUBDH
RJCHKOP= 1
if (RJSUBDH = 1)
	{
		RJCHKOP= 0
	}
subdvar=
IniRead,subdvar,rj\cur.ini,%RJSYSDD%,RJSUBDS
Loop, parse,subdvar,|
	{
		subdh1=
		subdh2=
		stringsplit,subdh,A_LoopField,:
			if (subdh1 = RJSUBDCBX)
				{
					if (subdh2 =RJCHKOP)
						{
							stringreplace, RJSUBDS, subdvar, %subdh1%:%RJCHKOP%, %subdh1%:%RJSUBDH%,All
							iniwrite, %RJSUBDS%,rj\cur.ini,%RJSYSDD%,RJSUBDS
						}
				}
	}
return

RJENDMOV:
gui,submit,nohide
return

RJZJP:
gui,submit,nohide
guicontrolget,RJZJP,,RJZJP
iniwrite, "%RJZJP%",rj\cur.ini,%RJSYSDD%,RJZIPPEEK
return

RJCHKJ:
gui,submit,nohide
SB_SetText("display jacket processing queue.")
return

RJCHKK:
gui,submit,nohide
guicontrolget,RJCHKK,,RJCHKK
IniWrite, %RJCHKK%,rj\cur.ini,%RJSYSDD%,RJABSOLROM
IniWrite, "`%ROMFN`%",rj\cur.ini,%RJSYSDD%,RJROMINJ
return

RJCHKL:
gui,submit,nohide
if (RJCHKL = 1)
	{
		guicontrol,enable,RJDELCOMP
	}
if (RJCHKP + RJCHKM + RJCHKL + RJCHKH + RJCHKI = 0)
	{
		guicontrol,disable,RJDELCOMP
	}
return

RJCHKM:
gui,submit,nohide
if (RJCHKM = 1)
	{
		guicontrol,enable,RJDELCOMP
	}
if (RJCHKP + RJCHKM + RJCHKL + RJCHKH + RJCHKI = 0)
	{
		guicontrol,disable,RJDELCOMP
	}
return

RJCHKH:
gui,submit,nohide
if (RJCHKG = 1)
	{
		guicontrol,enable,RJDELCOMP
	}
if (RJCHKP + RJCHKM + RJCHKL + RJCHKH + RJCHKI = 0)
	{
		guicontrol,disable,RJDELCOMP
	}
return

RJCHKI:
gui,submit,nohide
if (RJCHKI = 1)
	{
		guicontrol,enable,RJDELCOMP
	}
if (RJCHKP + RJCHKM + RJCHKL + RJCHKH + RJCHKI = 0)
	{
		guicontrol,disable,RJDELCOMP
	}
return

RJCHKP:
gui,submit,nohide
if (RJCHKP = 1)
	{
		guicontrol,enable,RJDELCOMP
	}
if (RJCHKP + RJCHKM + RJCHKL + RJCHKH + RJCHKI = 0)
	{
		guicontrol,disable,RJDELCOMP
	}
return

RJCHKO:
gui,submit,nohide
guicontrolget, RJCHKO,,RJCHKO
iniwrite, %RJCHKO%,rj\cur.ini,%RJSYSDD%,RJEMUCFGOV
return

RJCHKQ:
gui,submit,nohide
guicontrolget, RJCHKQ,,RJCHKQ
guicontrol,,RJCHKQ,Other
guicontrol,enable,RJBUTM
if (RJCHKQ = 1)
	{
		if (RJEMULOC = 0)
			{
				gosub, RJBUTM
				if (RJEMULOC = 0)
					{
						guicontrol,, RJCHKQ,0
						guicontrol,disable,RJBUTM
						iniwrite, 0,rj\cur.ini,%RJSYSDD%,RJEMULOC
						return
					}
			}
		guicontrol,,RJCHKQ,%rjemuxe%
		guicontrol,move,RJCHKQ,w60
		iniwrite, %RJEMULOC%,rj\cur.ini,%RJSYSDD%,RJEMULOC
		return
	}
iniWrite, 0,rj\cur.ini,%RJSYSDD%,RJEMULOC
return

RJCHKR:
gui,submit,nohide
guicontrolget,RJCHKR,,RJCHKR
if (RJCHKR = 1)
		{
			guicontrol,,RJCHKK,1
			guicontrol,enable,RJCBXJ
			guicontrolget,RJCBXJ,,RJCBXJ
		}
if (RJCHKR = 0)
		{
			guicontrol,disable,RJCBXJ
		}
iniwrite, %RJCHKR%,rj\cur.ini,%RJSYSDD%,RJMULTIDISC
iniwrite, $%RJCBXJ%$,rj\cur.ini,%RJSYSDD%,RJDISCIDENT
return

RJCHKU:
gui,submit,nohide
guicontrolget, RJCHKU,,RJCHKU
iniwrite, %RJCHKU%,rj\cur.ini,%RJSYSDD%,RJQUOTES
gosub, RJUPDATEDISP
return

RJCHKT:
gui,submit,nohide
guicontrolget, RJCHKT,,RJCHKT
iniwrite, %RJCHKT%,rj\cur.ini,%RJSYSDD%,RJPATH
gosub, RJUPDATEDISP
return

RJCHKS:
gui,submit,nohide
guicontrolget, RJCHKS,,RJCHKS
iniwrite, %RJCHKS%,rj\cur.ini,%RJSYSDD%,RJEXT
gosub, RJUPDATEDISP
return

RJMAP1PL:
gui,submit,nohide
guicontrolget, RJMAP1PL,,RJMAP1PL
IniWrite, %RJMAP1PL%,rj\cur.ini,%RJSYSDD%,RJPLYR1
return

RJPRECFGCBX:
gui,submit,nohide
guicontrolget,RJPRECFGCBX,,RJPRECFGCBX
return

RJPOSTCFGCBX:
gui,submit,nohide
guicontrolget,RJPOSTCFGCBX,,RJPOSTCFGCBX
return

RJMAPRET:
gui,submit,nohide
guicontrolget,RJMAPRET,,RJMAPRET
IniWrite, %RJMAPRET%,rj\cur.ini,%RJSYSDD%,RJMASTERPROF
return

RJCBXJ:
gui,submit,nohide
return

RJMAP2PL:
gui,submit,nohide
guicontrolget, RJMAP2PL,,RJMAP2PL
IniWrite, %RJMAP2PL%,rj\cur.ini,%RJSYSDD%,RJPLYR2
return

RJLNCHTYP:
gui,submit,nohide
RJLNCHP= 0
BLNKLNCH= 0
guicontrol,enable,RJEMUXTCBX
guicontrol,enable,RJCHKU
guicontrol,enable,RJCHKT
guicontrol,enable,RJCHKS
if (RJLNCHTYP = 0)
	{
		RJLNCHP= X
		BLNKLNCH= 1
		guicontrol,disable,RJEMUXTCBX
		guicontrol,disable,RJCHKU
		guicontrol,disable,RJCHKT
		guicontrol,disable,RJCHKS
	}
IniWrite, %RJLNCHP%,rj\cur.ini,%RJSYSDD%,RJLNCHP
return

RJEOPTSCBX:
gui,submit,nohide
guicontrolget,RJEOPTSCBX,,RJEOPTSCBX
stringreplace,RJEOPTSCBX,RJEOPTSCBX,%A_SPACE%,`<,All
IniWrite, %RJEOPTSCBX%,rj\cur.ini,%RJSYSDD%,RJEMUOPTS
gosub, RJUPDATEDISP
return

RRJEARGSCBX:
gui,submit,nohide
guicontrolget,RRJEARGSCBX,,RRJEARGSCBX
stringreplace,RRJEARGSCBX,RRJEARGSCBX,%A_SPACE%,`<,All
IniWrite, %RRJEARGSCBX%,rj\cur.ini,%RJSYSDD%,RJEMUARGS
gosub, RJUPDATEDISP
return

RJUPDATEDISP:
guicontrolget,RRJEARGSCBX,,RRJEARGSCBX
guicontrolget,RJEMUPRECFG,,RJEMUPRECFG
guicontrolget,RJEOPTSCBX,,RJEOPTSCBX
qsndr=
psndr=
esndr=
exesnp=
fpsnd= $EmulatorPath$\
rsndr= $ROM$
if (RJRAD1A <> 1)
	{
		fpsnd= $ROMPath$\..\
	}
if (rjchku = 1)
	{
		qesndr= "
		;"
		qsndr= "
		;"
	}
if (rjchkt= 1)
	{
		psndr= $ROMPath$\
	}
if (rjchks= 1)
	{
		esndr= .ExT
	}
iniread,exesndr,Apps.ini,EMULATORS,%RJEMUPRECFG%
exesndg= %exesndr%
splitpath,exesndg,exesndr,exesnp
if (exesndg = "ERROR")
	{
		ifinstring,rjemuprecfg,.exe
			{
				splitpath,RJEMUPRECFG,exesndr
			}
	}
stringreplace,RRJEARGSCBX,RRJEARGSCBX,[CUSTMOPT],%A_Space%,All
stringreplace,RRJEARGSCBX,RRJEARGSCBX,[EMUPATH],$EmulatorPath$,All
stringreplace,RRJEARGSCBX,RRJEARGSCBX,[ROMPATH],$ROMPath$,All
stringreplace,RRJEARGSCBX,RRJEARGSCBX,[CUSTMARG],,All
stringreplace,RRJEARGSCBX,RRJEARGSCBX,<,%A_Space%,All
stringreplace,RJEOPTSCBX,RJEOPTSCBX,[CUSTMOPT],%A_Space%,All
stringreplace,RJEOPTSCBX,RJEOPTSCBX,[EMUPATH],$EmulatorPath$,All
stringreplace,RJEOPTSCBX,RJEOPTSCBX,[ROMPATH],$ROMPath$,All
stringreplace,RJEOPTSCBX,RJEOPTSCBX,[CUSTMARG],,All
stringreplace,RJEOPTSCBX,RJEOPTSCBX,<,%A_Space%,All
SB_SetText(" " fpsnd "" exesndr "" RJEOPTSCBX "" qsndr "" psndr "" rsndr "" esndr "" qesndr ""RRJEARGSCBX "")
return

RJEMUXTCBX:
gui,submit,nohide
guicontrolget, RJEMUXTCBX,,RJEMUXTCBX
stringreplace,RJEMUXTCBX,RJEMUXTCBX,",,All
;"
stringreplace,RJEMUXTCBX,RJEMUXTCBX,*,,All
stringreplace,RJEMUXTCBX,RJEMUXTCBX,%A_Space%,,All
stringreplace,RJEMUXTCBX,RJEMUXTCBX,`%,,All
RJEXTENSIONS= %RJEMUXTCBX%
stringreplace,RJEXTENSIONS,RJEXTENSIONS,[ROM],`%ROM`%
stringreplace,RJEXTENSIONS,RJEXTENSIONS,[ROMF],`%ROMF`%
stringreplace,RJEXTENSIONS,RJEXTENSIONS,[EMUL],`%EMUZ`%
stringreplace,RJEXTENSIONS,RJEXTENSIONS,[EMUL],`%EMUL`%
IniWrite, %RJEXTENSIONS%,rj\cur.ini,%RJSYSDD%,RJROMXT
return

RJMAPDD:
gui,submit,nohide
guicontrolget,RJMAPDD,,RJMAPDD
iniread, kmprloc,apps.ini,KEYMAPPERS,%RJMAPDD%
if (RJMAPDD = "Antimicro")
	{
		kmprxtn= .amgp
		splitpath,kmprloc,,kmprd
		guicontrol,,RJMAPRET,|%kmprd%\Mediacenter%kmprxtn%||%kmprd%\nolayout1%kmprxtn%
		guicontrol,,RJMAP1PL,|Player1%kmprxtn%||%kmprd%\nolayout1%kmprxtn%
		guicontrol,,RJMAP2PL,|Player2%kmprxtn%||%kmprd%\nolayout1%kmprxtn%
	}
if (RJMAPDD = "Xpadder")
	{
		kmprxtn= .xpadderprofile
		splitpath,kmprloc,,kmprd
		guicontrol,,RJMAPRET,|%kmprd%\Mediacenter%kmprxtn%||%kmprd%\nolayout1%kmprxtn%
		guicontrol,,RJMAP1PL,|Player1%kmprxtn%||%kmprd%\nolayout1%kmprxtn%
		guicontrol,,RJMAP2PL,|Player2%kmprxtn%||%kmprd%\nolayout1%kmprxtn%
	}
IniWrite, %RJMAPDD%,rj\cur.ini,%RJSYSDD%,RJKEYMAPPER
return

RJPREW:
return

RJPOSTW:
return

RJDDLF:
gui,submit,nohide
guicontrolget,RJDDLF,,RJDDLF
CMDRO= RJPREOPT
CMDRT= RJPRERUN
CMDRS= RJPREW
if (RJDDLF = "Post-Command")
	{
		CMDRO= RJPOSTOPT
		CMDRT= RJPOSTRUN
		CMDRS= RJPOSTW
	}
IniRead, ADDFN,rj\cur.ini,%RJSYSDD%,%CMDRT%
guicontrol,,RJDDLP,|%ADDFN%
return

RJDMNTDD:
gui,submit,nohide
guicontrolget,RJDMNTDD,,RJDMNTDD
return

RJCNSLDD:
gui,submit,nohide
guicontrolget,RJCNSLDD,,RJCNSLDD
if (RJCNSLDD = "Individuate")
	{
		guicontrol,disable,RJCNSLDD
		guicontrol,,RJENCNSLD,0
	}
iniwrite,%RJCNSLDD%,rj\cur.ini,%RJSYSDD%,RJCONSOLID
return

RJQLSTDD:
noqq=
RJDLTMP:= RJSYSDD
gui,submit,nohide
guicontrolget,RJQLSTDD,,RJQLSTDD
Guicontrol,,RJTXTAB, 1 System
Guicontrol,,RJPROCQ,CONFIRM 1
guicontrol,disable,RJADDQ
Loop, rj\*_q.tdb
	{
		rjvarn=
		rjmvr=
		splitpath,A_LoopFileName,,,,rjmvr
		StringTrimRight,rjvarn,rjmvr,2
		if (rjvarn = RJSYSDD)
			{
				guicontrol,disable,RJADDQ
			}
	}
if (RJQLSTDD = "QUEUE")
	{
		Guicontrol,,RJTXTAB,%RJQNUM%-Systems
		Guicontrol,,RJPROCQ,CONFIRM %RJQNUM%
		guicontrol,enable,RJADDQ
		gosub, OPENJACKOPT
		return
	}
gosub, MUTEJACKOPT
return

MUTEJACKOPT:
Loop, JACKETGUIITEMS,|
	{
		GUICONTROL,show,%A_LoopField%
	}
return

OPENJACKOPT:
Loop, JACKETGUIITEMS,|
	{
		GUICONTROL,hide,%A_LoopField%
	}
return

RJXTRARCDD:
gui,submit,nohide
guicontrolget, RJXTRARCDD,,RJXTRARCDD
if (RJXTRARCDD = "Store")
	{
		RJARCLOC= 0
	}
if (RJXTRARCDD = "Keep")
	{
		RJARCLOC= 1
	}
if (RJXTRARCDD = "Delete")
	{
		RJARCLOC= 2
	}
IniWrite, %RJARCLOC%,rj\cur.ini,%RJSYSDD%,RJARCLOC
return

RJSYSDD:
SWTCHINEMU=
ncfnd:= 8707
if (quryad = 1)
	{
		ncfnd= 3
	}
gui,submit,nohide
sleep, 1000
guicontrol,disable,RJADDQ
EMUSN=
PXSTCFG=
guicontrol,,RJLSTYP,|Jackets+ROMs||Jackets ONLY|ROMs ONLY|All file`s
guicontrolget,RJSYSDD,,RJSYSDD
if (RJSYSDD = "Systems")
	{
		LPLST=
		if (RJSYSDN <> "Systems")
			{
				guicontrol, ,RJSYSDD,|%RJSYSDN%||%systmfldrs%
				RJSYSDD= %RJSYSDN%
				guicontrol,enable,RJADDQ
				return
			}
		FileDelete, rj\%RJSYSDD%.tdb
		Gui, ListView, RJLSTV
		LV_Delete()
		guicontrol,enable,RJADDQ
		return
	}
QUEUEOPTIONSRESET:
ADDCTRLS= 
LSTCTRLS= disable
gosub, LSTCTRLS
guicontrol,,RJQLSTDD,|QUEUE||%SYSTMQ%
IfNotExist, rj\%RJSYSDN%.ini
	{
		if (RJSYSDD <> RJSYSDN)
			{
				if (RJSYSDN <> "Systems")
					{
						fileread,a,rj\dflt.ini
						fileread,v,rj\cur.ini
						if (a <> v)
							{
								MsgBox,3,No %RJSYSDN% config found,This configuration has not been saved.`nWould you like to save now?
								IfMsgBox,Yes
									{
										FileCopy,rj\cur.ini,rj\%RJSYSDN%.ini,1
										guicontrol,,RJSYSDD,|%RJSYSDD%||Systems|%systmfldrs%
									}
								IfMsgBox,Cancel
									{
										gui,submit, nohide
										guicontrol,,RJSYSDD,|%RJSYSDN%||Systems|%systmfldrs%
										return
									}
								IfMsgBox,No
									{
										gui,submit, nohide
										filedelete,rj\dflt.ini
										filedelete,rj\cur.ini
										guicontrol,,RJSYSDD,|%RJSYSDD%||Systems|%systmfldrs%
									}
							}
					}
			}
	}
RJSYSDN= %RJSYSDD%
CMDRO= RJPREOPT
CMDRT= RJPRERUN
CMDRS= RJPREW
optn=
guicontrolget, RJCHKG,,RJCHKG
guicontrolget, RJLSTYP,,RJLSTYP
rjlistview=
FileDelete, rj\dflt.ini
FileDelete, rj\cur.ini
guicontrol,,RJSYSRADB,1
RJSYSDD_TDB=
gosub, OPENJACKOPT
EXSTCFG= rj\dflt.ini
ifexist, rj\%RJSYSDD%.ini
	{
		guicontrol,,RJSYSRADC,1
		EXSTCFG= rj\%RJSYSDD%.ini
		PXSTCFG= 1
	}
FLTHRU:
Iniread,defprefs,emuCfgPresets.ini,ROMJACKETS
guicontrolget,RJEMUPRECFG,,RJEMUPRECFG
Loop, parse, defprefs,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		defprfx1=
		defprfx2=
		defprfx3=
		defprfx4=
		defprfx5=
		defprfx6=
		stringsplit, defprfx,A_LoopField,=
		if (defprfx3 <> "")
			{
				defprfx3= =%defprfx3%
			}
		if (defprfx4 <> "")
			{
				defprfx4= =%defprfx4%
			}
		if (defprfx5 <> "")
			{
				defprfx5= =%defprfx5%
			}
		if (defprfx6 <> "")
			{
				defprfx6= =%defprfx6%
			}
		IniWrite,%defprfx2%%defprfx3%%defprfx4%%defprfx5%%defprfx6%,rj\dflt.ini,%RJSYSDD%,%defprfx1%
	}
READEMUINTORJ:
guicontrolget,RJEMUPRECFG,,RJEMUPRECFG
IniRead,RJEMURMPG,emuCfgPresets.ini,%RJSYSDD%,RJEMUPRESET
if (SWITCHINEMU <> "")
	{
		RJEMURMPG= %RJEMUPRECFG%
	}
Iniread,syspref,emuCfgPresets.ini,%RJSYSDD%
if (syspref <> "")
	{
		loop, parse, syspref,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				QARP1=
				QARP2=
				QARP3=
				QARP4=
				QARP5=
				QARP6=
				stringsplit,QARP,A_LoopField,?
				if (QARP2 <> "")
					{
						sysqv1=
						sysqv2=
						sysqv3=
						sysqv4=
						sysqv5=
						sysqv6=
						StringSplit,sysqv,QARP2,=
						if (sysqv3 <> "")
							{
								sysqv3= =%sysqv3%
							}
						if (sysqv4 <> "")
							{
								sysqv4= =%sysqv4%
							}
						if (sysqv5 <> "")
							{
								sysqv5= =%sysqv5%
							}
						if (sysqv6 <> "")
							{
								sysqv6= =%sysqv6%
							}
						if (sysqv2 = "RJEMUOPTS")
								{
									if (QARP1 = RJEMURMPG)
										{
											ejespl1=
											stringreplace,sysqv2,sysqv2,%A_Space%,<,All
											stringsplit,ejespl,sysqv2,|
											Iniwrite, %ejespl1%,rj\dflt.ini,%RJSYSDD%,RJEMUOPTS
											;;guicontrol,,RJEOPTSCBX,|%ejespl1%||%sysqv2%|%INJOPT%
											guicontrol,,RJEOPTSCBX,|%ejespl1%||%sysqv2%
											continue
										}
								}
						if (sysqv2= "RJEMUARGS")
								{
									if (QARP1 = RJEMUPRECFG)
										{
											ejespl1=
											stringreplace,sysqv2,sysqv2,%A_Space%,<,All
											stringsplit,ejespl,sysqv2,|
											Iniwrite, %ejespl1%,rj\dflt.ini,%RJSYSDD%,RJEMUARGS
											;;guicontrol,,RJEARGSCBX,|%ejespl1%||%sysqv2%|%INJARG%
											guicontrol,,RJEARGSCBX,|%ejespl1%||%sysqv2%
											continue
										}
								}
					}
				curepref1=
				curepref2=
				curepref3=
				curepref4=
				curepref5=
				curepref6=
				stringsplit,curepref,A_LoopField,=
				if (curepref3 <> "")
					{
						curepref3= =%curepref3%
					}
				if (curepref4 <> "")
					{
						curepref4= =%curepref4%
					}
				if (curepref5 <> "")
					{
						curepref5= =%curepref5%
					}
				if (curepref6 <> "")
					{
						curepref6= =%curepref6%
					}
				nnen1=
				nnen2=
				stringsplit,nnen,A_LoopField,?
				if (nnen2 <> "")
					{
						continue
					}
				IniWrite,%curepref2%%curepref3%%curepref4%%curepref5%%curepref6%,rj\dflt.ini,%RJSYSDD%,%curepref1%
				continue
			}
	}
RJEMUPRESET=
Iniread,RJEMUPRESET,%EXSTCFG%,%RJSYSDD%,RJEMUPRESET
if (SWTCHINEMU <> "")
	{
		RJEMUPRESET= %RJEMUPRECFG%
	}
Iniread,emupref,emuCfgPresets.ini,%RJEMUPRESET%
if (emupref <> "")
	{
		loop, parse, emupref,`n`r
			{
				curepref1=
				curepref2=
				curepref3=
				curepref4=
				curepref5=
				curepref6=
				stringsplit,curepref,A_LoopField,=
				if (curepref3 <> "")
					{
						curepref3= =%curepref3%
					}
				if (curepref4 <> "")
					{
						curepref4= =%curepref4%
					}
				if (curepref5 <> "")
					{
						curepref5= =%curepref5%
					}
				if (curepref6 <> "")
					{
						curepref6= =%curepref6%
					}
				IniWrite,%curepref2%%curepref3%%curepref4%%curepref5%%curepref6%,rj\dflt.ini,%RJSYSDD%,%curepref1%
			}
	}
FileCopy, %EXSTCFG%, rj\cur.ini,1
gosub, RJSYSRAD
Gui,listview,RJLSTV
LV_Delete()
if (RJSYSDD = "Systems")
	{
		LSTCTRLS= enable
		gosub, LSTCTRLS
		guicontrol,disable,RJADDQ
		return
	}
guicontrol,disable,RJADDQ
SB_SetText("Populating " RJSYSDD " ")
TOTFN=
TOTRN=
TOTJKTS=
LPRFX=
if (RJCHKG = 1)
	{
		LPRFX= %RJSYSDD%\
	}
rjlistview=
LPLST= 1
SB_SetText("Generating cache...")
gosub, RJFLTROMS
FileRead,RJSYSDD_TDB,rj\%RJSYSDD%.tdb
SB_SetText("Cache generated")
CURQN= 0
guicontrol,,RJINCEXCL,|All||A-Z|#
guicontrolget,RJCHKF,,RJCHKF
if (RJCHKF = 1)
	{
		guicontrolget,rjtmpemu,,RJEMUPRECFG
		gosub, EMUCFGCOPY
	}
if (PXSTCFG = "")
	{
		gosub, RJEMUPRECFG
	}
IfExist,rj\%RJSYSDD%_q.tdb
	{
		rjlistview=
		SB_SetText(" Populating items from the queue. ")
		LV_Delete()
		FileRead, RJSYSDD_FUL,rj\%RJSYSDD%.tdb
		FileRead, RJSYSDD_TDB,rj\%RJSYSDD%_q.tdb
		guicontrol,,RJCHKG,1
		if (RJCHKG = 1)
			{
				Loop, Parse, RJSYSDD_FUL,`n`r
					{
						if (A_LoopField = "")
							{
								continue
							}
						inclnum+=1
						lvachk= ""
						rjflz1=
						rjflz2=
						stringsplit,rjflz,A_LoopField,|
						ifinstring,RJSYSDD_TDB,%rjflz1%
							{
								lvachk= +Check
							}
						LV_Add(lvachk,rjflz1)
						rjlistview.= A_LoopField . "|"
					}
				LV_ModifyCol()
				LV_Modify(0, "-Select")
				LSTCTRLS= enable
				gosub, LSTCTRLS
				FileRead,RJSYSDD_TDB,rj\%RJSYSDD%_q.tdb
				SB_SetText(" Populated " RJSYSDD " . ")
			}
		guicontrol,enable,RJADDQ
		return
	}
guicontrol,,RLSTOT,%CURQN% items
OVRKND=
Loop, Parse, SysLLst,`n`r
	{
		LKUP1=
		LKUP2=
		LKUP3=
		stringsplit, LKUP, A_LoopField, =
		if (RJSYSDD = LKUP1)
			{
				OVRKND:= LKUP2
				SHRTXT:= LKUP3
				%LKUP2%= %LKUP1%
				SHRTN= % %LKUP2%
				break
			}
	}
if (SHRTXT = "")
	{
		SHRTXT= *.*
	}
if (OVRKND = "")
	{
	}
gosub, RJLSTYP
Loop, SYSTMQ,|
	{
		if (A_LoopField = RJSYSDD)
			{
				LSTCTRLS= enable
				gosub, LSTCTRLS
				return
			}
	}
LSTCTRLS= enable
gosub, ADDCTRLS
return

ADDCTRLS:
Loop,parse,ADDCTRLS,|
	{
		guicontrol,%LSTCTRLS%,%A_LoopField%
	}
LSTCTRLS:
Loop,parse,RJLSTCTRLSp,|
	{
		guicontrol,%LSTCTRLS%,%A_LoopField%
	}
return

RJFLTRALL:
FileDelete, rj\%RJSYSDD%.tdb
RJALLFILES= 1
Loop, %RJSYSTEMS%\%RJSYSDD%\*,2
	{
		inclnum+=1
		FileAppend,:%A_LoopFileName%|1`n,rj\%RJSYSDD%.tdb
	}
Loop, %RJSYSTEMS%\%RJSYSDD%\*.*
	{
		if A_LoopFileAttrib not contains H
			{
				inclnum+=1
				FileAppend,%A_LoopFileName%|1`n,rj\%RJSYSDD%.tdb
			}
	}
FileRead, RJSYSDD_TDB,rj\%RJSYSDD%.tdb
return

RJFLTROMS:
FileDelete,rj\%RJSYSDD%.tdb
RJALLFILES=
SB_SetText("...Iterating " RJSYSDD " database...")
Loop, %RJSYSTEMS%\%RJSYSDD%\*, 2
	{
		if A_LoopFileAttrib contains H
			{
				continue
			}
		TOTFN+=1
		FileAppend,:%A_LoopFileName%|1`n,rj\%RJSYSDD%.tdb
		if (LPLST = "")
			{
				FileDelete,rj\%RJSYSDD%.tdb
				break
			}
	}
SB_SetText("...building...")
Loop, %RJSYSTEMS%\%RJSYSDD%\*.*
	{
		if A_LoopFileAttrib contains H
			continue
		ext= %A_LoopFileExt%
		noapl=
		for k, v in ar
			{
				extm:= v
				if (ext = extm)
					{
						noapl= 1
					}
			}
		if (noapl = "")
			{
				TOTRN+=1
				FileAppend,%A_LoopFileName%|1`n,rj\%RJSYSDD%.tdb
				if (LPLST = "")
					{
						FileDelete,rj\%RJSYSDD%.tdb
						break
					}
			}
	}
FileRead, RJSYSDD_TDB,rj\%RJSYSDD%.tdb
return

RJEMUPRECFG:
gui,submit,nohide
guicontrolget, RJEMUTG,,RJEMUPRECFG
iniWrite, %RJEMUTG%,rj\cur.ini,%RJSYSDD%,RJEMUPRESET
gosub, EMUCFGCOPY
gosub, EMUPPSTPOP
SWTCHINEMU= 1
gosub, RJUPDATEDISP
return

EMUPPSTPOP:
lkupa=
lkupax=
lkupb=
lkupbx=
lkupc=
lkupd=
lkupe=
lkupf=
iniread,lkupa,emuCfgPresets.ini,%RJEMUTG%,RJEMUOPTS
ejespl1=
if (lkupa <> "ERROR")
	{
		stringsplit,ejespl,lkupa,|
		;;guicontrol,,RJEOPTSCBX,|%ejespl1%||%lkupa%|%INJOPT%
		guicontrol,,RJEOPTSCBX,|%ejespl1%||%lkupa%
		guicontrolget,RJEOPTSCBX,,RJEOPTSCBX
		iniWrite, %ejespl1%,rj\cur.ini,%RJSYSDD%,RJEMUOPTS
	}
if (lkupa = "ERROR")
	{
		lkupa=
		guicontrol,,RJEOPTSCBX,||%INJOPT%
		inidelete,RJEMUOPTS,rj\cur.ini,%RJSYSDD%
	}
ejespl1=
iniread, lkupax,emuCfgPresets.ini, %RJSYSDD%,%RJEMUTG%?RJEMUOPTS
if (lkupax <> "ERROR")
	{
		if (lkupa <> "")
			{
				lkupax:= lkupa . "|" . lkupax
			}
		stringsplit,ejespl,lkupax,|
		;;guicontrol,,RJEOPTSCBX,|%ejespl1%||%lkupax%|%INJOPT%
		guicontrol,,RJEOPTSCBX,|%ejespl1%||%lkupax%
		guicontrolget,RJEOPTSCBX,,RJEOPTSCBX
		iniWrite, %RJEOPTSCBX%,rj\cur.ini,%RJSYSDD%,RJEMUOPTS
	}
iniread, lkupb,emuCfgPresets.ini, %RJEMUTG%, RJEMUARGS
ejespl1=
if (lkupb <> "ERROR")
	{
		stringsplit,ejespl,lkupa,|
		;;guicontrol,,RRJEARGSCBX,|%ejespl1%||%lkupb%|%INJARG%
		guicontrol,,RRJEARGSCBX,|%ejespl1%||%lkupb%
		guicontrolget,RRJEARGSCBX,,RRJEARGSCBX
		iniWrite, %RRJEARGSCBX%,rj\cur.ini,%RJSYSDD%,RJEMUARGS
	}
if (lkupb = "ERROR")
	{
		lkupb=
		guicontrol,,RRJEARGSCBX,||%INJARG%
		inidelete,RJEMUARGS,rj\cur.ini,%RJSYSDD%
	}
iniread, lkupbx,emuCfgPresets.ini, %RJSYSDD%, %RJEMUTG%?RJEMUARGS
ejespl1=
if (lkupbx <> "ERROR")
	{
		if (lkupb <> "")
			{
				lkupbx:= lkupbx . "|" . lkupb
			}
		stringsplit,ejespl,lkupbx,|
		;;guicontrol,,RRJEARGSCBX,|%ejespl1%||%lkupbx%|%INJARG%
		guicontrol,,RRJEARGSCBX,|%ejespl1%||%lkupbx%
		guicontrolget,RRJEARGSCBX,,RRJEARGSCBX
		iniWrite, %RRJEARGSCBX%,rj\cur.ini,%RJSYSDD%,%RJEMUTG%?RJEMUARGS
	}
iniread, lkupc,emuCfgPresets.ini, %RJEMUTG%, RJPRECFG
if (lkupc = "ERROR")
	{
		guicontrol,,RJPRECFGCBX,|
	}
if (lkupc <> "ERROR")
	{
		guicontrol,,RJPRECFGCBX,|%lkupc%||%RJPRECFGR%
		iniWrite, %lkupc%,rj\cur.ini,%RJSYSDD%,RJPRECFG
	}
iniread, lkupd,emuCfgPresets.ini, %RJEMUTG%, RJPOSTCFG
if (lkupd = "ERROR")
	{
		guicontrol,,RJPOSTCFGCBX,|
	}
if (lkupd <> "ERROR")
	{
		guicontrol,,RJPOSTCFGCBX,|%lkupd%||%RJPOSTCFG%
		iniWrite, %lkupd%,rj\cur.ini,%RJSYSDD%,RJPOSTCFG
	}
iniread, lkupd,emuCfgPresets.ini, %RJEMUTG%,RJEXTRARC
if (lkupd <> "ERROR")
	{
		guicontrol,,RJENXTRARC,0
		if (lkupd <> 0)
			{
				guicontrol,,RJENXTRARC,1
			}
	}
iniWrite, %lkupd%,rj\cur.ini,%RJSYSDD%,RJEXTRARC
iniread, lkupe,emuCfgPresets.ini, %RJEMUTG%, RJRUNDIR
if (lkupe <> "ERROR")
	{
		if (lkupe = 1)
			{
				guicontrol,,RJRAD1A,1
			}
		if (lkupe <> 1)
			{
				guicontrol,,RJRAD1B,1
			}
	}
iniWrite, %lkupe%,rj\cur.ini,%RJSYSDD%,RJRUNDIR
iniread, lkupf,emuCfgPresets.ini, %RJEMUTG%, RJROMXT
if (lkupf <> "ERROR")
	{
		guicontrol,,RJEMUXTCBX,|%lkupf%||%RJEMUXTCBX%
		iniWrite, %lkupf%,rj\cur.ini,%RJSYSDD%,RJROMXT
	}
return

RJINCEXCL:
gui,submit,nohide
guicontrolget,RJINCEXCL,,RJINCEXCL
guicontrol,,RJFNDINLST,Find
if (RJINCEXCL = "All")
	{
		guicontrol,hide,RJFLTRLST
		guicontrol,hide,RJTXTH
		guicontrol,hide,RJEDTD
		guicontrol,hide,RJEDTDN
		guicontrol,hide,RJEDTB
		guicontrol,hide,RJEDTBN
		RJLIMIT=
		gosub, RJLSTYP
	}
if (RJINCEXCL = "A-Z")
	{
		guicontrol,show,RJFLTRLST
		guicontrol,show,RJTXTH
		guicontrol,hide,RJEDTD
		guicontrol,show,RJEDTDN
		guicontrol,hide,RJEDTB
		guicontrol,show,RJEDTBN
		RJLIMIT= X
	}
if (RJINCEXCL = "#")
	{
		guicontrol,show,RJFLTRLST
		guicontrol,show,RJTXTH
		guicontrol,show,RJEDTD
		guicontrol,hide,RJEDTDN
		guicontrol,show,RJEDTB
		guicontrol,hide,RJEDTBN
		RJLIMIT= 1
	}
return

RJLSTYP:
gui,submit,nohide
Gui, ListView, RJLSTV
LV_Delete()
guicontrolget, RJLSTYP,,RJLSTYP
if (RJLSTYP = "Jackets+ROMs")
	{
		if (RJALLFILES = 1)
			{
				gosub, RJFLTROMS
			}
		inclnum=
		rjlistview=
		Loop, Parse, RJSYSDD_TDB,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				inclnum+=1
				lvachk= ""
				rjflz1=
				rjflz2=
				stringsplit,rjflz,A_LoopField,|
				if (rjflz2 = 1)
					{
						lvachk= +Check
					}
				LV_Add(lvachk,rjflz1)
			}
		LV_ModifyCol()
		LV_Modify(0, "-Select")
		SB_SetText("Added " inclnum " ROMs and Jackets")
		guicontrol,,RLSTOT,%inclnum% items
		return
	}
if (RJLSTYP = "Jackets ONLY")
	{
		inclnum=
		rjlistview=
		Loop, Parse, RJSYSDD_TDB,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				inclnum+=1
				rjflz1=
				rjflz2=
				rjflzl1=
				rjflzl2=
				stringsplit,rjflz,A_LoopField,|
				stringsplit,rjflzl,rjflz1,:
				if (rjflzl2 <> "")
					{
						lvachk= ""
						if (rjflz2 = 1)
							{
								lvachk= +Check
							}
						LV_Add(lvachk,rjflz1)
					}
			}
		LV_ModifyCol()
		SB_SetText("Added " inclnum " Jackets")
		guicontrol,,RLSTOT,%inclnum% items
		LV_Modify(0, "-Select")
		return
	}
if (RJLSTYP = "ROMs ONLY")
	{
		if (RJALLFILES = 1)
			{
				gosub, RJFLTROMS
			}
		inclnum=
		rjlistview=
		Loop, Parse, RJSYSDD_TDB,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				inclnum+=1
				rjflz1=
				rjflz2=
				rjflzl1=
				rjflzl2=
				stringsplit,rjflz,A_LoopField,|
				stringsplit,rjflzl,rjflz1,:
				if (rjflzl2 = "")
					{
						lvachk= ""
						if (rjflz2 = 1)
							{
								lvachk= +Check
							}
						LV_Add(lvachk,rjflz1)
					}
			}
		LV_ModifyCol()
		SB_SetText("Added " inclnum " ROMs")
		guicontrol,,RLSTOT,%inclnum% items
		return
	}
if (RJLSTYP = "All Files")
	{
		gosub, RJFLTRALL
		inclnum=
		rjlistview=
		Loop, Parse, RJSYSDD_TDB,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				lvachk= +Check
				stringsplit,inclxl,A_LoopField,|
				if (inclxl2 = 0)
					{
						lvachk= ""
					}
				inclnum+=1
				LV_Add(lvachk,inclxl1)
			}
		LV_ModifyCol()
		LV_Modify(0, "-Select")
		SB_SetText("Added " inclnum " items")
		guicontrol,,RLSTOT,%inclnum% items
		guicontrol,,RJLSTYP,|Jackets+ROMs||Jackets ONLY|ROMs ONLY|All Files
		return
	}
SB_SetText("Added " inclnum " items")
return

RJEDTA:
gui,submit,nohide
return

RJEDTB:
gui,submit,nohide
return

RJEDTBN:
gui,submit,nohide
return

RJEDTC:
gui,submit,nohide
guicontrolget,RJEDTC,,RJEDTC
return

RJEDTD:
gui,submit,nohide
return

RJEDTDN:
gui,submit,nohide
return

RJCPYMVCFG:
gui,submit,nohide
return

RJRad1A:
gui,submit,nohide
IniWrite, 1,rj\cur.ini,%RJSYSDD%,RJRUNDIR
gosub, RJUPDATEDISP
return

RJRad1B:
gui,submit,nohide
IniWrite, 0,rj\cur.ini,%RJSYSDD%,RJRUNDIR
gosub, RJUPDATEDISP
return

RJSYSRADB:
gui,submit,nohide
Iniread,syspref,emuCfgPresets.ini,%RJSYSDD%
if (syspref <> "ERROR")
	{
		loop, parse, syspref,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				curepref1=
				curepref2=
				curepref3=
				curepref4=
				curepref5=
				curepref6=
				stringsplit,curepref,A_LoopField,=
				if (curepref3 <> "")
					{
						curepref3= =%curepref3%
					}
				if (curepref4 <> "")
					{
						curepref4= =%curepref4%
					}
				if (curepref5 <> "")
					{
						curepref5= =%curepref5%
					}
				if (curepref6 <> "")
					{
						curepref6= =%curepref6%
					}
				IniWrite,%curpref2%,rj\%RJSYSDD%.ini,%RJSYSDD%,%curpref1%
			}
	}
return

RJSYSRADC:
gui,submit,nohide
return

RJRad4A:
gui,submit,nohide
return

RJRad4B:
gui,submit,nohide
return

RJSYSRAD:
gui,submit,nohide
guicontrolget,RJSYSRADA,,RJSYSRADA
if (RJSYSRADA = 1)
	{
		FileDelete,rj\%RJSYSDD%.ini
		gosub, QUEUEOPTIONSRESET
		EXSTCFG= rj\dflt.ini
	}
if (RJSYSRADB = 1)
	{
		EXSTCFG= rj\dflt.ini
	}
if (RJSYSRADC = 1)
	{
		EXSTCFG= rj\cur.ini
		ifexist,rj\%RJSYSDD%.ini
			{
				EXSTCFG= rj\%RJSYSDD%.ini
			}
	}
gosub, LOADRJINI
return

RJSYSRADA:
gui,submit,nohide
return

RJXTRARCA:
gui,submit,nohide
iniwrite,2,rj\cur.ini,%RJSYSDD%,RJEXTRARC
return

RJXTRARCB:
gui,submit,nohide
iniwrite,3,rj\cur.ini,%RJSYSDD%,RJEXTRARC
return

RJRad8A:
gui,submit,nohide
return

RJRad8B:
gui,submit,nohide
return

RJMAP2ROFTYPA:
gui,submit,nohide
guicontrol,,RJMAP2PL,|Player2%kmprtxn%||%kmprd%\nolayout2%kmprxtn%
IniWrite, Player2%kmprtxn%,rj\cur.ini,%RJSYSDD%,RJMAP2PL
IniWrite, 0,rj\cur.ini,%RJSYSDD%,RJMAP2ROFTYP
return

RJMAP2ROFTYPB:
gui,submit,nohide
guicontrol,,RJMAP2PL,|Player2%kmprtxn%||%kmprd%\nolayout2%kmprxtn%
IniWrite, Player2%kmprtxn%,rj\cur.ini,%RJSYSDD%,RJMAP2PL
IniWrite, 1,rj\cur.ini,%RJSYSDD%,RJMAP2ROFTYP
return

RJMAP2ROFTYPC:
gui,submit,nohide
guicontrol,,RJMAP2PL,|%kmprd%\nolayout2%kmprxtn%||Player2%kmprtxn%
IniWrite, %kmprd%\nolayout2%kmprxtn%,rj\cur.ini,%RJSYSDD%,RJMAP2PL
IniWrite, 2,rj\cur.ini,%RJSYSDD%,RJMAP2ROFTYP
return

RJOVKM:
gui,submit,nohide
guicontrolget, RJOVKM,,RJOVKM
IniWrite, %RJOVKM%,rj\cur.ini,%RJSYSDD%,RJKEYOW
return

RJMAP1ROFTYPA:
gui,submit,nohide
guicontrol,,RJMAP1PL,|Player1%kmprtxn%||%kmprd%\nolayout1%kmprxtn%
IniWrite, Player1%kmprtxn%,rj\cur.ini,%RJSYSDD%,RJMAP1PL
IniWrite, 0,rj\cur.ini,%RJSYSDD%,RJMAP1ROFTYP
return

RJMAP1ROFTYPB:
gui,submit,nohide
guicontrol,,RJMAP1PL,|Player1%kmprtxn%||%kmprd%\nolayout1%kmprxtn%
IniWrite, Player1%kmprtxn%,rj\cur.ini,%RJSYSDD%,RJMAP1PL
IniWrite, 1,rj\cur.ini,%RJSYSDD%,RJMAP1ROFTYP
return

RJMAP1ROFTYPC:
gui,submit,nohide
guicontrol,,RJMAP1PL,|%kmprd%\nolayout1%kmprxtn%||Player1%kmprtxn%
IniWrite, %kmprd%\nolayout1%kmprxtn%,rj\cur.ini,%RJSYSDD%,RJMAP1PL
IniWrite, 2,rj\cur.ini,%RJSYSDD%,RJMAP1ROFTYP
return

RJRad6A:
gui,submit,nohide
return

RJRad6B:
gui,submit,nohide
return

LOADRJINI:
gui,submit,nohide
ifnotexist, %MAMELOC%\%MAMEAPP%
	{
		MAMEAPP= mame.exe
		MAMELOC= apps\mame
	}
IniRead, allrjvals, %EXSTCFG%,%RJSYSDD%
IniRead, RJMAMENM, %EXSTCFG%,%RJSYSDD%,RJMAMENM
StringSplit,mamensp,mamenmz,-,%A_Space% ""
mamename:= mamensp1
fnd=
bibxl=
ifnotexist, %MAMELOC%\%MAMEAPP%
	{
		goto, ALLRJVR
	}
fileRead,lmini,lm.ini	
if (RJEMUPRECFG = "MAME - Arcade")
	{
		if (RJMAMENM <> 0)
			{
				newxtlst=
				Loop,parse,lmini,`n`r
						{
							if (A_LoopField = "")
								{
									continue
								}
							avn1=
							avn2=
							avn3=
							avn4=
							avn5=
							avn6=
							avn7=
							avn8=
							avn9=
							avn10=
							splsys1=
							stringsplit,splsys,A_LoopField,%A_Space%
							stringsplit,avn,A_LoopField,(),%A_Space%
							stringsplit,axn,A_LoopField,.,%A_Space%
							if (splsys1 = mamename)
								{
									medtyp:= avn2
									fnd+=1
								}
							tmpmed:= avn2
									if (tmpmed <> medtyp)
										{
											fnd+=1
											newxtlst=
										}
							if (splsys1 <> "")
								{
									if (splsys1 <> mamename)
										{
											fnd=
										}
								}
							if (fnd >= 1)
								{
									aar := Object()
									Loop, %axn0%
										{
											new= % (axn%a_index%)
											if (axn%a_index% <> "")
												{
													if (a_index <> 1)
														{
															aar.insert(new)
														}
												}
										}
									for k, v in aar
										{
											itrate=
											Loop, newtxtlst, `,
											if (A_LoopField = v)
												{
													itrate= 1
												}
											if (itrate = "")
												{
													newxtlst.= v . "`,"
												}
										}
									bibxl.= newxtlst . "=" . "`"" . avn . "`"" . "|"
								}
						}
							if (fnd = 1)
								{
									msgbox,1,,"%splsys1%`n%bibxl%"
								}
							if (splsys1 <> "")
								{
									if (splsys1 <> mamename)
										{
											fnd=
											axn1=
											axn2=
											axn3=
											axn4=
											axn5=
											axn6=
											axn7=
											axn8=
											axn9=
											axn10=
											axn11=
											axn12=
											axn13=
											axn14=
											axn15=
											axn16=
											axn17=
											axn18=
											axn19=
											axn20=
											axn21=
											axn22=
											axn23=
										}
								}
			}
	}
ALLRJVR:
BLNKLNCH=
Loop, Parse, allrjvals,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		rjaval1=
		rjaval2=
		rjaval3=
		rjaval4=
		rjaval5=
		rjaval6=
		emprs1=
		emprs2=
		emprs3=
		emprs4=
		stringsplit,emprs, A_LoopField,?
		if (emprs2 = "")
			{
				emprs2 = %emprs1%
			}
		stringsplit, rjaval, emprs2,=,$
		if (rjaval3 <> "")
			{
				rjaval2= %rjaval2%=%rjaval3%
			}
		if (rjaval4 <> "")
			{
				rjaval2= %rjaval2%=%rjaval4%
			}
		if (rjaval5 <> "")
			{
				rjaval2= %rjaval2%=%rjaval5%
			}
		if (rjaval6 <> "")
			{
				rjaval2= %rjaval2%=%rjaval6%
			}
		try gosub, %rjaval1%
		catch
			{
			}
	}
return

RJEMUPRESET:
gui,submit,nohide
guicontrol,,RJEMUPRECFG,|%rjaval2%||%emulist%
return

RJMAMENM:
gui,submit,nohide
RJMAMENAME:= rjaval2
return

RJMEDNM:
gui,submit,nohide
RJMEDNM:= rjaval2
return

RJEMULOC:
rjemuxe=
rjemulocd=
gui,submit,nohide
guicontrol,,RJCHKQ,0
guicontrol,,RJCHKQ,Other
RJEMULOC= 0
if (rjaval2 <> 0)
	{
		RJEMULOC:= rjaval2
		guicontrol,,RJCHKQ,1
		SplitPath,RJEMULOC,rjemuxe,rjemulocd
		guicontrol,move,RJCHKQ, w60
		guicontrol,,RJCHKQ,%rjemuxe%
	}
return

RJSYSCFG:
gui,submit,nohide
if (rjaval2 = 0)
	{
		guicontrol,,RJSYSRADC,1
		return
	}
if (rjaval2 = 1)
	{
		guicontrol,,RJSYSRADB,1
		return
	}
if (rjaval2 = 2)
	{
		guicontrol,,RJSYSRADC,1
		return
	}
guicontrol,,RJSYSRADB,1
return

RJEMUOPTS:
gui,submit,nohide
guicontrol,,RJEOPTSCBX,|%rjaval2%
return

RJEMUARGS:
guicontrol,,RRJEARGSCBX,|%rjaval2%
gui,submit,nohide
return

RJZIPPEEK:
gui,submit,nohide
stringreplace,rjaval2,rjaval2,",,All
;"
guicontrol,,RJZJP,%rjaval2%
return

RJQUOTES:
gui,submit,nohide
guicontrol,,RJCHKU,%rjaval2%
return

RJPATH:
gui,submit,nohide
guicontrol,,RJCHKT,%rjaval2%
return

RJEXT:
gui,submit,nohide
guicontrol,,RJCHKS,%rjaval2%
return

RJRUNDIR:
gui,submit,nohide
guicontrol,,RJRAD1B,1
if (rjaval2 = 1)
	{
		guicontrol,,RJRAD1A,1
	}
IniWrite,%rjaval2%,rj\cur.ini,%RJSYSDD%,RJRUNDIR
return

ROMNAME:
gui,submit,nohide
guicontrol,,RJCHKK,0
if (rjaval2 = 1)
	{
		guicontrol,,RJCHKK,1
	}
return

RJEMUCFG:
gui,submit,nohide
guicontrol,,RJCHKF,0
if (rjaval2 >= 1)
	{
		guicontrol,,RJCHKF,1
		ADDCTRLS.= "RJCHKO|RJRAD6A|RJRAD6B|RJPRECFGCBX|RJADDPRECFG|RJREMPRECFG|RJCPYMVCFGA|RJCPYMVCFGB|RJPOSTCFGCBX|RJADDPOSTCFG|RJREMPOSTCFG|"
	}
return

RJEMUCFGOV:
gui,submit,nohide
guicontrol,,RJCHKO,0
if (rjaval2 = 1)
	{
		guicontrol,,RJCHKO,1
	}
return

RJLNCHCFG:
gui,submit,nohide
guicontrol,,RJENLNCHR,0
if (rjaval2 >= 1)
	{
		guicontrol,,RJENLNCHR,1
		ADDCTRLS.= "RJLNCHOVR|RJRAD4A|RJRAD4B|RJEXEB|RJEMUPRECFG|RJEMUPRM|RJCHKQ|RJBUTM|RJCHKKK|"
	}
return

RJLNCHCFGOW:
gui,submit,nohide
guicontrol,,RJLNCHOVR,0
gui, font,normal
guicontrol, font, RJLNCHOVR
guicontrol,,RJLNCHOVR,Overwrite
if (rjaval2 = 1)
	{
		gui, font, %fontXlg% bold
		guicontrol, font, RJLNCHOVR
		guicontrol,,RJLNCHOVR,Overwrite
		gui, font, %fontXmed% normal
		guicontrol,,RJLNCHOVR,1
	}
return

RJDISCMNT:
gui,submit,nohide
guicontrol,,RJENDMNT,%rjaval2%
if (rjaval2 = 1)
	{
		ADDCTRLS.= "RJDMNTDD|RJDIMGET|RJRAD8A|RJRAD8B|RJENDMOV|"
	}
return

RJDISKMNTAPP:
gui,submit,nohide
return

RJDISCIMG:
gui,submit,nohide
return

RJSETLST:
gui,submit,nohide
return

RJNICEFLDR:
gui,submit,nohide
return

RJROMINJ:
gui,submit,nohide
return

RJPROPXE:
gui,submit,nohide
guicontrol,,RJEXEB,0
if (rjaval2 = 1)
	{
		guicontrol,,RJEXEB,1
	}
return

RJLNCHP:
gui, submit,nohide
guicontrol,,RJLNCHTYP, 1
BLNKLNCH= 0
if (rjaval2 = "X")
	{
		BLNKLNCH= 1
		guicontrol,,RJLNCHTYP, 0
	}
return

RJMULTIDISC:
gui,submit,nohide
guicontrol,,RJCHKR,%rjaval2%
if (rjaval2 = 1)
	{
		ADDCTRLS.= "RJCBXJ|"
	}
return

RJDISCIDENT:
gui,submit,nohide
guicontrol,,RJCBXJ,|%rjaval2%||
return

RJROMXT:
gui,submit,nohide
if (rjaval2 <> 0)
	{
		guicontrol,,RJEMUXTCBX,|%rjaval2%||.exe`,.cmd`,,bat|.bin`,.cue
	}
return

RJSUBDS:
gui,submit,nohide
Loop, Parse, rjaval2,|,""
	{
		subds1=
		subds2=
		subds3=
		subds4=
		subds5=
		subds6=
		subds7=
		subds8=
		subds9=
		subds10=
		stringsplit,subdz,A_LoopField,:,""
			if (A_Index = 1)
				{
					SUBDPOP.= subdz1 . "|" . "|"
					If (subdz2 = 1)
						{
							guicontrol,,RJSUBDH,1
						}
				continue
					}
				SUBDPOP.= subdz1 . "|"
	}
guicontrol,,RJSUBDCBX,|%SUBDPOP%
return

SETLST:
return
gui,submit,nohide
SETLST=
Loop, Parse, rjaval2, |
	{
		SETLST.= A_LoopField . "|"
	}
return

RJABSOLROM:
guicontrol,,RJCHKK,%rjaval2%
IniWrite, %rjaval2%,rj\cur.ini,%RJSYSDD%,RJABSOLROM
return

RJKEYMAPPER:
gui,submit,nohide
if (rjaval2 = 0)
	{
		rjaval2= %keympr%
	}
SplitPath,rjaval2,,,,keymprn
guicontrol,,RJMAPDD,|%rjaval2%||Antimicro|Xpadder
IniWrite, %rjaval2%,rj\cur.ini,%RJSYSDD%,RJKEYMAPPER
return

RJKEYON:
gui,submit,nohide
guicontrol,,RJENMAP,0
if (rjaval2 = 1)
	{
		iniread,kmpchkt,apps.ini,KEYMAPPERS,Xpadder
		if (kmpchkt <> "ERROR")
			{
				guicontrol,,RJENMAP,1
			}
		iniread,kmpchkt,apps.ini,KEYMAPPERS,Antimicro
		if (kmpchkt <> "ERROR")
			{
				guicontrol,,RJENMAP,1
			}
		ADDCTRLS.= "RJOVKM|RJMAPDD|RJMAPRET|RJMAPRETOPN|RJMAP1ROFTYPA|RJMAP1ROFTYPB|RJMAP1ROFTYPC|RJMAP1PL|RJMAP1PLOPN|RJMAP2ROFTYPA|RJMAP2ROFTYPB|RJMAP2ROFTYPC|RJMAP2PL|RJMAP2PLOPN|"
	}
return

RJKEYOW:
gui,submit,nohide
guicontrol,,RJOVKM,%rjaval2%
return

PEREMUCFG:
gui,submit,nohide
if (rjaval2 <> "")
	{
		PEREMUCFG= %rjaval2%
	}
IniWrite, %rjaval2%,rj\cur.ini,%RJSYSDD%,PEREMUCFG
return

RJMASTERPROF:
gui,submit,nohide
if (rjaval2 <> "")
	{
		guicontrol,,RJMAPRET,|%rjaval2%||%kmprd%\Mediacenter%kmprxtn%|%kmprd%\nolayout1%kmprxtn%
	}
guicontrolget,RJMAPRET,,RJMAPRET
IniWrite, %RJMAPRET%,rj\cur.ini,%RJSYSDD%,RJMASTERPROF
return

RJPLYR1:
gui,submit,nohide
if (rjaval2 <> "")
	{
		guicontrol,,RJMAP1PL,|%rjaval2%||Player1%kmprxtn%|%kmprd%\nolayout1%kmprxtn%
	}
guicontrolget,RJPLYR1,,RJMAP1PL
IniWrite, %RJPLYR1%,rj\cur.ini,%RJSYSDD%,RJPLYR1
return

RJPLYR2:
gui,submit,nohide
if (rjaval2 <> "")
	{
		guicontrol,,RJMAP2PL,|%rjaval2%||Player2%kmprxtn%|%kmprd%\nolayout2%kmprxtn%
	}
guicontrolget,RJPLYR2,,RJMAP2PL
IniWrite, %RJPLYR2%,rj\cur.ini,%RJSYSDD%,RJPLYR2
return

RJPOSTOPT:
gui,submit,nohide
guicontrol,,RJEDTO,
return

RJPREOPT:
gui,submit,nohide
guicontrol,,RJEDTO,
return

RJPRERUN:
gui,submit,nohide
guicontrol,,RJDDLP,|%rjaval2%| |
return

RJACKET:
gui,submit,nohide
guicontrol,,RJCHKA,0
if (rjaval2 = 1)
	{
		guicontrol,,RJCHKA,1
		ADDCTRLS.= "RJADDSUBD|RJREMSUBD|RJSUBDCBX|RJTXTA1|RJSUBDH|RJCNSLDD|RJENCNSLD|"
	}
return

RJCONSOLID:
gui,submit,nohide
guicontrol,disable,RJCNSLDD
guicontrol,,RJENCNSLD,%rjaval2%
if (rjaval2 = "Individuate")
	{
		guicontrol,,RJCNSLDD,|Individuate||()[]|()|[]
	}
if (rjaval2 <> "Individuate")
	{
		guicontrol,enable,RJCNSLDD
		guicontrol,,RJENCNSLD,1
		guicontrol,,RJCNSLDD,|%rjaval2%||()[]|()|[]|Individuate
	}
return

RJEXTRARC:
gui,submit,nohide
guicontrol,,RJENXTRARC,0
if (rjaval2 >= 1)
	{
		guicontrol,,RJENXTRARC,1
		ADDCTRLS.= "RJXTRARCA|RJXTRARCB|RJTXTK|RJRJXTRARCDD"
		if (rjaval2 = 2)
			{
				guicontrol,,RJXTRARCA,1
			}
		if (rjaval2 = 3)
			{
				guicontrol,,RJXTRARCB,1
			}
		}
return

RJARCLOC:
gui,submit,nohide
if (rjaval2 = 0)
	{
		guicontrol,,RJXTRARCDD,|Store||Delete|Keep
	}
return
if (rjaval2 = 1)
	{
		guicontrol,,RJXTRARCDD,|Delete||Store|Keep
	}
return
if (rjaval2 = 3)
	{
		guicontrol,,RJXTRARCDD,|Keep||Store|Delete
	}
return

RJPRECFG:
gui,submit,nohide
guicontrol,,RJPRECFGCBX,|%rjaval2%
return

RJPOSTCFG:
gui,submit,nohide
guicontrol,,RJPOSTCFGCBX,|%rjaval2%
return

RJPOSTRUN:
gui,submit,nohide
if (RJDDLF = "Post-Command")
	{
		guicontrol,,RJDDLP,|%rjaval2%| |
	}
return

CoreDerive:
qisf=
decore=
iniread,fiiw,Assignments.ini,ASSIGNMENTS
Loop, Parse, fiiw,`n`r
	{
		saik1=
		saik2=
		stringsplit,saik,A_LoopField,=,"
		;"
		saixe=
		if (saik1 = RJEMUTG)
			{
				ifinstring,saik2,.exe
					{
						splitpath,saik2,saixe,saixd,saixt,saixn
						Loop, Parse, EmuPartSet,`n`r
							{
								if (A_LoopField = "")
									{
										continue
									}
								empt1=
								empt2=
								empt3=
								empt4=
								stringsplit,empt,A_LoopField,<
								if (empt3 = saixe)
									{
										Loop,parse,supguiitems,|
											{
												if (A_LoopField = empt1)
													{
														decore= %A_LoopField%
														qisf= 1
														break
													}
											}
									}
							}
					}
				if (qisf = 1)
					{
						break
					}
			}
	}
return

ExtensionLookup:
if (ROMDRP = 1)
	{
		goto, DewDrop
	}
if (DDLU = 1)
	{
		dlx=
		iniread,apoa,Assignments.ini,OVERRIDES,
		Loop, Parse, apoa,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				appn1=
				appn2=
				stringsplit,appn,A_LoopField,=,"
				;"
				stringsplit,aij,appn2,|
				appn2= %aij1%
				if (appn1 = DDLUX)
					{
						coreseltst=
						ROMSYS= %appn1%
						dlx=
						aij1=
						stringsplit,aij,coreselv,|
						coreselv= %aij1%
						splitpath,coreselv, , ,dlx
						if (dlx <> "dll")
							{
								APLN= 1
							}
						return
					}
			}
		if (dlx <> "")
			{
				return
			}
	}
DewDrop:
tstxtn= .%inputext%
iniread,apov,Assignments.ini,OVERRIDES,
runadd=
overDD=
siv=
Loop, Parse, apov,`n`r
	{
		if ((A_LoopField = "") or (A_LoopField = A_Space) or (A_LoopField = A_Tab) or (A_LoopField = "`n"))
			{
				continue
			}
		appn1=
		appn2=
		stringsplit,appn,A_LoopField,=,"
		;"
		if (appn2 = "")
			{
				continue
			}
		Loop, Parse, appn2,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				if (appn2 = siv)
					{
						continue
					}
				overDD .= appn1 . "|"
				emutsta=
				IniRead,emutsta,Assignments.ini,ASSIGNMENTS,%appn2%
				if (emutsta = "")
					{
						continue
					}
				if (emutsta = "ERROR")
					{
						continue
					}
				ifinstring,runadd,|%appn2%|
					{
						continue
					}
				runadd .= "|" . appn2
				siv= %appn2%
			}
	}
runlistx=
runlistx:= corelist . runadd
stringreplace,runlistx,runlistx,||,|,All
stringreplace,runlistx,runlistx,||,|,All
stringleft,runltmp,runlistx,1
if (runltmp = "|")
	{
		stringtrimleft,runlistx,runlistx,1
	}
if (tstxtn = ".zip")
	{
		gosub, ZIPOpen
	}
gosub, ExtTables
if (EXTID = 1)
	{
		coreselv= %racr%
		if (RUNSYSCHNG = "")
			{
				goto, OVRAP
			}
		guicontrol,,LCORE,|%coreselv%||%runlist%
	}
if (ROMDRP = 1)
	{
		if (coreselv = "")
			{
				CHOSEN= 1
			}
	}
if (DDLU = 1)
	{
		return
	}
if (RUNCOREOVERRIDE <> "")
	{
		return
	}
if (coreselv = "")
	{
		goto, DDLS
	}
return

DDLS:
nslrt=
coreselv=
Gui,Add,DropDownList, w220 vUNKDDL gSUBDDL, Run with...||%runlistx%
gui, show, ,%tstxtn% file
return

SUBDDL:
cancel=
gui, submit, nohide
guicontrolget, coreselv,,UNKDDL
if (coreselv = "Run with...")
	{
		goto,DDLS
	}
OVRAP:
SplitPath,coreselv,cfn,cod,coe,con,cod
if (coe <> "dll")
	{
		iniread,OvrExtAs,Assignments.ini,ASSIGNMENTS,%coreselv%
		iniread,EPGC,AppParams.ini,%coreselv%,per_game_configurations
		iniread,RunOptions,AppParams.ini,%coreselv%,options
		ifinstring,coreselv,mame
			{
				iniread,RJMAMENM,emuCfgPresets.ini,%romsys%,RJMAMENM
				if ((mlmame = "")&&(if fileexist("lm.ini")))
					{
						gosub, MAMELMREAD
					}
				if (RJMAMENM <> "ERROR")
					{
						iniread,CUSTMOPTLST,emuCfgPresets.ini,%romsys%,MAME?RJEMUOPTS
						if (CUSTMOPTLST <> "ERROR")
							{
								Loop,Parse,CUSTMOPTLST,|
									{
										if (A_LoopField = "")
											{
												continue
											}
										coremsvc= 1
										stringreplace,CSTINJOPT,A_LoopField,<,%A_Space%,All
										stringreplace,CSTINJOPT,CSTINJOPT,[RJMAMESYS],%RJMAMENM%,All
										break
									}
							}
						ifinstring,RunOptions,[
							{
								if (coremsvc = 1)
									{
										coremsvc=
										ifinstring,coreselv,mame
											{
												ifinstring,CSTINJOPT,[RJ
													{
														nwextfnd= % (MAME_%RJMAMENM%_medtyps)
														splitpath,romf,,,xtnv
														ifinstring,romf,.zip
															{
																romfj1=
																romfj2=
																stringsplit, romfj, romf,#
																if (romf <> romfj1)
																	{
																		ifexist, %romfj1%
																			{
																				romf= %romfj1%
																			}
																	}
																partition=
																splitpath,romf,romtitle,rompth,xtnv,romname,romdrv
																concatcmd= "%S_KeyDir%\bin\7za.exe" l -slt "%romf%"
																StdOut := StdoutToVar_CreateProcess(concatcmd)
																partition=
																fext= %xtnv%
																gosub, zpkproc
															}
														Loop, Parse, nwextfnd,|
															{
																if (A_LoopField = "")
																	{
																		continue
																	}
																MEDP= %A_LoopField%
																stringreplace,MEDP,MEDP,%A_Space%,,All
																stringreplace,MEDP,MEDP,`n,,All
																stringreplace,MEDP,MEDP,`r,,All
																nweinxtf= % (MAME_%RJMAMENM%_%MEDP%_extyp)
																if (nweinxtf = "")
																	{
																		SB_SetText(" SYSTEM NOT FOUND ")
																		continue
																	}
																ifinstring,nweinxtf,%xtnv%
																	{
																		stringreplace,CSTINJOPT,CSTINJOPT,[RJRTYP],%MEDP%,All,UseErrorLevel
																		if (ERRORLEVEL <> 0)
																			{
																				CSTINJOPT= %RJMAMENM% -%MEDP%
																				break
																			}
																		stringreplace,CSTINJOPT,CSTINJOPT,[RJMAMESYS],%RJMAMENM%,All
																	}
															}
													}
											}
										stringright,cstchk,CSTINJOPT,1
										if (CSTINJOPT <> "")
											{
												if (cstchk <> A_Space)
													{
														stringleft,fea,CSTINJOPT,1
														if (fea = A_Space)
															{
																StringTrimLeft,CSTINJOPT,CSTINJOPT,1
															}
														stringright,fea,CSTINJOPT,1
														if (fea = A_Space)
															{
																StringTrimRight,CSTINJOPT,CSTINJOPT,1
															}
														stringreplace,RunOptions,RunOptions,[CUSTMOPT],%A_SPACE%%CSTINJOPT%%A_Space%,All
														CSTINJOPT=
													}
											}
									}
							}
						if (CSTINJOPT <> "")
							{
								CUSTMOPT= %CSTINJOPT%
								stringleft,afix,CUSTMOPT,1
								if (avix = A_Space)
									{
										stringtrimleft,CUSTMOPT,CUSTMOPT,1
									}
								stringright,afix,CUSTMOPT,1
								if (avix = A_Space)
									{
										stringtrimright,CUSTMOPT,CUSTMOPT,1
									}
								stringreplace,RunOptions,RunOptions,[CUSTMOPT],%A_Space%%CUSTMOPT%%A_Space%,All
								CSTINJOPT=
							}
					}
			}
		if (strmvid = 1)
			{
				;;stringreplace,RunOptions,RunOptions,[CUSTMOPT], --sout file/muxer:"[ROMPATH]\[ROMFILE]"%A_Space%,All
			}
		iniread,RunArgs,AppParams.ini,%coreselv%,arguments
		iniread,omtxt,AppParams.ini,%coreselv%,extension
		iniread,RunFrom,AppParams.ini,%coreselv%,run_location
		iniread,OMITQ,AppParams.ini,%coreselv%,no_quotes
		iniread,OMITPTH,AppParams.ini,%coreselv%,no_path
		iniread,EXTARUN,AppParams.ini,%coreselv%,EXTARUN
		SplitPath,OvrExtAs,emuexe,emupth,emuxtn,emuname,emudrv
		stringreplace,RunOptions,RunOptions,[CUSTMOPT],%A_SPACE%%CUSTMOPT%%A_SPACE%,All
		stringreplace,RunArgs,RunArgs,[CUSTMARG],%A_SPACE%%CUSTMARG%%A_SPACE%,All
		stringreplace,RunOptions,RunOptions,[ROMPATH],%A_SPACE%%rompth%%A_SPACE%,All
		stringreplace,RunArgs,RunArgs,[ROMPATH],%rompth%,All
		stringreplace,RunArgs,RunArgs,[ROMFILE],%romtitle%,All
		stringreplace,RunOptions,RunOptions,[EMUPATH],%emupth%,All
		stringreplace,RunOptions,RunOptions,[ROMFILE],%romtitle%,All
		stringreplace,RunArgs,RunArgs,[EMUPATH],%emupth%,All
		if (DDRUN = 1)
			{
				Gui, Destroy
			}
		goto, LNCHAPP
	}
guicontrol,,LCORE,%coreselv%|
return

ZipOpen:
FINR=
ziptmp= %tstxtn%
concatcmd= "%S_KeyDir%\bin\7za.exe" l -slt "%romf%"
StdOut := StdoutToVar_CreateProcess(concatcmd)
partition=
gosub, zpkproc
Loop,parse,rjgdsk,|
	{
		ROMZ= %A_LoopField%
		break
	}
splitpath,ROMZ,,,tstxtn,romname
tstxtn= .%tstxtn%
FINR= 1
return

OpnAssign:
if (sysrev = "")
	{
		return
	}
EXTID=
ROMSYS= %sysrev%
iniread,ari,Assignments.ini,OVERRIDES,%sysrev%
stringreplace,ari,ari,`n,|,All
stringreplace,ari,ari,",,All
;"
cvrve= 
crv= 
runfnd= |%runlistx%|
if (ari <> "")
	{
		Loop,parse,ari,|
			{
				if ((A_LoopField = "") or (A_LoopField = A_Space) or (A_LoopField = A_Tab) or (A_LoopField = "`n"))
					{
						continue 
					}
				if (A_Index = 1)
					{
						racr= %A_LoopField%
						crva= %A_LoopField%||
						continue
					}
				ifexist,%A_LibretroDirectory%\%A_LoopField%
					{
						cvrve.= A_LoopField . "|"
					}
				cvrv= %crva%%cvrve%	
				EXTID= 1
				return
			}
	}
ifinstring,SysLLst,%sysrev%=
	{
		iniread,esfe,emuCfgPresets.ini,%sysrev%,SUPEMU
		Loop,parse,esfe,|
			{
				if (A_LoopField = "")
					{
						continue
					}
				racr= %A_LoopField%
				if (A_Index = 1)
					{
						crva= %racr%||
						continue
					}
				ifinstring,runfnd,|%racr%|
					{
						cvrve.= racr . "|"
						EXTID= 1
					}
				return
			}
		iniread,esfc,emuCfgPresets.ini,%sysrev%,SUPCORE
		if (raexefile <> "")
			{
				Loop,parse,esfc,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						racr= %A_LoopField%
						ifexist,%A_LibretroDirectory%\%A_LoopField%
							{
								cvrve.= A_LoopField . "|"
							}
						ifinstring,corelist,%racr%
							{
								cvra= %A_LoopField%||
								EXTID= 1
							}
						cvrv= %cvra%%cvrve%
						return
					}
			}
	}
return

ExtTables:
sysrev=
if (romsz < 100000)
{
	goto, ToSZ
}
unknszstr= .nrg|.mdf|.ccd|.toc|.iso|.cdi|.cdz|.img|.cue
Loop,parse,unknszstr,|
	{
		if (tstxtr = A_LoopField)		
			{
				sysrev=
				gosub,OpnAssign
				return
			}
	}
if (tstxtn = ".gdi")
	{
		sysrev=%SEGDC%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".cso")or(tstxtn = ".ciso")or(tstxtn = ".jso")or(tstxtn = ".psp")or(tstxtn = ".prx")or(tstxtn = ".pbp"))
	{		
		sysrev=%SPLAYP%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".3ds")
	{		
		sysrev=%NN3DS%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".wbfs")
	{		
		sysrev=%NWII%
		gosub,OpnAssign
		Return
	}
ToSZ:
if (romsz < 10000)
	{
		goto, UNKSZ
	}
if ((tstxtn = ".ds")or(tstxtn = ".srl")or(tstxtn = ".nds")or(tstxtn = ".nd5"))
	{		
		sysrev=%NNDS%
		gosub,OpnAssign
		Return
	}
UNKSZ:
unkszstr= .bin|.hdf|.rom|.adf|.do|.po|.2mg|.cas|.xdf|.ipf|.dsk|.tap|.88d|.d88|.2dd|.2hd|.ssd|.dsd|.fdi|
Loop,parse,unkszstr,|
	{
		if (tstxtn = A_LoopField)		
				{
					sysrev=
					return
				}
	}
if ((tstxtn = ".dup")or(tstxtn = ".dim"))
	{
		sysrev=%SHARP68K%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".nhd")or(tstxtn = ".thd")or(tstxtn = ".vhd"))
	{		
		sysrev=%NPC98%
		gosub, OpnAssign
		Return
	}
MDSZ:
if ((tstxtn = ".pal")or(tstxtn = ".usa")or(tstxtn = ".u64")or(tstxtn = ".v64")or(tstxtn = ".n64")or(tstxtn = ".z64"))
	{
		sysrev=%NN64%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".j64")or(tstxtn = ".jag"))
	{
		sysrev=%ATJAG%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".adf")or(tstxtn = ".amiga"))
	{
		sysrev=%AMIG%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".32x")
	{
		sysrev=%SG32X%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".gba")
	{
		sysrev=%NNGBA%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".sgb")
	{
		sysrev=%NSGB%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".sgx")
	{		
		sysrev=%NSGX%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".smd")or(tstxtn = ".gen")or(tstxtn = ".md"))
	{
		sysrev=%SMEGAD%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".pco")
	{
		sysrev=%SPICO%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".sfc")
	{
		sysrev=%NSFAM%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".smc")
	{
		sysrev=%NSNES%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".bml")
	{
		sysrev= % %NSNES%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".pce")
	{
		sysrev=%NPCENG%
		gosub,OpnAssign
		Return
	}
SMSZ:
if (tstxtn = ".ngc")
	{
		sysrev=%SNEOPKTC%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".ngp")or(tstxtn = ".npk"))
	{
		sysrev=%SNEOPKT%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".gg")
	{
		sysrev=%SGG%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".int")or(tstxtn = ".intv"))
	{
		sysrev=%MINTEL%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".gb")
	{		
		sysrev=%NNGB%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".ws")
	{
		sysrev=%BWSWAN%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".msa")or(tstxtn = ".st")or(tstxtn = ".stx"))
	{
		sysrev=%ATST%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".lnx")
	{
		sysrev=%ATLNX%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".sg")
	{
		sysrev=%SSG1K%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".sms")
	{
		sysrev=%SEGMS%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".wsc")
	{
		sysrev=%BWSWANC%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".vec")
	{
		sysrev=%VECX%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".fds")or(tstxtn = ".fam"))
	{		
		sysrev=%NNFAM%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".gcm")
	{		
		sysrev=%NNGC%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".vb")or(tstxtn = ".vboy"))
	{		
		sysrev=%NNVB%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".obx")or(tstxtn = ".dcm")or(tstxtn = ".xex")or(tstxtn = ".pro")or(tstxtn = ".atz")or(tstxtn = ".xfd")or(tstxtn = ".atx")or(tstxtn = ".atr"))
	{
		sysrev=%AT8H%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".unf")or(tstxtn = ".nez")or(tstxtn = ".nsf")or(tstxtn = ".nes"))
	{		
		sysrev=%NNES%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".di1")or(tstxtn = ".di2")or(tstxtn = ".360")or(tstxtn = ".720")or(tstxtn = ".ri")or(tstxtn = ".sc")or(tstxtn = ".sf7")or(tstxtn = ".mx1")or(tstxtn = ".mx2"))
	{
		sysrev=%MSX%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".gbc")
	{
		sysrev=%NNGBC%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".a78")
	{		
		sysrev=%AT78%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".a52")
	{		
		sysrev=%AT52%
		gosub,OpnAssign
		Return
	}
if ((tstxtn = ".z26")or(tstxtn = ".a26"))
	{
		sysrev=%AT26%
		gosub,OpnAssign
		Return
	}
TNSZ:
if (tstxtn = ".scummvm")
	{		
		sysrev=%SCUMV%
		gosub,OpnAssign
		Return
	}
if (tstxtn = ".conf")
	{
		sysrev=%MSDOS%
		gosub,OpnAssign
		Return
	}
imgszset= .png|.bmp|.tif|.svg|.jpg|.gif|.psd
ifinstring,imgszset,%tstxtn%
	{
		sysrev=
		gosub,OpnAssign
	}
return

EDTFROM:
gui,submit,nohide
guicontrolget,KITLSN,,RUNROMCBX
if (CURRENTROM = KITLSN)
	{
		return
	}
CURRENTROM= %KITLSN%
ifnotinstring,KITLSN,:\
	{
		KITLSN= %RJSYSTEMS%\%OPTYP%\%romf%
	}
guicontrol,,MORROM,|%KITLSN%||%lsrchpop%
guicontrol,,hide,RUNROMCBX

EDTROM:
Gui, submit, nohide
guicontrolget,OPTYP,,RUNSYSDDL
Guicontrolget,romf,,MORROM
if (CURRENTROM = romf)
	{
		return
	}
lnchui= disable
Loop,parse,LNCH_UI,|
	{
		guicontrol,%lnchui%,%A_LoopField%
	}
CURRENTROM= %romf%
RUNSYSCHNG+=1
aemcfg=
curjport=
romindnum=
stilltyp:
ROMSYS= %OPTYP%
ifnotinstring,romf,:\
	{
		romf= %RJSYSTEMS%\%OPTYP%\%romf%
		guicontrol,,MORROM,%romf%||
	}
MORROM= %romf%
splitpath,MORROM,EDTRMF,EDTRMP,inputext,EDTRMFN
guicontrol,-Altsubmit,MORROM
gui,submit,nohide
indvcp=
if (romf = "")
	{
		lnchui= enable
		Loop,parse,LNCH_TUI,|
			{
				guicontrol,%lnchui%,%A_LoopField%
			}
		gosub, LNCHCHK
		RUNSYSCHNG=
		return
	}
if (romf = ".........indexing............")
	{
		lnchui= enable
		Loop,parse,LNCH_TUI,|
			{
				guicontrol,%lnchui%,%A_LoopField%
			}
		return
	}
cursli=
lnumfnd=
numfnd=
finumj=
optnt= 1
opcnt=
APLN= 1
newPlF=
stringtrimright,TRPTYP,OPTYP,4
if (RUNPLRAD = 1)
	{
		selectedplaylist= %playlistLoc%\%OPTYP%
		if (OPTYP = "History")
			{
				selectedplaylist= %historyloc%
			}
		ifinstring,selectedplaylist,.lpl
			{
				Loop, Read, %selectedplaylist%
					{
						if (A_LoopReadLine = "")
							{
								continue
							}
						ttnf1=
						ttnf2=
						stringreplace,kif,A_LoopReadLine,%A_Space%,,All
						stringreplace,kif,kif,%A_Tab%,,All
						if (kif = "{")
							{
								newPlF= 1
								continue
							}
						if (newPlF = 1)
							{
								ifinstring,A_LoopReadLine,"path":
									{
										lnumfnd:= A_Index+2
										finumj:= A_Index+3
										stringsplit,ttnx,A_LoopReadLine,"
										;"
										stringreplace,ttnf,ttnx4,\\,\,All
										;"
										rom_f= %ttnf%
										ifinstring,ttnf,.zip#
											{
												stringsplit,romhn,ttnf,#
												rom_f= %romhn2%
											}
											else {
													rom_f= %ttnf%
											}
										if (rom_f <> romf)
											{
												continue
											}
										filereadline,coreselz,%selectedplaylist%,%lnumfnd%
										
										stringreplace,coreselz,coreselz,"core_path":%A_Space%,,All
										stringreplace,coreselz,coreselz,\\,\,All
										stringreplace,coreselz,coreselz,",,All
										;"
										stringtrimright,coreselz,coreselz,1
										splitpath,coreselz,coreselj,,,corselm
										ifnotinstring,runlist,%corselm%
											{
												corselm= DETECT
											}
										coreselv= %corselm%
										if (corextnt = "exe")
											{
												filereadline,coreselz,%selectedplaylist%,%finumj%
												Stringreplace,coreselz,coreselz,"core_name":%A_Space%,,UseErrorLevel
												stringtrimright,coreselz,coreselz,1
												stringreplace,coreselz,coreselz,",,All
												;"
												coreselv= %coreselz%
											}
										if (coreselv <> "DETECT")
											{
												guicontrol,,LCORE,|%coreselv%||
											}
										break
									}
								continue
							}
						StringSplit,ttnf,A_LoopReadLine,#
						opcnt+=1
						if (romf = ttnf1)
							{
								numfnd= 1
								lnumfnd:= opcnt+2
								if (optnt = 1)
									{
										filereadline,coreselv,%playlistLoc%\%OPTYP%,%lnumfnd%
										splitpath,coreselv,coreselv
										if (coreselv <> "DETECT")
											{
												guicontrol,,LCORE,|%coreselv%||
											}
										break
									}
								if (romindnum = optnt)
									{
										filereadline,coreselv,%playlistLoc%\%OPTYP%,%lnumfnd%
										splitpath,coreselv,coreselv
										if (coreselv <> "DETECT")
											{
												guicontrol,,LCORE,|%coreselv%||
											}
										break
									}
							}
						if (opcnt = 6)
							{
								opcnt=
								optnt+=1
							}
					}
			}
		if (coreselv = "DETECT")
			{
				inpl= sets\Assignments.ini
				rersini:
				iniread,fijj,%inpl%,OVERRIDES,%TRPTYP%
				if (fijj = "ERROR")
					{
						if (inpl <> "sets\Assignments.set")
							{
								inpl= sets\Assignments.set
								goto, rersini
							}
						coreselv= mame_libretro.dll
					}
				Loop, Parse, fijj,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						Loop,parse,emulist,|
						if (A_LoopField = coreselv)
							{
								coreselv.= A_LoopField . "|"
							}
					}
				guicontrol,,LCORE,%coreselv%|
			}
		romfj1=
		romfj2=
		romtf=
		ziprom=
		izinc=
		izfr=
		ifinstring,romf,.zip#
			{
				stringsplit,romfj,romf,#
				ainc=
				Loop,%romfj0%
					{
						ainc+=1
						repn= % romfj%A_Index%
						stringright,ziptfj,repn,4
						if (ziptfj = ".zip")
							{
								romtf:= repn
								if (ainc > 1)
									{
										romtf:= romfrn . "#" . repn
										romf= %romtf%
										ziprom:= romtf
									}
								ainc=
								continue
							}
						romfrn.= repn . "#"
						if (romtf <> "")
							{
								izfr= % romfj%A_Index%
								ziprom:= izinc . "#" . izfr
								izinc.= "#" . izfr
							}
					}
			}
		stringmid,romhnck,romf,2,1
		if (romhnck <> ":")
			{
				ifexist, %raexedir%\%romfj1%
					{
						romf= %raexedir%\%romfj1%
						if (romfj2 <> "")
							{
								romf= %raexedir%\%romfj1%#%romfj2%
							}
					}
			}
	}
pgmargs=
SplitPath,romf,romtitle,rompth,romxt,romname
ifinstring,coreselv,_libretro.dll
	{
		APLN=
		if (PGM = 1)
			{
				stringreplace,ccv,coreselv,_libretro.dll
				gosub, getCREN
				Loop,%raexedir%\config\%corcfgnam%\%romname%.*
					{
						if (A_Index = 1)
							{
								pgmargs:= A_Space . "-appendconfig="
							}
						pgmargs.= "%A_LoopField%" . "|"
					}
			}	
	}
guicontrolget,coreselv,,LCORE
iniread,romnaov,GameOverrides.ini,%ROMSYS%,%romname%
if ((romnaov <> "ERROR")&&(AUTOPGS = 1))
	{
		coreselv= %romnaov%
		guicontrol,,LCORE,|%coreselv%|
	}
if ((FILT_UNSUP <> 1)&&(OPTYP <> "History"))
	{
		ifnotinstring,SysLLst,%OPTYP%=
			{
				gosub,RecentRead
			}
	}
corinjs= %coreselv%
ifinstring,corinjs,.dll
	{
		corinjs= retroarch
		guicontrol,hide,CustSwitchs
	}
	else {
		guicontrol,show,CustSwitchs
	}
if ((coreselve = "")or(coreselve = "|"))
	{
		coreselve= %coreselv%|
	}
guicontrol,,LCORE,|%coreselve%
r_noconf:
iniwrite, "%romf%",Settings.ini,GLOBAL,last_rom
lnchui= enable
Loop,parse,LNCH_TUI,|
	{
		guicontrol,%lnchui%,%A_LoopField%
	}
gosub, LNCHCHK
SK_MODE= 1
RUNSYSCHNG=
return

NEWROM:
if romf=
gosub, GetROM
return

GetROM:
ROMFileSel=
FileSelectFile, ROMFileSel, 3, , Select a ROM file, ROM (*.*)
if (ROMFileSel = "")
	{
		romf=
		return
	}
guicontrol,,EDTROMBTN,>
guicontrol,show,RUNROMCBX
guicontrol,hide,MORROM
romf= %ROMFileSel%
guicontrol,,RUNROMCBX, |%romf%||
guicontrol,,LCORE,||%runlist%
guicontrol,enable,LNCHBUT
guicontrol,enable,RCLCNCH
Gui, submit, nohide
return

RecentRead:
guicontrolget,coreselv,,LCORE
guicontrolget,RSYSDL,,RUNSYSDDL
splitpath,coreselv,,,dlx
guicontrolget,TOXTN,,MORROM
ttnf1=
ttnf2=
StringSplit,ttnf,TOXTN,#
if (ttnf2 = "")
	{
		ttnf2= %ttnf1%
	}
SplitPath,ttnf2,,,inputext
FileGetSize,romsz,%ttnf1%,K
plpcr=
if (RUNPLRAD = 1)
	{
		selectedplaylist= %playlistLoc%\%RSYSDL%
		SplitPath,TOXTN,rton,rtod,inputext
		FileGetSize,romsz,%TOXTN%,K
		if (OPTYP = "History")
			{
				selectedplaylist= %historyloc%
			}
		APLN= 1
		if (dlx = "dll")
			{
				APLN=
			}
		if (qmen = 1)
			{
				qmen=
				return
			}
		gosub, ExtensionLookup
		if (coreselv = "")
			{
				SB_SetText("  ")
				return
			}
		ifexist,%raexedir%\cores\%coreselv%
			{
				guicontrol,,LCORE,%coreselv%|
			}
		gosub, CoreAuto
		if (dlx <> "dll")
			{
				APLN= 1
				guicontrol,,LCORE,%coreselv%|
			}
		SB_SetText(" indexing playlist complete ")
		curline=
		coreline=
		Loop, Read, %selectedplaylist%
			{
				if (A_LoopReadLine = "")
					{
						continue
					}
				PLineNum+=1
				PLineAdd+=1
				if (PLineAdd = 1)
					{
						romhn1=
						romhn2=
						if (A_LoopReadLine = "{")
							{
								newPlF= 1
								continue
							}
						if (newPlF = 1)
							{
								continue
							}
						StringSplit,romhn,A_LoopReadLine,#
						if (romhn2 = "")
							{
								romhn2= %romhn1%
							}
						if (romf = "")
							{
								romf= %romhn1%
								finumb:= PlineNum + 2
							}
						poptadd.= romhn1 . "|"
					}
				if (newPlF = 1)
					{
						Stringreplace,romha,A_LoopReadLine,"path":%A_Space%,,UseErrorLevel
						if (ERRORLEVEL = 1)
							{
								finumb:= PLineNum+2
								stringtrimright,romha,romha,1
								stringreplace,romha,romha,\\,\,All
								stringreplace,romha,romha,",,All
								;"
								ifinstring,romha,.zip#
									{
										stringsplit,romhn,romha,#
										romf= %romhn1%
									}
									else {
											romf= %romha%
									}
								poptadd.= romf . "|"
								PLineAdd=
								continue
							}
					}
				if (PLineAdd =  6)
					{
						PLineAdd=
					}
			}
		romfj1=
		romfj2=
		filereadline,tolcr,%selectedplaylist%,%finumb%
		if (newPlF = 1)
			{
				stringreplace,tolcr,tolcr,"core_path":%A_Space%,,UseErrorLevel
				stringtrimright,tolcr,tolcr,1
				stringreplace,tolcr,tolcr,\\,\,All
				stringreplace,tolcr,tolcr,",,All
				;"
			}
		splitpath,tolcr,coreselv
		if (plpcr = "")
			{
				plpcr:= coreselv
			}
		if (stcl <> "DETECT")
			{
				guicontrol,, LCORE,|%plpcr%||%runlist%
				SB_SetText(" indexing detected playlist complete ")
				return
			}
		qmen= 1
		return
	}
if (qmen = 1)
	{
		qmen=
		return
	}
qmen= 1
gosub, ExtensionLookup
guicontrol,,LCORE,|%coreselv%|
gosub, CoreAuto
if (dlx <> "dll")
	{
		APLN= 1
	}
SB_SetText(" system search complete ")
return

CreateConfig:
filedelete, Settings.ini
FileAppend, [GLOBAL]`n, Settings.ini
FileAppend, working_config = "%S_KeyDir%\config.cfg"`n, Settings.ini
FileAppend, retroarch_location = ""`n, Settings.ini
FileAppend, ARCH = "%ARCH%"`n, Settings.ini
FileAppend, last_rom = "%romf%"`n, Settings.ini
FileAppend, last_core = "%LCORE%"`n, Settings.ini
FileAppend, last_connect = "%IPA%.%IPB%.%IPC%.%IPD%"`n, Settings.ini
FileAppend, last_port = "%HPORTNUM%"`n, Settings.ini
FileAppend, core_option_copy = "%CORECOPY%"`n, Settings.ini
FileAppend, RemoteRepository = "%ARCSRC%"`n, Settings.ini
FileAppend, archive_login = `n, Settings.ini
FileAppend, archive_password = `n, Settings.ini
FileAppend, jacket_mode = "0"`n, Settings.ini
FileAppend, emulators_directory = ""`n, Settings.ini
FileAppend, systems_directory = ""`n, Settings.ini
FileAppend, AutoPopulate_Search = "1"`n, Settings.ini
FileAppend, AutoLoad_PerGameSettings = "1"`n, Settings.ini
FileAppend, Launcher_Priority = "1"`n, Settings.ini
FileAppend, version = "%VERSION%"`n, Settings.ini
FileAppend, global_filter = "1"`n, Settings.ini
FileAppend, history_append = "1"`n, Settings.ini
filedelete, apps.ini
FileAppend, [EMULATORS]`n, apps.ini
FileAppend, [KEYMAPPERS]`n, apps.ini
FileAppend, [FRONTENDS]`n, apps.ini
FileAppend, [UTILITIES]`n, apps.ini
return

AutoLaunch:
gui, submit, nohide
AUTOLNCH= 1
return

extractrun:
efek= |=""
fein= %omitxt%
kro= 1
iniread,extpl,emuCfgPresets.ini,%EXTRSYS%,RJROMXT
if (extpl <> "ERROR")
	{
		efek= `,
		fein= extpl
		kro=
	}
stringsplit,fndext,fein,%efek%
agr := Object()
Loop, %fndext0%
	{
		new= % (fndext%a_index%)
		if (fndext%a_index% <> "")
			{
				agr.insert(new)
			}
	}
splitpath,romf,romtitle,rompth,romext,romname,romdrv
if ((romext = "zip")or(romext = "rar")or(romext = "7z")or(romext = "gz")or(romext = "tar"))
	{
		RunWait, "%S_KeyDir%\bin\7za.exe" e -y "%romf%" -O"%cacheloc%\%romname%",,hide
		SB_SetText(Extracting rom from " romf ")
		Loop, %cacheloc%\%romname%\*.*
			{
				ext= %A_LoopFileExt%
				noapl=
				for k, v in agr
					{
						extm:= v
						if (ext = extm)
							{
								noapl= 1
							}
					}
				if (noapl = kro)
					{
						romf= %A_LoopFileLongPath%
						romfj1= %A_LoopFileLongPath%
						splitpath,romf,romtitle,rompth,romext,romname,romdrv
						break
					}
			}
	}
return

RETAL:
gui,submit,nohide
RETRANSLID= 
if ((TRANSLID > 65)&&(DYNTRANS = 1))
	{
		RETRANSLID= 1
		WinSet,Transparent,65,skeletonKey
		guicontrol,,TRANSLID,65
		if (ALWOTP = 0)
			{
				Winset,Disable,,skeletonKey
			}				
	}
runwait, %comspec% /c " "%raexedir%\%RaExeFile%" -c "%S_KeyDir%\config.cfg"",%S_KeyDir%
if (RETRANSLID = 1)
	{
		Winset,Transparent,%TRANSLID%,skeletonKey
		guicontrol,,TRANSLID,%TRANSLID%
		Winset,Enable,,skeletonKey	
		Winset,Top,,skeletonKey		
		WinActivate,skeletonKey
			}
guicontrol,hide,RETAL
guicontrol,move,CLRCUROM,x744 y34
return

RETALRAXE:
RETRANSLID= 
if ((TRANSLID > 65)&&(DYNTRANS = 1))
	{
		RETRANSLID= 1
		WinSet,Transparent,65,skeletonKey
		guicontrol,,TRANSLID,65
		if (ALWOTP = 0)
			{
				Winset,Disable,,skeletonKey
			}				
	}
runwait, %comspec% /c " "%raexedir%\%RaExeFile%" -c "%curcfg%"",%S_KeyDir%
if (RETRANSLID = 1)
	{
		Winset,Transparent,%TRANSLID%,skeletonKey
		guicontrol,,TRANSLID,%TRANSLID%
		Winset,Enable,,skeletonKey	
		Winset,Top,,skeletonKey		
		WinActivate,skeletonKey
	}
guicontrol,hide,RETAL
guicontrol,move,CLRCUROM,x744 y34
return

ESWPLCRE:
gui,submit,nohide
guicontrolget,ESWPLCRE,,ESWPLCRE
if (ESWPLCRE = "E")
	{
		guicontrol,,LCORECBX,| ||%runlist%
		guicontrol,hide,LCORE
		guicontrol,show,LCORECBX
		guicontrol,,ESWPLCRE,>
		guicontrol,focus,LCORECBX
		Controlfocus,ahk_id %RUNCORECBX%
		return	
	}
guicontrol,show,LCORE
guicontrol,hide,LCORECBX
guicontrol,,ESWPLCRE,E
return	

LCORECBX:
guicontrolget,LCGRBX,,LCORECBX
Sleep, 1100
gui,submit,nohide
guicontrolget,COREGRBX,,LCORECBX
if (COREGRBX <> LCGRBX)
	{
		goto,LCORECBX
	}
if (COREGRBX = "")
	{
		ROMSYS=  
	}
stringreplace,corenvbx,coregrbx,%A_SPACE%,,All	
if ((COREGRBX = "")or(CORENVBX = ""))
	{
		guicontrol,,LCORE,|%LCore%||
		guicontrol,show,LCORE
		guicontrol,hide,LCORECBX
		guicontrol,,ESWPLCRE,E
		return
	}
main_search= 
Loop,parse,runlist,|
	{
		if (A_LoopField = COREGRBX)
			{
				LCORECBX= %A_LoopField%
				main_search= %A_LoopField%||%runlist%
				guicontrol,show,LCORE
				guicontrol,hide,LCORECBX
				guicontrol,,LCORECBX,|%main_search%
				guicontrol,,LCORE,|%main_search%
				guicontrol,,ESWPLCRE,E
				goto, LnchCore
			}
	}
Loop,Parse,runlist,|
	{
		if Instr(A_LoopField, COREGRBX)
			{
				main_search.=  A_LoopField . "|"
			}
	}
if (main_search = "")
		{
			main_search= %swpparv%
		}
guicontrol,,LCORECBX,|%COREGRBX%||%main_search%
Control, ShowDropDown, , ,ahk_id %RUNCORECBX%
return


LnchCore:
gui,submit,nohide
guicontrol,enable,LCORE
guicontrolget,LCORE,,LCORE
curmedINPT=
BCSTO=
BCSTA=
USRCORE= 1
gosub, LNCHCHK
if (nlnch <> "")
	{
		return
	}
corinjs= %LCORE%
ifinstring,corinjs,.dll
	{
		corinjs= retroarch
		guicontrol,hide,CustSwitchs
	}
	else {
		guicontrol,show,CustSwitchs
	}
CoreAuto:
Gui, Submit, NoHide
guicontrolget,LCORE,,LCORE
if (LCORE = "")
	{
		guicontrol,disable,LNCHBUT
		guicontrol,disable,RCLLNCH
		return
	}
return

SKLNCH:
if (RUNCOREOVERRIDE <> "")
	{
		coreselv:= RUNCOREOVERRIDE
	}
guicontrolget,ROMSTMP,,RUNSYSDDL
ifinstring,ROMSTMP,:=:
	{
		stringsplit,EDTROMV,EDTROM,\
		Loop, %EDTROMV0%
			{
				ifinstring,EDTROMV%A_index%,%A_space%-%A_Space%
					{
						rmsym= % EDTROMV%A_index%
						Loop, Parse, allsupsys,`n`r
							{
								if (A_LoopField = "")
									{
										continue
									}
								if (A_LoopField = rmsym)
									{
										ROMSYS= %A_LoopField%
										break
									}
							}
					}
			}
		ROMSYS=
	}
lknwnc=
mtyp= %coreselv%
iniread,OvrExtAs,Assignments.ini,ASSIGNMENTS,%coreselv%
emucfgn=
if (ROMSYS = "")
	{
		if (ARCSYS <> "")
			{
				ROMSYS= %ARCSYS%
			}
	}
EXTRSYS= %ROMSYS%
emucfgn= %coreselv%
if (ROMSYS = "")
	{
		iniread,lpovrd,Assignments.ini,OVERRIDES,
		Loop,Parse,lpovrd,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				StringSplit,corsyt,A_LoopField,=,"
				;"
				stringsplit,aij,corsyt2,|
				corsyt2= %aij1%
				if (corsyt2 = coreselv)
					{
						lknwnc= %corsyt2%
						iniread,OvrExtAs,Assignments.ini,ASSIGNMENTS,%corsyt2%
						ifinstring,romf,%corsyt1%
							{
								emucfgn= %coreselv%
								mtyp= %corsyt1%
								ROMSYS= %corsyt1%
							}
					}
			}
	}
if (ROMSYS = "")
	{
		emucfgn= %lknwnc%
		mtyp= %lknwnc%
		ROMSYS= %lknwnc%
		if (EXTRSYS <> "")
			{
				if (lknwnc = "")
					{
						emucfgn= %coreselv%
						mtyp= %EXTRSYS%
					}
				ROMSYS= %EXTRSYS%
			}
	}
svoc=
if (directrun = 1)
	{
		iniread,sysexov,AppParams.ini,%EXTRSYS%,%lnmxtn%
		if (sysexov <> "ERROR")
			{
				if (sysexov <> "")
					{
						svoc= 1
						coreselv= %sysexov%
						iniread,OvrExtAs,Assignments.ini,ASSIGNMENTS,%coreselv%
					}
			}
	}
directrun=
iniread,EPGC,AppParams.ini,%coreselv%,per_game_configurations
iniread,RunOptions,AppParams.ini,%coreselv%,options
iniread,RunArgs,AppParams.ini,%coreselv%,arguments
iniread,omtxt,AppParams.ini,%coreselv%,extension
iniread,RunFrom,AppParams.ini,%coreselv%,run_location
iniread,OMITQ,AppParams.ini,%coreselv%,no_quotes
iniread,OMITPTH,AppParams.ini,%coreselv%,no_path
iniread,EXTARUN,AppParams.ini,%coreselv%,EXTARUN
if (coremsvc = "")
	{
		if (CUSTSWITCHS = 0)
			{
				ifinstring,coreselv,mame
					{
						iniread,RJMAMENM,emuCfgPresets.ini,%EXTRSYS%,RJMAMENM
						iniread,CUSTMOPTLST,emuCfgPresets.ini,%EXTRSYS%,MAME?RJEMUOPTS
						if (CUSTMOPTLST <> "ERROR")
							{
								Loop,Parse,CUSTMOPTLST,|
									{
										if (A_LoopField = "")
											{
												continue
											}
										coremsvc= 1
										stringreplace,CSTINJOPT,A_LoopField,<,%A_Space%,All
										stringreplace,CSTINJOPT,CSTINJOPT,[RJMAMESYS],%RJMAMENM%,All
										break
									}
							}
					}
			}
	}
ifinstring,RunOptions,[
	{
		if (coremsvc = 1)
			{
				coremsvc=
				ifinstring,coreselv,mame
					{
						ifinstring,CSTINJOPT,[RJ
							{
								nwextfnd= % (MAME_%RJMAMENM%_medtyps)
								splitpath,romf,,,xtnv
								ifinstring,romf,.zip
									{
										stringsplit, romfj, romf,#
										if (romf <> romfj1)
											{
												ifexist, %romfj1%
													{
														romf= %romfj1%
													}
											}
										partition=
										splitpath,romf,romtitle,rompth,xtnv,romname,romdrv
										concatcmd= "%S_KeyDir%\bin\7za.exe" l -slt "%romf%"
										StdOut := StdoutToVar_CreateProcess(concatcmd)
										partition=
										fext= %xtnv%
										gosub, zpkproc
									}
								Loop, Parse, nwextfnd,|
									{
										if (A_LoopField = "")
											{
												continue
											}
										MEDP= %A_LoopField%
										stringreplace,MEDP,MEDP,%A_Space%,,All
										stringreplace,MEDP,MEDP,`n,,All
										stringreplace,MEDP,MEDP,`r,,All
										nweinxtf= % (MAME_%RJMAMENM%_%MEDP%_extyp)
										if (nweinxtf = "")
											{
												SB_SetText(" SYSTEM NOT FOUND ")
												continue
											}
										ifinstring,nweinxtf,%xtnv%
											{
												stringreplace,CSTINJOPT,CSTINJOPT,[RJRTYP],%MEDP%,All,UseErrorLevel
												if (ERRORLEVEL <> 0)
													{
														CSTINJOPT= %RJMAMENM% -%MEDP%
														break
													}
												stringreplace,CSTINJOPT,CSTINJOPT,[RJMAMESYS],%RJMAMENM%,All
											}
									}
							}
					}
				stringright,cstchk,CSTINJOPT,1
				if (CSTINJOPT <> "")
					{
						if (cstchk <> A_Space)
							{
								stringleft,fea,CSTINJOPT,1
								if (fea = A_Space)
									{
										StringTrimLeft,CSTINJOPT,CSTINJOPT,1
									}
								stringright,fea,CSTINJOPT,1
								if (fea = A_Space)
									{
										StringTrimRight,CSTINJOPT,CSTINJOPT,1
									}
								stringreplace,RunOptions,RunOptions,[CUSTMOPT],%A_SPACE%%CSTINJOPT%%A_Space%,All
								CSTINJOPT=
							}
					}
			}
		else {
			if (strmvid = 1)
				{
					;;stringreplace,RunOptions,RunOptions,[CUSTMOPT], --sout file/muxer:"[ROMPATH]\[ROMFILE]",All
				}
			stringreplace,CUSTMOPT,CUSTMOPT,[CUSTMOPT],,All
			stringreplace,CUSTMARG,CUSTMARG,[CUSTMARG],,All
		}
	}
if (CSTINJOPT <> "")
	{
		CUSTMOPT= %CSTINJOPT%
		stringleft,afix,CUSTMOPT,1
		if (avix = A_Space)
			{
				stringtrimleft,CUSTMOPT,CUSTMOPT,1
			}
		stringright,afix,CUSTMOPT,1
		if (avix = A_Space)
			{
				stringtrimright,CUSTMOPT,CUSTMOPT,1
			}
		stringreplace,RunOptions,RunOptions,[CUSTMOPT],%A_Space%%CUSTMOPT%%A_Space%,All
		CSTINJOPT=
	}
stringreplace,RunOptions,RunOptions,[CUSTMOPT],%A_SPACE%%CUSTMOPT%,All
stringreplace,RunArgs,RunArgs,[CUSTMARG],%A_SPACE%%CUSTMARG%,All
stringreplace,RunOptions,RunOptions,[ROMPATH],%rompth%,All
stringreplace,RunArgs,RunArgs,[ROMPATH],%rompth%,All
stringreplace,RunArgs,RunArgs,[ROMFILE],%romtitle%,All
stringreplace,RunOptions,RunOptions,[ROMFILE],%romtitle%,All
SplitPath,OvrExtAs,emuexe,emupth,emuxtn,emuname,emudrv
stringreplace,RunOptions,RunOptions,[EMUPATH],%emupth%,All
stringreplace,RunArgs,RunArgs,[EMUPATH],%emupth%,All
LNCHAPP:
romfj1=
romfj2=
stringsplit, romfj, romf,#
if (EXTARUN = 1)
	{
		gosub, extractrun
	}
if (romf <> romfj1)
	{
		ifexist, %romfj1%
			{
				romf= %romfj1%
			}
	}
stringmid,romhnck,romfj1,2,1
if (romhnck <> ":")
	{
		ifexist, %raexedir%\%romfj1%
			{
				romf= %raexedir%\%romfj1%
			}
	}
splitpath,romf,romtitle,rompth,romext,romname,romdrv
splitpath,rompth,romjakt,romhse
splitpath,romhse,romhouse
if (!instr(romname,romjakt)&& instr(SysLLst,romhouse . "="))
	{
		romtitle= %romjakt%
	}
if (RunFrom = 1)
	{
		runloc= %rompth%
		runbrv= ~rom directory
	}
if (RunFrom <> 1)
	{
		runloc= %emupth%
		runbrv= ~emu directory
	}
RUNROM= %romf%
if (omtxt = 1)
	{
		RUNROM= %rompth%\%romname%
	}
if (OMITPTH = 1)
	{
		if (omtxt = 1)
			{
				RUNROM= %romname%
			}
		if (omtxt <> 1)
			{
				RUNROM= %romtitle%
			}
	}
if (OMITQ = 1)
	{
		RUNROM= %RUNROM%
	}
if (OMITQ <> 1)
	{
		RUNROM= "%RUNROM%"
	}
if (EPGC = 1)
	{
		ptsp=
		emudx=
		cfga=
		cfgb=
		cfgc=
		cfgd=
		IfNotExist,cfg\%ROMSYS%\%emucfgn%\%romtitle%
			{
				FileCreateDir,cfg\%ROMSYS%\%emucfgn%\%romtitle%
				EDTRMFN= %romtitle%
			}
		splitpath,OvrExtAs,,ptsp
		splitpath,ptsp,emudx
		emupts=	
		stringreplace,emupthd,emupth,\,\\,All
		stringreplace,rompthd,rompth,\,\\,All
		stringreplace,emupthr,emupth,\,/,All
		stringreplace,rompthr,rompth,\,/,All
		Loop, Parse, EmuPartSet,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				pgpts1=
				pgpts2=
				pgpts3=
				pgpts4=
				pgpts5=
				pgpts6=
				pgpts7=
				StringReplace,emuvers,A_LoopField,[ROMSYS],%RJMAMENM%,All
				StringReplace,emuvers,emuvers,[ROMNAME],%romtitle%,All
				stringsplit,pgpts,emuvers,<,:
				if (pgpts1 = emudx)
						{
							emupts= 1
							emuna= %emudx%
							if (pgpts4 <> "")
								{
									cfga:= pgpts4
									Loop, Parse, pgpts4,|
										{
											SplitPath,A_LoopField,pgptf
											cplp= %A_LoopField%
											Loop,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%pgptf%
												{
													FileRead,bncfg,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%A_LoopFileName%
													filedelete,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%A_LoopFileName%
													if (ERRORLEVEL = 0)
														{
															stringreplace,bncfg,bncfg,[EMUPATH],%emupth%,All
															stringreplace,bncfg,bncfg,[EMUPATHD],%emupthd%,All
															stringreplace,bncfg,bncfg,[EMUPATHR],%emupthr%,All
															stringreplace,bncfg,bncfg,[ROMPATH],%rompth%,All
															stringreplace,bncfg,bncfg,[ROMPATHD],%rompthd%,All
															stringreplace,bncfg,bncfg,[ROMPATHR],%rompthr%,All
															stringreplace,bncfg,bncfg,[ROMF],%romtitle%,All
															stringreplace,bncfg,bncfg,\[SNAPS],,All
															stringreplace,bncfg,bncfg,\[SSTATE],,All
															stringreplace,bncfg,bncfg,\[MEM],,All
															FileAppend,%bncfg%,%ptsp%\%cplp%
														}
														else, {
															FileCopy,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%A_LoopFileName%,%ptsp%\%cplp%
														}
												}
										}
								}
							if (pgpts5 <> "")
								{
									cfgb:= pgpts5
									Loop, Parse, pgpts5,|
										{
											SplitPath,A_LoopField,pgptf
											cplp= %A_LoopField%
											Loop,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%pgptf%
												{
													;;FileCopy,cfg\%ROMSYS%\%emucfgn%\%romtitle%\.sstates\%A_LoopFileName%,%ptsp%\%cplp%,1
													FileCopy,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%A_LoopFileName%,%ptsp%\%cplp%,1
												}
										}
								}
							if (pgpts6 <> "")
								{
									cfgc:= pgpts6
									Loop, Parse, pgpts6,|
										{
											SplitPath,A_LoopField,pgptf
											cplp= %A_LoopField%
											Loop,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%pgptf%
												{
													;;FileCopy,cfg\%ROMSYS%\%emucfgn%\%romtitle%\.Mem\%A_LoopFileName%,%ptsp%\%cplp%,1
													FileCopy,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%A_LoopFileName%,%ptsp%\%cplp%,1
												}
										}
								}
							if (pgpts7 <> "")
								{
									cfgd:= pgpts7
									Loop, Parse, pgpts7,|
										{
											SplitPath,A_LoopField,pgptf
											cplp= %A_LoopField%
											Loop,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%pgptf%
												{
													;;FileCopy,cfg\%ROMSYS%\%emucfgn%\%romtitle%\.Mem\%A_LoopFileName%,%ptsp%\%cplp%,1
													FileCopy,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%A_LoopFileName%,%ptsp%\%cplp%,1
												}
										}
								}
						}
					if (emupts = "")
						{
							FileCopy,cfg\%ROMSYS%\%emucfgn%\%romtitle%\*.ini,%ptsp%,1
						}
			}
	}
if (STRMVID = 1)
	{
		RUNROM= "%URLFILE%"
	}
splitpath,OvrExtAs,xenm,xenmp
gosub, SKLPRER
iniread,dmchk,AppParams.ini,%coreselv%,DSKMNTCHK
if (dmchk = 1)
	{
		DSKROMF= %RUNROM%
		iniread,dskmntprg,AppParams.ini,%coreselv%,DSKMNTPRG
		iniread,dskmntexe,Apps.ini,UTILITIES,%dskmntprg%
		dskmntopt:= " -mount scsi, 0,"
		dskunmntopt:= " -unmount scsi, 0"
		if (dskmntprg <> "DaemonTools")
			{
				dskmntexe= %dskmntprg%
				dskmntopt= %A_Space%
				dskunmntopt= %A_Space%
			}
		if (dskmntprg = "Windows")
			{
				DSKROMF=
				dskmntexe= powershell.exe
				dskmntopt:= "Mount-DiskImage ""%ROMF%"""
				dskmntopt:= "Dismount-DiskImage ""%ROMF%"""
			}
		iniread,dskmntovr,AppParams.ini,%coreselv%,DSKMNTOVR
		if (dskmntovr <> 0)
			{
				ROMF= %dskmntovr%
				stringreplace,ROMF,ROMF,",,All
				;"
			}
		Run, %comspec% /c "%dskmntexe%"%dskmntopt%"%DSKROMF%"
		if (dskmntovr = 0)
			{
				RUNROM=
			}
	}
histrplcd=	
ifinstring,historyloc,%RUNROM%
	{
		histrplcd= 1
	}
guicontrol,,LCORE,%coreselv%|
SB_SetText(" ..\" xenm "" RunOptions "" RUNROM "" RunArgs "|||from " runbrv " ")
RETRANSLID= 
if ((TRANSLID > 65)&&(DYNTRANS = 1))
	{
		RETRANSLID= 1
		WinSet,Transparent,65,skeletonKey
		guicontrol,,TRANSLID,65
		if (ALWOTP = 0)
			{
				Winset,Disable,,skeletonKey
			}
	}
RunWait, "%OvrExtAs%"%RunOptions%%RUNROM%%RunArgs%,%runloc%,,overxtpid
if (RETRANSLID = 1)
	{
		Winset,Transparent,%TRANSLID%,skeletonKey
		guicontrol,,TRANSLID,%TRANSLID%
		Winset,Enable,,skeletonKey
		WinActivate,skeletonKey
		Winset,Top,,skeletonKey
	}
CHOSEN= 0
GLBLRUN=
process, close, %overxtpid%
if (dmchk = 1)
	{
		Run, %comspec% /c "%dskmntexe%"%dskunmntopt%
	}
gosub, SKLPOST

POSTEMULAUNCH:
if (EPGC = 1)
	{
		SB_SetText("...reloading settings...")
		if (cfga <> "")
			{
				Loop, Parse, cfga,|
					{
						SplitPath,A_LoopField,pgptf
						cplp= %A_LoopField%
						Loop,%ptsp%\%A_LoopField%
							{
								FileCopy,%ptsp%\%A_LoopFileName%,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%pgptf%,1
							}
					}
			}
		if (cfgb <> "")
			{
				Loop, Parse, cfgb,|
					{
						SplitPath,A_LoopField,pgptf
						cplp= %A_LoopField%
						Loop,%ptsp%\%A_LoopField%
							{
								FileCopy,%ptsp%\%A_LoopFileName%,cfg\%ROMSYS%\%emucfgn%\%romtitle%\.sstates\%pgptf%,1
							}
					}
			}
		if (cfgc <> "")
			{
				Loop, Parse, cfgc,|
					{
						SplitPath,A_LoopField,pgptf
						cplp= %A_LoopField%
						Loop,%ptsp%\%A_LoopField%
							{
								FileCopy,%ptsp%\%A_LoopFileName%,cfg\%ROMSYS%\%emucfgn%\%romtitle%\.Mem\%pgptf%,1
							}
					}
			}
		if (cfgd <> "")
			{
				Loop, Parse, cfgd,|
					{
						SplitPath,A_LoopField,pgptf
						cplp= %A_LoopField%
						Loop,%ptsp%\%A_LoopField%
							{
								FileCopy,%ptsp%\%A_LoopFileName%,cfg\%ROMSYS%\%emucfgn%\%romtitle%\.Mem\%pgptf%,1
							}
					}
			}
		if (emupts = "")
			{
				FileCopy,%ptsp%\*.ini,cfg\%ROMSYS%\%emucfgn%\%romtitle%\%pgptf%,1
			}
		SB_SetText("settings reloaded")
	}
lnchui= enable
gosub, LNCHUI
inithist= 
if (HISAPND = 1)
	{
		ifnotexist,%historyLoc%
			{
				inithist= 1
				FileAppend,{`n%pspce%"version": "1.0"`,`n%pspce%"items": [`n,*%historyloc%
			}
		hisapl= %pspxe%{`n%pspce%"path": %RUNROM%`,`n%pspce%"label": "%ROMNAME%"`,`n%pspce%"core_path": "%OvrExtAs%"`,`n%pspce%"core_name": "%coreselv%"`,`n%pspce%"crc32": ""`,`n%pspce%"db_name": ""`,`n%pspxe%}`n%A_Space%%A_Space%]`n ;}}}
		stringreplace,hisapl,hisapl,\\\\,\,All
		stringreplace,hisapl,hisapl,\\\,\,All
		stringreplace,hisapl,hisapl,\\,\,All
		stringreplace,hisapl,hisapl,\,\\,All
		hiscnt:=TF_CountLines(TF(historyloc))
 		replinea:= hiscnt - 3
		replineb:= hiscnt - 2
		if (inithist = 1)
			{
				fileappend,%hisapl%,*%historyloc%	
			}
			else {
				if (histrplcd = "")
					{
						stringreplace,hisapl,hisapl,"core_name": "DETECT","core_name": "%coreselv%",All
					}
				TF_replaceline("!"historyloc,replinea,replinea,"" pspxe "}," "")
				TF_replaceline("!"historyloc,replineb,replineb,hisapl)
			}
	}
if (DDRUN = "")
	{
		return
	}
goto, QUITOUT
ExitApp
DAMMOUNT:
return

SKLPRER:
IniRead,EMPRERUN,AppParams.ini,%coreselv%,EMPRERUN
IniRead,EMPREOPT,AppParams.ini,%coreselv%,EMPREOPT
IniRead,EMPREW,AppParams.ini,%coreselv%,EMPREW
if (EMPREW = "")
	{
		return
	}
Loop, Parse, EMPREW,|
	{
		STRTYP%A_Index%= Runwait
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = 0)
			{
				STRTYP%A_Index%= Run
			}
	}
if (EMPRERUN <> "")
	{
		prrunitms=
		Loop, Parse, EMPRERUN,|
			{
				prrunitms+= 1
				if (A_LoopField = "")
					{
						continue
					}
				ikiv1=
				ikiv2=
				emprecmdnum%A_Index%= %A_Index%
				stringsplit,ikiv,A_LoopField,>
				stringreplace,avvr,ikiv1,[ROMPATH],%rompath%,All
				stringreplace,avvr,avvr,[ROM],%romname%,All
				stringreplace,avvr,avvr,[ROMF],%romf%,All
				stringreplace,avvr,avvr,[EMUL],%xenmp%,All
				stringreplace,avvr,avvr,[EMUZ],%xenm%,All
				rprn+=1
				rprw=
				if (avvr = "ERROR")
					{
						continue
					}
				preruni.= avvr
				empro=
				Loop, Parse, EMPREOPT,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						empro+=1
						if (empro = rprn)
							{
								if (A_LoopField = ":")
									{
										preruni.= "|"
										continue
									}
								stringreplace,avvr,ikiv1,[ROMPATH],%rompath%,All
								stringreplace,avvr,avvr,[ROM],%romname%,All
								stringreplace,avvr,avvr,[ROMF],%romf%,All
								stringreplace,avvr,avvr,[EMUL],%xenmp%,All
								stringreplace,avvr,avvr,[EMUZ],%xenm%,All
								preruni.= avvr . "|"
							}
					}
			}
	}
Loop, Parse, preruni,|
	{
		arin= % STRTYP%A_Index%
		if (arin = "Run")
			{
				Run, %A_LoopField%
			}
		if (arin = "Runwait")
			{
				Runwait, %A_LoopField%
			}
	}
return

SKLPOST:
IniRead,EMPOSTRUN,AppParams.ini,%coreselv%,EMPOSTRUN
IniRead,EMPOSTOPT,AppParams.ini,%coreselv%,EMPOSTOPT
IniRead,EMPOSTW,AppParams.ini,%coreselv%,EMPOSTW
if (EMPOSTW = "")
	{
		return
	}
Loop, Parse, EMPOSTW,|
	{
		STRTYP%A_Index%= Runwait
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = 0)
			{
				STRTYP%A_Index%= Run
			}
	}
if (EMPOSTRUN <> "")
	{
		prrunitms=
		Loop, Parse, EMPOSTRUN,|
			{
				prrunitms+= 1
				if (A_LoopField = "")
					{
						continue
					}
				ikiv1=
				ikiv2=
				empostcmdnum%A_Index%= %A_Index%
				stringsplit,ikiv,A_LoopField,>
				stringreplace,avvr,ikiv1,[ROMPATH],%rompath%,All
				stringreplace,avvr,avvr,[ROM],%romname%,All
				stringreplace,avvr,avvr,[ROMF],%romf%,All
				stringreplace,avvr,avvr,[EMUL],%xenmp%,All
				stringreplace,avvr,avvr,[EMUZ],%xenm%,All
				if (avvr = "ERROR")
					{
						continue
					}
				postruni.= avvr
				empro=
				Loop, Parse, EMPOSTOPT,|
					{
						if (A_LoopField = "")
							{
								continue
							}
						empro+=1
						if (empro = rprn)
							{
								if (A_LoopField = ":")
									{
										postruni.= "|"
										continue
									}
								stringreplace,avvr,ikiv1,[ROMPATH],%rompath%,All
								stringreplace,avvr,avvr,[ROM],%romname%,All
								stringreplace,avvr,avvr,[ROMF],%romf%,All
								stringreplace,avvr,avvr,[EMUL],%xenmp%,All
								stringreplace,avvr,avvr,[EMUZ],%xenm%,All
								postruni.= avvr . "|"
							}
					}
			}
	}
Loop, Parse, postruni,|
	{
		arin= % STRTYP%A_Index%
		if (arin = "Run")
			{
				Run, %A_LoopField%
			}
		if (arin = "Runwait")
			{
				Runwait, %A_LoopField%
			}
	}
return

LNCH:
gui,submit,nohide
lnchui= disable
gosub, LNCHUI
guicontrolget,EXTRSYS,,RUNSYSDDL
ifinstring,EXTRSYS,.lpl
	{
		stringtrimright,EXTRSYSX,EXTRSYS,4
		ifinstring,A_LoopField,%A_Space%-%A_Space%
		Loop,parse,SysLLst,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,vir,A_LoopField,=
				if (vir1 = EXTRSYSX)
					{
						EXTRSYS= %A_LoopField%
						break
					}
			}
	}
if (EXTRSYS = "History")
	{
		guicontrolget,rrn,,MORROM
		Loop,parse,rrn,\
			{
				rsts= %A_LoopField%
				ifinstring,rsts,%A_Space%-%A_Space%
					{
						Loop,parse,SysLLst,`n`r
							{
								if (A_LoopField = "")
									{
										continue
									}
								stringsplit,vir,A_LoopField,=
								if (vir1 = rsts)
									{
										EXTRSYSK= %vir1%
										break
									}
							}
					}
				if (EXTRSYSK <> "")
					{
						EXTRSYS= %EXTRSYSK%
						break
					}
			}
	}
if (EXTRSYSK = "")
	{
		SB_SetText("no system detected")
	}
SUBLNCH:
guicontrolget,lcore,,LCORE
if (aemcfg = 1)
	{
		if (lcore <> ARCCORES)
			{
				guicontrol,,ARCCORES,|%lcore%||%runlist%
			}
		guicontrol,choose,TABMENU,7
		ROMSYS= %ARCSYS%
		goto, ArcLaunch
	}
if (OVRLKUPNM <> "OBSERVED_VOID")
	{
		lcore= %fiin%
	}
coreselv= %lcore%
APLN= 1
ifinstring,lcore,_libretro.dll
	{
		APLN=
	}
ifinstring,runcfginj,|%lcore%|
	{
		try, gosub, %lcore%precfg
			catch{
			SB_SetText(" NO CFG FOUND ")
			}
	}
if (romf = "")
	{
		guicontrolget,romf,,MORROM	
	}
splitpath,romf,,,lnmxtn,romna
romfj1=
romfj2=
stringsplit, romfj, romf,#
stringmid,romhnck,romf,2,1
if (romhnck <> ":")
	{
		ifexist, %raexedir%\%romfj1%
			{
				romf= %raexedir%\%romfj1%
				if (romfj2 <> "")
					{
						romf= %raexedir%\%romfj1%#%romfj2%
					}
			}
	}
if (APLN = 1)
	{
		guicontrolget,ROMSYS,,RUNSYSDDL
		if (refrae = 1)
			{
				ROMSYS= %ARCSYS%
				refrae=
			}
		goto, SKLNCH
	}
pgmargs=
if (PGM = 1)
	{
		stringreplace,ccv,lcore,_libretro.dll
		gosub, getCREN
		Loop,%raexedir%\config\%corcfgnam%\%romna%.*
			{
				if (A_Index = 1)
					{
						pgmargs:= A_Space . "-appendconfig="
					}
				pgmargs.= "%A_LoopField%" . "|"
			}
	}
LNCH= 1
AHKsock_Close()
if (CSTCMD = 1)
	{
		COREON=
		ifnotexist,%raexedir%\cores\%LCORE%
			{
				SB_SetText("")
			}
		RETRANSLID= 
		if ((TRANSLID > 65)&&(DYNTRANS = 1))
			{
				RETRANSLID= 1
				WinSet,Transparent,65,skeletonKey
				guicontrol,,TRANSLID,65
				if (ALWOTP = 0)
					{
						Winset,Disable,,skeletonKey
					}				
			}
		SB_SetText(" " raexedir " \ " RaExeFile " " CSTRAOPTF " " RUNROM " -L" LCORE " " CSTRAARGF " |||from " ~emu directory " ")
		Runwait, "%raexedir%\%RaExeFile%" %CSTRAOPTF% %RUNROM% %CSTRAARGF%,%raexedir%,,
		if (RETRANSLID = 1)
			{
				Winset,Transparent,%TRANSLID%,skeletonKey
				guicontrol,,TRANSLID,%TRANSLID%
				Winset,Enable,,skeletonKey	
				Winset,Top,,skeletonKey		
				WinActivate,skeletonKey
			}
		return
	}
LaunchRA:
LNCHCORE= -L "%raexedir%\cores\%coreselv%"
LNCHROM= "%romf%"
LNCHCFG= 
AHKsock_Close()
if (romf = "")
	{
		LNCHCORE=
		LNCHROM=
	}
lnchui= disable
gosub, LNCHUI
RETRANSLID= 
if ((TRANSLID > 65)&&(DYNTRANS = 1))
	{
		RETRANSLID= 1
		WinSet,Transparent,65,skeletonKey
		guicontrol,,TRANSLID,65
		if (ALWOTP = 0)
			{
				Winset,Disable,,skeletonKey
			}	
	}
SB_SetText(" " raexedir " \ " RaExeFile " "LNCHCORE " " BSV " "LNCHROM " " LNCHCFG " " pgmargs " |||from ~emu directory ")
Runwait, "%raexedir%\%RaExeFile%" %LNCHCORE% %BSV% %LNCHROM% %LNCHCFG%%pgmargs%,%raexedir%,,
if (RETRANSLID = 1)
	{
		Winset,Transparent,%TRANSLID%,skeletonKey
		guicontrol,,TRANSLID,%TRANSLID%
		Winset,Enable,,skeletonKey
		Winset,Top,,skeletonKey
		WinActivate,skeletonKey
	}
guicontrolget, SAVEXIT
if (SAVEXIT = 1)
	{
	}
lastcore= %coreselv%
lnchui= enable
gosub, LNCHUI
IniWrite, "%coreselv%", Settings.ini,GLOBAL,last_core
gosub, RecentWrite
LNCH=
return

LNCHUI:
Loop,parse,LNCH_UI,|
	{
		guicontrol,%lnchui%,%A_LoopField%
	}	
return	
SKRESET:
gui, submit, nohide
guicontrolget,SKRESDDL,,SKRESDDL
msgbox,8707,Confirm,Are you certain you want to reset %SKRESDDL% settings?
ifmsgbox, No
	{
		return
	}
ifmsgbox,Cancel
	{
		return
	}
if (SKRESDDL = "Jacket-Presets")
	{
		gosub, CLEAN_ROMJACKETS
	}
if (SKRESDDL = "Scraped-Assets")
	{
		gosub, CLEAN_ARTWORK
	}
if (SKRESDDL = "Session")
	{
		gosub, resetSYS
	}
if (SKRESDDL = "All")
	{
		gosub, RESET_ALL_QUIT
	}
if (SKRESDDL = "Associations")
	{
		gosub, AsocInit
	}
if (SKRESDDL = "Playlist-DB")
	{
		gosub, PlaylistInit
	}
return

SKRESDDL:
gui,submit,nohide
guicontrolget,SKRESDDL,,SKRESDDL
return

RESET:
msgbox,8452,Are you sure?, Delete All skeletonKey configuration files?
ifmsgbox, yes
	{
		goto RESET_ALL_QUIT
	}
ifmsgbox, no
	{
		return
	}
return

RESET_ALL_QUIT:
filedelete, *.ini
filedelete, *.cfg
goto, GLBTOP
CLEAN_ARTWORK:
FileRemoveDir, Assets,1
if errorlevel = 1
{
	Msgbox,1,In Use,Files in the ''%S_KeyDir%\Assets'' are in use`,8
	return
	}
filecreatedir, Assets
return

CLEAN_ROMJACKETS:
FileRemoveDir, rj\syscfgs,1
if errorlevel = 1
{
Msgbox,1,In Use,The folder ''%S_KeyDir%\rj\syscfgs'' is in Use`n,8
return
}
filecreatedir, rj\syscfgs
return

RECONFIGURE:
SB_SetText("..........REGENERATING CONFIGURATION FILES...........")
gosub resetSYS
gosub resetRunList
gosub,PlaylistInit
SB_SetText("Complete")
return

initall:
FileDelete,*.ini
FileDelete,*.cfg
FileDelete,rj\*.ini
FileDelete,rj\*.tbd
FileRemoveDir,rj\syscfgs,1
FileRemoveDir,cfg,1
FileCreateDir,cfg
FileRemoveDir,tmp,1
FileCreateDir,tmp
FileRemoveDir,executable,1
FileCreateDir,executable
Loop, rj\netart\*
	{
		FileRemoveDir,%A_LoopFileFullPath%,1
	}
ifinstring,getport,!q
	{
		goto, QUITOUT
	}
Msgbox,3,Restart,Restart Skeletonkey?
ifmsgbox,yes
	{
		goto, INITRESTART
	}
goto, QUITOUT
clearset:
FileDelete,*.ini
goto, cmdlineout
clearrj:
FileDelete,rj\*.ini
FileDelete,rj\*.tbd
FileRemoveDir,rj\syscfgs,1
goto, cmdlineout
clearcfg:
FileRemoveDir,cfg,1
FileCreateDir,cfg
goto, cmdlineout
cleartmp:
FileRemoveDir,tmp,1
FileCreateDir,tmp
goto, cmdlineout
clearexe:
FileRemoveDir,executable,1
FileCreateDir,executable
goto, cmdlineout
clearscrape:
Loop, rj\netart\*
	{
		FileRemoveDir,%A_LoopFileFullPath%,1
	}
cmdlineout:
ifinstring,getport,!q
	{
		goto, QUITOUT
	}
Msgbox,3,Restart,Restart Skeletonkey?
ifmsgbox,yes
	{
		goto, INITRESTART
	}
goto, QUITOUT
resetEmuList:
IniRead,emultl,apps.ini,EMULATORS
emulist= MAME - System|MAME - Arcade|
Loop, Parse, emultl,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		emulti1=
		emulti2=
		StringSplit,emulti,A_LoopField,=
		emulist.= emulti1 . "|"
	}
guicontrol,,EMPRDDL,|Emulators||%emulist%
guicontrol,,INSTEMUDDL,|%selfnd%|%emuinstpop%
return

resetRunList:
emup1=
emup2=
emuj=
siv=
PBEGN=
runlist=
addemu=
IniRead,emuj,Assignments.ini,ASSIGNMENTS
Loop,Parse,emuj,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		emup2=
		stringsplit,emup,A_LoopField,=,"
		;"
		if (instr(emup1," - ")&& instr(allsupport,emup1)or instr(UTLPARTSET,emup1)or instr(FEPARTSET,emup1)or instr(KMPPARTSET,emup1))
			{
				continue
			}
		if (emup2 = "")
			{
				continue
			}
		ifnotinstring,addemu,%emup1%|
			{
				if (emup2 = "")
					{
						continue
					}
				addemu.= "|" . emup1
			}
}
runlist:= corelist . "|" . addemu
stringreplace,runlist,runlist,||,|,All
stringreplace,runlist,runlist,||,|,All
stringleft,runltmp,runlist,1
if (runltmp = "|")
	{
		stringtrimleft,runlist,runlist,1
	}
guicontrol,,LCORE,|%runlist%
guicontrol,,EMPRDDL,|Emulators|%runlist%
guicontrol,,ARCCORES,|Emu_Preset||%runlist%
guicontrol,,PLCORE,|%lastcore%||%runlist%
return

resetCORES:
if (libretroDirectory = "")
	{
		libretroDirectory= %raexedir%\cores
	}
corelist=
Loop, %libretroDirectory%\*_libretro.dll
	{
		corelist.= A_LoopFileName . "|"
	}
gosub, ResetRunList
guicontrol,,SKCCTXT,%SKCCTXT%
return

resetSYS:
FileDelete, msys.ini
FileDelete, sys.ini
FileDelete, hacksyst.ini
syslist=
msyslist=
mamesplit= 
mame_sysk=
mame_syst.=
nsys=
msys=
iniread,alra,Settings.ini,GLOBAL,%urlTxt%_EULA
if (alra <> 1)
	{
		SB_SetText("You must agree to the EULA before accessing the repositories.")
		if (current_EULA <> 1)
			{
				return
			}
	}
loop, %GAMSRCS%\MAME - Systems\*.gam
	{
		msys+=1
		stringsplit,syn,A_LoopFileName,.
		msyslist .= (msys == 1 ? "" : "|") . syn1
	}
hacksyst=
loop, %GAMSRCS%\*.gam
	{
		ifinstring,A_LoopFileName,#
			{
				hacksyst.= A_LoopFileName . "|"
				continue
			}
		nsys+=1
		stringsplit,syn,A_LoopFileName,.
		syslist.= (nsys == 1 ? "" : "|") . syn1
	}
stringreplace,hacksyst,hacksyst,#HACKS#,,All
fileappend,%hacksyst%,hacksyst.ini
fileappend,%syslist%,sys.ini
fileappend,%msyslist%,msys.ini
guicontrol,,ARCSYS,|Select A System||%syslist%
mame_sys=
fileread,emucfgpr,emuCfgPresets.ini
iniread,pnvf,emuCfgPresets.ini
systrt=
Loop,parse,pnvf,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		if (A_LoopField = "END_EMU")
			{
				systrt= 1
			}
		if (systrt = "")
			{
				continue
			}
		nwsys= %A_LoopField%
		ecfsysn= %A_LoopField%
		iniread,bbvr,emuCfgPresets.ini,%nwsys%,RJMAMENM
		mamad= 
		sysfnd= 
		Loop, Parse, msyslist,|
			{
				einv= %A_LoopField%
				ifnotinstring,mame_sysk,%einv%|
					{
						mame_sysk.= einv . "|"
					}
				if (bbvr = einv)
					{
						MAME_%bbvr%= %einv%
						mame_syst.= ecfsysn . "|"
						rev_%bbvr%= %ecfsysn%
						mamesplit.= einv . "|" . ecfsysn . "`n"
						mamad= 1
						break
					}
			}
	}
if (msyslist <> "")
	{
		afep= |
		Loop, Parse, mamesplit,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				stringsplit,ji,A_LoopField,|
				afep.= ji2 . "|"
				Loop,parse,mame_sysk,|
					{
						if (A_LoopField = ji1)
							{
								mame_sys.= ji2 . "|"
								stringreplace,mame_sysk,mame_sysk,%ji1%|,,
								break
							}
					}
			}
		mame_sys.= mame_sysk
		sort,mame_sys, Alphabetically D|		
	}
return

resetCoreAssets:
dwnlfldrs=
systmfldrs=
rjsystmfldrs=
Loop, %RJSYSTEMS%\*,2
	{
		if A_LoopFileAttrib contains H
			{
				continue
			}
		rjsystmfldrs .= A_LoopFileName . "|"
	}
IniRead,suitar,SystemLocations.ini,LOCATIONS
Loop,parse,suitar,`n`r
	{
		if (A_LoopField = "")
			{
				continue
			}
		stringsplit,aip,A_LoopField,=,""
		if (aip2 <> "")
			{
				ifnotinstring,systmfldrs,%aip1%|
					{
						dwnlfldrs .= aip1 . "|"
						systmfldrs .= aip1 . "|"
					}
			}
	}
guicontrol,,RJSYDD,|Systems||%rjsystmfldrs%
guicontrol,,RUNSYSDDL,|:=:System List:=:||%INITFLDRS%
guicontrol,,SRCHLOCDDL,|:=:System List:=:||%systmfldrs%
guicontrol,,ESDWNLPOS,|%systmfldrs%
guicontrol,,OVDLDS,|Matching||%systmfldrs%
guicontrol,,DWNLPOS,|%systmfldrs%
guicontrol,,ESPLXMP,|%systmfldrs%%escommon%
if (NETDWNL = 1)
	{
		guicontrol,,SRCHLOCDDL,|:=:System List:=:||%systmfldrs%
	}
return

PlaylistInit:
Menu,Tray,Tip, Generating Playlist Database cache
guicontrol,disable,SVPLST
FileDelete,hashdb.ini
SB_SetText("...Initializing Playlist Database...")
plistfiles=
plistNamz=
Loop, %playlistLoc%\*.lpl
	{
		plistfiles .= A_LoopFileName . "|"
		SplitPath,A_LoopFileName,,,,plistNam
		plistNamz .= plistNam . "|"
		totn=
		pln= %A_LoopFileName%
		SB_SetText("...Initializing Playlist Database..." pln " parsing ")
		anum=
		fileread,tmplst,%A_LoopFileFullPath%
		PLineNum= 
		crcnum= 
		Loop, parse, tmplst,`n`r
			{
				if (A_LoopField = "")
					{
						continue
					}
				PLineNum+=1
				stringsplit, plprsplt, A_LoopField,"
				;"
				if (plprsplt2 = "path")
					{
						prpthn= %PLineNum%
						stringreplace,fnm,plprsplt4,\\,\,All
						if instr(nrmf,".zip#")or instr(nrmf,".7z#")
							{
								stringsplit,nrmfs,nrmf,#
								fnm= %nrmfs1%
							}
						splitpath,fnm,nrmfl,nrmfp,nrmx,nrmfn
					}
				if (plprsplt2 = "crc32")
					{
						stringsplit, HASHSPLIT, A_LoopField,|"
						;"
						crchsh= %HASHSPLIT4%
						FileAppend,%fnm%|%pln%|%prpthn%|%crchsh%`n,hashdb.ini
					}
			}
	}
SB_SetText("Playlist Database created")
guicontrol,enable,SVPLST
return

resetPlaylists:
plistfiles=
plistNamz=
Loop, %playlistLoc%\*.lpl,
	{
		plistfiles .= A_LoopFileName . "|"
		SplitPath,A_LoopFileName,,,,plistNam
		plistNamz .= plistNam . "|"
	}
return

AsocInit:
filecopy,Assignments.ini,Assignments.bak,1
filecopy,AppParams.ini,AppParams.bak,1
filecopy,sets\Assignments.set,Assignments.ini,1
filecopy,sets\AppParams.set,AppParams.ini,1
return

makePortable:
guicontrolget,Ppltxt,,PplTxt
splitpath,S_KeyDir,,,,,skeldrv
pcfgext= ini|cfg|config|conf|xml|settings|opt
stringsplit,pcfgxt,pcfgext,= | ""
recfgf= ovr.ini|hashdb.ini|Assignments.ini|AppParams.ini|Settings.ini|config.cfg
IfNotExist, Settings.ini
	{
		TGLPBL= 1
		goto, GenSetQ
	}
IfNotExist, config.cfg
	{
		TGLPBL= 1
		goto, GenSetQ
	}
skeloc=
oldskel=
IniRead, pcfgskel, Settings.ini,GLOBAL,working_config
SplitPath,pcfgskel,,oldskel
guicontrol,,PRBFND,|%oldskel%||%oldra%
if (A_ScriptDir <> oldskel)
	{
		gosub, SetPSK
		ifnotexist, %oldskel%
			{
				oldskel:= skeloc
			}
	}
if (skeldrv <> oldradrv)
	{
	}
Gui, Add, Button, x333 y24 w43 h21 vSETPSK gSetPSK, Select
Gui,Add,Edit, hwndEdtHndl107 x6 y0 w323 h21 vDisplRaTXT gDisplRaTXT, %reconfRA%
Gui,Add,Edit, hwndEdtHndl108 x6 y24 w323 h21 vDisplSkTXT gDisplSkTXT, %oldskel%
Gui, Add, Button, x4 y63 w29 h20 vSeekRep gSeekRep, File
Gui, Add, CheckBox, x37 y66 w118 h14 vTGLREP gTglRep, Replace instances of
Gui,Add,ComboBox, hwndCbxHndl104 x158 y59 w216 vPRBFND gPrbFnd disabled, |%oldra%\downloads||%oldskel%|%pradir%
Gui, Add, Text, x39 y86h16 vPToTxt disabled, To
Gui,Add,ComboBox, hwndCbxHndl105 x56 y82 w218 h21 vPRBREP gPrbRep disabled, |%pradir%\downloads||%oldskel%
Gui, Add, Checkbox, x278 y84 h23 vPplTxt gPortablocal disabled checked, localize
gui, font, Bold
Gui, Add, Button, x335 y82 w40 h20 vINJPORTABLE gInjPortable, OK
gui, font, normal
Gui, Add, CheckBox, x246 y46 h13 vMKPDTI gMKPDTI Checked, Create a desktop icon
Gui, Add, CheckBox, x6 y46 h13 vSETSYSTMP gSETSYSTMP, host cache_directory
Gui, Add, StatusBar, vPRBSTATUS, Feedback
Gui Show, w379 h131, PortableUtil
goto, setPortable
SetPSK:
gui,submit,nohide
skeloc=
FileSelectFolder, skeloc,,3,Select the portable skeletonkey folder
if (skeloc = "")
	{
		goto, QUITOUT
	}
stringright,efi,skeloc,2
stringLeft,efix,skeloc,2
if (efi = ":\")
	{
		skeloc= %efix%
	}	
guicontrol,,DisplSkTXT, %skeloc%
return

SETSYSTMP:
gui,submit,nohide
if (SETSYSTMP = 0)
{
	systemp= %RJSYSTEMS%\Netplay - Netplay
	return
}
FileDelete, %lpful%\tst.txt
FileAppend, tst,%lpful%\tst.txt
if (errorLevel <> 0)
	{
		guicontrol,,SETSYSTMP,0
		systemp= %RJSYSTEMS%\Netplay - Netplay
		SB_SetText("cache directory set to " lpful "")
		return
	}
systemp= %lpful%
return

DisplSkTXT:
gui,submit,nohide
guicontrolget,DisplSkTXT,,DisplSkTXT
return

Portablocal:
gui,submit,nohide
guicontrolget, Ppltxt,,PplTxt
return

InjPortable:
gui,submit,nohide
guicontrolget,Ppltxt,,PplTxt
guicontrolget,DisplRaTXT,,DisplRaTXT
guicontrolget,skeloc,,DisplSkTXT
guicontrolget,MKPDTI,,MKPDTI
if (MKPDTI = 1)
{
	FileDelete,%A_Desktop%\skeletonKey.lnk
	FileCreateShortcut, %skeloc%\skeletonKey.exe, %A_Desktop%\skeletonKey.lnk, %skeloc%\, , Portable skeletonKey, %skeloc%\site\key.ico
}
IniWrite, "%DisplRaTXT%", Settings.ini,GLOBAL,retroarch_location
IniWrite, "%skeloc%\config.cfg", Settings.ini,GLOBAL,working_config
IniWrite, "%systemp%", config.cfg,OPTIONS,cache_directory
if (TGLREP = 1)
	{
		guicontrolget,PRBFND,,PRBFND
		guicontrolget,PRBREP,,PRBREP
		if (PRBFND <> "")
			{
				Loop, Parse, recfgf,|
					{
						FileRead,REPB,%A_LoopField%
						FileMove,%A_LoopField%,%A_LoopField%.bak,1
						StringReplace,NREPB,REPB,%PRBFND%,%PRBREP%,All
						SB_SetText("Replacing in file " A_LoopField " ")
						FileAppend,%NREPB%,%A_LoopField%
					}
				aqr := Object()
				Loop, Parse, %pcfgxt0%
					{
						new= % (pcfgext%a_index%)
						if (pcfgext%a_index% <> "")
							{
								aqr.insert(new)
							}
					}
				cfgplst=
				Loop, Files, cfg\*.*,R
					{
						ext= %A_LoopFileExt%
						noapl=
						for k, v in aqr
							{
								extm:= v
								if (ext = extm)
									{
										noapl= 1
									}
							}
						if (noapl = 1)
							{
								cfgplst .= A_LoopFileFullPath . "|"
							}
					}
				Loop, Files, %RJEMUD%\*.*,R
					{
						ext= %A_LoopFileExt%
						noapl=
						for k, v in ar
							{
								extm:= v
								if (ext = extm)
									{
										noapl= 1
									}
							}
						if (noapl = 1)
							{
								cfgplst .= A_LoopFileFullPath . "|"
							}
					}
				if (Ppltxt = 1)
					{
						Loop, Files, %pradir%\playlists\*.lpl
							{
								subpl.= A_LoopFileFullPath . "|"
							}
						Loop, Parse, subpl,|
							{
								FileRead,REPB,%A_LoopField%
								SplitPath,A_LoopField,repfn
								SB_SetText("Replacing in playlist " A_LoopField  " ")
								FileMove,%A_LoopField%,%A_LoopField%.bak,1
								StringReplace,NREPB,REPB,%PRBFND%,downloads,All
								FileAppend,%NREPB%,%A_LoopField%
							}
					}
				if (Ppltxt = 0)
						{
							Loop, Files, %pradir%\playlists\*.lpl
								{
									cfgplst.= A_LoopFileFullPath . "|"
								}
						}
				Loop, Parse, cfgplst,|
					{
						FileRead,REPB,%A_LoopField%
						SplitPath,A_LoopField,repfn
						SB_SetText("Replacing in file " repfn "")
						FileMove,%A_LoopField%,%A_LoopField%.bak,1
						StringReplace,NREPB,REPB,%PRBFND%,%PRBREP%,All
						FileAppend,%NREPB%,%A_LoopField%
					}
		}
	}
msgbox,0,,SkeletonKey can now be launched from the portable device.,10
gui,1:destroy
gosub, QUITOUT
exitapp
return

SeekRep:
gui,submit,nohide
lplsrch=
Fileselectfile,lplsrch,3,,Select a playlist file or database
guicontrolget,PRBFND,,PRBFND
SB_SetText("...Searching...")
fullnm=
fullnm:= StrLen(PRBFND)
if (lplsrch = "")
	{
		return
	}
		repPl=
		arbdfn=
		fndrep=
		Loop, read, %lplsrch%
			{
				arbdfn+=1
				vok=
				newprfx := StrLen(A_LoopReadLine)
				if (PRBFND <> "")
					{
						ifinstring,A_LoopReadLine,%PRBFND%
							{
						StringGetPos,vok,A_LoopReadLine, %PRBFND%,
						if (vok >= 0)
							{
								vokk:= vok+fullnm
								newrepp=
								stringleft,newrepp,A_LoopReadLine,%vokk%
								if (newrepp <> fndrep)
									{
									msgbox,8196, Search string found,`n"%newrepp%" was detected.`nWould you like to migrate this to your current portable setup?
									IfMsgBox,Yes
										{
											repPl= 1
											SB_SetText(" " newrepp " found")
											guicontrol,,PRBFND,|%newrepp%||%PRBFND%|%oldra%|%oldskel%
											break
										}
									IfMsgBox,No
										{
											repPl= 0
											fndrep= %newrepp%
										}
									}
							}
						}
					}
				if (PRBFND = "")
					{
						ifinstring,A_LoopReadLine,\retroarch\downloads
							{
						StringGetPos,vok,A_LoopReadLine, \retroarch\downloads,
						if (vok >= 0)
							{
								vokk:= vok+20
								newrepp=
								stringleft,newrepp,A_LoopReadLine,%vokk%
								if (newrepp <> fndrep)
									{
									msgbox,8196, Retroarch Downloads Found,`n"%newrepp%" was detected.`nWould you like to migrate this to your current portable setup?
									IfMsgBox,Yes
										{
											repPl= 1
											SB_SetText(" " newrepp " found")
											guicontrol,,PRBFND,|%newrepp%||%PRBFND%|%oldra%|%oldskel%
											break
										}
									IfMsgBox,No
										{
											repPl= 0
											fndrep= %newrepp%
										}
									}
							}
						}
					}
			}
		Loop, Parse, recfgf,|
			{
		FileRead, RepSet, %A_LoopField%
		FileDelete, %A_LoopField%
		StringReplace, gvo, RepSet, %skeloc%, %skeloc%, All
		StringReplace, repout, gvo, %ralocsel%, %pradir%, All
		FileAppend, %repout%, %A_LoopField%
	}
return

TglRep:
gui,submit,nohide
guicontrolget,TGLREP,,TGLREP
guicontrol,disable,PToTxt
guicontrol,disable,PplTxt
guicontrol,disable,PRBREP
guicontrol,disable,PRBFND
if (TGLREP = 1)
	{
		guicontrol,enable,PToTxt
		guicontrol,enable,PplTxt
		guicontrol,enable,PRBREP
		guicontrol,enable,PRBFND
	}
return

MKPDTI:
gui,submit,nohide
return

PrbRep:
gui,submit,nohide
guicontrolget,PRBREP,,PRBREP
return

PrbFnd:
gui,submit,nohide
guicontrolget,PRBFND,,PRBFND
return

!LButton::
if (MINIMODE = 1)
	{
			If DoubleAlt
				{
					MouseGetPos,,,KDE_id
					; This message is mostly equivalent to WinMinimize,
					; but it avoids a bug with PSPad.
					PostMessage,0x112,0xf020,,,ahk_id %KDE_id%
					DoubleAlt := false
					return
				}
			MouseGetPos,KDE_X1,KDE_Y1,KDE_id
			WinGet,KDE_Win,MinMax,ahk_id %KDE_id%
			WinGet,KDE_Pid,PID,ahk_id %KDE_id%
			If KDE_Win
				return
			if (KDE_Pid <> CURPID)
				{
					return
				}
			; Get the initial window position.
			WinGetPos,KDE_WinX1,KDE_WinY1,,,ahk_id %KDE_id%
			Loop
				{
					GetKeyState,KDE_Button,LButton,P ; Break if button has been released.
					If KDE_Button = U
						break
					MouseGetPos,KDE_X2,KDE_Y2 ; Get the current mouse position.
					KDE_X2 -= KDE_X1 ; Obtain an offset from the initial mouse position.
					KDE_Y2 -= KDE_Y1
					KDE_WinX2 := (KDE_WinX1 + KDE_X2) ; Apply this offset to the window position.
					KDE_WinY2 := (KDE_WinY1 + KDE_Y2)
					WinMove,ahk_id %KDE_id%,,%KDE_WinX2%,%KDE_WinY2% ; Move the window to the new position.
				}
	}
return

~Alt::
DoubleAlt := A_PriorHotkey = "~Alt" AND A_TimeSincePriorHotkey < 400
Sleep 0
KeyWait Alt  ; This prevents the keyboard's auto-repeat feature from interfering.
return
#IfWinActive skeletonKey
esc::
gosub, MINIMODEOFF
msgbox, 8452,Exiting, Would you like to close skeletonKey?
ifmsgbox, yes
	{
		AHKsock_Close()
		gosub, QUITOUT
	}
ifmsgbox, no
	{
		DWNCNCL=
		return
	}
return

GuiSize:
   If (A_EventInfo != 1) {
      Gui, %A_Gui%:+LastFound
      WinSet, ReDraw
   }
return

QUITOUT:
AHKsock_Close()
Process, close, Invader.exe
Process, close, skeletonKey.exe
MenuHandler:
GuiEscape:
GuiClose:
/*  ;;[DEBUGOV]
CtlColors.Free()
*/  ;;[DEBUGOV]
Gui, Destroy
Exitapp
Return